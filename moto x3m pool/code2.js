!function(){var o;function X(n,t){var e=function(){return e.method.apply(e.scope,arguments)};return e.scope=n,e.method=t,e}window.js=js={_Boot:{}},window.zpp_nape=zpp_nape={shape:{},constraint:{},geom:{},phys:{},dynamics:{},callbacks:{},util:{},space:{}},window.sandbox=sandbox={},window.nape=nape={shape:{},constraint:{},geom:{},phys:{},dynamics:{},callbacks:{},space:{},util:{}};var a=function(){};a.__name__=["Reflect"],a.field=function(n,t){try{return n[t]}catch(n){return null}},a.fields=function(n){var t=[];if(null!=n){var e,i=Object.prototype.hasOwnProperty;for(e in n)"__id__"!=e&&"hx__closures__"!=e&&i.call(n,e)&&t.push(e)}return t},a.copy=function(n){for(var t={},e=0,i=a.fields(n);e<i.length;){var p=i[e];++e,t[p]=a.field(n,p)}return t},a.prototype.__class__=a;var i=function(){};i.__name__=["Std"],i.string=function(n){return D.__string_rec(n,"")},i.prototype.__class__=i;var n=function(){};n.__name__=["StringTools"],n.hex=function(n,t){for(var e="";e="0123456789ABCDEF".charAt(15&n)+e,0<(n>>>=4););if(null!=t)for(;e.length<t;)e="0"+e;return e},n.prototype.__class__=n;var p=js._Boot.HaxeError=function(n){Error.call(this),this.val=n,this.message=String(n),Error.captureStackTrace&&Error.captureStackTrace(this,p)};p.__name__=["js","_Boot","HaxeError"],p.__super__=Error,p.prototype=Object.create(Error.prototype),p.wrap=function(n){return n instanceof Error?n:new p(n)},p.prototype.val=null,p.prototype.__class__=p;var D=js.Boot=function(){};D.__name__=["js","Boot"],D.getClass=function(n){if(n instanceof Array&&null==n.__enum__)return Array;var t=n.__class__;if(null!=t)return t;n=D.__nativeClassName(n);return null!=n?D.__resolveNativeClass(n):null},D.__string_rec=function(n,t){if(null==n)return"null";if(5<=t.length)return"<...>";var e,i=typeof n;switch("function"==i&&(n.__name__||n.__ename__)&&(i="object"),i){case"function":return"<function>";case"object":if(n instanceof Array){if(n.__enum__){if(2==n.length)return n[0];var p=n[0]+"(";t+="\t";for(var l=2,r=n.length;l<r;){var o=l++;p+=2!=o?","+D.__string_rec(n[o],t):D.__string_rec(n[o],t)}return p+")"}var a="[";t+="\t";for(var s=0,_=n.length;s<_;){var h=s++;a+=(0<h?",":"")+D.__string_rec(n[h],t)}return a+="]"}try{e=n.toString}catch(n){return"???"}if(null!=e&&e!=Object.toString&&"function"==typeof e){var u=n.toString();if("[object Object]"!=u)return u}var x=null,d="{\n";t+="\t";var y=null!=n.hasOwnProperty;for(x in n)y&&!n.hasOwnProperty(x)||"prototype"!=x&&"__class__"!=x&&"__super__"!=x&&"__interfaces__"!=x&&"__properties__"!=x&&(2!=d.length&&(d+=", \n"),d+=t+x+" : "+D.__string_rec(n[x],t));return d+="\n"+(t=t.substring(1))+"}";case"string":return n;default:return String(n)}},D.__interfLoop=function(n,t){if(null==n)return!1;if(n==t)return!0;var e=n.__interfaces__;if(null!=e)for(var i=0,p=e.length;i<p;){var l=e[i++];if(l==t||D.__interfLoop(l,t))return!0}return D.__interfLoop(n.__super__,t)},D.__instanceof=function(n,t){if(null==t)return!1;switch(t){case Array:return n instanceof Array&&null==n.__enum__;case hp:return"boolean"==typeof n;case sp:return!0;case _p:return"number"==typeof n;case ap:return"number"==typeof n&&(0|n)===n;case String:return"string"==typeof n;default:if(null==n)return!1;if("function"==typeof t){if(n instanceof t)return!0;if(D.__interfLoop(D.getClass(n),t))return!0}else if("object"==typeof t&&D.__isNativeObj(t)&&n instanceof t)return!0;return t==up&&null!=n.__name__?!0:t==xp&&null!=n.__ename__||n.__enum__==t}},D.__nativeClassName=function(n){n=D.__toStr.call(n).slice(8,-1);return"Object"==n||"Function"==n||"Math"==n||"JSON"==n?null:n},D.__isNativeObj=function(n){return null!=D.__nativeClassName(n)},D.__resolveNativeClass=function(n){return $global[n]},D.prototype.__class__=D;var jp=nape.Config=function(){};jp.__name__=["nape","Config"],jp.prototype.__class__=jp;var t=nape.callbacks.Callback=function(){this.zpp_inner=null};t.__name__=["nape","callbacks","Callback"],t.prototype.zpp_inner=null,t.prototype.get_event=function(){return An.events[this.zpp_inner.event]},t.prototype.get_listener=function(){return this.zpp_inner.listener.outer},t.prototype.toString=function(){return""},Object.defineProperty(t.prototype,"event",{get:t.prototype.get_event}),Object.defineProperty(t.prototype,"listener",{get:t.prototype.get_listener}),t.prototype.__class__=t;var e=nape.callbacks.BodyCallback=function(){t.call(this)};e.__name__=["nape","callbacks","BodyCallback"],e.__super__=t,e.prototype=Object.create(t.prototype),e.prototype.get_body=function(){return this.zpp_inner.body.outer},e.prototype.toString=function(){var n="Cb:"+["WAKE","SLEEP"][this.zpp_inner.event-2];return n+=":"+this.zpp_inner.body.outer.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(e.prototype,"body",{get:e.prototype.get_body}),e.prototype.__class__=e;var s=nape.callbacks.Listener=function(){this.zpp_inner=null};s.__name__=["nape","callbacks","Listener"],s.prototype.zpp_inner=null,s.prototype.get_type=function(){return An.types[this.zpp_inner.type]},s.prototype.get_event=function(){return An.events[this.zpp_inner.event]},s.prototype.set_event=function(n){return An.events[this.zpp_inner.event]!=n&&(null==Yi.CbEvent_BEGIN&&(Yi.internal=!0,Yi.CbEvent_BEGIN=new _,Yi.internal=!1),n=n==Yi.CbEvent_BEGIN?0:(null==Yi.CbEvent_ONGOING&&(Yi.internal=!0,Yi.CbEvent_ONGOING=new _,Yi.internal=!1),n==Yi.CbEvent_ONGOING?6:(null==Yi.CbEvent_END&&(Yi.internal=!0,Yi.CbEvent_END=new _,Yi.internal=!1),n==Yi.CbEvent_END?1:(null==Yi.CbEvent_SLEEP&&(Yi.internal=!0,Yi.CbEvent_SLEEP=new _,Yi.internal=!1),n==Yi.CbEvent_SLEEP?3:(null==Yi.CbEvent_WAKE&&(Yi.internal=!0,Yi.CbEvent_WAKE=new _,Yi.internal=!1),n==Yi.CbEvent_WAKE?2:(null==Yi.CbEvent_PRE&&(Yi.internal=!0,Yi.CbEvent_PRE=new _,Yi.internal=!1),n==Yi.CbEvent_PRE?5:4))))),this.zpp_inner.swapEvent(n)),An.events[this.zpp_inner.event]},s.prototype.get_precedence=function(){return this.zpp_inner.precedence},s.prototype.set_precedence=function(n){return this.zpp_inner.precedence!=n&&(this.zpp_inner.precedence=n,this.zpp_inner.invalidate_precedence()),this.zpp_inner.precedence},s.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},s.prototype.set_space=function(n){return(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(this),null!=n?(n=n.zpp_inner.wrap_listeners).zpp_inner.reverse_flag?n.push(this):n.unshift(this):this.zpp_inner.space=null),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},s.prototype.toString=function(){var n=["BEGIN","END","WAKE","SLEEP","BREAK","PRE","ONGOING"][this.zpp_inner.event];if(0==this.zpp_inner.type)return"BodyListener{"+n+"::"+i.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}";if(1==this.zpp_inner.type)return"ConstraintListener{"+n+"::"+i.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}";var t,e=this.zpp_inner.interaction;switch(e.itype){case 1:t="COLLISION";break;case 2:t="SENSOR";break;case 4:t="FLUID";break;default:t="ALL"}return(2==this.zpp_inner.type?"InteractionListener{"+n+"#"+t+"::"+i.string(e.outer_zni.zpp_inner_zn.options1.outer)+":"+i.string(e.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+t+"::"+i.string(e.outer_znp.zpp_inner_zn.options1.outer)+":"+i.string(e.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},Object.defineProperty(s.prototype,"type",{get:s.prototype.get_type}),Object.defineProperty(s.prototype,"event",{get:s.prototype.get_event,set:s.prototype.set_event}),Object.defineProperty(s.prototype,"precedence",{get:s.prototype.get_precedence,set:s.prototype.set_precedence}),Object.defineProperty(s.prototype,"space",{get:s.prototype.get_space,set:s.prototype.set_space}),s.prototype.__class__=s;var l=nape.callbacks.BodyListener=function(n,t,e,i){null==i&&(i=0),this.zpp_inner_zn=null,s.call(this);var p=-1;null==Yi.CbEvent_WAKE&&(Yi.internal=!0,Yi.CbEvent_WAKE=new _,Yi.internal=!1),n==Yi.CbEvent_WAKE?p=2:(null==Yi.CbEvent_SLEEP&&(Yi.internal=!0,Yi.CbEvent_SLEEP=new _,Yi.internal=!1),n==Yi.CbEvent_SLEEP&&(p=3)),this.zpp_inner_zn=new jn(Tn.argument(t),p,e),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner.precedence=i};l.__name__=["nape","callbacks","BodyListener"],l.__super__=s,l.prototype=Object.create(s.prototype),l.prototype.zpp_inner_zn=null,l.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},l.prototype.set_options=function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},l.prototype.get_handler=function(){return this.zpp_inner_zn.handler},l.prototype.set_handler=function(n){return this.zpp_inner_zn.handler=n,this.zpp_inner_zn.handler},Object.defineProperty(l.prototype,"options",{get:l.prototype.get_options,set:l.prototype.set_options}),Object.defineProperty(l.prototype,"handler",{get:l.prototype.get_handler,set:l.prototype.set_handler}),l.prototype.__class__=l;var _=nape.callbacks.CbEvent=function(){};_.__name__=["nape","callbacks","CbEvent"],_.BEGIN=null,_.get_BEGIN=function(){return null==Yi.CbEvent_BEGIN&&(Yi.internal=!0,Yi.CbEvent_BEGIN=new _,Yi.internal=!1),Yi.CbEvent_BEGIN},_.ONGOING=null,_.get_ONGOING=function(){return null==Yi.CbEvent_ONGOING&&(Yi.internal=!0,Yi.CbEvent_ONGOING=new _,Yi.internal=!1),Yi.CbEvent_ONGOING},_.END=null,_.get_END=function(){return null==Yi.CbEvent_END&&(Yi.internal=!0,Yi.CbEvent_END=new _,Yi.internal=!1),Yi.CbEvent_END},_.WAKE=null,_.get_WAKE=function(){return null==Yi.CbEvent_WAKE&&(Yi.internal=!0,Yi.CbEvent_WAKE=new _,Yi.internal=!1),Yi.CbEvent_WAKE},_.SLEEP=null,_.get_SLEEP=function(){return null==Yi.CbEvent_SLEEP&&(Yi.internal=!0,Yi.CbEvent_SLEEP=new _,Yi.internal=!1),Yi.CbEvent_SLEEP},_.BREAK=null,_.get_BREAK=function(){return null==Yi.CbEvent_BREAK&&(Yi.internal=!0,Yi.CbEvent_BREAK=new _,Yi.internal=!1),Yi.CbEvent_BREAK},_.PRE=null,_.get_PRE=function(){return null==Yi.CbEvent_PRE&&(Yi.internal=!0,Yi.CbEvent_PRE=new _,Yi.internal=!1),Yi.CbEvent_PRE},_.prototype.toString=function(){return null==Yi.CbEvent_PRE&&(Yi.internal=!0,Yi.CbEvent_PRE=new _,Yi.internal=!1),this==Yi.CbEvent_PRE?"PRE":(null==Yi.CbEvent_BEGIN&&(Yi.internal=!0,Yi.CbEvent_BEGIN=new _,Yi.internal=!1),this==Yi.CbEvent_BEGIN?"BEGIN":(null==Yi.CbEvent_ONGOING&&(Yi.internal=!0,Yi.CbEvent_ONGOING=new _,Yi.internal=!1),this==Yi.CbEvent_ONGOING?"ONGOING":(null==Yi.CbEvent_END&&(Yi.internal=!0,Yi.CbEvent_END=new _,Yi.internal=!1),this==Yi.CbEvent_END?"END":(null==Yi.CbEvent_WAKE&&(Yi.internal=!0,Yi.CbEvent_WAKE=new _,Yi.internal=!1),this==Yi.CbEvent_WAKE?"WAKE":(null==Yi.CbEvent_SLEEP&&(Yi.internal=!0,Yi.CbEvent_SLEEP=new _,Yi.internal=!1),this==Yi.CbEvent_SLEEP?"SLEEP":(null==Yi.CbEvent_BREAK&&(Yi.internal=!0,Yi.CbEvent_BREAK=new _,Yi.internal=!1),this==Yi.CbEvent_BREAK?"BREAK":""))))))},Object.defineProperty(_,"BEGIN",{get:_.get_BEGIN}),Object.defineProperty(_,"ONGOING",{get:_.get_ONGOING}),Object.defineProperty(_,"END",{get:_.get_END}),Object.defineProperty(_,"WAKE",{get:_.get_WAKE}),Object.defineProperty(_,"SLEEP",{get:_.get_SLEEP}),Object.defineProperty(_,"BREAK",{get:_.get_BREAK}),Object.defineProperty(_,"PRE",{get:_.get_PRE}),_.prototype.__class__=_;var h=nape.callbacks.CbType=function(){this.zpp_inner=null,this.zpp_inner=new Sn,this.zpp_inner.outer=this};h.__name__=["nape","callbacks","CbType"],h.ANY_BODY=null,h.get_ANY_BODY=function(){return Sn.ANY_BODY},h.ANY_CONSTRAINT=null,h.get_ANY_CONSTRAINT=function(){return Sn.ANY_CONSTRAINT},h.ANY_SHAPE=null,h.get_ANY_SHAPE=function(){return Sn.ANY_SHAPE},h.ANY_COMPOUND=null,h.get_ANY_COMPOUND=function(){return Sn.ANY_COMPOUND},h.prototype.zpp_inner=null,h.prototype.get_id=function(){return this.zpp_inner.id},h.prototype.including=function(n){return new m(this).including(n)},h.prototype.excluding=function(n){return new m(this).excluding(n)},h.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},h.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=Mi.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},h.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=gi.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},h.prototype.toString=function(){return this==Sn.ANY_BODY?"ANY_BODY":this==Sn.ANY_SHAPE?"ANY_SHAPE":this==Sn.ANY_COMPOUND?"ANY_COMPOUND":this==Sn.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},Object.defineProperty(h,"ANY_BODY",{get:h.get_ANY_BODY}),Object.defineProperty(h,"ANY_CONSTRAINT",{get:h.get_ANY_CONSTRAINT}),Object.defineProperty(h,"ANY_SHAPE",{get:h.get_ANY_SHAPE}),Object.defineProperty(h,"ANY_COMPOUND",{get:h.get_ANY_COMPOUND}),Object.defineProperty(h.prototype,"id",{get:h.prototype.get_id}),Object.defineProperty(h.prototype,"userData",{get:h.prototype.get_userData}),Object.defineProperty(h.prototype,"interactors",{get:h.prototype.get_interactors}),Object.defineProperty(h.prototype,"constraints",{get:h.prototype.get_constraints}),h.prototype.__class__=h;var qn=nape.callbacks.CbTypeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};qn.__name__=["nape","callbacks","CbTypeIterator"],qn.get=function(n){var t,e=null==qn.zpp_pool?(Oi.internal=!0,t=new qn,Oi.internal=!1,t):(e=qn.zpp_pool,qn.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},qn.prototype.zpp_inner=null,qn.prototype.zpp_i=null,qn.prototype.zpp_critical=null,qn.prototype.zpp_next=null,qn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=qn.zpp_pool,(qn.zpp_pool=this).zpp_inner=null,!1)},qn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},qn.prototype.__class__=qn;var u=nape.callbacks.CbTypeList=function(){this.zpp_inner=null,this.zpp_inner=new Oi,this.zpp_inner.outer=this};u.__name__=["nape","callbacks","CbTypeList"],u.fromArray=function(n){for(var t=new u,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},u.prototype.zpp_inner=null,u.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},u.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},u.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},u.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},u.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},u.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer},u.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer},u.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},u.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},u.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},u.prototype.empty=function(){return null==this.zpp_inner.inner.head},u.prototype.iterator=function(){return this.zpp_inner.valmod(),qn.get(this)},u.prototype.copy=function(n){null==n&&(n=!1);var t=new u;this.zpp_inner.valmod();for(var e=qn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=qn.zpp_pool,(qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},u.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=qn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=qn.zpp_pool,(qn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},u.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=qn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=qn.zpp_pool,(qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},u.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=qn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=qn.zpp_pool,(qn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=qn.zpp_pool,(qn.zpp_pool=t).zpp_inner=null;break}}return this},u.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(u.prototype,"length",{get:u.prototype.get_length}),u.prototype.__class__=u;var r=nape.callbacks.ConstraintCallback=function(){t.call(this)};r.__name__=["nape","callbacks","ConstraintCallback"],r.__super__=t,r.prototype=Object.create(t.prototype),r.prototype.get_constraint=function(){return this.zpp_inner.constraint.outer},r.prototype.toString=function(){var n="Cb:"+["WAKE","SLEEP","BREAK"][this.zpp_inner.event-2];return n+=":"+this.zpp_inner.constraint.outer.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(r.prototype,"constraint",{get:r.prototype.get_constraint}),r.prototype.__class__=r;var x=nape.callbacks.ConstraintListener=function(n,t,e,i){null==i&&(i=0),this.zpp_inner_zn=null,s.call(this);var p=-1;null==Yi.CbEvent_WAKE&&(Yi.internal=!0,Yi.CbEvent_WAKE=new _,Yi.internal=!1),n==Yi.CbEvent_WAKE?p=2:(null==Yi.CbEvent_SLEEP&&(Yi.internal=!0,Yi.CbEvent_SLEEP=new _,Yi.internal=!1),n==Yi.CbEvent_SLEEP?p=3:(null==Yi.CbEvent_BREAK&&(Yi.internal=!0,Yi.CbEvent_BREAK=new _,Yi.internal=!1),n==Yi.CbEvent_BREAK&&(p=4))),this.zpp_inner_zn=new En(Tn.argument(t),p,e),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner.precedence=i};x.__name__=["nape","callbacks","ConstraintListener"],x.__super__=s,x.prototype=Object.create(s.prototype),x.prototype.zpp_inner_zn=null,x.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},x.prototype.set_options=function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},x.prototype.get_handler=function(){return this.zpp_inner_zn.handler},x.prototype.set_handler=function(n){return this.zpp_inner_zn.handler=n,this.zpp_inner_zn.handler},Object.defineProperty(x.prototype,"options",{get:x.prototype.get_options,set:x.prototype.set_options}),Object.defineProperty(x.prototype,"handler",{get:x.prototype.get_handler,set:x.prototype.set_handler}),x.prototype.__class__=x;var d=nape.callbacks.InteractionCallback=function(){t.call(this)};d.__name__=["nape","callbacks","InteractionCallback"],d.__super__=t,d.prototype=Object.create(t.prototype),d.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},d.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},d.prototype.get_arbiters=function(){return this.zpp_inner.wrap_arbiters},d.prototype.toString=function(){var n="Cb:"+["BEGIN","END","","","","","ONGOING"][this.zpp_inner.event];return n+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),n+=" : "+this.zpp_inner.wrap_arbiters.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(d.prototype,"int1",{get:d.prototype.get_int1}),Object.defineProperty(d.prototype,"int2",{get:d.prototype.get_int2}),Object.defineProperty(d.prototype,"arbiters",{get:d.prototype.get_arbiters}),d.prototype.__class__=d;var y=nape.callbacks.InteractionListener=function(n,t,e,i,p,l){null==l&&(l=0),this.zpp_inner_zn=null,s.call(this);var r=-1;null==Yi.CbEvent_BEGIN&&(Yi.internal=!0,Yi.CbEvent_BEGIN=new _,Yi.internal=!1),n==Yi.CbEvent_BEGIN?r=0:(null==Yi.CbEvent_END&&(Yi.internal=!0,Yi.CbEvent_END=new _,Yi.internal=!1),n==Yi.CbEvent_END?r=1:(null==Yi.CbEvent_ONGOING&&(Yi.internal=!0,Yi.CbEvent_ONGOING=new _,Yi.internal=!1),n==Yi.CbEvent_ONGOING&&(r=6))),this.zpp_inner_zn=new Dt(Tn.argument(e),Tn.argument(i),r,2),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_zni=this).zpp_inner.precedence=l,this.zpp_inner_zn.handleri=p;p=this.zpp_inner_zn.itype,p=1==p?(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION):2==p?(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR):4==p?(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID):7==p?(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY):null;p!=t&&(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),o=t==Yi.InteractionType_COLLISION?1:(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),t==Yi.InteractionType_SENSOR?2:(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),t==Yi.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=o);var o=this.zpp_inner_zn.itype;1==o?null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1):2==o?null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1):4==o?null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1):7==o&&null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1)};y.__name__=["nape","callbacks","InteractionListener"],y.__super__=s,y.prototype=Object.create(s.prototype),y.prototype.zpp_inner_zn=null,y.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},y.prototype.set_options1=function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},y.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},y.prototype.set_options2=function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},y.prototype.get_interactionType=function(){var n=this.zpp_inner_zn.itype;return 1==n?(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION):2==n?(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR):4==n?(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID):7==n?(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY):null},y.prototype.set_interactionType=function(n){var t=this.zpp_inner_zn.itype,t=1==t?(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION):2==t?(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR):4==t?(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID):7==t?(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY):null;t!=n&&(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),e=n==Yi.InteractionType_COLLISION?1:(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),n==Yi.InteractionType_SENSOR?2:(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),n==Yi.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=e);var e=this.zpp_inner_zn.itype;return 1==e?(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION):2==e?(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR):4==e?(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID):7==e?(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY):null},y.prototype.get_handler=function(){return this.zpp_inner_zn.handleri},y.prototype.set_handler=function(n){return this.zpp_inner_zn.handleri=n,this.zpp_inner_zn.handleri},y.prototype.get_allowSleepingCallbacks=function(){return this.zpp_inner_zn.allowSleepingCallbacks},y.prototype.set_allowSleepingCallbacks=function(n){return this.zpp_inner_zn.allowSleepingCallbacks=n,this.zpp_inner_zn.allowSleepingCallbacks},Object.defineProperty(y.prototype,"options1",{get:y.prototype.get_options1,set:y.prototype.set_options1}),Object.defineProperty(y.prototype,"options2",{get:y.prototype.get_options2,set:y.prototype.set_options2}),Object.defineProperty(y.prototype,"interactionType",{get:y.prototype.get_interactionType,set:y.prototype.set_interactionType}),Object.defineProperty(y.prototype,"handler",{get:y.prototype.get_handler,set:y.prototype.set_handler}),Object.defineProperty(y.prototype,"allowSleepingCallbacks",{get:y.prototype.get_allowSleepingCallbacks,set:y.prototype.set_allowSleepingCallbacks}),y.prototype.__class__=y;var z=nape.callbacks.InteractionType=function(){};z.__name__=["nape","callbacks","InteractionType"],z.COLLISION=null,z.get_COLLISION=function(){return null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION},z.SENSOR=null,z.get_SENSOR=function(){return null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR},z.FLUID=null,z.get_FLUID=function(){return null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID},z.ANY=null,z.get_ANY=function(){return null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY},z.prototype.toString=function(){return null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),this==Yi.InteractionType_COLLISION?"COLLISION":(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),this==Yi.InteractionType_SENSOR?"SENSOR":(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),this==Yi.InteractionType_FLUID?"FLUID":(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),this==Yi.InteractionType_ANY?"ANY":"")))},Object.defineProperty(z,"COLLISION",{get:z.get_COLLISION}),Object.defineProperty(z,"SENSOR",{get:z.get_SENSOR}),Object.defineProperty(z,"FLUID",{get:z.get_FLUID}),Object.defineProperty(z,"ANY",{get:z.get_ANY}),z.prototype.__class__=z;var Un=nape.callbacks.ListenerIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Un.__name__=["nape","callbacks","ListenerIterator"],Un.get=function(n){var t,e=null==Un.zpp_pool?(ki.internal=!0,t=new Un,ki.internal=!1,t):(e=Un.zpp_pool,Un.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Un.prototype.zpp_inner=null,Un.prototype.zpp_i=null,Un.prototype.zpp_critical=null,Un.prototype.zpp_next=null,Un.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Un.zpp_pool,(Un.zpp_pool=this).zpp_inner=null,!1)},Un.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Un.prototype.__class__=Un;var c=nape.callbacks.ListenerList=function(){this.zpp_inner=null,this.zpp_inner=new ki,this.zpp_inner.outer=this};c.__name__=["nape","callbacks","ListenerList"],c.fromArray=function(n){for(var t=new c,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},c.prototype.zpp_inner=null,c.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},c.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},c.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},c.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},c.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},c.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer},c.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer},c.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},c.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},c.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},c.prototype.empty=function(){return null==this.zpp_inner.inner.head},c.prototype.iterator=function(){return this.zpp_inner.valmod(),Un.get(this)},c.prototype.copy=function(n){null==n&&(n=!1);var t=new c;this.zpp_inner.valmod();for(var e=Un.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Un.zpp_pool,(Un.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},c.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Un.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Un.zpp_pool,(Un.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},c.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Un.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Un.zpp_pool,(Un.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},c.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Un.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Un.zpp_pool,(Un.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Un.zpp_pool,(Un.zpp_pool=t).zpp_inner=null;break}}return this},c.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(c.prototype,"length",{get:c.prototype.get_length}),c.prototype.__class__=c;var v=nape.callbacks.ListenerType=function(){};v.__name__=["nape","callbacks","ListenerType"],v.BODY=null,v.get_BODY=function(){return null==Yi.ListenerType_BODY&&(Yi.internal=!0,Yi.ListenerType_BODY=new v,Yi.internal=!1),Yi.ListenerType_BODY},v.CONSTRAINT=null,v.get_CONSTRAINT=function(){return null==Yi.ListenerType_CONSTRAINT&&(Yi.internal=!0,Yi.ListenerType_CONSTRAINT=new v,Yi.internal=!1),Yi.ListenerType_CONSTRAINT},v.INTERACTION=null,v.get_INTERACTION=function(){return null==Yi.ListenerType_INTERACTION&&(Yi.internal=!0,Yi.ListenerType_INTERACTION=new v,Yi.internal=!1),Yi.ListenerType_INTERACTION},v.PRE=null,v.get_PRE=function(){return null==Yi.ListenerType_PRE&&(Yi.internal=!0,Yi.ListenerType_PRE=new v,Yi.internal=!1),Yi.ListenerType_PRE},v.prototype.toString=function(){return null==Yi.ListenerType_BODY&&(Yi.internal=!0,Yi.ListenerType_BODY=new v,Yi.internal=!1),this==Yi.ListenerType_BODY?"BODY":(null==Yi.ListenerType_CONSTRAINT&&(Yi.internal=!0,Yi.ListenerType_CONSTRAINT=new v,Yi.internal=!1),this==Yi.ListenerType_CONSTRAINT?"CONSTRAINT":(null==Yi.ListenerType_INTERACTION&&(Yi.internal=!0,Yi.ListenerType_INTERACTION=new v,Yi.internal=!1),this==Yi.ListenerType_INTERACTION?"INTERACTION":(null==Yi.ListenerType_PRE&&(Yi.internal=!0,Yi.ListenerType_PRE=new v,Yi.internal=!1),this==Yi.ListenerType_PRE?"PRE":"")))},Object.defineProperty(v,"BODY",{get:v.get_BODY}),Object.defineProperty(v,"CONSTRAINT",{get:v.get_CONSTRAINT}),Object.defineProperty(v,"INTERACTION",{get:v.get_INTERACTION}),Object.defineProperty(v,"PRE",{get:v.get_PRE}),v.prototype.__class__=v;var m=nape.callbacks.OptionType=function(n,t){this.zpp_inner=null,this.zpp_inner=new Tn,this.zpp_inner.outer=this,null!=n&&this.including(n),null!=t&&this.excluding(t)};m.__name__=["nape","callbacks","OptionType"],m.prototype.zpp_inner=null,m.prototype.get_includes=function(){return null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes(),this.zpp_inner.wrap_includes},m.prototype.get_excludes=function(){return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),this.zpp_inner.wrap_excludes},m.prototype.including=function(n){return this.zpp_inner.append(this.zpp_inner.includes,n),this},m.prototype.excluding=function(n){return this.zpp_inner.append(this.zpp_inner.excludes,n),this},m.prototype.toString=function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var n=this.zpp_inner.wrap_includes.toString();return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),"@{"+n+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},Object.defineProperty(m.prototype,"includes",{get:m.prototype.get_includes}),Object.defineProperty(m.prototype,"excludes",{get:m.prototype.get_excludes}),m.prototype.__class__=m;var f=nape.callbacks.PreCallback=function(){t.call(this)};f.__name__=["nape","callbacks","PreCallback"],f.__super__=t,f.prototype=Object.create(t.prototype),f.prototype.get_arbiter=function(){return this.zpp_inner.pre_arbiter.wrapper()},f.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},f.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},f.prototype.get_swapped=function(){return this.zpp_inner.pre_swapped},f.prototype.toString=function(){var n="Cb:PRE::"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString();return n+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString(),n+=" : listnener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(f.prototype,"arbiter",{get:f.prototype.get_arbiter}),Object.defineProperty(f.prototype,"int1",{get:f.prototype.get_int1}),Object.defineProperty(f.prototype,"int2",{get:f.prototype.get_int2}),Object.defineProperty(f.prototype,"swapped",{get:f.prototype.get_swapped}),f.prototype.__class__=f;var Ui=nape.callbacks.PreFlag=function(){};Ui.__name__=["nape","callbacks","PreFlag"],Ui.ACCEPT=null,Ui.get_ACCEPT=function(){return null==Yi.PreFlag_ACCEPT&&(Yi.internal=!0,Yi.PreFlag_ACCEPT=new Ui,Yi.internal=!1),Yi.PreFlag_ACCEPT},Ui.IGNORE=null,Ui.get_IGNORE=function(){return null==Yi.PreFlag_IGNORE&&(Yi.internal=!0,Yi.PreFlag_IGNORE=new Ui,Yi.internal=!1),Yi.PreFlag_IGNORE},Ui.ACCEPT_ONCE=null,Ui.get_ACCEPT_ONCE=function(){return null==Yi.PreFlag_ACCEPT_ONCE&&(Yi.internal=!0,Yi.PreFlag_ACCEPT_ONCE=new Ui,Yi.internal=!1),Yi.PreFlag_ACCEPT_ONCE},Ui.IGNORE_ONCE=null,Ui.get_IGNORE_ONCE=function(){return null==Yi.PreFlag_IGNORE_ONCE&&(Yi.internal=!0,Yi.PreFlag_IGNORE_ONCE=new Ui,Yi.internal=!1),Yi.PreFlag_IGNORE_ONCE},Ui.prototype.toString=function(){return null==Yi.PreFlag_ACCEPT&&(Yi.internal=!0,Yi.PreFlag_ACCEPT=new Ui,Yi.internal=!1),this==Yi.PreFlag_ACCEPT?"ACCEPT":(null==Yi.PreFlag_IGNORE&&(Yi.internal=!0,Yi.PreFlag_IGNORE=new Ui,Yi.internal=!1),this==Yi.PreFlag_IGNORE?"IGNORE":(null==Yi.PreFlag_ACCEPT_ONCE&&(Yi.internal=!0,Yi.PreFlag_ACCEPT_ONCE=new Ui,Yi.internal=!1),this==Yi.PreFlag_ACCEPT_ONCE?"ACCEPT_ONCE":(null==Yi.PreFlag_IGNORE_ONCE&&(Yi.internal=!0,Yi.PreFlag_IGNORE_ONCE=new Ui,Yi.internal=!1),this==Yi.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")))},Object.defineProperty(Ui,"ACCEPT",{get:Ui.get_ACCEPT}),Object.defineProperty(Ui,"IGNORE",{get:Ui.get_IGNORE}),Object.defineProperty(Ui,"ACCEPT_ONCE",{get:Ui.get_ACCEPT_ONCE}),Object.defineProperty(Ui,"IGNORE_ONCE",{get:Ui.get_IGNORE_ONCE}),Ui.prototype.__class__=Ui,(l=nape.callbacks.PreListener=function(n,t,e,i,p,l){null==l&&(l=!1),null==p&&(p=0),this.zpp_inner_zn=null,s.call(this),this.zpp_inner_zn=new Dt(Tn.argument(t),Tn.argument(e),5,3),this.zpp_inner=this.zpp_inner_zn,((this.zpp_inner.outer=this).zpp_inner_zn.outer_znp=this).zpp_inner.precedence=p,this.zpp_inner_zn.pure=l,this.zpp_inner_zn.handlerp=i;i=this.zpp_inner_zn.itype,i=1==i?(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION):2==i?(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR):4==i?(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID):7==i?(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY):null;i!=n&&(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),r=n==Yi.InteractionType_COLLISION?1:(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),n==Yi.InteractionType_SENSOR?2:(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),n==Yi.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=r);var r=this.zpp_inner_zn.itype;1==r?null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1):2==r?null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1):4==r?null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1):7==r&&null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1)}).__name__=["nape","callbacks","PreListener"],l.__super__=s,l.prototype=Object.create(s.prototype),l.prototype.zpp_inner_zn=null,l.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},l.prototype.set_options1=function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},l.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},l.prototype.set_options2=function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},l.prototype.get_handler=function(){return this.zpp_inner_zn.handlerp},l.prototype.set_handler=function(n){return this.zpp_inner_zn.handlerp=n,this.zpp_inner_zn.wake(),this.zpp_inner_zn.handlerp},l.prototype.get_pure=function(){return this.zpp_inner_zn.pure},l.prototype.set_pure=function(n){return n||this.zpp_inner_zn.wake(),this.zpp_inner_zn.pure=n,this.zpp_inner_zn.pure},l.prototype.get_interactionType=function(){var n=this.zpp_inner_zn.itype;return 1==n?(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION):2==n?(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR):4==n?(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID):7==n?(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY):null},l.prototype.set_interactionType=function(n){var t=this.zpp_inner_zn.itype,t=1==t?(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION):2==t?(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR):4==t?(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID):7==t?(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY):null;t!=n&&(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),e=n==Yi.InteractionType_COLLISION?1:(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),n==Yi.InteractionType_SENSOR?2:(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),n==Yi.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=e);var e=this.zpp_inner_zn.itype;return 1==e?(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION):2==e?(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR):4==e?(null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID):7==e?(null==Yi.InteractionType_ANY&&(Yi.internal=!0,Yi.InteractionType_ANY=new z,Yi.internal=!1),Yi.InteractionType_ANY):null},Object.defineProperty(l.prototype,"options1",{get:l.prototype.get_options1,set:l.prototype.set_options1}),Object.defineProperty(l.prototype,"options2",{get:l.prototype.get_options2,set:l.prototype.set_options2}),Object.defineProperty(l.prototype,"handler",{get:l.prototype.get_handler,set:l.prototype.set_handler}),Object.defineProperty(l.prototype,"pure",{get:l.prototype.get_pure,set:l.prototype.set_pure}),Object.defineProperty(l.prototype,"interactionType",{get:l.prototype.get_interactionType,set:l.prototype.set_interactionType}),l.prototype.__class__=l;var b=nape.constraint.Constraint=function(){this.debugDraw=!0,this.zpp_inner.insert_cbtype(Sn.ANY_CONSTRAINT.zpp_inner)};b.__name__=["nape","constraint","Constraint"],b.prototype.zpp_inner=null,b.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},b.prototype.debugDraw=null,b.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},b.prototype.set_compound=function(n){return(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(this),null!=n&&((n=n.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?n.push(this):n.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},b.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},b.prototype.set_space=function(n){return(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(this),null!=n?(n=n.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?n.push(this):n.unshift(this):this.zpp_inner.space=null),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},b.prototype.get_isSleeping=function(){return this.zpp_inner.component.sleeping},b.prototype.get_active=function(){return this.zpp_inner.active},b.prototype.set_active=function(n){return this.zpp_inner.active!=n&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),n?(this.zpp_inner.active=n,this.zpp_inner.activate(),null!=this.zpp_inner.space&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.sleeping=!0),this.zpp_inner.space.wake_constraint(this.zpp_inner,!0))):(null!=this.zpp_inner.space&&(this.zpp_inner.wake(),this.zpp_inner.space.live_constraints.remove(this.zpp_inner)),this.zpp_inner.active=n,this.zpp_inner.deactivate())),this.zpp_inner.active},b.prototype.get_ignore=function(){return this.zpp_inner.ignore},b.prototype.set_ignore=function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.ignore=n,this.zpp_inner.wake()),this.zpp_inner.ignore},b.prototype.get_stiff=function(){return this.zpp_inner.stiff},b.prototype.set_stiff=function(n){return this.zpp_inner.stiff!=n&&(this.zpp_inner.stiff=n,this.zpp_inner.wake()),this.zpp_inner.stiff},b.prototype.get_frequency=function(){return this.zpp_inner.frequency},b.prototype.set_frequency=function(n){return this.zpp_inner.frequency!=n&&(this.zpp_inner.frequency=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.frequency},b.prototype.get_damping=function(){return this.zpp_inner.damping},b.prototype.set_damping=function(n){return this.zpp_inner.damping!=n&&(this.zpp_inner.damping=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.damping},b.prototype.get_maxForce=function(){return this.zpp_inner.maxForce},b.prototype.set_maxForce=function(n){return this.zpp_inner.maxForce!=n&&(this.zpp_inner.maxForce=n,this.zpp_inner.wake()),this.zpp_inner.maxForce},b.prototype.get_maxError=function(){return this.zpp_inner.maxError},b.prototype.set_maxError=function(n){return this.zpp_inner.maxError!=n&&(this.zpp_inner.maxError=n,this.zpp_inner.wake()),this.zpp_inner.maxError},b.prototype.get_breakUnderForce=function(){return this.zpp_inner.breakUnderForce},b.prototype.set_breakUnderForce=function(n){return this.zpp_inner.breakUnderForce!=n&&(this.zpp_inner.breakUnderForce=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderForce},b.prototype.get_breakUnderError=function(){return this.zpp_inner.breakUnderError},b.prototype.set_breakUnderError=function(n){return this.zpp_inner.breakUnderError!=n&&(this.zpp_inner.breakUnderError=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderError},b.prototype.get_removeOnBreak=function(){return this.zpp_inner.removeOnBreak},b.prototype.set_removeOnBreak=function(n){return this.zpp_inner.removeOnBreak=n,this.zpp_inner.removeOnBreak},b.prototype.impulse=function(){return null},b.prototype.bodyImpulse=function(n){return null},b.prototype.visitBodies=function(n){},b.prototype.get_cbTypes=function(){return null==this.zpp_inner.wrap_cbTypes&&this.zpp_inner.setupcbTypes(),this.zpp_inner.wrap_cbTypes},b.prototype.toString=function(){return"{Constraint}"},b.prototype.copy=function(){return this.zpp_inner.copy()},Object.defineProperty(b.prototype,"userData",{get:b.prototype.get_userData}),Object.defineProperty(b.prototype,"compound",{get:b.prototype.get_compound,set:b.prototype.set_compound}),Object.defineProperty(b.prototype,"space",{get:b.prototype.get_space,set:b.prototype.set_space}),Object.defineProperty(b.prototype,"isSleeping",{get:b.prototype.get_isSleeping}),Object.defineProperty(b.prototype,"active",{get:b.prototype.get_active,set:b.prototype.set_active}),Object.defineProperty(b.prototype,"ignore",{get:b.prototype.get_ignore,set:b.prototype.set_ignore}),Object.defineProperty(b.prototype,"stiff",{get:b.prototype.get_stiff,set:b.prototype.set_stiff}),Object.defineProperty(b.prototype,"frequency",{get:b.prototype.get_frequency,set:b.prototype.set_frequency}),Object.defineProperty(b.prototype,"damping",{get:b.prototype.get_damping,set:b.prototype.set_damping}),Object.defineProperty(b.prototype,"maxForce",{get:b.prototype.get_maxForce,set:b.prototype.set_maxForce}),Object.defineProperty(b.prototype,"maxError",{get:b.prototype.get_maxError,set:b.prototype.set_maxError}),Object.defineProperty(b.prototype,"breakUnderForce",{get:b.prototype.get_breakUnderForce,set:b.prototype.set_breakUnderForce}),Object.defineProperty(b.prototype,"breakUnderError",{get:b.prototype.get_breakUnderError,set:b.prototype.set_breakUnderError}),Object.defineProperty(b.prototype,"removeOnBreak",{get:b.prototype.get_removeOnBreak,set:b.prototype.set_removeOnBreak}),Object.defineProperty(b.prototype,"cbTypes",{get:b.prototype.get_cbTypes}),b.prototype.__class__=b;var g=nape.constraint.AngleJoint=function(n,t,e,i,p){null==p&&(p=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Ln,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=e&&(this.zpp_inner_zn.jointMin=e,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=i&&(this.zpp_inner_zn.jointMax=i,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=p&&(this.zpp_inner_zn.ratio=p,this.zpp_inner.wake())};g.__name__=["nape","constraint","AngleJoint"],g.__super__=b,g.prototype=Object.create(b.prototype),g.prototype.zpp_inner_zn=null,g.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},g.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},g.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},g.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},g.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},g.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},g.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},g.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},g.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},g.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},g.prototype.isSlack=function(){var n,t=this.zpp_inner_zn,e=t.ratio*t.b2.rot-t.b1.rot;return t.equal?(n=!1,t.scale=1):n=e<t.jointMin?!(t.scale=-1):e>t.jointMax?(e-=t.jointMax,!(t.scale=1)):!(e=t.scale=0),n},g.prototype.impulse=function(){var n=new q(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},g.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):J.get(0,0,0)},g.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(g.prototype,"body1",{get:g.prototype.get_body1,set:g.prototype.set_body1}),Object.defineProperty(g.prototype,"body2",{get:g.prototype.get_body2,set:g.prototype.set_body2}),Object.defineProperty(g.prototype,"jointMin",{get:g.prototype.get_jointMin,set:g.prototype.set_jointMin}),Object.defineProperty(g.prototype,"jointMax",{get:g.prototype.get_jointMax,set:g.prototype.set_jointMax}),Object.defineProperty(g.prototype,"ratio",{get:g.prototype.get_ratio,set:g.prototype.set_ratio}),g.prototype.__class__=g;var Kn=nape.constraint.ConstraintIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Kn.__name__=["nape","constraint","ConstraintIterator"],Kn.get=function(n){var t,e=null==Kn.zpp_pool?(gi.internal=!0,t=new Kn,gi.internal=!1,t):(e=Kn.zpp_pool,Kn.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Kn.prototype.zpp_inner=null,Kn.prototype.zpp_i=null,Kn.prototype.zpp_critical=null,Kn.prototype.zpp_next=null,Kn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=this).zpp_inner=null,!1)},Kn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Kn.prototype.__class__=Kn;var w=nape.constraint.ConstraintList=function(){this.zpp_inner=null,this.zpp_inner=new gi,this.zpp_inner.outer=this};w.__name__=["nape","constraint","ConstraintList"],w.fromArray=function(n){for(var t=new w,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},w.prototype.zpp_inner=null,w.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},w.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},w.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},w.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},w.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},w.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer},w.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer},w.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},w.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},w.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},w.prototype.empty=function(){return null==this.zpp_inner.inner.head},w.prototype.iterator=function(){return this.zpp_inner.valmod(),Kn.get(this)},w.prototype.copy=function(n){null==n&&(n=!1);var t=new w;this.zpp_inner.valmod();for(var e=Kn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},w.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Kn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},w.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Kn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},w.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Kn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=t).zpp_inner=null;break}}return this},w.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(w.prototype,"length",{get:w.prototype.get_length}),w.prototype.__class__=w;var M=nape.constraint.DistanceJoint=function(n,t,e,i,p,l){this.zpp_inner_zn=null,this.zpp_inner_zn=new Dn,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var r=null==n?null:n.zpp_inner;r!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b2!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var o=null==t?null:t.zpp_inner;o!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=o,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=o&&this.zpp_inner_zn.b1!=o&&null!=o&&o.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=o&&o.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();n=this.zpp_inner_zn.wrap_a1,r=e.zpp_inner;null!=r._validate&&r._validate();t=e.zpp_inner.x,o=e.zpp_inner;null!=o._validate&&o._validate();r=e.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate(),n.zpp_inner.x==t&&(null!=(o=n.zpp_inner)._validate&&o._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=t,n.zpp_inner.y=r,null!=(a=n.zpp_inner)._invalidate&&a._invalidate(a)),e.zpp_inner.weak&&(s=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ip.zpp_pool,Ip.zpp_pool=s),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var n=this.zpp_inner_zn.wrap_a2,a=i.zpp_inner;null!=a._validate&&a._validate();var e=i.zpp_inner.x,s=i.zpp_inner;null!=s._validate&&s._validate();var _,a=i.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate(),n.zpp_inner.x==e&&(null!=(s=n.zpp_inner)._validate&&s._validate(),n.zpp_inner.y==a)||(n.zpp_inner.x=e,n.zpp_inner.y=a,null!=(_=n.zpp_inner)._invalidate&&_._invalidate(_)),i.zpp_inner.weak&&(_=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Vi.poolVec2,Vi.poolVec2=i,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Ip.zpp_pool,Ip.zpp_pool=_),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=p&&(this.zpp_inner_zn.jointMin=p,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=l&&(this.zpp_inner_zn.jointMax=l,this.zpp_inner.wake())};M.__name__=["nape","constraint","DistanceJoint"],M.__super__=b,M.prototype=Object.create(b.prototype),M.prototype.zpp_inner_zn=null,M.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},M.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},M.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},M.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},M.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},M.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},M.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},M.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},M.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},M.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},M.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},M.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},M.prototype.isSlack=function(){return this.zpp_inner_zn.slack},M.prototype.impulse=function(){var n=new q(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},M.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):J.get()},M.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(M.prototype,"body1",{get:M.prototype.get_body1,set:M.prototype.set_body1}),Object.defineProperty(M.prototype,"body2",{get:M.prototype.get_body2,set:M.prototype.set_body2}),Object.defineProperty(M.prototype,"anchor1",{get:M.prototype.get_anchor1,set:M.prototype.set_anchor1}),Object.defineProperty(M.prototype,"anchor2",{get:M.prototype.get_anchor2,set:M.prototype.set_anchor2}),Object.defineProperty(M.prototype,"jointMin",{get:M.prototype.get_jointMin,set:M.prototype.set_jointMin}),Object.defineProperty(M.prototype,"jointMax",{get:M.prototype.get_jointMax,set:M.prototype.set_jointMax}),M.prototype.__class__=M;var C=nape.constraint.LineJoint=function(n,t,e,i,p,l,r){this.zpp_inner_zn=null,this.zpp_inner_zn=new Fn,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var o=null==n?null:n.zpp_inner;o!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=o,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=o&&this.zpp_inner_zn.b2!=o&&null!=o&&o.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=o&&o.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var a=null==t?null:t.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();n=this.zpp_inner_zn.wrap_a1,o=e.zpp_inner;null!=o._validate&&o._validate();t=e.zpp_inner.x,a=e.zpp_inner;null!=a._validate&&a._validate();o=e.zpp_inner.y,a=n.zpp_inner;null!=a._validate&&a._validate(),n.zpp_inner.x==t&&(null!=(a=n.zpp_inner)._validate&&a._validate(),n.zpp_inner.y==o)||(n.zpp_inner.x=t,n.zpp_inner.y=o,null!=(s=n.zpp_inner)._invalidate&&s._invalidate(s)),e.zpp_inner.weak&&(_=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Ip.zpp_pool,Ip.zpp_pool=_),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var n=this.zpp_inner_zn.wrap_a2,s=i.zpp_inner;null!=s._validate&&s._validate();var e=i.zpp_inner.x,_=i.zpp_inner;null!=_._validate&&_._validate();s=i.zpp_inner.y,_=n.zpp_inner;null!=_._validate&&_._validate(),n.zpp_inner.x==e&&(null!=(_=n.zpp_inner)._validate&&_._validate(),n.zpp_inner.y==s)||(n.zpp_inner.x=e,n.zpp_inner.y=s,null!=(h=n.zpp_inner)._invalidate&&h._invalidate(h)),i.zpp_inner.weak&&(u=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Vi.poolVec2,Vi.poolVec2=i,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ip.zpp_pool,Ip.zpp_pool=u),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var n=this.zpp_inner_zn.wrap_n,h=p.zpp_inner;null!=h._validate&&h._validate();var i=p.zpp_inner.x,u=p.zpp_inner;null!=u._validate&&u._validate();var x,h=p.zpp_inner.y,u=n.zpp_inner;null!=u._validate&&u._validate(),n.zpp_inner.x==i&&(null!=(u=n.zpp_inner)._validate&&u._validate(),n.zpp_inner.y==h)||(n.zpp_inner.x=i,n.zpp_inner.y=h,null!=(x=n.zpp_inner)._invalidate&&x._invalidate(x)),p.zpp_inner.weak&&(x=p.zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Vi.poolVec2,Vi.poolVec2=p,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ip.zpp_pool,Ip.zpp_pool=x),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=l&&(this.zpp_inner_zn.jointMin=l,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=r&&(this.zpp_inner_zn.jointMax=r,this.zpp_inner.wake())};C.__name__=["nape","constraint","LineJoint"],C.__super__=b,C.prototype=Object.create(b.prototype),C.prototype.zpp_inner_zn=null,C.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},C.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},C.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},C.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},C.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},C.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},C.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},C.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},C.prototype.get_direction=function(){return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},C.prototype.set_direction=function(n){null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var t=this.zpp_inner_zn.wrap_n,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},C.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},C.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},C.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},C.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},C.prototype.impulse=function(){var n=new q(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},C.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):J.get()},C.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(C.prototype,"body1",{get:C.prototype.get_body1,set:C.prototype.set_body1}),Object.defineProperty(C.prototype,"body2",{get:C.prototype.get_body2,set:C.prototype.set_body2}),Object.defineProperty(C.prototype,"anchor1",{get:C.prototype.get_anchor1,set:C.prototype.set_anchor1}),Object.defineProperty(C.prototype,"anchor2",{get:C.prototype.get_anchor2,set:C.prototype.set_anchor2}),Object.defineProperty(C.prototype,"direction",{get:C.prototype.get_direction,set:C.prototype.set_direction}),Object.defineProperty(C.prototype,"jointMin",{get:C.prototype.get_jointMin,set:C.prototype.set_jointMin}),Object.defineProperty(C.prototype,"jointMax",{get:C.prototype.get_jointMax,set:C.prototype.set_jointMax}),C.prototype.__class__=C;var k=nape.constraint.MotorJoint=function(n,t,e,i){null==i&&(i=1),null==e&&(e=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new Rn,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");t=null==t?null:t.zpp_inner;t!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=e&&(this.zpp_inner_zn.rate=e,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=i&&(this.zpp_inner_zn.ratio=i,this.zpp_inner.wake())};k.__name__=["nape","constraint","MotorJoint"],k.__super__=b,k.prototype=Object.create(b.prototype),k.prototype.zpp_inner_zn=null,k.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},k.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},k.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},k.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},k.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},k.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},k.prototype.get_rate=function(){return this.zpp_inner_zn.rate},k.prototype.set_rate=function(n){return this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=n&&(this.zpp_inner_zn.rate=n,this.zpp_inner.wake()),this.zpp_inner_zn.rate},k.prototype.impulse=function(){var n=new q(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},k.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):J.get()},k.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(k.prototype,"body1",{get:k.prototype.get_body1,set:k.prototype.set_body1}),Object.defineProperty(k.prototype,"body2",{get:k.prototype.get_body2,set:k.prototype.set_body2}),Object.defineProperty(k.prototype,"ratio",{get:k.prototype.get_ratio,set:k.prototype.set_ratio}),Object.defineProperty(k.prototype,"rate",{get:k.prototype.get_rate,set:k.prototype.set_rate}),k.prototype.__class__=k;var O=nape.constraint.PivotJoint=function(n,t,e,i){this.zpp_inner_zn=null,this.zpp_inner_zn=new Zn,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==n?null:n.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var l=null==t?null:t.zpp_inner;l!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b1!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();n=this.zpp_inner_zn.wrap_a1,p=e.zpp_inner;null!=p._validate&&p._validate();t=e.zpp_inner.x,l=e.zpp_inner;null!=l._validate&&l._validate();p=e.zpp_inner.y,l=n.zpp_inner;null!=l._validate&&l._validate(),n.zpp_inner.x==t&&(null!=(l=n.zpp_inner)._validate&&l._validate(),n.zpp_inner.y==p)||(n.zpp_inner.x=t,n.zpp_inner.y=p,null!=(r=n.zpp_inner)._invalidate&&r._invalidate(r)),e.zpp_inner.weak&&(o=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var n=this.zpp_inner_zn.wrap_a2,r=i.zpp_inner;null!=r._validate&&r._validate();var e=i.zpp_inner.x,o=i.zpp_inner;null!=o._validate&&o._validate();var a,r=i.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate(),n.zpp_inner.x==e&&(null!=(o=n.zpp_inner)._validate&&o._validate(),n.zpp_inner.y==r)||(n.zpp_inner.x=e,n.zpp_inner.y=r,null!=(a=n.zpp_inner)._invalidate&&a._invalidate(a)),i.zpp_inner.weak&&(a=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Vi.poolVec2,Vi.poolVec2=i,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2()};O.__name__=["nape","constraint","PivotJoint"],O.__super__=b,O.prototype=Object.create(b.prototype),O.prototype.zpp_inner_zn=null,O.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},O.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},O.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},O.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},O.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},O.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},O.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},O.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},O.prototype.impulse=function(){var n=new q(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},O.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):J.get()},O.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(O.prototype,"body1",{get:O.prototype.get_body1,set:O.prototype.set_body1}),Object.defineProperty(O.prototype,"body2",{get:O.prototype.get_body2,set:O.prototype.set_body2}),Object.defineProperty(O.prototype,"anchor1",{get:O.prototype.get_anchor1,set:O.prototype.set_anchor1}),Object.defineProperty(O.prototype,"anchor2",{get:O.prototype.get_anchor2,set:O.prototype.set_anchor2}),O.prototype.__class__=O;var P=nape.constraint.PulleyJoint=function(n,t,e,i,p,l,r,o,a,s,_){null==_&&(_=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Bn,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&this.zpp_inner_zn.b3!=n&&this.zpp_inner_zn.b4!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");n=null==t?null:t.zpp_inner;n!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&this.zpp_inner_zn.b3!=n&&this.zpp_inner_zn.b4!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),this.zpp_inner.immutable_midstep("Constraint::body3");t=null==e?null:e.zpp_inner;t!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=t,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=t&&this.zpp_inner_zn.b1!=t&&this.zpp_inner_zn.b2!=t&&this.zpp_inner_zn.b4!=t&&null!=t&&t.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=t&&t.wake())),this.zpp_inner.immutable_midstep("Constraint::body4");n=null==i?null:i.zpp_inner;n!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&this.zpp_inner_zn.b2!=n&&this.zpp_inner_zn.b3!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();e=this.zpp_inner_zn.wrap_a1,t=p.zpp_inner;null!=t._validate&&t._validate();i=p.zpp_inner.x,n=p.zpp_inner;null!=n._validate&&n._validate();t=p.zpp_inner.y,n=e.zpp_inner;null!=n._validate&&n._validate(),e.zpp_inner.x==i&&(null!=(n=e.zpp_inner)._validate&&n._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=i,e.zpp_inner.y=t,null!=(h=e.zpp_inner)._invalidate&&h._invalidate(h)),p.zpp_inner.weak&&(u=p.zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Vi.poolVec2,Vi.poolVec2=p,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ip.zpp_pool,Ip.zpp_pool=u),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,h=l.zpp_inner;null!=h._validate&&h._validate();var p=l.zpp_inner.x,u=l.zpp_inner;null!=u._validate&&u._validate();h=l.zpp_inner.y,u=e.zpp_inner;null!=u._validate&&u._validate(),e.zpp_inner.x==p&&(null!=(u=e.zpp_inner)._validate&&u._validate(),e.zpp_inner.y==h)||(e.zpp_inner.x=p,e.zpp_inner.y=h,null!=(x=e.zpp_inner)._invalidate&&x._invalidate(x)),l.zpp_inner.weak&&(d=l.zpp_inner,l.zpp_inner.outer=null,l.zpp_inner=null,l.zpp_pool=Vi.poolVec2,Vi.poolVec2=l,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=Ip.zpp_pool,Ip.zpp_pool=d),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var e=this.zpp_inner_zn.wrap_a3,x=r.zpp_inner;null!=x._validate&&x._validate();var l=r.zpp_inner.x,d=r.zpp_inner;null!=d._validate&&d._validate();x=r.zpp_inner.y,d=e.zpp_inner;null!=d._validate&&d._validate(),e.zpp_inner.x==l&&(null!=(d=e.zpp_inner)._validate&&d._validate(),e.zpp_inner.y==x)||(e.zpp_inner.x=l,e.zpp_inner.y=x,null!=(y=e.zpp_inner)._invalidate&&y._invalidate(y)),r.zpp_inner.weak&&(z=r.zpp_inner,r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Vi.poolVec2,Vi.poolVec2=r,null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=Ip.zpp_pool,Ip.zpp_pool=z),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var e=this.zpp_inner_zn.wrap_a4,y=o.zpp_inner;null!=y._validate&&y._validate();var r=o.zpp_inner.x,z=o.zpp_inner;null!=z._validate&&z._validate();var c,y=o.zpp_inner.y,z=e.zpp_inner;null!=z._validate&&z._validate(),e.zpp_inner.x==r&&(null!=(z=e.zpp_inner)._validate&&z._validate(),e.zpp_inner.y==y)||(e.zpp_inner.x=r,e.zpp_inner.y=y,null!=(c=e.zpp_inner)._invalidate&&c._invalidate(c)),o.zpp_inner.weak&&(c=o.zpp_inner,o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=Vi.poolVec2,Vi.poolVec2=o,null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=Ip.zpp_pool,Ip.zpp_pool=c),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=_&&(this.zpp_inner_zn.ratio=_,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=a&&(this.zpp_inner_zn.jointMin=a,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=s&&(this.zpp_inner_zn.jointMax=s,this.zpp_inner.wake())};P.__name__=["nape","constraint","PulleyJoint"],P.__super__=b,P.prototype=Object.create(b.prototype),P.prototype.zpp_inner_zn=null,P.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},P.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&this.zpp_inner_zn.b3!=n&&this.zpp_inner_zn.b4!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},P.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},P.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&this.zpp_inner_zn.b3!=n&&this.zpp_inner_zn.b4!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},P.prototype.get_body3=function(){return null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},P.prototype.set_body3=function(n){this.zpp_inner.immutable_midstep("Constraint::body3");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&this.zpp_inner_zn.b2!=n&&this.zpp_inner_zn.b4!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},P.prototype.get_body4=function(){return null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},P.prototype.set_body4=function(n){this.zpp_inner.immutable_midstep("Constraint::body4");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&this.zpp_inner_zn.b2!=n&&this.zpp_inner_zn.b3!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},P.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},P.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},P.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},P.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},P.prototype.get_anchor3=function(){return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},P.prototype.set_anchor3=function(n){null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var t=this.zpp_inner_zn.wrap_a3,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},P.prototype.get_anchor4=function(){return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},P.prototype.set_anchor4=function(n){null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var t=this.zpp_inner_zn.wrap_a4,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},P.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},P.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},P.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},P.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},P.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},P.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},P.prototype.isSlack=function(){return this.zpp_inner_zn.slack},P.prototype.impulse=function(){var n=new q(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},P.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):J.get()},P.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer),null!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&n(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer),null!=(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&n(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)},Object.defineProperty(P.prototype,"body1",{get:P.prototype.get_body1,set:P.prototype.set_body1}),Object.defineProperty(P.prototype,"body2",{get:P.prototype.get_body2,set:P.prototype.set_body2}),Object.defineProperty(P.prototype,"body3",{get:P.prototype.get_body3,set:P.prototype.set_body3}),Object.defineProperty(P.prototype,"body4",{get:P.prototype.get_body4,set:P.prototype.set_body4}),Object.defineProperty(P.prototype,"anchor1",{get:P.prototype.get_anchor1,set:P.prototype.set_anchor1}),Object.defineProperty(P.prototype,"anchor2",{get:P.prototype.get_anchor2,set:P.prototype.set_anchor2}),Object.defineProperty(P.prototype,"anchor3",{get:P.prototype.get_anchor3,set:P.prototype.set_anchor3}),Object.defineProperty(P.prototype,"anchor4",{get:P.prototype.get_anchor4,set:P.prototype.set_anchor4}),Object.defineProperty(P.prototype,"jointMin",{get:P.prototype.get_jointMin,set:P.prototype.set_jointMin}),Object.defineProperty(P.prototype,"jointMax",{get:P.prototype.get_jointMax,set:P.prototype.set_jointMax}),Object.defineProperty(P.prototype,"ratio",{get:P.prototype.get_ratio,set:P.prototype.set_ratio}),P.prototype.__class__=P,(x=nape.constraint.UserConstraint=function(n,t){null==t&&(t=!1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Gn(n,t),this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this)}).__name__=["nape","constraint","UserConstraint"],x.__super__=b,x.prototype=Object.create(b.prototype),x.prototype.zpp_inner_zn=null,x.prototype.__bindVec2=function(){var n=new Cn;return n.zpp_inner._inuse=!0,n.zpp_inner._invalidate=X(o=this.zpp_inner_zn,o.bindVec2_invalidate),n},x.prototype.__copy=function(){return null},x.prototype.__broken=function(){},x.prototype.__validate=function(){},x.prototype.__draw=function(n){},x.prototype.__prepare=function(){},x.prototype.__position=function(n){},x.prototype.__velocity=function(n){},x.prototype.__eff_mass=function(n){},x.prototype.__clamp=function(n){},x.prototype.__impulse=function(n,t,e){},x.prototype.impulse=function(){for(var n=new q(this.zpp_inner_zn.dim,1),t=0,e=this.zpp_inner_zn.dim;t<e;){var i=t++;n.zpp_inner.x[i*n.zpp_inner.n]=this.zpp_inner_zn.jAcc[i]}return n},x.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):J.get()},x.prototype.visitBodies=function(n){for(var t=0,e=this.zpp_inner_zn.bodies.length;t<e;){var i=this.zpp_inner_zn.bodies[t];if(null!=i.body){for(var p=!1,l=t+1;l<e;)if(this.zpp_inner_zn.bodies[l++].body==i.body){p=!0;break}p||n(i.body.outer)}++t}},x.prototype.__invalidate=function(){this.zpp_inner.immutable_midstep("UserConstraint::invalidate()"),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner.wake()},x.prototype.__registerBody=function(n,t){return this.zpp_inner.immutable_midstep("UserConstraint::registerBody(..)"),n!=t&&(null!=n&&(this.zpp_inner_zn.remBody(n.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&n.zpp_inner.wake()),null!=t&&this.zpp_inner_zn.addBody(t.zpp_inner),this.zpp_inner.wake(),null!=t&&t.zpp_inner.wake()),t},x.prototype.__class__=x;var S=nape.constraint.WeldJoint=function(n,t,e,i,p){null==p&&(p=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new ot,this.zpp_inner=this.zpp_inner_zn,(this.zpp_inner.outer=this).zpp_inner_zn.outer_zn=this,b.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==t?null:t.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();n=this.zpp_inner_zn.wrap_a1,l=e.zpp_inner;null!=l._validate&&l._validate();t=e.zpp_inner.x,r=e.zpp_inner;null!=r._validate&&r._validate();l=e.zpp_inner.y,r=n.zpp_inner;null!=r._validate&&r._validate(),n.zpp_inner.x==t&&(null!=(r=n.zpp_inner)._validate&&r._validate(),n.zpp_inner.y==l)||(n.zpp_inner.x=t,n.zpp_inner.y=l,null!=(o=n.zpp_inner)._invalidate&&o._invalidate(o)),e.zpp_inner.weak&&(a=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var n=this.zpp_inner_zn.wrap_a2,o=i.zpp_inner;null!=o._validate&&o._validate();var e=i.zpp_inner.x,a=i.zpp_inner;null!=a._validate&&a._validate();var s,o=i.zpp_inner.y,a=n.zpp_inner;null!=a._validate&&a._validate(),n.zpp_inner.x==e&&(null!=(a=n.zpp_inner)._validate&&a._validate(),n.zpp_inner.y==o)||(n.zpp_inner.x=e,n.zpp_inner.y=o,null!=(s=n.zpp_inner)._invalidate&&s._invalidate(s)),i.zpp_inner.weak&&(s=i.zpp_inner,i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Vi.poolVec2,Vi.poolVec2=i,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ip.zpp_pool,Ip.zpp_pool=s),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=p&&(this.zpp_inner_zn.phase=p,this.zpp_inner.wake())};S.__name__=["nape","constraint","WeldJoint"],S.__super__=b,S.prototype=Object.create(b.prototype),S.prototype.zpp_inner_zn=null,S.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},S.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b2!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},S.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},S.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");n=null==n?null:n.zpp_inner;return n!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=n,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=n&&this.zpp_inner_zn.b1!=n&&null!=n&&n.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=n&&n.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},S.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},S.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var t=this.zpp_inner_zn.wrap_a1,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},S.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},S.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var t=this.zpp_inner_zn.wrap_a2,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},S.prototype.get_phase=function(){return this.zpp_inner_zn.phase},S.prototype.set_phase=function(n){return this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=n&&(this.zpp_inner_zn.phase=n,this.zpp_inner.wake()),this.zpp_inner_zn.phase},S.prototype.impulse=function(){var n=new q(3,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccz,n},S.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):J.get()},S.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(S.prototype,"body1",{get:S.prototype.get_body1,set:S.prototype.set_body1}),Object.defineProperty(S.prototype,"body2",{get:S.prototype.get_body2,set:S.prototype.set_body2}),Object.defineProperty(S.prototype,"anchor1",{get:S.prototype.get_anchor1,set:S.prototype.set_anchor1}),Object.defineProperty(S.prototype,"anchor2",{get:S.prototype.get_anchor2,set:S.prototype.set_anchor2}),Object.defineProperty(S.prototype,"phase",{get:S.prototype.get_phase,set:S.prototype.set_phase}),S.prototype.__class__=S;var A=nape.dynamics.Arbiter=function(){this.zpp_inner=null};A.__name__=["nape","dynamics","Arbiter"],A.prototype.zpp_inner=null,A.prototype.get_isSleeping=function(){return this.zpp_inner.sleeping},A.prototype.get_type=function(){return Qt.types[this.zpp_inner.type]},A.prototype.isCollisionArbiter=function(){return this.zpp_inner.type==Qt.COL},A.prototype.isFluidArbiter=function(){return this.zpp_inner.type==Qt.FLUID},A.prototype.isSensorArbiter=function(){return this.zpp_inner.type==Qt.SENSOR},A.prototype.get_collisionArbiter=function(){return this.zpp_inner.type==Qt.COL?this.zpp_inner.colarb.outer_zn:null},A.prototype.get_fluidArbiter=function(){return this.zpp_inner.type==Qt.FLUID?this.zpp_inner.fluidarb.outer_zn:null},A.prototype.get_shape1=function(){return(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2:this.zpp_inner.ws1).outer},A.prototype.get_shape2=function(){return(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1:this.zpp_inner.ws2).outer},A.prototype.get_body1=function(){return(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2:this.zpp_inner.b1).outer},A.prototype.get_body2=function(){return(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1:this.zpp_inner.b2).outer},A.prototype.get_state=function(){var n=this.zpp_inner.immState;return 5==n?(null==Yi.PreFlag_ACCEPT&&(Yi.internal=!0,Yi.PreFlag_ACCEPT=new Ui,Yi.internal=!1),Yi.PreFlag_ACCEPT):1==n?(null==Yi.PreFlag_ACCEPT_ONCE&&(Yi.internal=!0,Yi.PreFlag_ACCEPT_ONCE=new Ui,Yi.internal=!1),Yi.PreFlag_ACCEPT_ONCE):6==n?(null==Yi.PreFlag_IGNORE&&(Yi.internal=!0,Yi.PreFlag_IGNORE=new Ui,Yi.internal=!1),Yi.PreFlag_IGNORE):(null==Yi.PreFlag_IGNORE_ONCE&&(Yi.internal=!0,Yi.PreFlag_IGNORE_ONCE=new Ui,Yi.internal=!1),Yi.PreFlag_IGNORE_ONCE)},A.prototype.totalImpulse=function(n,t){return null==t&&(t=!1),J.get(0,0,0)},A.prototype.toString=function(){var n=this.zpp_inner.type==Qt.COL?"CollisionArbiter":this.zpp_inner.type==Qt.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)return n+"(object-pooled)";var t=n+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2:this.zpp_inner.ws1).outer.toString()+"|"+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1:this.zpp_inner.ws2).outer.toString()+")"+(this.zpp_inner.type==Qt.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"")+"<-",n=this.zpp_inner.immState,n=5==n?(null==Yi.PreFlag_ACCEPT&&(Yi.internal=!0,Yi.PreFlag_ACCEPT=new Ui,Yi.internal=!1),Yi.PreFlag_ACCEPT):1==n?(null==Yi.PreFlag_ACCEPT_ONCE&&(Yi.internal=!0,Yi.PreFlag_ACCEPT_ONCE=new Ui,Yi.internal=!1),Yi.PreFlag_ACCEPT_ONCE):6==n?(null==Yi.PreFlag_IGNORE&&(Yi.internal=!0,Yi.PreFlag_IGNORE=new Ui,Yi.internal=!1),Yi.PreFlag_IGNORE):(null==Yi.PreFlag_IGNORE_ONCE&&(Yi.internal=!0,Yi.PreFlag_IGNORE_ONCE=new Ui,Yi.internal=!1),Yi.PreFlag_IGNORE_ONCE);return t+n.toString()},Object.defineProperty(A.prototype,"isSleeping",{get:A.prototype.get_isSleeping}),Object.defineProperty(A.prototype,"type",{get:A.prototype.get_type}),Object.defineProperty(A.prototype,"collisionArbiter",{get:A.prototype.get_collisionArbiter}),Object.defineProperty(A.prototype,"fluidArbiter",{get:A.prototype.get_fluidArbiter}),Object.defineProperty(A.prototype,"shape1",{get:A.prototype.get_shape1}),Object.defineProperty(A.prototype,"shape2",{get:A.prototype.get_shape2}),Object.defineProperty(A.prototype,"body1",{get:A.prototype.get_body1}),Object.defineProperty(A.prototype,"body2",{get:A.prototype.get_body2}),Object.defineProperty(A.prototype,"state",{get:A.prototype.get_state}),A.prototype.__class__=A;var Wn=nape.dynamics.ArbiterIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Wn.__name__=["nape","dynamics","ArbiterIterator"],Wn.get=function(n){var t,e=null==Wn.zpp_pool?(Ni.internal=!0,t=new Wn,Ni.internal=!1,t):(e=Wn.zpp_pool,Wn.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Wn.prototype.zpp_inner=null,Wn.prototype.zpp_i=null,Wn.prototype.zpp_critical=null,Wn.prototype.zpp_next=null,Wn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=this).zpp_inner=null,!1)},Wn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Wn.prototype.__class__=Wn;var j=nape.dynamics.ArbiterList=function(){this.zpp_inner=null,this.zpp_inner=new Ni,this.zpp_inner.outer=this};j.__name__=["nape","dynamics","ArbiterList"],j.fromArray=function(n){for(var t=new j,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},j.prototype.zpp_inner=null,j.prototype.get_length=function(){return this.zpp_gl()},j.prototype.zpp_gl=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.head;null!=n;)n.elt.active&&this.zpp_inner.user_length++,n=n.next}return this.zpp_inner.user_length},j.prototype.zpp_vm=function(){this.zpp_inner.valmod()},j.prototype.has=function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},j.prototype.at=function(n){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},j.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},j.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},j.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),t=(e=(null==(n=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head:n.next).elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.wrapper()},j.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),n=(e=(null==(t=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head:t.next).elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.wrapper()},j.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},j.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},j.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},j.prototype.empty=function(){return 0==this.zpp_gl()},j.prototype.iterator=function(){return this.zpp_vm(),Wn.get(this)},j.prototype.copy=function(n){null==n&&(n=!1);for(var t=new j,e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},j.prototype.merge=function(n){for(var t=n.iterator();;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||this.add(e)}},j.prototype.toString=function(){for(var n="[",t=!0,e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},j.prototype.foreach=function(n){for(var t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=t).zpp_inner=null;break}}return this},j.prototype.filter=function(n){for(var t=0;t<this.zpp_gl();){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(j.prototype,"length",{get:j.prototype.get_length}),j.prototype.__class__=j;var E=nape.dynamics.ArbiterType=function(){};E.__name__=["nape","dynamics","ArbiterType"],E.COLLISION=null,E.get_COLLISION=function(){return null==Yi.ArbiterType_COLLISION&&(Yi.internal=!0,Yi.ArbiterType_COLLISION=new E,Yi.internal=!1),Yi.ArbiterType_COLLISION},E.SENSOR=null,E.get_SENSOR=function(){return null==Yi.ArbiterType_SENSOR&&(Yi.internal=!0,Yi.ArbiterType_SENSOR=new E,Yi.internal=!1),Yi.ArbiterType_SENSOR},E.FLUID=null,E.get_FLUID=function(){return null==Yi.ArbiterType_FLUID&&(Yi.internal=!0,Yi.ArbiterType_FLUID=new E,Yi.internal=!1),Yi.ArbiterType_FLUID},E.prototype.toString=function(){return null==Yi.ArbiterType_COLLISION&&(Yi.internal=!0,Yi.ArbiterType_COLLISION=new E,Yi.internal=!1),this==Yi.ArbiterType_COLLISION?"COLLISION":(null==Yi.ArbiterType_SENSOR&&(Yi.internal=!0,Yi.ArbiterType_SENSOR=new E,Yi.internal=!1),this==Yi.ArbiterType_SENSOR?"SENSOR":(null==Yi.ArbiterType_FLUID&&(Yi.internal=!0,Yi.ArbiterType_FLUID=new E,Yi.internal=!1),this==Yi.ArbiterType_FLUID?"FLUID":""))},Object.defineProperty(E,"COLLISION",{get:E.get_COLLISION}),Object.defineProperty(E,"SENSOR",{get:E.get_SENSOR}),Object.defineProperty(E,"FLUID",{get:E.get_FLUID}),E.prototype.__class__=E;var I=nape.dynamics.CollisionArbiter=function(){A.call(this)};I.__name__=["nape","dynamics","CollisionArbiter"],I.__super__=A,I.prototype=Object.create(A.prototype),I.prototype.get_contacts=function(){return null==this.zpp_inner.colarb.wrap_contacts&&this.zpp_inner.colarb.setupcontacts(),this.zpp_inner.colarb.wrap_contacts},I.prototype.get_normal=function(){return null==this.zpp_inner.colarb.wrap_normal&&this.zpp_inner.colarb.getnormal(),this.zpp_inner.colarb.wrap_normal},I.prototype.get_radius=function(){return this.zpp_inner.colarb.radius},I.prototype.get_referenceEdge1=function(){var n=this.zpp_inner.colarb.__ref_edge1;return null==n||1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2:this.zpp_inner.ws1).outer.zpp_inner.type&&(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2:this.zpp_inner.ws1).outer.zpp_inner==n.polygon||(n=this.zpp_inner.colarb.__ref_edge2),null==n?null:n.wrapper()},I.prototype.get_referenceEdge2=function(){var n=this.zpp_inner.colarb.__ref_edge1;return null==n||1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1:this.zpp_inner.ws2).outer.zpp_inner.type&&(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1:this.zpp_inner.ws2).outer.zpp_inner==n.polygon||(n=this.zpp_inner.colarb.__ref_edge2),null==n?null:n.wrapper()},I.prototype.firstVertex=function(){return null!=this.zpp_inner.colarb.__ref_edge1!=(null!=this.zpp_inner.colarb.__ref_edge2)&&-1==this.zpp_inner.colarb.__ref_vertex},I.prototype.secondVertex=function(){return null!=this.zpp_inner.colarb.__ref_edge1!=(null!=this.zpp_inner.colarb.__ref_edge2)&&1==this.zpp_inner.colarb.__ref_vertex},I.prototype.normalImpulse=function(n,t){null==t&&(t=!1);var e,i,p=0,l=0,r=0,o=this.zpp_inner.colarb;return t&&!o.oc1.fresh||(null!=(i=(e=o.oc1.wrapper().normalImpulse(n)).zpp_inner)._validate&&i._validate(),p+=e.zpp_inner.x,null!=(i=e.zpp_inner)._validate&&i._validate(),l+=e.zpp_inner.y,null!=(i=e.zpp_inner)._validate&&i._validate(),r+=e.zpp_inner.z,e.dispose()),o.hc2&&(t&&!o.oc2.fresh||(null!=(n=(o=o.oc2.wrapper().normalImpulse(n)).zpp_inner)._validate&&n._validate(),p+=o.zpp_inner.x,null!=(n=o.zpp_inner)._validate&&n._validate(),l+=o.zpp_inner.y,null!=(n=o.zpp_inner)._validate&&n._validate(),r+=o.zpp_inner.z,o.dispose())),J.get(p,l,r)},I.prototype.tangentImpulse=function(n,t){null==t&&(t=!1);var e,i,p=0,l=0,r=0,o=this.zpp_inner.colarb;return t&&!o.oc1.fresh||(null!=(i=(e=o.oc1.wrapper().tangentImpulse(n)).zpp_inner)._validate&&i._validate(),p+=e.zpp_inner.x,null!=(i=e.zpp_inner)._validate&&i._validate(),l+=e.zpp_inner.y,null!=(i=e.zpp_inner)._validate&&i._validate(),r+=e.zpp_inner.z,e.dispose()),o.hc2&&(t&&!o.oc2.fresh||(null!=(n=(o=o.oc2.wrapper().tangentImpulse(n)).zpp_inner)._validate&&n._validate(),p+=o.zpp_inner.x,null!=(n=o.zpp_inner)._validate&&n._validate(),l+=o.zpp_inner.y,null!=(n=o.zpp_inner)._validate&&n._validate(),r+=o.zpp_inner.z,o.dispose())),J.get(p,l,r)},I.prototype.totalImpulse=function(n,t){null==t&&(t=!1);var e,i,p=0,l=0,r=0,o=this.zpp_inner.colarb;return t&&!o.oc1.fresh||(null!=(i=(e=o.oc1.wrapper().totalImpulse(n)).zpp_inner)._validate&&i._validate(),p+=e.zpp_inner.x,null!=(i=e.zpp_inner)._validate&&i._validate(),l+=e.zpp_inner.y,null!=(i=e.zpp_inner)._validate&&i._validate(),r+=e.zpp_inner.z,e.dispose()),o.hc2&&(t&&!o.oc2.fresh||(null!=(n=(o=o.oc2.wrapper().totalImpulse(n)).zpp_inner)._validate&&n._validate(),p+=o.zpp_inner.x,null!=(n=o.zpp_inner)._validate&&n._validate(),l+=o.zpp_inner.y,null!=(n=o.zpp_inner)._validate&&n._validate(),r+=o.zpp_inner.z,o.dispose())),J.get(p,l,r)},I.prototype.rollingImpulse=function(n,t){null==t&&(t=!1);var e=this.zpp_inner.colarb;return!t||e.oc1.fresh?e.oc1.wrapper().rollingImpulse(n):0},I.prototype.get_elasticity=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),1<n.restitution&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.restitution},I.prototype.set_elasticity=function(n){var t=this.zpp_inner.colarb;t.restitution=n,t.userdef_restitution=!0;t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),1<t.restitution&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.restitution},I.prototype.get_dynamicFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),1<n.restitution&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.dyn_fric},I.prototype.set_dynamicFriction=function(n){var t=this.zpp_inner.colarb;t.dyn_fric=n,t.userdef_dyn_fric=!0;t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),1<t.restitution&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.dyn_fric},I.prototype.get_staticFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),1<n.restitution&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.stat_fric},I.prototype.set_staticFriction=function(n){var t=this.zpp_inner.colarb;t.stat_fric=n,t.userdef_stat_fric=!0;t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),1<t.restitution&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.stat_fric},I.prototype.get_rollingFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),1<n.restitution&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.rfric},I.prototype.set_rollingFriction=function(n){var t=this.zpp_inner.colarb;t.rfric=n,t.userdef_rfric=!0;t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),1<t.restitution&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.rfric},Object.defineProperty(I.prototype,"contacts",{get:I.prototype.get_contacts}),Object.defineProperty(I.prototype,"normal",{get:I.prototype.get_normal}),Object.defineProperty(I.prototype,"radius",{get:I.prototype.get_radius}),Object.defineProperty(I.prototype,"referenceEdge1",{get:I.prototype.get_referenceEdge1}),Object.defineProperty(I.prototype,"referenceEdge2",{get:I.prototype.get_referenceEdge2}),Object.defineProperty(I.prototype,"elasticity",{get:I.prototype.get_elasticity,set:I.prototype.set_elasticity}),Object.defineProperty(I.prototype,"dynamicFriction",{get:I.prototype.get_dynamicFriction,set:I.prototype.set_dynamicFriction}),Object.defineProperty(I.prototype,"staticFriction",{get:I.prototype.get_staticFriction,set:I.prototype.set_staticFriction}),Object.defineProperty(I.prototype,"rollingFriction",{get:I.prototype.get_rollingFriction,set:I.prototype.set_rollingFriction}),I.prototype.__class__=I;var T=nape.dynamics.Contact=function(){this.zpp_inner=null};T.__name__=["nape","dynamics","Contact"],T.prototype.zpp_inner=null,T.prototype.get_arbiter=function(){if(null==this.zpp_inner.arbiter)return null;var n=this.zpp_inner.arbiter.outer;return n.zpp_inner.type==Qt.COL?n.zpp_inner.colarb.outer_zn:null},T.prototype.get_penetration=function(){return-this.zpp_inner.dist},T.prototype.get_position=function(){return null==this.zpp_inner.wrap_position&&this.zpp_inner.getposition(),this.zpp_inner.wrap_position},T.prototype.get_fresh=function(){return this.zpp_inner.fresh},T.prototype.normalImpulse=function(n){var t=this.zpp_inner.arbiter.colarb,e=this.zpp_inner.inner,i=e.jnAcc;return null==n?J.get(t.nx*i,t.ny*i):n==t.b1.outer?J.get(t.nx*-i,t.ny*-i,-(t.ny*e.r1x-t.nx*e.r1y)*i):J.get(t.nx*i,t.ny*i,(t.ny*e.r2x-t.nx*e.r2y)*i)},T.prototype.tangentImpulse=function(n){var t=this.zpp_inner.arbiter.colarb,e=this.zpp_inner.inner,i=e.jtAcc;return null==n?J.get(-t.ny*i,t.nx*i):n==t.b1.outer?J.get(t.ny*i,-t.nx*i,-(e.r1x*t.nx+e.r1y*t.ny)*i):J.get(-t.ny*i,t.nx*i,(e.r2x*t.nx+e.r2y*t.ny)*i)},T.prototype.rollingImpulse=function(n){var t=this.zpp_inner.arbiter.colarb,e=this.zpp_inner.arbiter.colarb.jrAcc;return null!=n&&n==t.b1.outer?-e:e},T.prototype.totalImpulse=function(n){var t=this.zpp_inner.arbiter.colarb,e=this.zpp_inner.inner,i=e.jnAcc,p=e.jtAcc,l=t.jrAcc;if(null==n)return J.get(t.nx*i-t.ny*p,t.ny*i+t.nx*p,l);var r=t.nx*i-t.ny*p,p=t.ny*i+t.nx*p;return n==t.b1.outer?J.get(-r,-p,-(p*e.r1x-r*e.r1y)-l):J.get(r,p,p*e.r2x-r*e.r2y+l)},T.prototype.get_friction=function(){return this.zpp_inner.inner.friction},T.prototype.toString=function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},Object.defineProperty(T.prototype,"arbiter",{get:T.prototype.get_arbiter}),Object.defineProperty(T.prototype,"penetration",{get:T.prototype.get_penetration}),Object.defineProperty(T.prototype,"position",{get:T.prototype.get_position}),Object.defineProperty(T.prototype,"fresh",{get:T.prototype.get_fresh}),Object.defineProperty(T.prototype,"friction",{get:T.prototype.get_friction}),T.prototype.__class__=T;var Yn=nape.dynamics.ContactIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Yn.__name__=["nape","dynamics","ContactIterator"],Yn.get=function(n){var t,e=null==Yn.zpp_pool?(Li.internal=!0,t=new Yn,Li.internal=!1,t):(e=Yn.zpp_pool,Yn.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Yn.prototype.zpp_inner=null,Yn.prototype.zpp_i=null,Yn.prototype.zpp_critical=null,Yn.prototype.zpp_next=null,Yn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;if(n.zpp_inner.valmod(),n.zpp_inner.zip_length){n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=0;for(var t=n.zpp_inner.inner.next;null!=t;)t.active&&t.arbiter.active&&n.zpp_inner.user_length++,t=t.next}var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=this).zpp_inner=null,!1)},Yn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Yn.prototype.__class__=Yn;var N=nape.dynamics.ContactList=function(){this.zpp_inner=null,this.zpp_inner=new Li,this.zpp_inner.outer=this};N.__name__=["nape","dynamics","ContactList"],N.fromArray=function(n){for(var t=new N,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},N.prototype.zpp_inner=null,N.prototype.get_length=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;)n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}return this.zpp_inner.user_length},N.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},N.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;)t.active&&t.arbiter.active&&this.zpp_inner.user_length++,t=t.next}n=this.zpp_inner.user_length-1-n}if(n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var e=this.zpp_inner.at_ite;if(e.active&&e.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var i=this.zpp_inner.at_ite;if(i.active&&i.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.wrapper()},N.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;)i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}if(0==this.zpp_inner.user_length)t=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;)p.active&&p.arbiter.active&&this.zpp_inner.user_length++,p=p.next}t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},N.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;)i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}if(0==this.zpp_inner.user_length)t=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;)p.active&&p.arbiter.active&&this.zpp_inner.user_length++,p=p.next}t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},N.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;if(this.zpp_inner.reverse_flag){var e=(t=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;)i.active&&i.arbiter.active&&this.zpp_inner.user_length++,i=i.next}if(1==this.zpp_inner.user_length)n=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;)p.active&&p.arbiter.active&&this.zpp_inner.user_length++,p=p.next}n=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)}e=(t=(null==n?this.zpp_inner.inner:n).next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)}return this.zpp_inner.invalidate(),t.wrapper()},N.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;)t.active&&t.arbiter.active&&this.zpp_inner.user_length++,t=t.next}if(1==this.zpp_inner.user_length)p=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;)e.active&&e.arbiter.active&&this.zpp_inner.user_length++,e=e.next}p=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)}var i=(n=(null==p?this.zpp_inner.inner:p).next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(p)}else{var p=(n=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.wrapper()},N.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},N.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.next;null!=e;){if(e==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},N.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;)n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}if(0==this.zpp_inner.user_length)break;this.pop()}else for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;)t.active&&t.arbiter.active&&this.zpp_inner.user_length++,t=t.next}if(0==this.zpp_inner.user_length)break;this.shift()}},N.prototype.empty=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;)n.active&&n.arbiter.active&&this.zpp_inner.user_length++,n=n.next}return 0==this.zpp_inner.user_length},N.prototype.iterator=function(){return this.zpp_inner.valmod(),Yn.get(this)},N.prototype.copy=function(n){null==n&&(n=!1);var t=new N;this.zpp_inner.valmod();for(var e=Yn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var p=i.zpp_inner.inner.next;null!=p;)p.active&&p.arbiter.active&&i.zpp_inner.user_length++,p=p.next}var l=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<l||(e.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;l=e.zpp_inner.at(e.zpp_i++);t.push(n?null:l)}return t},N.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Yn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;if(e.zpp_inner.valmod(),e.zpp_inner.zip_length){e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=0;for(var i=e.zpp_inner.inner.next;null!=i;)i.active&&i.arbiter.active&&e.zpp_inner.user_length++,i=i.next}var p=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<p||(t.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;p=t.zpp_inner.at(t.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},N.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Yn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var p=i.zpp_inner.inner.next;null!=p;)p.active&&p.arbiter.active&&i.zpp_inner.user_length++,p=p.next}var l=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<l||(e.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;l=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==l?"NULL":l.toString(),t=!1}return n+"]"},N.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Yn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;if(e.zpp_inner.valmod(),e.zpp_inner.zip_length){e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=0;for(var i=e.zpp_inner.inner.next;null!=i;)i.active&&i.arbiter.active&&e.zpp_inner.user_length++,i=i.next}var p=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<p||(t.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Yn.zpp_pool,(Yn.zpp_pool=t).zpp_inner=null;break}}return this},N.prototype.filter=function(n){for(var t=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;)e.active&&e.arbiter.active&&this.zpp_inner.user_length++,e=e.next}if(!(t<this.zpp_inner.user_length))break;var i=this.at(t);try{n(i)?++t:this.remove(i)}catch(n){break}}return this},Object.defineProperty(N.prototype,"length",{get:N.prototype.get_length}),N.prototype.__class__=N;var L=nape.dynamics.FluidArbiter=function(){A.call(this)};L.__name__=["nape","dynamics","FluidArbiter"],L.__super__=A,L.prototype=Object.create(A.prototype),L.prototype.get_position=function(){return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},L.prototype.set_position=function(n){null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition();var t=this.zpp_inner.fluidarb.wrap_position,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},L.prototype.get_overlap=function(){return this.zpp_inner.fluidarb.overlap},L.prototype.set_overlap=function(n){return this.zpp_inner.fluidarb.overlap=n,this.zpp_inner.fluidarb.overlap},L.prototype.buoyancyImpulse=function(n){var t=this.zpp_inner.fluidarb;return null==n?J.get(t.buoyx,t.buoyy,0):n.zpp_inner==this.zpp_inner.b2?J.get(t.buoyx,t.buoyy,t.buoyy*t.r2x-t.buoyx*t.r2y):J.get(-t.buoyx,-t.buoyy,-(t.buoyy*t.r1x-t.buoyx*t.r1y))},L.prototype.dragImpulse=function(n){var t=this.zpp_inner.fluidarb,n=null==n||n.zpp_inner==this.zpp_inner.b2?1:-1;return J.get(t.dampx*n,t.dampy*n,t.adamp*n)},L.prototype.totalImpulse=function(n,t){null==t&&(t=!1);var e=this.buoyancyImpulse(n),i=this.dragImpulse(n),t=i.zpp_inner;null!=t._validate&&t._validate();n=i.zpp_inner.x,t=e.zpp_inner;null!=t._validate&&t._validate(),i.zpp_inner.x=n+e.zpp_inner.x;t=i.zpp_inner;null!=t._validate&&t._validate();n=i.zpp_inner;null!=n._validate&&n._validate();t=i.zpp_inner.y,n=e.zpp_inner;null!=n._validate&&n._validate(),i.zpp_inner.y=t+e.zpp_inner.y;n=i.zpp_inner;null!=n._validate&&n._validate();t=i.zpp_inner;null!=t._validate&&t._validate();n=i.zpp_inner.z,t=e.zpp_inner;null!=t._validate&&t._validate(),i.zpp_inner.z=n+e.zpp_inner.z;n=i.zpp_inner;return null!=n._validate&&n._validate(),e.dispose(),i},Object.defineProperty(L.prototype,"position",{get:L.prototype.get_position,set:L.prototype.set_position}),Object.defineProperty(L.prototype,"overlap",{get:L.prototype.get_overlap,set:L.prototype.set_overlap}),L.prototype.__class__=L;var V=nape.dynamics.InteractionFilter=function(n,t,e,i,p,l){null==l&&(l=-1),null==p&&(p=1),null==i&&(i=-1),null==e&&(e=1),null==t&&(t=-1),null==n&&(n=1),(this.zpp_inner=null)==st.zpp_pool?this.zpp_inner=new st:(this.zpp_inner=st.zpp_pool,st.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),(this.zpp_inner.outer=this).zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask!=t&&(this.zpp_inner.collisionMask=t,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup!=e&&(this.zpp_inner.sensorGroup=e,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask!=i&&(this.zpp_inner.sensorMask=i,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup!=p&&(this.zpp_inner.fluidGroup=p,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask!=l&&(this.zpp_inner.fluidMask=l,this.zpp_inner.invalidate())};V.__name__=["nape","dynamics","InteractionFilter"],V.prototype.zpp_inner=null,V.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},V.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=Ii.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},V.prototype.get_collisionGroup=function(){return this.zpp_inner.collisionGroup},V.prototype.set_collisionGroup=function(n){return this.zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionGroup},V.prototype.get_collisionMask=function(){return this.zpp_inner.collisionMask},V.prototype.set_collisionMask=function(n){return this.zpp_inner.collisionMask!=n&&(this.zpp_inner.collisionMask=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask},V.prototype.get_sensorGroup=function(){return this.zpp_inner.sensorGroup},V.prototype.set_sensorGroup=function(n){return this.zpp_inner.sensorGroup!=n&&(this.zpp_inner.sensorGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup},V.prototype.get_sensorMask=function(){return this.zpp_inner.sensorMask},V.prototype.set_sensorMask=function(n){return this.zpp_inner.sensorMask!=n&&(this.zpp_inner.sensorMask=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask},V.prototype.get_fluidGroup=function(){return this.zpp_inner.fluidGroup},V.prototype.set_fluidGroup=function(n){return this.zpp_inner.fluidGroup!=n&&(this.zpp_inner.fluidGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup},V.prototype.get_fluidMask=function(){return this.zpp_inner.fluidMask},V.prototype.set_fluidMask=function(n){return this.zpp_inner.fluidMask!=n&&(this.zpp_inner.fluidMask=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask},V.prototype.shouldCollide=function(n){var t=this.zpp_inner,n=n.zpp_inner;return 0!=(t.collisionMask&n.collisionGroup)&&0!=(n.collisionMask&t.collisionGroup)},V.prototype.shouldSense=function(n){var t=this.zpp_inner,n=n.zpp_inner;return 0!=(t.sensorMask&n.sensorGroup)&&0!=(n.sensorMask&t.sensorGroup)},V.prototype.shouldFlow=function(n){var t=this.zpp_inner,n=n.zpp_inner;return 0!=(t.fluidMask&n.fluidGroup)&&0!=(n.fluidMask&t.fluidGroup)},V.prototype.copy=function(){return new V(this.zpp_inner.collisionGroup,this.zpp_inner.collisionMask,this.zpp_inner.sensorGroup,this.zpp_inner.sensorMask,this.zpp_inner.fluidGroup,this.zpp_inner.fluidMask)},V.prototype.toString=function(){return"{ collision: "+n.hex(this.zpp_inner.collisionGroup,8)+"~"+n.hex(this.zpp_inner.collisionMask,8)+" sensor: "+n.hex(this.zpp_inner.sensorGroup,8)+"~"+n.hex(this.zpp_inner.sensorMask,8)+" fluid: "+n.hex(this.zpp_inner.fluidGroup,8)+"~"+n.hex(this.zpp_inner.fluidMask,8)+" }"},Object.defineProperty(V.prototype,"userData",{get:V.prototype.get_userData}),Object.defineProperty(V.prototype,"shapes",{get:V.prototype.get_shapes}),Object.defineProperty(V.prototype,"collisionGroup",{get:V.prototype.get_collisionGroup,set:V.prototype.set_collisionGroup}),Object.defineProperty(V.prototype,"collisionMask",{get:V.prototype.get_collisionMask,set:V.prototype.set_collisionMask}),Object.defineProperty(V.prototype,"sensorGroup",{get:V.prototype.get_sensorGroup,set:V.prototype.set_sensorGroup}),Object.defineProperty(V.prototype,"sensorMask",{get:V.prototype.get_sensorMask,set:V.prototype.set_sensorMask}),Object.defineProperty(V.prototype,"fluidGroup",{get:V.prototype.get_fluidGroup,set:V.prototype.set_fluidGroup}),Object.defineProperty(V.prototype,"fluidMask",{get:V.prototype.get_fluidMask,set:V.prototype.set_fluidMask}),V.prototype.__class__=V,(y=nape.dynamics.InteractionGroup=function(n){null==n&&(n=!1),this.zpp_inner=null,this.zpp_inner=new _t,(this.zpp_inner.outer=this).zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n)}).__name__=["nape","dynamics","InteractionGroup"],y.prototype.zpp_inner=null,y.prototype.get_group=function(){return null==this.zpp_inner.group?null:this.zpp_inner.group.outer},y.prototype.set_group=function(n){return this.zpp_inner.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner.group?null:this.zpp_inner.group.outer},y.prototype.get_ignore=function(){return this.zpp_inner.ignore},y.prototype.set_ignore=function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n),this.zpp_inner.ignore},y.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=Mi.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},y.prototype.get_groups=function(){return null==this.zpp_inner.wrap_groups&&(this.zpp_inner.wrap_groups=Ti.get(this.zpp_inner.groups,!0)),this.zpp_inner.wrap_groups},y.prototype.toString=function(){var n="InteractionGroup";return this.zpp_inner.ignore&&(n="InteractionGroup:ignore"),n},Object.defineProperty(y.prototype,"group",{get:y.prototype.get_group,set:y.prototype.set_group}),Object.defineProperty(y.prototype,"ignore",{get:y.prototype.get_ignore,set:y.prototype.set_ignore}),Object.defineProperty(y.prototype,"interactors",{get:y.prototype.get_interactors}),Object.defineProperty(y.prototype,"groups",{get:y.prototype.get_groups}),y.prototype.__class__=y;var Jn=nape.dynamics.InteractionGroupIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Jn.__name__=["nape","dynamics","InteractionGroupIterator"],Jn.get=function(n){var t,e=null==Jn.zpp_pool?(Ti.internal=!0,t=new Jn,Ti.internal=!1,t):(e=Jn.zpp_pool,Jn.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Jn.prototype.zpp_inner=null,Jn.prototype.zpp_i=null,Jn.prototype.zpp_critical=null,Jn.prototype.zpp_next=null,Jn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=this).zpp_inner=null,!1)},Jn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Jn.prototype.__class__=Jn;var F=nape.dynamics.InteractionGroupList=function(){this.zpp_inner=null,this.zpp_inner=new Ti,this.zpp_inner.outer=this};F.__name__=["nape","dynamics","InteractionGroupList"],F.fromArray=function(n){for(var t=new F,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},F.prototype.zpp_inner=null,F.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},F.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},F.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},F.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},F.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},F.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer},F.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer},F.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},F.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},F.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},F.prototype.empty=function(){return null==this.zpp_inner.inner.head},F.prototype.iterator=function(){return this.zpp_inner.valmod(),Jn.get(this)},F.prototype.copy=function(n){null==n&&(n=!1);var t=new F;this.zpp_inner.valmod();for(var e=Jn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},F.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Jn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},F.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Jn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},F.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Jn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Jn.zpp_pool,(Jn.zpp_pool=t).zpp_inner=null;break}}return this},F.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(F.prototype,"length",{get:F.prototype.get_length}),F.prototype.__class__=F;var R=nape.geom.AABB=function(n,t,e,i){var p;null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),null==n&&(n=0),(this.zpp_inner=null)==Lt.zpp_pool?p=new Lt:(p=Lt.zpp_pool,Lt.zpp_pool=p.next,p.next=null),p.minx=n,p.miny=t,p.maxx=n+e,p.maxy=t+i,this.zpp_inner=p,this.zpp_inner.outer=this};R.__name__=["nape","geom","AABB"],R.prototype.zpp_inner=null,R.prototype.copy=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t,e=this.zpp_inner,i=e.minx,p=e.miny,n=e.maxx,e=e.maxy;return null==Lt.zpp_pool?t=new Lt:(t=Lt.zpp_pool,Lt.zpp_pool=t.next,t.next=null),t.minx=i,t.miny=p,t.maxx=n,t.maxy=e,t.wrapper()},R.prototype.get_min=function(){return this.zpp_inner.getmin()},R.prototype.set_min=function(n){var t=this.zpp_inner.getmin(),e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),this.zpp_inner.getmin()},R.prototype.get_max=function(){return this.zpp_inner.getmax()},R.prototype.set_max=function(n){var t=this.zpp_inner.getmax(),e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),this.zpp_inner.getmax()},R.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.minx},R.prototype.set_x=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.minx!=n&&(this.zpp_inner.maxx+=n-this.zpp_inner.minx,this.zpp_inner.minx=n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(e));var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.minx},R.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.miny},R.prototype.set_y=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.miny!=n&&(this.zpp_inner.maxy+=n-this.zpp_inner.miny,this.zpp_inner.miny=n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(e));var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.miny},R.prototype.get_width=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();n=this.zpp_inner;return n.maxx-n.minx},R.prototype.set_width=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();t=this.zpp_inner;t.maxx-t.minx!=n&&(null!=(e=this.zpp_inner)._validate&&e._validate(),this.zpp_inner.maxx=this.zpp_inner.minx+n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(e));var e=this.zpp_inner;null!=e._validate&&e._validate();e=this.zpp_inner;return e.maxx-e.minx},R.prototype.get_height=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();n=this.zpp_inner;return n.maxy-n.miny},R.prototype.set_height=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();t=this.zpp_inner;t.maxy-t.miny!=n&&(null!=(e=this.zpp_inner)._validate&&e._validate(),this.zpp_inner.maxy=this.zpp_inner.miny+n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(e));var e=this.zpp_inner;null!=e._validate&&e._validate();e=this.zpp_inner;return e.maxy-e.miny},R.prototype.toString=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.toString()},Object.defineProperty(R.prototype,"min",{get:R.prototype.get_min,set:R.prototype.set_min}),Object.defineProperty(R.prototype,"max",{get:R.prototype.get_max,set:R.prototype.set_max}),Object.defineProperty(R.prototype,"x",{get:R.prototype.get_x,set:R.prototype.set_x}),Object.defineProperty(R.prototype,"y",{get:R.prototype.get_y,set:R.prototype.set_y}),Object.defineProperty(R.prototype,"width",{get:R.prototype.get_width,set:R.prototype.set_width}),Object.defineProperty(R.prototype,"height",{get:R.prototype.get_height,set:R.prototype.set_height}),R.prototype.__class__=R;var Z=nape.geom.ConvexResult=function(){this.zpp_inner=null};Z.__name__=["nape","geom","ConvexResult"],Z.prototype.zpp_inner=null,Z.prototype.get_normal=function(){return this.zpp_inner.normal},Z.prototype.get_position=function(){return this.zpp_inner.position},Z.prototype.get_toi=function(){return this.zpp_inner.toiDistance},Z.prototype.get_shape=function(){return this.zpp_inner.shape},Z.prototype.dispose=function(){this.zpp_inner.free()},Z.prototype.toString=function(){return"{ shape: "+i.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},Object.defineProperty(Z.prototype,"normal",{get:Z.prototype.get_normal}),Object.defineProperty(Z.prototype,"position",{get:Z.prototype.get_position}),Object.defineProperty(Z.prototype,"toi",{get:Z.prototype.get_toi}),Object.defineProperty(Z.prototype,"shape",{get:Z.prototype.get_shape}),Z.prototype.__class__=Z;var Xn=nape.geom.ConvexResultIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Xn.__name__=["nape","geom","ConvexResultIterator"],Xn.get=function(n){var t,e=null==Xn.zpp_pool?(ji.internal=!0,t=new Xn,ji.internal=!1,t):(e=Xn.zpp_pool,Xn.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Xn.prototype.zpp_inner=null,Xn.prototype.zpp_i=null,Xn.prototype.zpp_critical=null,Xn.prototype.zpp_next=null,Xn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=this).zpp_inner=null,!1)},Xn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Xn.prototype.__class__=Xn;var Mn=nape.geom.ConvexResultList=function(){this.zpp_inner=null,this.zpp_inner=new ji,this.zpp_inner.outer=this};Mn.__name__=["nape","geom","ConvexResultList"],Mn.fromArray=function(n){for(var t=new Mn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},Mn.prototype.zpp_inner=null,Mn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},Mn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},Mn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},Mn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},Mn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)):this.zpp_inner.inner.add(n),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},Mn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;return this.zpp_inner.reverse_flag?(t=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),t},Mn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(t=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),t},Mn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},Mn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),t},Mn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},Mn.prototype.empty=function(){return null==this.zpp_inner.inner.head},Mn.prototype.iterator=function(){return this.zpp_inner.valmod(),Xn.get(this)},Mn.prototype.copy=function(n){null==n&&(n=!1);var t=new Mn;this.zpp_inner.valmod();for(var e=Xn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},Mn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Xn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},Mn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Xn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},Mn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Xn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Xn.zpp_pool,(Xn.zpp_pool=t).zpp_inner=null;break}}return this},Mn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(Mn.prototype,"length",{get:Mn.prototype.get_length}),Mn.prototype.__class__=Mn,(l=nape.geom.Geom=function(){}).__name__=["nape","geom","Geom"],l.distanceBody=function(n,t,e,i){for(var p=n.zpp_inner.shapes.head;null!=p;)yt.validateShape(p.elt),p=p.next;for(var l=t.zpp_inner.shapes.head;null!=l;)yt.validateShape(l.elt),l=l.next;return Tt.distanceBody(n.zpp_inner,t.zpp_inner,e.zpp_inner,i.zpp_inner)},l.distance=function(n,t,e,i){yt.validateShape(n.zpp_inner),yt.validateShape(t.zpp_inner),null==Ip.zpp_pool?_n=new Ip:(_n=Ip.zpp_pool,Ip.zpp_pool=_n.next,_n.next=null),_n.weak=!1;var p=n.zpp_inner,l=t.zpp_inner,r=e.zpp_inner,o=i.zpp_inner;if(0==p.type&&0==l.type){var a,n=p.circle,t=l.circle,e=0,s=0,e=t.worldCOMx-n.worldCOMx,s=t.worldCOMy-n.worldCOMy,i=Math.sqrt(e*e+s*s),_=i-(n.radius+t.radius);_<1e100&&(0==i?(e=1,s=0):(e*=a=1/i,s*=a),a=n.radius,r.x=n.worldCOMx+e*a,r.y=n.worldCOMy+s*a,a=-t.radius,o.x=t.worldCOMx+e*a,o.y=t.worldCOMy+s*a,_n.x=e,_n.y=s),s=_}else{_=!1;if(0==p.type&&1==l.type&&(u=p,p=l,l=u,h=r,r=o,o=h,_=!0),1==p.type&&0==l.type){for(var h,u=p.polygon,x=l.circle,d=-1e100,y=null,z=u.edges.head;null!=z;){var c=z.elt,v=c.gnormx*x.worldCOMx+c.gnormy*x.worldCOMy-c.gprojection-x.radius;if(1e100<v){d=v;break}0<v?d<v&&(d=v,y=c):d<0&&d<v&&(d=v,y=c),z=z.next}d<1e100&&(h=y.gp0,W=y.gp1,(K=x.worldCOMy*y.gnormx-x.worldCOMx*y.gnormy)<=h.y*y.gnormx-h.x*y.gnormy?(D=V=0,V=x.worldCOMx-h.x,D=x.worldCOMy-h.y,(d=(u=Math.sqrt(V*V+D*D))-x.radius)<1e100&&(0==u?(V=1,D=0):(V*=L=1/u,D*=L),r.x=h.x+0*V,r.y=h.y+0*D,L=-x.radius,o.x=x.worldCOMx+V*L,o.y=x.worldCOMy+D*L,_n.x=V,_n.y=D)):K>=W.y*y.gnormx-W.x*y.gnormy?(R=F=0,F=x.worldCOMx-W.x,R=x.worldCOMy-W.y,(d=(J=Math.sqrt(F*F+R*R))-x.radius)<1e100&&(0==J?(F=1,R=0):(F*=U=1/J,R*=U),r.x=W.x+0*F,r.y=W.y+0*R,Y=-x.radius,o.x=x.worldCOMx+F*Y,o.y=x.worldCOMy+R*Y,_n.x=F,_n.y=R)):(Z=-x.radius,o.x=x.worldCOMx+y.gnormx*Z,o.y=x.worldCOMy+y.gnormy*Z,B=-d,r.x=o.x+y.gnormx*B,r.y=o.y+y.gnormy*B,_n.x=y.gnormx,_n.y=y.gnormy)),_&&(_n.x=-_n.x,_n.y=-_n.y),s=d}else{for(var m=p.polygon,f=l.polygon,b=-1e100,g=null,w=null,M=0,C=m.edges.head;null!=C;){for(var k=C.elt,O=1e100,P=f.gverts.next;null!=P;){var S=k.gnormx*P.x+k.gnormy*P.y;S<O&&(O=S),P=P.next}if(1e100<(O-=k.gprojection)){b=O;break}0<O?b<O&&(b=O,g=k,M=1):b<0&&b<O&&(b=O,g=k,M=1),C=C.next}if(b<1e100){for(var A,j=f.edges.head;null!=j;){for(var E=j.elt,I=1e100,T=m.gverts.next;null!=T;){var N=E.gnormx*T.x+E.gnormy*T.y;N<I&&(I=N),T=T.next}if(1e100<(I-=E.gprojection)){b=I;break}0<I?b<I&&(b=I,w=E,M=2):b<0&&b<I&&(b=I,w=E,M=2),j=j.next}if(b<1e100){1==M?(q=f,A=g):(q=m,A=w,G=r,r=o,o=G,_=!_);for(var L,V,D,F,R,Z,B,G,q,U,K,W,Y,J,X,H,$,Q,nn,tn,en,pn,ln=null,rn=1e100,on=q.edges.head;null!=on;){var an=on.elt,sn=A.gnormx*an.gnormx+A.gnormy*an.gnormy;sn<rn&&(rn=sn,ln=an),on=on.next}_?(_n.x=-A.gnormx,_n.y=-A.gnormy):(_n.x=A.gnormx,_n.y=A.gnormy),s=0<=b?(L=A.gp0,V=A.gp1,D=ln.gp0,$=ln.gp1,X=J=nn=K=0,H=1/((K=V.x-L.x)*K+(nn=V.y-L.y)*nn),U=1/((J=$.x-D.x)*J+(X=$.y-D.y)*X),(tn=-(K*(L.x-D.x)+nn*(L.y-D.y))*H)<0?tn=0:1<tn&&(tn=1),(W=-(K*(L.x-$.x)+nn*(L.y-$.y))*H)<0?W=0:1<W&&(W=1),(Y=-(J*(D.x-L.x)+X*(D.y-L.y))*U)<0?Y=0:1<Y&&(Y=1),(en=-(J*(D.x-V.x)+X*(D.y-V.y))*U)<0?en=0:1<en&&(en=1),R=F=0,F=L.x+K*tn,R=L.y+nn*tn,pn=Z=0,Z=L.x+K*W,pn=L.y+nn*W,p=B=0,B=D.x+J*Y,p=D.y+X*Y,G=l=0,l=D.x+J*en,G=D.y+X*en,X=J=Y=W=nn=K=tn=U=H=q=0,en=null,(H=(q=F-D.x)*q+(H=R-D.y)*H)<(tn=(U=Z-$.x)*U+(tn=pn-$.y)*tn)?(J=F,X=R,en=D):(J=Z,X=pn,en=$,H=tn),$=pn=0,tn=null,(nn=(K=B-L.x)*K+(nn=p-L.y)*nn)<(Y=(W=l-V.x)*W+(Y=G-V.y)*Y)?(pn=B,$=p,tn=L):(pn=l,$=G,tn=V,nn=Y),0!=(b=H<nn?(r.x=J,r.y=X,o.x=en.x,o.y=en.y,Math.sqrt(H)):(o.x=pn,o.y=$,r.x=tn.x,r.y=tn.y,Math.sqrt(nn)))&&(_n.x=o.x-r.x,_n.y=o.y-r.y,Q=1/b,_n.x*=Q,_n.y*=Q,_&&(_n.x=-_n.x,_n.y=-_n.y)),b):(en=X=0,X=ln.gp0.x,en=ln.gp0.y,tn=$=pn=H=0,$=(H=ln.gp1.x)-X,tn=(pn=ln.gp1.y)-en,nn=A.gnormy*X-A.gnormx*en,_=1/((Q=A.gnormy*H-A.gnormx*pn)-nn),(nn=(-A.tp1-nn)*_)>jp.epsilon&&(X+=$*nn,en+=tn*nn),(_=(-A.tp0-Q)*_)<-jp.epsilon&&(H+=$*_,pn+=tn*_),(tn=X*A.gnormx+en*A.gnormy-A.gprojection)<(_=H*A.gnormx+pn*A.gnormy-A.gprojection)?(o.x=X,o.y=en,en=-tn,r.x=o.x+A.gnormx*en,r.y=o.y+A.gnormy*en,tn):(o.x=H,o.y=pn,pn=-_,r.x=o.x+A.gnormx*pn,r.y=o.y+A.gnormy*pn,_))}else s=1e100}else s=1e100}}var _n=_n;return null!=_n.outer&&(_n.outer.zpp_inner=null,_n.outer=null),_n._isimmutable=null,_n._validate=null,_n._invalidate=null,_n.next=Ip.zpp_pool,Ip.zpp_pool=_n,s},l.intersectsBody=function(n,t){for(var e=n.zpp_inner.shapes.head;null!=e;)yt.validateShape(e.elt),e=e.next;for(var i=t.zpp_inner.shapes.head;null!=i;)yt.validateShape(i.elt),i=i.next;var p=n.zpp_inner.aabb,l=t.zpp_inner.aabb;if(l.miny<=p.maxy&&p.miny<=l.maxy&&l.minx<=p.maxx&&p.minx<=l.maxx){for(var r=n.zpp_inner.shapes.head;null!=r;){for(var o=r.elt,a=t.zpp_inner.shapes.head;null!=a;){if(Ep.testCollide_safe(o,a.elt))return!0;a=a.next}r=r.next}return!1}return!1},l.intersects=function(n,t){yt.validateShape(n.zpp_inner),yt.validateShape(t.zpp_inner);var e=n.zpp_inner.aabb,i=t.zpp_inner.aabb;return i.miny<=e.maxy&&e.miny<=i.maxy&&i.minx<=e.maxx&&e.minx<=i.maxx&&Ep.testCollide_safe(n.zpp_inner,t.zpp_inner)},l.contains=function(n,t){return yt.validateShape(n.zpp_inner),yt.validateShape(t.zpp_inner),Ep.containTest(n.zpp_inner,t.zpp_inner)},l.prototype.__class__=l;var xe=nape.geom.GeomPoly=function(n){if(this.zpp_inner=null,this.zpp_pool=null,this.zpp_inner=new zt(this),null!=n){if(n instanceof Array&&null==n.__enum__)for(var t=n,e=0;e<t.length;){var i=t[e];++e;var p=i,l=p.zpp_inner;null!=l._validate&&l._validate();i=p.zpp_inner.x,l=p.zpp_inner;null!=l._validate&&l._validate();var r,p=p.zpp_inner.y;null==ii.zpp_pool?r=new ii:(r=ii.zpp_pool,ii.zpp_pool=r.next,r.next=null),r.forced=!1,r.x=i,r.y=p;p=r;null==this.zpp_inner.vertices?this.zpp_inner.vertices=p.prev=p.next=p:(p.prev=this.zpp_inner.vertices,p.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=p,this.zpp_inner.vertices.next=p),this.zpp_inner.vertices=p}else if(D.__instanceof(n,Y))for(var o=n.iterator();;){o.zpp_inner.zpp_inner.valmod();var a=o.zpp_inner.zpp_gl();if(o.zpp_critical=!0,!(o.zpp_i<a||(o.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=o).zpp_inner=null,!1)))break;o.zpp_critical=!1;var s=o.zpp_inner.at(o.zpp_i++),_=s.zpp_inner;null!=_._validate&&_._validate();a=s.zpp_inner.x,_=s.zpp_inner;null!=_._validate&&_._validate();var h,s=s.zpp_inner.y;null==ii.zpp_pool?h=new ii:(h=ii.zpp_pool,ii.zpp_pool=h.next,h.next=null),h.forced=!1,h.x=a,h.y=s;s=h;null==this.zpp_inner.vertices?this.zpp_inner.vertices=s.prev=s.next=s:(s.prev=this.zpp_inner.vertices,s.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=s,this.zpp_inner.vertices.next=s),this.zpp_inner.vertices=s}else if(D.__instanceof(n,xe)){var u=n.zpp_inner.vertices;if(null!=u)for(var x=u;;){var d,y,z,c=x.x,v=x.y;null==Vi.poolVec2?d=new Cn:(d=Vi.poolVec2,Vi.poolVec2=d.zpp_pool,d.zpp_pool=null),null==d.zpp_inner?(null==Ip.zpp_pool?y=new Ip:(y=Ip.zpp_pool,Ip.zpp_pool=y.next,y.next=null),y.weak=!1,y._immutable=!1,y.x=c,y.y=v,d.zpp_inner=y,d.zpp_inner.outer=d):(null!=(z=d.zpp_inner)._validate&&z._validate(),d.zpp_inner.x==c&&(null!=(z=d.zpp_inner)._validate&&z._validate(),d.zpp_inner.y==v)||(d.zpp_inner.x=c,d.zpp_inner.y=v,null!=(m=d.zpp_inner)._invalidate&&m._invalidate(m))),d.zpp_inner.weak=!1;c=d,x=x.next,v=c.zpp_inner;null!=v._validate&&v._validate();var m=c.zpp_inner.x,v=c.zpp_inner;null!=v._validate&&v._validate();var f,v=c.zpp_inner.y;null==ii.zpp_pool?f=new ii:(f=ii.zpp_pool,ii.zpp_pool=f.next,f.next=null),f.forced=!1,f.x=m,f.y=v;v=f;null==this.zpp_inner.vertices?this.zpp_inner.vertices=v.prev=v.next=v:(v.prev=this.zpp_inner.vertices,v.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=v,this.zpp_inner.vertices.next=v),this.zpp_inner.vertices=v;v=c.zpp_inner;c.zpp_inner.outer=null,c.zpp_inner=null;c=c;c.zpp_pool=Vi.poolVec2,Vi.poolVec2=c;v=v;if(null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Ip.zpp_pool,Ip.zpp_pool=v,x==u)break}}if(this.skipForward(1),n instanceof Array&&null==n.__enum__)for(var b=n,g=0;g<b.length;){var w=b[g],M=!!w.zpp_inner.weak&&(M=w.zpp_inner,w.zpp_inner.outer=null,w.zpp_inner=null,(w=w).zpp_pool=Vi.poolVec2,Vi.poolVec2=w,null!=(M=M).outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=Ip.zpp_pool,Ip.zpp_pool=M,!0);M?b.splice(g,1):++g}else if(D.__instanceof(n,Y)){n=n;null!=n.zpp_inner._validate&&n.zpp_inner._validate();for(var C=n.zpp_inner.inner,k=null,O=C.head;null!=O;){var P,S=O.elt;S.outer.zpp_inner.weak?(O=C.erase(k),S.outer.zpp_inner.weak&&(S=(P=S.outer).zpp_inner,P.zpp_inner.outer=null,P.zpp_inner=null,(P=P).zpp_pool=Vi.poolVec2,Vi.poolVec2=P,null!=(S=S).outer&&(S.outer.zpp_inner=null,S.outer=null),S._isimmutable=null,S._validate=null,S._invalidate=null,S.next=Ip.zpp_pool,Ip.zpp_pool=S)):O=(k=O).next}}}};xe.__name__=["nape","geom","GeomPoly"],xe.get=function(n){var t;if(null==Vi.poolGeomPoly?t=new xe:(t=Vi.poolGeomPoly,Vi.poolGeomPoly=t.zpp_pool,t.zpp_pool=null),null!=n){if(n instanceof Array&&null==n.__enum__)for(var e=n,i=0;i<e.length;){var p=e[i];++i;var l=p,r=l.zpp_inner;null!=r._validate&&r._validate();p=l.zpp_inner.x,r=l.zpp_inner;null!=r._validate&&r._validate();var o,l=l.zpp_inner.y;null==ii.zpp_pool?o=new ii:(o=ii.zpp_pool,ii.zpp_pool=o.next,o.next=null),o.forced=!1,o.x=p,o.y=l;l=o;null==t.zpp_inner.vertices?t.zpp_inner.vertices=l.prev=l.next=l:(l.prev=t.zpp_inner.vertices,l.next=t.zpp_inner.vertices.next,t.zpp_inner.vertices.next.prev=l,t.zpp_inner.vertices.next=l),t.zpp_inner.vertices=l}else if(D.__instanceof(n,Y))for(var a=n.iterator();;){a.zpp_inner.zpp_inner.valmod();var s=a.zpp_inner.zpp_gl();if(a.zpp_critical=!0,!(a.zpp_i<s||(a.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=a).zpp_inner=null,!1)))break;a.zpp_critical=!1;var _=a.zpp_inner.at(a.zpp_i++),h=_.zpp_inner;null!=h._validate&&h._validate();s=_.zpp_inner.x,h=_.zpp_inner;null!=h._validate&&h._validate();var u,_=_.zpp_inner.y;null==ii.zpp_pool?u=new ii:(u=ii.zpp_pool,ii.zpp_pool=u.next,u.next=null),u.forced=!1,u.x=s,u.y=_;_=u;null==t.zpp_inner.vertices?t.zpp_inner.vertices=_.prev=_.next=_:(_.prev=t.zpp_inner.vertices,_.next=t.zpp_inner.vertices.next,t.zpp_inner.vertices.next.prev=_,t.zpp_inner.vertices.next=_),t.zpp_inner.vertices=_}else if(D.__instanceof(n,xe)){var x=n.zpp_inner.vertices;if(null!=x)for(var d=x;;){var y,z,c,v=d.x,m=d.y;null==Vi.poolVec2?y=new Cn:(y=Vi.poolVec2,Vi.poolVec2=y.zpp_pool,y.zpp_pool=null),null==y.zpp_inner?(null==Ip.zpp_pool?z=new Ip:(z=Ip.zpp_pool,Ip.zpp_pool=z.next,z.next=null),z.weak=!1,z._immutable=!1,z.x=v,z.y=m,y.zpp_inner=z,y.zpp_inner.outer=y):(null!=(c=y.zpp_inner)._validate&&c._validate(),y.zpp_inner.x==v&&(null!=(c=y.zpp_inner)._validate&&c._validate(),y.zpp_inner.y==m)||(y.zpp_inner.x=v,y.zpp_inner.y=m,null!=(f=y.zpp_inner)._invalidate&&f._invalidate(f))),y.zpp_inner.weak=!1;v=y,d=d.next,m=v.zpp_inner;null!=m._validate&&m._validate();var f=v.zpp_inner.x,m=v.zpp_inner;null!=m._validate&&m._validate();var b,m=v.zpp_inner.y;null==ii.zpp_pool?b=new ii:(b=ii.zpp_pool,ii.zpp_pool=b.next,b.next=null),b.forced=!1,b.x=f,b.y=m;m=b;null==t.zpp_inner.vertices?t.zpp_inner.vertices=m.prev=m.next=m:(m.prev=t.zpp_inner.vertices,m.next=t.zpp_inner.vertices.next,t.zpp_inner.vertices.next.prev=m,t.zpp_inner.vertices.next=m),t.zpp_inner.vertices=m;m=v.zpp_inner;v.zpp_inner.outer=null,v.zpp_inner=null;v=v;v.zpp_pool=Vi.poolVec2,Vi.poolVec2=v;m=m;if(null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Ip.zpp_pool,Ip.zpp_pool=m,d==x)break}}if(t.skipForward(1),n instanceof Array&&null==n.__enum__)for(var g=n,w=0;w<g.length;){var M=g[w],C=!!M.zpp_inner.weak&&(C=M.zpp_inner,M.zpp_inner.outer=null,M.zpp_inner=null,(M=M).zpp_pool=Vi.poolVec2,Vi.poolVec2=M,null!=(C=C).outer&&(C.outer.zpp_inner=null,C.outer=null),C._isimmutable=null,C._validate=null,C._invalidate=null,C.next=Ip.zpp_pool,Ip.zpp_pool=C,!0);C?g.splice(w,1):++w}else if(D.__instanceof(n,Y)){n=n;null!=n.zpp_inner._validate&&n.zpp_inner._validate();for(var k=n.zpp_inner.inner,O=null,P=k.head;null!=P;){var S,A=P.elt;A.outer.zpp_inner.weak?(P=k.erase(O),A.outer.zpp_inner.weak&&(A=(S=A.outer).zpp_inner,S.zpp_inner.outer=null,S.zpp_inner=null,(S=S).zpp_pool=Vi.poolVec2,Vi.poolVec2=S,null!=(A=A).outer&&(A.outer.zpp_inner=null,A.outer=null),A._isimmutable=null,A._validate=null,A._invalidate=null,A.next=Ip.zpp_pool,Ip.zpp_pool=A)):P=(O=P).next}}}return t},xe.prototype.zpp_pool=null,xe.prototype.zpp_inner=null,xe.prototype.empty=function(){return null==this.zpp_inner.vertices},xe.prototype.size=function(){var n=0,t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;++n,(i=i.next)!=e;);return n},xe.prototype.iterator=function(){return ct.get(this.zpp_inner.vertices,!0)},xe.prototype.forwardIterator=function(){return ct.get(this.zpp_inner.vertices,!0)},xe.prototype.backwardsIterator=function(){return ct.get(this.zpp_inner.vertices,!1)},xe.prototype.current=function(){var n,t,e,i,p=this.zpp_inner.vertices;return null==p.wrap&&(n=p.x,i=p.y,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=n,t.zpp_inner.y=i,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,p.wrap=t,p.wrap.zpp_inner._inuse=!0,p.wrap.zpp_inner._invalidate=X(p,p.modwrap),p.wrap.zpp_inner._validate=X(p,p.getwrap)),p.wrap},xe.prototype.push=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,t=n.zpp_inner;null!=t._validate&&t._validate();t=n.zpp_inner.y;null==ii.zpp_pool?i=new ii:(i=ii.zpp_pool,ii.zpp_pool=i.next,i.next=null),i.forced=!1,i.x=e,i.y=t;var i=i;return null==this.zpp_inner.vertices?this.zpp_inner.vertices=i.prev=i.next=i:(i.prev=this.zpp_inner.vertices,i.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=i,this.zpp_inner.vertices.next=i),this.zpp_inner.vertices=i,n.zpp_inner.weak&&(i=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ip.zpp_pool,Ip.zpp_pool=i),this},xe.prototype.pop=function(){var n,t=this.zpp_inner.vertices,e=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null:(n=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n);return this.zpp_inner.vertices=e,null!=t.wrap&&(t.wrap.zpp_inner._inuse=!1,e=(n=t.wrap).zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,t.wrap=null),t.prev=t.next=null,t.next=ii.zpp_pool,ii.zpp_pool=t,this},xe.prototype.unshift=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,t=n.zpp_inner;null!=t._validate&&t._validate();t=n.zpp_inner.y;null==ii.zpp_pool?i=new ii:(i=ii.zpp_pool,ii.zpp_pool=i.next,i.next=null),i.forced=!1,i.x=e,i.y=t;var i=i;return null==this.zpp_inner.vertices?this.zpp_inner.vertices=i.prev=i.next=i:(i.next=this.zpp_inner.vertices,i.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=i,this.zpp_inner.vertices.prev=i),this.zpp_inner.vertices=i,n.zpp_inner.weak&&(i=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ip.zpp_pool,Ip.zpp_pool=i),this},xe.prototype.shift=function(){var n,t=this.zpp_inner.vertices,e=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(n=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n);return this.zpp_inner.vertices=e,null!=t.wrap&&(t.wrap.zpp_inner._inuse=!1,e=(n=t.wrap).zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,t.wrap=null),t.prev=t.next=null,t.next=ii.zpp_pool,ii.zpp_pool=t,this},xe.prototype.skipForward=function(n){if(null!=this.zpp_inner.vertices)if(0<n)for(;0<n--;)this.zpp_inner.vertices=this.zpp_inner.vertices.next;else if(n<0)for(;n++<0;)this.zpp_inner.vertices=this.zpp_inner.vertices.prev;return this},xe.prototype.skipBackwards=function(n){return this.skipForward(-n)},xe.prototype.erase=function(n){for(;0!=n&&null!=this.zpp_inner.vertices;){var t,e,i,p=this.zpp_inner.vertices;0<n?(t=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(t=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,t),this.zpp_inner.vertices=t,--n):n<0&&(i=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null:(e=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,e),this.zpp_inner.vertices=i,++n),null!=p.wrap&&(p.wrap.zpp_inner._inuse=!1,i=(e=p.wrap).zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ip.zpp_pool,Ip.zpp_pool=i,p.wrap=null),p.prev=p.next=null,p.next=ii.zpp_pool,ii.zpp_pool=p}return this},xe.prototype.clear=function(){for(;null!=this.zpp_inner.vertices;){var n,t=this.zpp_inner.vertices,e=null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices?(this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null):(n=this.zpp_inner.vertices.next,this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n);this.zpp_inner.vertices=e,null!=t.wrap&&(t.wrap.zpp_inner._inuse=!1,e=(n=t.wrap).zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,t.wrap=null),t.prev=t.next=null,t.next=ii.zpp_pool,ii.zpp_pool=t}return this},xe.prototype.copy=function(){var n=xe.get(),t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;){var p,l=i.x,r=i.y;null==ii.zpp_pool?p=new ii:(p=ii.zpp_pool,ii.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=l,p.y=r;r=p;if(null==n.zpp_inner.vertices?n.zpp_inner.vertices=r.prev=r.next=r:(r.prev=n.zpp_inner.vertices,r.next=n.zpp_inner.vertices.next,n.zpp_inner.vertices.next.prev=r,n.zpp_inner.vertices.next=r),n.zpp_inner.vertices=r,(i=i.next)==e)break}return n.skipForward(1)},xe.prototype.dispose=function(){this.clear();this.zpp_pool=Vi.poolGeomPoly,Vi.poolGeomPoly=this},xe.prototype.toString=function(){var n="GeomPoly[",t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;)if(i!=this.zpp_inner.vertices&&(n+=","),n+="{"+i.x+","+i.y+"}",(i=i.next)==e)break;return n+"]"},xe.prototype.area=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return 0;var n=0,t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;)if(n+=i.x*(i.next.y-i.prev.y),(i=i.next)==e)break;t=.5*n;return t<0?-t:t},xe.prototype.winding=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return null==Yi.Winding_UNDEFINED&&(Yi.internal=!0,Yi.Winding_UNDEFINED=new H,Yi.internal=!1),Yi.Winding_UNDEFINED;var n=0,t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;)if(n+=i.x*(i.next.y-i.prev.y),(i=i.next)==e)break;t=.5*n;return 0<t?(null==Yi.Winding_CLOCKWISE&&(Yi.internal=!0,Yi.Winding_CLOCKWISE=new H,Yi.internal=!1),Yi.Winding_CLOCKWISE):0==t?(null==Yi.Winding_UNDEFINED&&(Yi.internal=!0,Yi.Winding_UNDEFINED=new H,Yi.internal=!1),Yi.Winding_UNDEFINED):(null==Yi.Winding_ANTICLOCKWISE&&(Yi.internal=!0,Yi.Winding_ANTICLOCKWISE=new H,Yi.internal=!1),Yi.Winding_ANTICLOCKWISE)},xe.prototype.contains=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.y,l=!1,t=this.zpp_inner.vertices,r=this.zpp_inner.vertices;if(null!=t)for(var o=t;;){var a=o.prev;if((o.y<p&&a.y>=p||a.y<p&&o.y>=p)&&(o.x<=e||a.x<=e)&&o.x+(p-o.y)/(a.y-o.y)*(a.x-o.x)<e&&(l=!l),(o=o.next)==r)break}i=l;return n.zpp_inner.weak&&(t=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t),i},xe.prototype.isClockwise=function(){var n=this.winding();return null==Yi.Winding_CLOCKWISE&&(Yi.internal=!0,Yi.Winding_CLOCKWISE=new H,Yi.internal=!1),n==Yi.Winding_CLOCKWISE},xe.prototype.isConvex=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return!0;var n=!1,t=!1,e=!0,i=this.zpp_inner.vertices,p=this.zpp_inner.vertices;if(null!=i)for(var l=i;;){var r=l.prev,o=l.next,a=o.x-l.x,s=o.y-l.y,o=l.x-r.x,s=(l.y-r.y)*a-o*s;if(0<s?t=!0:s<0&&(n=!0),t&&n){e=!1;break}if((l=l.next)==p)break}return e},xe.prototype.isSimple=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||St.isSimple(this.zpp_inner.vertices)},xe.prototype.isMonotone=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||bt.isMonotone(this.zpp_inner.vertices)},xe.prototype.isDegenerate=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||this.area()<jp.epsilon},xe.prototype.simplify=function(n){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return this.copy();var t=Et.simplify(this.zpp_inner.vertices,n),n=xe.get();return n.zpp_inner.vertices=t,n},xe.prototype.simpleDecomposition=function(n){null==wt.sharedGVList&&(wt.sharedGVList=new Oe);for(var t=St.decompose(this.zpp_inner.vertices,wt.sharedGVList),e=null==n?new de:n;null!=t.head;){var i=t.pop_unsafe(),p=xe.get();p.zpp_inner.vertices=i,e.zpp_inner.reverse_flag?e.push(p):e.unshift(p)}return e},xe.prototype.monotoneDecomposition=function(n){null==bt.sharedPPoly&&(bt.sharedPPoly=new wt);var t=bt.decompose(this.zpp_inner.vertices,bt.sharedPPoly);null==wt.sharedGVList&&(wt.sharedGVList=new Oe);for(var e=t.extract(wt.sharedGVList),i=null==n?new de:n;null!=e.head;){var p=e.pop_unsafe(),l=xe.get();l.zpp_inner.vertices=p,i.zpp_inner.reverse_flag?i.push(l):i.unshift(l)}return i},xe.prototype.convexDecomposition=function(n,t){null==n&&(n=!1),null==bt.sharedPPoly&&(bt.sharedPPoly=new wt);var e=bt.decompose(this.zpp_inner.vertices,bt.sharedPPoly);null==wt.sharedPPList&&(wt.sharedPPList=new ke);for(var i=e.extract_partitions(wt.sharedPPList),p=null==t?new de:t;null!=i.head;){var l=i.pop_unsafe();Vt.triangulate(l),n&&Vt.optimise(l),xt.optimise(l),null==wt.sharedGVList&&(wt.sharedGVList=new Oe);var r=l.extract(wt.sharedGVList);for(l.next=wt.zpp_pool,wt.zpp_pool=l;null!=r.head;){var o=r.pop_unsafe(),a=xe.get();a.zpp_inner.vertices=o,p.zpp_inner.reverse_flag?p.push(a):p.unshift(a)}}return p},xe.prototype.triangularDecomposition=function(n,t){null==n&&(n=!1),null==bt.sharedPPoly&&(bt.sharedPPoly=new wt);var e=bt.decompose(this.zpp_inner.vertices,bt.sharedPPoly);null==wt.sharedPPList&&(wt.sharedPPList=new ke);for(var i=e.extract_partitions(wt.sharedPPList),p=null==t?new de:t;null!=i.head;){var l=i.pop_unsafe();Vt.triangulate(l),n&&Vt.optimise(l),null==wt.sharedGVList&&(wt.sharedGVList=new Oe);var r=l.extract(wt.sharedGVList);for(l.next=wt.zpp_pool,wt.zpp_pool=l;null!=r.head;){var o=r.pop_unsafe(),a=xe.get();a.zpp_inner.vertices=o,p.zpp_inner.reverse_flag?p.push(a):p.unshift(a)}}return p},xe.prototype.inflate=function(n){var t=xe.get(),e=this.winding();null==Yi.Winding_CLOCKWISE&&(Yi.internal=!0,Yi.Winding_CLOCKWISE=new H,Yi.internal=!1),e==Yi.Winding_CLOCKWISE&&(n=-n);var e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var p=e;;){var l=p,r=l.prev,o=l.next,a=0,s=l.x-r.x,_=l.y-r.y,a=o.x-l.x,h=o.y-l.y,u=0,x=s,d=_,r=1/Math.sqrt(x*x+d*d),o=x*=r;x=-(d*=r),d=o,x*=n,d*=n,c=a,u=h;var y,z,r=1/Math.sqrt(c*c+u*u),o=c*=r,c=-(u*=r),u=o,u=h*((c*=n)-x)-a*((u*=n)-d),u=0==u?0:u/(h*s-a*_),a=0,h=l.x+x,a=l.y+d;if(h+=s*u,a+=_*u,null==Vi.poolVec2?y=new Cn:(y=Vi.poolVec2,Vi.poolVec2=y.zpp_pool,y.zpp_pool=null),null==y.zpp_inner?(null==Ip.zpp_pool?z=new Ip:(z=Ip.zpp_pool,Ip.zpp_pool=z.next,z.next=null),z.weak=!1,z._immutable=!1,z.x=h,z.y=a,y.zpp_inner=z,y.zpp_inner.outer=y):(null!=(u=y.zpp_inner)._validate&&u._validate(),y.zpp_inner.x==h&&(null!=(u=y.zpp_inner)._validate&&u._validate(),y.zpp_inner.y==a)||(y.zpp_inner.x=h,y.zpp_inner.y=a,null!=(a=y.zpp_inner)._invalidate&&a._invalidate(a))),y.zpp_inner.weak=!1,t.push(y),(p=p.next)==i)break}return t.skipForward(1)},xe.prototype.cut=function(n,t,e,i,p){null==i&&(i=!1),null==e&&(e=!1);var l,p=ce.run(this.zpp_inner.vertices,n,t,e,i,p);return n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),t.zpp_inner.weak&&(l=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),p},xe.prototype.transform=function(n){var t=this.zpp_inner.vertices,e=this.zpp_inner.vertices;if(null!=t)for(var i=t;;){var p=i,l=n.zpp_inner.a*p.x+n.zpp_inner.b*p.y+n.zpp_inner.tx;if(p.y=n.zpp_inner.c*p.x+n.zpp_inner.d*p.y+n.zpp_inner.ty,p.x=l,(i=i.next)==e)break}return this},xe.prototype.bounds=function(){var n=1e100,t=1e100,e=-1e100,i=-1e100,p=this.zpp_inner.vertices,l=this.zpp_inner.vertices;if(null!=p)for(var r=p;;)if(r.x<n&&(n=r.x),r.y<t&&(t=r.y),r.x>e&&(e=r.x),r.y>i&&(i=r.y),(r=r.next)==l)break;return new R(n,t,e-n,i-t)},xe.prototype.top=function(){var n,t,e,i=this.zpp_inner.vertices,p=this.zpp_inner.vertices.next,l=this.zpp_inner.vertices;if(null!=p)for(var r=p;;)if(r.y<i.y&&(i=r),(r=r.next)==l)break;return null==i.wrap&&(n=i.x,p=i.y,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=p,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==p)||(t.zpp_inner.x=n,t.zpp_inner.y=p,null!=(p=t.zpp_inner)._invalidate&&p._invalidate(p))),t.zpp_inner.weak=!1,i.wrap=t,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=X(i,i.modwrap),i.wrap.zpp_inner._validate=X(i,i.getwrap)),i.wrap},xe.prototype.bottom=function(){var n,t,e,i=this.zpp_inner.vertices,p=this.zpp_inner.vertices.next,l=this.zpp_inner.vertices;if(null!=p)for(var r=p;;)if(r.y>i.y&&(i=r),(r=r.next)==l)break;return null==i.wrap&&(n=i.x,p=i.y,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=p,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==p)||(t.zpp_inner.x=n,t.zpp_inner.y=p,null!=(p=t.zpp_inner)._invalidate&&p._invalidate(p))),t.zpp_inner.weak=!1,i.wrap=t,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=X(i,i.modwrap),i.wrap.zpp_inner._validate=X(i,i.getwrap)),i.wrap},xe.prototype.left=function(){var n,t,e,i=this.zpp_inner.vertices,p=this.zpp_inner.vertices.next,l=this.zpp_inner.vertices;if(null!=p)for(var r=p;;)if(r.x<i.x&&(i=r),(r=r.next)==l)break;return null==i.wrap&&(n=i.x,p=i.y,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=p,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==p)||(t.zpp_inner.x=n,t.zpp_inner.y=p,null!=(p=t.zpp_inner)._invalidate&&p._invalidate(p))),t.zpp_inner.weak=!1,i.wrap=t,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=X(i,i.modwrap),i.wrap.zpp_inner._validate=X(i,i.getwrap)),i.wrap},xe.prototype.right=function(){var n,t,e,i=this.zpp_inner.vertices,p=this.zpp_inner.vertices.next,l=this.zpp_inner.vertices;if(null!=p)for(var r=p;;)if(r.x>i.x&&(i=r),(r=r.next)==l)break;return null==i.wrap&&(n=i.x,p=i.y,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=p,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==p)||(t.zpp_inner.x=n,t.zpp_inner.y=p,null!=(p=t.zpp_inner)._invalidate&&p._invalidate(p))),t.zpp_inner.weak=!1,i.wrap=t,i.wrap.zpp_inner._inuse=!0,i.wrap.zpp_inner._invalidate=X(i,i.modwrap),i.wrap.zpp_inner._validate=X(i,i.getwrap)),i.wrap},xe.prototype.__class__=xe;var Hn=nape.geom.GeomPolyIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Hn.__name__=["nape","geom","GeomPolyIterator"],Hn.get=function(n){var t,e=null==Hn.zpp_pool?(Si.internal=!0,t=new Hn,Si.internal=!1,t):(e=Hn.zpp_pool,Hn.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Hn.prototype.zpp_inner=null,Hn.prototype.zpp_i=null,Hn.prototype.zpp_critical=null,Hn.prototype.zpp_next=null,Hn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=this).zpp_inner=null,!1)},Hn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Hn.prototype.__class__=Hn;var de=nape.geom.GeomPolyList=function(){this.zpp_inner=null,this.zpp_inner=new Si,this.zpp_inner.outer=this};de.__name__=["nape","geom","GeomPolyList"],de.fromArray=function(n){for(var t=new de,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},de.prototype.zpp_inner=null,de.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},de.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},de.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},de.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},de.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},de.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer},de.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer},de.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},de.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},de.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},de.prototype.empty=function(){return null==this.zpp_inner.inner.head},de.prototype.iterator=function(){return this.zpp_inner.valmod(),Hn.get(this)},de.prototype.copy=function(n){null==n&&(n=!1);var t=new de;this.zpp_inner.valmod();for(var e=Hn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},de.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=Hn.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},de.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=Hn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},de.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=Hn.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Hn.zpp_pool,(Hn.zpp_pool=t).zpp_inner=null;break}}return this},de.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(de.prototype,"length",{get:de.prototype.get_length}),de.prototype.__class__=de;var B=nape.geom.GeomVertexIterator=function(){};B.__name__=["nape","geom","GeomVertexIterator"],B.prototype.zpp_inner=null,B.prototype.hasNext=function(){var n,t=this.zpp_inner.ptr!=this.zpp_inner.start||this.zpp_inner.first;return this.zpp_inner.first=!1,t||((n=this.zpp_inner).outer.zpp_inner=null,n.ptr=n.start=null,n.next=ct.zpp_pool,ct.zpp_pool=n),t},B.prototype.next=function(){var n,t,e,i,p=this.zpp_inner.ptr;null==p.wrap&&(n=p.x,i=p.y,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=n,t.zpp_inner.y=i,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,p.wrap=t,p.wrap.zpp_inner._inuse=!0,p.wrap.zpp_inner._invalidate=X(p,p.modwrap),p.wrap.zpp_inner._validate=X(p,p.getwrap));p=p.wrap;return this.zpp_inner.ptr=this.zpp_inner.forward?this.zpp_inner.ptr.next:this.zpp_inner.ptr.prev,p},B.prototype.__class__=B,(x=nape.geom.MarchingSquares=function(){}).__name__=["nape","geom","MarchingSquares"],x.run=function(n,t,e,i,p,l,r){null==l&&(l=!0),null==i&&(i=2);var o,a=null!=r?r:new de;if(null==p){var s=t.zpp_inner;null!=s._validate&&s._validate();var _=t.zpp_inner.minx,h=t.zpp_inner;null!=h._validate&&h._validate();var u=t.zpp_inner.miny,r=t.zpp_inner.getmax(),s=r.zpp_inner;null!=s._validate&&s._validate();h=r.zpp_inner.x,s=t.zpp_inner.getmax(),r=s.zpp_inner;null!=r._validate&&r._validate(),li.run(n,_,u,h,s.zpp_inner.y,e,i,l,a)}else{u=t.zpp_inner;null!=u._validate&&u._validate();h=t.zpp_inner,s=h.maxx-h.minx,u=p.zpp_inner;null!=u._validate&&u._validate();h=s/p.zpp_inner.x,u=t.zpp_inner;null!=u._validate&&u._validate();s=t.zpp_inner,u=s.maxy-s.miny,s=p.zpp_inner;null!=s._validate&&s._validate();var u=u/p.zpp_inner.y,x=0|h,d=0|u;x!=h&&++x,d!=u&&++d;for(var y=0,z=x;y<z;){var c=y++,v=t.zpp_inner;null!=v._validate&&v._validate();var m=t.zpp_inner.minx,v=p.zpp_inner;null!=v._validate&&v._validate();for(var f,b=m+p.zpp_inner.x*c,g=c==x-1?(null!=(c=(f=t.zpp_inner.getmax()).zpp_inner)._validate&&c._validate(),f.zpp_inner.x):(null!=(f=p.zpp_inner)._validate&&f._validate(),b+p.zpp_inner.x),w=0,M=d;w<M;){var C=w++,k=t.zpp_inner;null!=k._validate&&k._validate();var O=t.zpp_inner.miny,k=p.zpp_inner;null!=k._validate&&k._validate();var k=O+p.zpp_inner.y*C,P=C==d-1?(null!=(C=(O=t.zpp_inner.getmax()).zpp_inner)._validate&&C._validate(),O.zpp_inner.y):(null!=(P=p.zpp_inner)._validate&&P._validate(),k+p.zpp_inner.y);li.run(n,b,k,g,P,e,i,l,a)}}}return e.zpp_inner.weak&&(o=e.zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o),null!=p&&p.zpp_inner.weak&&(o=p.zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Vi.poolVec2,Vi.poolVec2=p,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o),a},x.prototype.__class__=x;var G=nape.geom.Mat23=function(n,t,e,i,p,l){null==l&&(l=0),null==p&&(p=0),null==i&&(i=1),null==e&&(e=0),null==t&&(t=0),null==n&&(n=1),this.zpp_inner=null,this.zpp_inner=mt.get(),(this.zpp_inner.outer=this).zpp_inner.a=n;n=this.zpp_inner;null!=n._invalidate&&n._invalidate(),this.zpp_inner.b=t;t=this.zpp_inner;null!=t._invalidate&&t._invalidate(),this.zpp_inner.tx=p;p=this.zpp_inner;null!=p._invalidate&&p._invalidate(),this.zpp_inner.c=e;e=this.zpp_inner;null!=e._invalidate&&e._invalidate(),this.zpp_inner.d=i;i=this.zpp_inner;null!=i._invalidate&&i._invalidate(),this.zpp_inner.ty=l;l=this.zpp_inner;null!=l._invalidate&&l._invalidate()};G.__name__=["nape","geom","Mat23"],G.rotation=function(n){var t=Math.cos(n),n=Math.sin(n);return new G(t,-n,n,t,0,0)},G.translation=function(n,t){return new G(1,0,0,1,n,t)},G.scale=function(n,t){return new G(n,0,0,t,0,0)},G.prototype.zpp_inner=null,G.prototype.get_a=function(){return this.zpp_inner.a},G.prototype.set_a=function(n){this.zpp_inner.a=n;n=this.zpp_inner;return null!=n._invalidate&&n._invalidate(),this.zpp_inner.a},G.prototype.get_b=function(){return this.zpp_inner.b},G.prototype.set_b=function(n){this.zpp_inner.b=n;n=this.zpp_inner;return null!=n._invalidate&&n._invalidate(),this.zpp_inner.b},G.prototype.get_c=function(){return this.zpp_inner.c},G.prototype.set_c=function(n){this.zpp_inner.c=n;n=this.zpp_inner;return null!=n._invalidate&&n._invalidate(),this.zpp_inner.c},G.prototype.get_d=function(){return this.zpp_inner.d},G.prototype.set_d=function(n){this.zpp_inner.d=n;n=this.zpp_inner;return null!=n._invalidate&&n._invalidate(),this.zpp_inner.d},G.prototype.get_tx=function(){return this.zpp_inner.tx},G.prototype.set_tx=function(n){this.zpp_inner.tx=n;n=this.zpp_inner;return null!=n._invalidate&&n._invalidate(),this.zpp_inner.tx},G.prototype.get_ty=function(){return this.zpp_inner.ty},G.prototype.set_ty=function(n){this.zpp_inner.ty=n;n=this.zpp_inner;return null!=n._invalidate&&n._invalidate(),this.zpp_inner.ty},G.prototype.copy=function(){return new G(this.zpp_inner.a,this.zpp_inner.b,this.zpp_inner.c,this.zpp_inner.d,this.zpp_inner.tx,this.zpp_inner.ty)},G.prototype.set=function(n){n=n.zpp_inner;this.zpp_inner.setas(n.a,n.b,n.c,n.d,n.tx,n.ty);n=this.zpp_inner;return null!=n._invalidate&&n._invalidate(),this},G.prototype.setAs=function(n,t,e,i,p,l){null==l&&(l=0),null==p&&(p=0),null==i&&(i=1),null==e&&(e=0),null==t&&(t=0),null==n&&(n=1),this.zpp_inner.setas(n,t,e,i,p,l);l=this.zpp_inner;return null!=l._invalidate&&l._invalidate(),this},G.prototype.reset=function(){return this.setAs()},G.prototype.get_determinant=function(){return this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c},G.prototype.singular=function(){var n=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d,t=this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c;return t<0&&(t=-t),n>jp.illConditionedThreshold*t},G.prototype.inverse=function(){var n=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);return new G(this.zpp_inner.d*n,-this.zpp_inner.b*n,-this.zpp_inner.c*n,this.zpp_inner.a*n,(this.zpp_inner.b*this.zpp_inner.ty-this.zpp_inner.d*this.zpp_inner.tx)*n,(this.zpp_inner.c*this.zpp_inner.tx-this.zpp_inner.a*this.zpp_inner.ty)*n)},G.prototype.transpose=function(){return new G(this.zpp_inner.a,this.zpp_inner.c,this.zpp_inner.b,this.zpp_inner.d,-this.zpp_inner.a*this.zpp_inner.tx-this.zpp_inner.c*this.zpp_inner.ty,-this.zpp_inner.b*this.zpp_inner.tx-this.zpp_inner.d*this.zpp_inner.ty)},G.prototype.concat=function(n){return new G(n.zpp_inner.a*this.zpp_inner.a+n.zpp_inner.b*this.zpp_inner.c,n.zpp_inner.a*this.zpp_inner.b+n.zpp_inner.b*this.zpp_inner.d,n.zpp_inner.c*this.zpp_inner.a+n.zpp_inner.d*this.zpp_inner.c,n.zpp_inner.c*this.zpp_inner.b+n.zpp_inner.d*this.zpp_inner.d,n.zpp_inner.a*this.zpp_inner.tx+n.zpp_inner.b*this.zpp_inner.ty+n.zpp_inner.tx,n.zpp_inner.c*this.zpp_inner.tx+n.zpp_inner.d*this.zpp_inner.ty+n.zpp_inner.ty)},G.prototype.transform=function(n,t,e){var i,p,l,r,o,a,s;return null==e&&(e=!1),null==t&&(t=!1),e=t?(null!=(i=n.zpp_inner)._validate&&i._validate(),l=n.zpp_inner.x*this.zpp_inner.a,null!=(t=n.zpp_inner)._validate&&t._validate(),i=l+n.zpp_inner.y*this.zpp_inner.b,null!=(t=n.zpp_inner)._validate&&t._validate(),l=n.zpp_inner.x*this.zpp_inner.c,null!=(t=n.zpp_inner)._validate&&t._validate(),l=l+n.zpp_inner.y*this.zpp_inner.d,null==Vi.poolVec2?r=new Cn:(r=Vi.poolVec2,Vi.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=i,p.y=l,r.zpp_inner=p,r.zpp_inner.outer=r):(null!=(p=r.zpp_inner)._validate&&p._validate(),r.zpp_inner.x==i&&(null!=(p=r.zpp_inner)._validate&&p._validate(),r.zpp_inner.y==l)||(r.zpp_inner.x=i,r.zpp_inner.y=l,null!=(a=r.zpp_inner)._invalidate&&a._invalidate(a))),r.zpp_inner.weak=e,r):(null!=(l=n.zpp_inner)._validate&&l._validate(),a=n.zpp_inner.x*this.zpp_inner.a,null!=(r=n.zpp_inner)._validate&&r._validate(),l=a+n.zpp_inner.y*this.zpp_inner.b+this.zpp_inner.tx,null!=(r=n.zpp_inner)._validate&&r._validate(),a=n.zpp_inner.x*this.zpp_inner.c,null!=(r=n.zpp_inner)._validate&&r._validate(),a=a+n.zpp_inner.y*this.zpp_inner.d+this.zpp_inner.ty,null==Vi.poolVec2?s=new Cn:(s=Vi.poolVec2,Vi.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==Ip.zpp_pool?o=new Ip:(o=Ip.zpp_pool,Ip.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=l,o.y=a,s.zpp_inner=o,s.zpp_inner.outer=s):(null!=(o=s.zpp_inner)._validate&&o._validate(),s.zpp_inner.x==l&&(null!=(o=s.zpp_inner)._validate&&o._validate(),s.zpp_inner.y==a)||(s.zpp_inner.x=l,s.zpp_inner.y=a,null!=(a=s.zpp_inner)._invalidate&&a._invalidate(a))),s.zpp_inner.weak=e,s),n.zpp_inner.weak&&(s=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ip.zpp_pool,Ip.zpp_pool=s),e},G.prototype.inverseTransform=function(n,t,e){null==e&&(e=!1),null==t&&(t=!1);var i,p,l,r,o,a,s,_=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c),e=t?(null!=(i=n.zpp_inner)._validate&&i._validate(),r=n.zpp_inner.x*this.zpp_inner.d,null!=(t=n.zpp_inner)._validate&&t._validate(),i=(r-n.zpp_inner.y*this.zpp_inner.b)*_,null!=(t=n.zpp_inner)._validate&&t._validate(),r=n.zpp_inner.y*this.zpp_inner.a,null!=(t=n.zpp_inner)._validate&&t._validate(),r=(r-n.zpp_inner.x*this.zpp_inner.c)*_,null==Vi.poolVec2?o=new Cn:(o=Vi.poolVec2,Vi.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=i,p.y=r,o.zpp_inner=p,o.zpp_inner.outer=o):(null!=(p=o.zpp_inner)._validate&&p._validate(),o.zpp_inner.x==i&&(null!=(p=o.zpp_inner)._validate&&p._validate(),o.zpp_inner.y==r)||(o.zpp_inner.x=i,o.zpp_inner.y=r,null!=(l=o.zpp_inner)._invalidate&&l._invalidate(l))),o.zpp_inner.weak=e,o):(null!=(r=n.zpp_inner)._validate&&r._validate(),l=n.zpp_inner.x-this.zpp_inner.tx,null!=(o=n.zpp_inner)._validate&&o._validate(),r=n.zpp_inner.y-this.zpp_inner.ty,o=(l*this.zpp_inner.d-r*this.zpp_inner.b)*_,_=(r*this.zpp_inner.a-l*this.zpp_inner.c)*_,null==Vi.poolVec2?s=new Cn:(s=Vi.poolVec2,Vi.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==Ip.zpp_pool?a=new Ip:(a=Ip.zpp_pool,Ip.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=o,a.y=_,s.zpp_inner=a,s.zpp_inner.outer=s):(null!=(a=s.zpp_inner)._validate&&a._validate(),s.zpp_inner.x==o&&(null!=(a=s.zpp_inner)._validate&&a._validate(),s.zpp_inner.y==_)||(s.zpp_inner.x=o,s.zpp_inner.y=_,null!=(_=s.zpp_inner)._invalidate&&_._invalidate(_))),s.zpp_inner.weak=e,s);return n.zpp_inner.weak&&(s=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ip.zpp_pool,Ip.zpp_pool=s),e},G.prototype.toString=function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},G.prototype.equiorthogonal=function(){if(this.singular())return!1;var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(n*n<jp.epsilon){n=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-this.zpp_inner.c*this.zpp_inner.c-this.zpp_inner.d*this.zpp_inner.d;return n*n<jp.epsilon}return!1},G.prototype.orthogonal=function(){var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(n*n<jp.epsilon){var t=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-1,n=this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d-1;return t*t<jp.epsilon&&n*n<jp.epsilon}return!1},G.prototype.equiorthogonalise=function(){var n,t,e,i,p;return this.equiorthogonal()||(e=(p=((e=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c))+(n=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d)))/2)/e,n=p/n,this.zpp_inner.a=this.zpp_inner.a*e,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.c=this.zpp_inner.c*e,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(),this.zpp_inner.b=this.zpp_inner.b*n,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.d=this.zpp_inner.d*n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(),t=.25*Math.PI-.5*Math.acos((this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d)/(p*p)),0<this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c&&(t=-t),i=Math.sin(t),n=Math.cos(t),e=this.zpp_inner.a*n-this.zpp_inner.c*i,p=this.zpp_inner.b*n+this.zpp_inner.d*i,this.zpp_inner.c=this.zpp_inner.c*n+this.zpp_inner.a*i,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(),this.zpp_inner.a=e,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(),this.zpp_inner.d=this.zpp_inner.d*n-this.zpp_inner.b*i,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.b=p,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(),null!=(p=this.zpp_inner)._invalidate&&p._invalidate()),this},G.prototype.orthogonalise=function(){var n,t,e,i,p;return this.orthogonal()||(t=1/(t=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c)),e=1/(e=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d)),this.zpp_inner.a=this.zpp_inner.a*t,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(),this.zpp_inner.c=this.zpp_inner.c*t,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.b=this.zpp_inner.b*e,null!=(n=this.zpp_inner)._invalidate&&n._invalidate(),this.zpp_inner.d=this.zpp_inner.d*e,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(),t=.25*Math.PI-.5*Math.acos(this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d),0<this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c&&(t=-t),i=Math.sin(t),n=Math.cos(t),e=this.zpp_inner.a*n-this.zpp_inner.c*i,p=this.zpp_inner.b*n+this.zpp_inner.d*i,this.zpp_inner.c=this.zpp_inner.c*n+this.zpp_inner.a*i,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(),this.zpp_inner.a=e,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(),this.zpp_inner.d=this.zpp_inner.d*n-this.zpp_inner.b*i,null!=(i=this.zpp_inner)._invalidate&&i._invalidate(),this.zpp_inner.b=p,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(),null!=(p=this.zpp_inner)._invalidate&&p._invalidate()),this},Object.defineProperty(G.prototype,"a",{get:G.prototype.get_a,set:G.prototype.set_a}),Object.defineProperty(G.prototype,"b",{get:G.prototype.get_b,set:G.prototype.set_b}),Object.defineProperty(G.prototype,"c",{get:G.prototype.get_c,set:G.prototype.set_c}),Object.defineProperty(G.prototype,"d",{get:G.prototype.get_d,set:G.prototype.set_d}),Object.defineProperty(G.prototype,"tx",{get:G.prototype.get_tx,set:G.prototype.set_tx}),Object.defineProperty(G.prototype,"ty",{get:G.prototype.get_ty,set:G.prototype.set_ty}),Object.defineProperty(G.prototype,"determinant",{get:G.prototype.get_determinant}),G.prototype.__class__=G;var q=nape.geom.MatMN=function(n,t){this.zpp_inner=null,this.zpp_inner=new ft(n,t),this.zpp_inner.outer=this};q.__name__=["nape","geom","MatMN"],q.prototype.zpp_inner=null,q.prototype.get_rows=function(){return this.zpp_inner.m},q.prototype.get_cols=function(){return this.zpp_inner.n},q.prototype.x=function(n,t){return this.zpp_inner.x[n*this.zpp_inner.n+t]},q.prototype.setx=function(n,t,e){return this.zpp_inner.x[n*this.zpp_inner.n+t]=e},q.prototype.toString=function(){for(var n="{ ",t=!0,e=0,i=this.zpp_inner.m;e<i;){var p=e++;t||(n+="; "),t=!1;for(var l=0,r=this.zpp_inner.n;l<r;)n+=this.zpp_inner.x[p*this.zpp_inner.n+l++]+" "}return n+="}"},q.prototype.transpose=function(){for(var n=new q(this.zpp_inner.n,this.zpp_inner.m),t=0,e=this.zpp_inner.m;t<e;)for(var i=t++,p=0,l=this.zpp_inner.n;p<l;){var r=p++;n.zpp_inner.x[r*n.zpp_inner.n+i]=this.zpp_inner.x[i*this.zpp_inner.n+r]}return n},q.prototype.mul=function(n){for(var t=new q(this.zpp_inner.m,n.zpp_inner.n),e=0,i=this.zpp_inner.m;e<i;)for(var p=e++,l=0,r=n.zpp_inner.n;l<r;){for(var o=l++,a=0,s=0,_=this.zpp_inner.n;s<_;){var h=s++;a+=this.zpp_inner.x[p*this.zpp_inner.n+h]*n.zpp_inner.x[h*n.zpp_inner.n+o]}t.zpp_inner.x[p*t.zpp_inner.n+o]=a}return t},Object.defineProperty(q.prototype,"rows",{get:q.prototype.get_rows}),Object.defineProperty(q.prototype,"cols",{get:q.prototype.get_cols}),q.prototype.__class__=q;var U=nape.geom.Ray=function(n,t){this.zpp_inner=null,this.zpp_inner=new Mt;var e=this.zpp_inner.origin,i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();i=n.zpp_inner.y,l=e.zpp_inner;null!=l._validate&&l._validate(),e.zpp_inner.x==p&&(null!=(l=e.zpp_inner)._validate&&l._validate(),e.zpp_inner.y==i)||(e.zpp_inner.x=p,e.zpp_inner.y=i,null!=(r=e.zpp_inner)._invalidate&&r._invalidate(r)),n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o);var e=this.zpp_inner.direction,r=t.zpp_inner;null!=r._validate&&r._validate();var n=t.zpp_inner.x,o=t.zpp_inner;null!=o._validate&&o._validate();var a,r=t.zpp_inner.y,o=e.zpp_inner;null!=o._validate&&o._validate(),e.zpp_inner.x==n&&(null!=(o=e.zpp_inner)._validate&&o._validate(),e.zpp_inner.y==r)||(e.zpp_inner.x=n,e.zpp_inner.y=r,null!=(a=e.zpp_inner)._invalidate&&a._invalidate(a)),t.zpp_inner.weak&&(a=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a),this.zpp_inner.zip_dir=!0,this.zpp_inner.maxdist=1/0};U.__name__=["nape","geom","Ray"],U.fromSegment=function(n,t){var e=new U(n,t.sub(n,!0)),i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.y,o=t.zpp_inner;null!=o._validate&&o._validate();i=t.zpp_inner.x,l=t.zpp_inner;null!=l._validate&&l._validate();var a,o=0,l=0,o=p-i,l=r-t.zpp_inner.y;return e.zpp_inner.maxdist=Math.sqrt(o*o+l*l),n.zpp_inner.weak&&(a=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a),t.zpp_inner.weak&&(a=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a),e},U.prototype.zpp_inner=null,U.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},U.prototype.get_origin=function(){return this.zpp_inner.origin},U.prototype.set_origin=function(n){var t=this.zpp_inner.origin,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),this.zpp_inner.origin},U.prototype.get_direction=function(){return this.zpp_inner.direction},U.prototype.set_direction=function(n){var t=this.zpp_inner.direction,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),this.zpp_inner.zip_dir=!0,this.zpp_inner.direction},U.prototype.get_maxDistance=function(){return this.zpp_inner.maxdist},U.prototype.set_maxDistance=function(n){return this.zpp_inner.maxdist=n,this.zpp_inner.maxdist},U.prototype.aabb=function(){return this.zpp_inner.rayAABB().wrapper()},U.prototype.at=function(n,t){null==t&&(t=!1),this.zpp_inner.validate_dir();var e=this.zpp_inner.origin,i=e.zpp_inner;null!=i._validate&&i._validate();var p=e.zpp_inner.x+n*this.zpp_inner.dirx,i=this.zpp_inner.origin,e=i.zpp_inner;null!=e._validate&&e._validate();var l,r,n=i.zpp_inner.y+n*this.zpp_inner.diry;return null==Vi.poolVec2?l=new Cn:(l=Vi.poolVec2,Vi.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==Ip.zpp_pool?r=new Ip:(r=Ip.zpp_pool,Ip.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=p,r.y=n,l.zpp_inner=r,l.zpp_inner.outer=l):(null!=(r=l.zpp_inner)._validate&&r._validate(),l.zpp_inner.x==p&&(null!=(r=l.zpp_inner)._validate&&r._validate(),l.zpp_inner.y==n)||(l.zpp_inner.x=p,l.zpp_inner.y=n,null!=(n=l.zpp_inner)._invalidate&&n._invalidate(n))),l.zpp_inner.weak=t,l},U.prototype.copy=function(){var n=new U(this.zpp_inner.origin,this.zpp_inner.direction);return n.zpp_inner.maxdist=this.zpp_inner.maxdist,n},Object.defineProperty(U.prototype,"userData",{get:U.prototype.get_userData}),Object.defineProperty(U.prototype,"origin",{get:U.prototype.get_origin,set:U.prototype.set_origin}),Object.defineProperty(U.prototype,"direction",{get:U.prototype.get_direction,set:U.prototype.set_direction}),Object.defineProperty(U.prototype,"maxDistance",{get:U.prototype.get_maxDistance,set:U.prototype.set_maxDistance}),U.prototype.__class__=U;var K=nape.geom.RayResult=function(){this.zpp_inner=null};K.__name__=["nape","geom","RayResult"],K.prototype.zpp_inner=null,K.prototype.get_normal=function(){return this.zpp_inner.normal},K.prototype.get_distance=function(){return this.zpp_inner.toiDistance},K.prototype.get_inner=function(){return this.zpp_inner.inner},K.prototype.get_shape=function(){return this.zpp_inner.shape},K.prototype.dispose=function(){this.zpp_inner.free()},K.prototype.toString=function(){return"{ shape: "+i.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+i.string(this.zpp_inner.inner)+" }"},Object.defineProperty(K.prototype,"normal",{get:K.prototype.get_normal}),Object.defineProperty(K.prototype,"distance",{get:K.prototype.get_distance}),Object.defineProperty(K.prototype,"inner",{get:K.prototype.get_inner}),Object.defineProperty(K.prototype,"shape",{get:K.prototype.get_shape}),K.prototype.__class__=K;var $n=nape.geom.RayResultIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};$n.__name__=["nape","geom","RayResultIterator"],$n.get=function(n){var t,e=null==$n.zpp_pool?(Ai.internal=!0,t=new $n,Ai.internal=!1,t):(e=$n.zpp_pool,$n.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},$n.prototype.zpp_inner=null,$n.prototype.zpp_i=null,$n.prototype.zpp_critical=null,$n.prototype.zpp_next=null,$n.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=$n.zpp_pool,($n.zpp_pool=this).zpp_inner=null,!1)},$n.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},$n.prototype.__class__=$n;var W=nape.geom.RayResultList=function(){this.zpp_inner=null,this.zpp_inner=new Ai,this.zpp_inner.outer=this};W.__name__=["nape","geom","RayResultList"],W.fromArray=function(n){for(var t=new W,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},W.prototype.zpp_inner=null,W.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},W.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},W.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},W.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},W.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)):this.zpp_inner.inner.add(n),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},W.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;return this.zpp_inner.reverse_flag?(t=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),t},W.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(t=this.zpp_inner.inner.head.elt,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),t},W.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},W.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),t},W.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},W.prototype.empty=function(){return null==this.zpp_inner.inner.head},W.prototype.iterator=function(){return this.zpp_inner.valmod(),$n.get(this)},W.prototype.copy=function(n){null==n&&(n=!1);var t=new W;this.zpp_inner.valmod();for(var e=$n.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=$n.zpp_pool,($n.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},W.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=$n.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=$n.zpp_pool,($n.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},W.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=$n.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=$n.zpp_pool,($n.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},W.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=$n.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=$n.zpp_pool,($n.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=$n.zpp_pool,($n.zpp_pool=t).zpp_inner=null;break}}return this},W.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(W.prototype,"length",{get:W.prototype.get_length}),W.prototype.__class__=W;var Cn=nape.geom.Vec2=function(n,t){var e;null==t&&(t=0),null==n&&(n=0),this.zpp_pool=null,(this.zpp_inner=null)==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=t,this.zpp_inner=e,this.zpp_inner.outer=this};Cn.__name__=["nape","geom","Vec2"],Cn.weak=function(n,t){var e,i;return null==t&&(t=0),null==n&&(n=0),null==Vi.poolVec2?e=new Cn:(e=Vi.poolVec2,Vi.poolVec2=e.zpp_pool,e.zpp_pool=null),null==e.zpp_inner?(null==Ip.zpp_pool?i=new Ip:(i=Ip.zpp_pool,Ip.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=t,e.zpp_inner=i,e.zpp_inner.outer=e):(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.x==n&&(null!=(i=e.zpp_inner)._validate&&i._validate(),e.zpp_inner.y==t)||(e.zpp_inner.x=n,e.zpp_inner.y=t,null!=(t=e.zpp_inner)._invalidate&&t._invalidate(t))),e.zpp_inner.weak=!0,e},Cn.get=function(n,t,e){var i,p;return null==e&&(e=!1),null==t&&(t=0),null==n&&(n=0),null==Vi.poolVec2?i=new Cn:(i=Vi.poolVec2,Vi.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.x==n&&(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.y==t)||(i.zpp_inner.x=n,i.zpp_inner.y=t,null!=(t=i.zpp_inner)._invalidate&&t._invalidate(t))),i.zpp_inner.weak=e,i},Cn.fromPolar=function(n,t,e){null==e&&(e=!1);var i,p,l=n*Math.cos(t),t=n*Math.sin(t);return null==Vi.poolVec2?i=new Cn:(i=Vi.poolVec2,Vi.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=l,p.y=t,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.x==l&&(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.y==t)||(i.zpp_inner.x=l,i.zpp_inner.y=t,null!=(t=i.zpp_inner)._invalidate&&t._invalidate(t))),i.zpp_inner.weak=e,i},Cn.dsq=function(n,t){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.y,r=t.zpp_inner;null!=r._validate&&r._validate();e=t.zpp_inner.x,p=t.zpp_inner;null!=p._validate&&p._validate();var o,r=0,p=0,p=(r=i-e)*r+(p=l-t.zpp_inner.y)*p;return n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o),t.zpp_inner.weak&&(o=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o),p},Cn.distance=function(n,t){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.y,r=t.zpp_inner;null!=r._validate&&r._validate();e=t.zpp_inner.x,p=t.zpp_inner;null!=p._validate&&p._validate();var o,r=0,p=0,r=i-e,p=l-t.zpp_inner.y,p=Math.sqrt(r*r+p*p);return n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o),t.zpp_inner.weak&&(o=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o),p},Cn.prototype.zpp_inner=null,Cn.prototype.zpp_pool=null,Cn.prototype.dispose=function(){var n=this.zpp_inner;this.zpp_inner.outer=null,this.zpp_inner=null;this.zpp_pool=Vi.poolVec2,Vi.poolVec2=this,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n},Cn.prototype.copy=function(n){null==n&&(n=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i,p,t=this.zpp_inner.y;return null==Vi.poolVec2?i=new Cn:(i=Vi.poolVec2,Vi.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=e,p.y=t,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.x==e&&(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.y==t)||(i.zpp_inner.x=e,i.zpp_inner.y=t,null!=(t=i.zpp_inner)._invalidate&&t._invalidate(t))),i.zpp_inner.weak=n,i},Cn.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},Cn.prototype.set_x=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.x!=n&&(this.zpp_inner.x=n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(e));var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x},Cn.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},Cn.prototype.set_y=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.y!=n&&(this.zpp_inner.y=n,null!=(e=this.zpp_inner)._invalidate&&e._invalidate(e));var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.y},Cn.prototype.get_length=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();n=t*this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();t=this.zpp_inner.y,e=this.zpp_inner;return null!=e._validate&&e._validate(),Math.sqrt(n+t*this.zpp_inner.y)},Cn.prototype.set_length=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();i=n/Math.sqrt(t+e*this.zpp_inner.y),n=this,t=n.zpp_inner;null!=t._validate&&t._validate();e=n.zpp_inner.x*i,t=n.zpp_inner;null!=t._validate&&t._validate(),n.zpp_inner.x!=e&&(n.zpp_inner.x=e,null!=(p=n.zpp_inner)._invalidate&&p._invalidate(p));var p=n.zpp_inner;null!=p._validate&&p._validate();n=this,p=n.zpp_inner;null!=p._validate&&p._validate();p=n.zpp_inner.y*i,i=n.zpp_inner;null!=i._validate&&i._validate(),n.zpp_inner.y!=p&&(n.zpp_inner.y=p,null!=(l=n.zpp_inner)._invalidate&&l._invalidate(l));p=n.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner;null!=l._invalidate&&l._invalidate(l);n=this.zpp_inner;null!=n._validate&&n._validate();p=this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();n=p*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();p=this.zpp_inner.y,l=this.zpp_inner;return null!=l._validate&&l._validate(),Math.sqrt(n+p*this.zpp_inner.y)},Cn.prototype.lsq=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();n=t*this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();t=this.zpp_inner.y,e=this.zpp_inner;return null!=e._validate&&e._validate(),n+t*this.zpp_inner.y},Cn.prototype.set=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();t=n.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.x==e&&(null!=(i=this.zpp_inner)._validate&&i._validate(),this.zpp_inner.y==t)||(this.zpp_inner.x=e,this.zpp_inner.y=t,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(p));var p;return n.zpp_inner.weak&&(p=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p),this},Cn.prototype.setxy=function(n,t){var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x==n&&(null!=(e=this.zpp_inner)._validate&&e._validate(),this.zpp_inner.y==t)||(this.zpp_inner.x=n,this.zpp_inner.y=t,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(t)),this},Cn.prototype.get_angle=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,n=this.zpp_inner;if(null!=n._validate&&n._validate(),t==this.zpp_inner.y&&(null!=(e=this.zpp_inner)._validate&&e._validate(),0==this.zpp_inner.x))return 0;t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.y,t=this.zpp_inner;return null!=t._validate&&t._validate(),Math.atan2(e,this.zpp_inner.x)},Cn.prototype.set_angle=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();t=Math.sqrt(t+e*this.zpp_inner.y),e=t*Math.cos(n),t*=Math.sin(n),n=this.zpp_inner;null!=n._validate&&n._validate(),this.zpp_inner.x==e&&(null!=(n=this.zpp_inner)._validate&&n._validate(),this.zpp_inner.y==t)||(this.zpp_inner.x=e,this.zpp_inner.y=t,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(p));t=this.zpp_inner;null!=t._validate&&t._validate();var p=this.zpp_inner.x,t=this.zpp_inner;if(null!=t._validate&&t._validate(),p==this.zpp_inner.y&&(null!=(l=this.zpp_inner)._validate&&l._validate(),0==this.zpp_inner.x))return 0;p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,p=this.zpp_inner;return null!=p._validate&&p._validate(),Math.atan2(l,this.zpp_inner.x)},Cn.prototype.rotate=function(n){var t,e;return n%(2*Math.PI)!=0&&(t=Math.sin(n),n=(e=Math.cos(n))*this.zpp_inner.x-t*this.zpp_inner.y,this.zpp_inner.y=this.zpp_inner.x*t+this.zpp_inner.y*e,this.zpp_inner.x=n,null!=(n=this.zpp_inner)._invalidate&&n._invalidate(n)),this},Cn.prototype.reflect=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var p,e=this.zpp_inner.y;null==Vi.poolVec2?l=new Cn:(l=Vi.poolVec2,Vi.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=i,p.y=e,l.zpp_inner=p,l.zpp_inner.outer=l):(null!=(p=l.zpp_inner)._validate&&p._validate(),l.zpp_inner.x==i&&(null!=(p=l.zpp_inner)._validate&&p._validate(),l.zpp_inner.y==e)||(l.zpp_inner.x=i,l.zpp_inner.y=e,null!=(e=l.zpp_inner)._invalidate&&e._invalidate(e))),l.zpp_inner.weak=!0;var l=l.normalise(),l=n.sub(l.muleq(2*l.dot(n)),t);return n.zpp_inner.weak&&(t=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t),l},Cn.prototype.normalise=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();var i=t*this.zpp_inner.x,n=this.zpp_inner;null!=n._validate&&n._validate();e=this.zpp_inner.y,t=this.zpp_inner;null!=t._validate&&t._validate();n=1/Math.sqrt(i+e*this.zpp_inner.y),t=this,i=t.zpp_inner;null!=i._validate&&i._validate();e=t.zpp_inner.x*n,i=t.zpp_inner;null!=i._validate&&i._validate(),t.zpp_inner.x!=e&&(t.zpp_inner.x=e,null!=(p=t.zpp_inner)._invalidate&&p._invalidate(p));var p=t.zpp_inner;null!=p._validate&&p._validate();t=this,p=t.zpp_inner;null!=p._validate&&p._validate();p=t.zpp_inner.y*n,n=t.zpp_inner;null!=n._validate&&n._validate(),t.zpp_inner.y!=p&&(t.zpp_inner.y=p,null!=(p=t.zpp_inner)._invalidate&&p._invalidate(p));t=t.zpp_inner;null!=t._validate&&t._validate();t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(t),this},Cn.prototype.unit=function(n){null==n&&(n=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();i=1/Math.sqrt(t+e*this.zpp_inner.y),t=this.zpp_inner;null!=t._validate&&t._validate();e=this.zpp_inner.x*i,t=this.zpp_inner;null!=t._validate&&t._validate();var p,l,i=this.zpp_inner.y*i;return null==Vi.poolVec2?p=new Cn:(p=Vi.poolVec2,Vi.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==Ip.zpp_pool?l=new Ip:(l=Ip.zpp_pool,Ip.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,p.zpp_inner=l,p.zpp_inner.outer=p):(null!=(l=p.zpp_inner)._validate&&l._validate(),p.zpp_inner.x==e&&(null!=(l=p.zpp_inner)._validate&&l._validate(),p.zpp_inner.y==i)||(p.zpp_inner.x=e,p.zpp_inner.y=i,null!=(i=p.zpp_inner)._invalidate&&i._invalidate(i))),p.zpp_inner.weak=n,p},Cn.prototype.add=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();e=i+n.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();i=this.zpp_inner.y,p=n.zpp_inner;null!=p._validate&&p._validate();var l,i=i+n.zpp_inner.y;null==Vi.poolVec2?r=new Cn:(r=Vi.poolVec2,Vi.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ip.zpp_pool?l=new Ip:(l=Ip.zpp_pool,Ip.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,r.zpp_inner=l,r.zpp_inner.outer=r):(null!=(l=r.zpp_inner)._validate&&l._validate(),r.zpp_inner.x==e&&(null!=(l=r.zpp_inner)._validate&&l._validate(),r.zpp_inner.y==i)||(r.zpp_inner.x=e,r.zpp_inner.y=i,null!=(i=r.zpp_inner)._invalidate&&i._invalidate(i))),r.zpp_inner.weak=t;var r,t=r;return n.zpp_inner.weak&&(r=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ip.zpp_pool,Ip.zpp_pool=r),t},Cn.prototype.addMul=function(n,t,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var p=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();i=p+n.zpp_inner.x*t,l=this.zpp_inner;null!=l._validate&&l._validate();p=this.zpp_inner.y,l=n.zpp_inner;null!=l._validate&&l._validate();var r,t=p+n.zpp_inner.y*t;null==Vi.poolVec2?o=new Cn:(o=Vi.poolVec2,Vi.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ip.zpp_pool?r=new Ip:(r=Ip.zpp_pool,Ip.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=t,o.zpp_inner=r,o.zpp_inner.outer=o):(null!=(r=o.zpp_inner)._validate&&r._validate(),o.zpp_inner.x==i&&(null!=(r=o.zpp_inner)._validate&&r._validate(),o.zpp_inner.y==t)||(o.zpp_inner.x=i,o.zpp_inner.y=t,null!=(t=o.zpp_inner)._invalidate&&t._invalidate(t))),o.zpp_inner.weak=e;var o,e=o;return n.zpp_inner.weak&&(o=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o),e},Cn.prototype.sub=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();e=i-n.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();i=this.zpp_inner.y,p=n.zpp_inner;null!=p._validate&&p._validate();var l,i=i-n.zpp_inner.y;null==Vi.poolVec2?r=new Cn:(r=Vi.poolVec2,Vi.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ip.zpp_pool?l=new Ip:(l=Ip.zpp_pool,Ip.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,r.zpp_inner=l,r.zpp_inner.outer=r):(null!=(l=r.zpp_inner)._validate&&l._validate(),r.zpp_inner.x==e&&(null!=(l=r.zpp_inner)._validate&&l._validate(),r.zpp_inner.y==i)||(r.zpp_inner.x=e,r.zpp_inner.y=i,null!=(i=r.zpp_inner)._invalidate&&i._invalidate(i))),r.zpp_inner.weak=t;var r,t=r;return n.zpp_inner.weak&&(r=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ip.zpp_pool,Ip.zpp_pool=r),t},Cn.prototype.mul=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x*n,e=this.zpp_inner;null!=e._validate&&e._validate();var p,l,n=this.zpp_inner.y*n;return null==Vi.poolVec2?p=new Cn:(p=Vi.poolVec2,Vi.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==Ip.zpp_pool?l=new Ip:(l=Ip.zpp_pool,Ip.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=i,l.y=n,p.zpp_inner=l,p.zpp_inner.outer=p):(null!=(l=p.zpp_inner)._validate&&l._validate(),p.zpp_inner.x==i&&(null!=(l=p.zpp_inner)._validate&&l._validate(),p.zpp_inner.y==n)||(p.zpp_inner.x=i,p.zpp_inner.y=n,null!=(n=p.zpp_inner)._invalidate&&n._invalidate(n))),p.zpp_inner.weak=t,p},Cn.prototype.addeq=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();t=e+n.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=n.zpp_inner;null!=i._validate&&i._validate();var p,i=e+n.zpp_inner.y,e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x==t&&(null!=(e=this.zpp_inner)._validate&&e._validate(),this.zpp_inner.y==i)||(this.zpp_inner.x=t,this.zpp_inner.y=i,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(p)),n.zpp_inner.weak&&(p=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p),this},Cn.prototype.subeq=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();t=e-n.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=n.zpp_inner;null!=i._validate&&i._validate();var p,i=e-n.zpp_inner.y,e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x==t&&(null!=(e=this.zpp_inner)._validate&&e._validate(),this.zpp_inner.y==i)||(this.zpp_inner.x=t,this.zpp_inner.y=i,null!=(p=this.zpp_inner)._invalidate&&p._invalidate(p)),n.zpp_inner.weak&&(p=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p),this},Cn.prototype.muleq=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x*n,t=this.zpp_inner;null!=t._validate&&t._validate();t=this.zpp_inner.y*n,n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x==e&&(null!=(n=this.zpp_inner)._validate&&n._validate(),this.zpp_inner.y==t)||(this.zpp_inner.x=e,this.zpp_inner.y=t,null!=(t=this.zpp_inner)._invalidate&&t._invalidate(t)),this},Cn.prototype.dot=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();t=e*n.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=n.zpp_inner;null!=i._validate&&i._validate();t+=e*n.zpp_inner.y;return n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e),t},Cn.prototype.cross=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();e=n.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t-=e*this.zpp_inner.y;return n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e),t},Cn.prototype.perp=function(n){null==n&&(n=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var e=-this.zpp_inner.y,t=this.zpp_inner;null!=t._validate&&t._validate();var i,p,t=this.zpp_inner.x;return null==Vi.poolVec2?i=new Cn:(i=Vi.poolVec2,Vi.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=e,p.y=t,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.x==e&&(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.y==t)||(i.zpp_inner.x=e,i.zpp_inner.y=t,null!=(t=i.zpp_inner)._invalidate&&t._invalidate(t))),i.zpp_inner.weak=n,i},Cn.prototype.toString=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.toString()},Object.defineProperty(Cn.prototype,"x",{get:Cn.prototype.get_x,set:Cn.prototype.set_x}),Object.defineProperty(Cn.prototype,"y",{get:Cn.prototype.get_y,set:Cn.prototype.set_y}),Object.defineProperty(Cn.prototype,"length",{get:Cn.prototype.get_length,set:Cn.prototype.set_length}),Object.defineProperty(Cn.prototype,"angle",{get:Cn.prototype.get_angle,set:Cn.prototype.set_angle}),Cn.prototype.__class__=Cn;var Qn=nape.geom.Vec2Iterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Qn.__name__=["nape","geom","Vec2Iterator"],Qn.get=function(n){var t,e=null==Qn.zpp_pool?(Pi.internal=!0,t=new Qn,Pi.internal=!1,t):(e=Qn.zpp_pool,Qn.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Qn.prototype.zpp_inner=null,Qn.prototype.zpp_i=null,Qn.prototype.zpp_critical=null,Qn.prototype.zpp_next=null,Qn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=this).zpp_inner=null,!1)},Qn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Qn.prototype.__class__=Qn;var Y=nape.geom.Vec2List=function(){this.zpp_inner=null,this.zpp_inner=new Pi,this.zpp_inner.outer=this};Y.__name__=["nape","geom","Vec2List"],Y.fromArray=function(n){for(var t=new Y,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},Y.prototype.zpp_inner=null,Y.prototype.get_length=function(){return this.zpp_gl()},Y.prototype.zpp_gl=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},Y.prototype.zpp_vm=function(){this.zpp_inner.valmod()},Y.prototype.has=function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},Y.prototype.at=function(n){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;var t,e=this.zpp_inner.at_ite.elt;return null==e.outer&&(e.outer=new Cn,null!=(t=e.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,e.outer.zpp_inner=e),e.outer},Y.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},Y.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},Y.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null==(i=this.zpp_inner.inner.head.elt).outer&&(i.outer=new Cn,null!=(n=i.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n,i.outer.zpp_inner=i),n=i.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),null==(i=(null==(e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head:e.next).elt).outer&&(i.outer=new Cn,null!=(t=i.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,i.outer.zpp_inner=i),t=i.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)),this.zpp_inner.invalidate(),null==i.outer&&(i.outer=new Cn,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,i.outer.zpp_inner=i),i.outer},Y.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),null==(i=(null==(n=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2))?this.zpp_inner.inner.head:n.next).elt).outer&&(i.outer=new Cn,null!=(t=i.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,i.outer.zpp_inner=i),t=i.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)):(null==(i=this.zpp_inner.inner.head.elt).outer&&(i.outer=new Cn,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,i.outer.zpp_inner=i),e=i.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),null==i.outer&&(i.outer=new Cn,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,i.outer.zpp_inner=i),i.outer},Y.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},Y.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},Y.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},Y.prototype.empty=function(){return 0==this.zpp_gl()},Y.prototype.iterator=function(){return this.zpp_vm(),Qn.get(this)},Y.prototype.copy=function(n){null==n&&(n=!1);for(var t=new Y,e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;var p,l,r,o,a=e.zpp_inner.at(e.zpp_i++),a=n?(null!=(o=a.zpp_inner)._validate&&o._validate(),p=a.zpp_inner.x,null!=(i=a.zpp_inner)._validate&&i._validate(),o=a.zpp_inner.y,null==Vi.poolVec2?l=new Cn:(l=Vi.poolVec2,Vi.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==Ip.zpp_pool?r=new Ip:(r=Ip.zpp_pool,Ip.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=p,r.y=o,l.zpp_inner=r,l.zpp_inner.outer=l):(null!=(i=l.zpp_inner)._validate&&i._validate(),l.zpp_inner.x==p&&(null!=(i=l.zpp_inner)._validate&&i._validate(),l.zpp_inner.y==o)||(l.zpp_inner.x=p,l.zpp_inner.y=o,null!=(o=l.zpp_inner)._invalidate&&o._invalidate(o))),l.zpp_inner.weak=!1,l):a;t.push(a)}return t},Y.prototype.merge=function(n){for(var t=n.iterator();;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||this.add(e)}},Y.prototype.toString=function(){for(var n="[",t=!0,e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},Y.prototype.foreach=function(n){for(var t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=t).zpp_inner=null;break}}return this},Y.prototype.filter=function(n){for(var t=0;t<this.zpp_gl();){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(Y.prototype,"length",{get:Y.prototype.get_length}),Y.prototype.__class__=Y;var J=nape.geom.Vec3=function(n,t,e){null==e&&(e=0),null==t&&(t=0),null==n&&(n=0),this.zpp_pool=null,this.zpp_inner=null,this.zpp_inner=new Ft,(this.zpp_inner.outer=this).zpp_inner.x=n;n=this.zpp_inner;null!=n._validate&&n._validate(),this.zpp_inner.y=t;t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.z=e;e=this.zpp_inner;null!=e._validate&&e._validate()};J.__name__=["nape","geom","Vec3"],J.get=function(n,t,e){var i;return null==e&&(e=0),null==t&&(t=0),null==n&&(n=0),null==Vi.poolVec3?i=new J:(i=Vi.poolVec3,Vi.poolVec3=i.zpp_pool,i.zpp_pool=null),i.setxyz(n,t,e),i.zpp_inner.immutable=!1,i.zpp_inner._validate=null,i},J.prototype.zpp_inner=null,J.prototype.zpp_pool=null,J.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},J.prototype.set_x=function(n){this.zpp_inner.x=n;n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},J.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},J.prototype.set_y=function(n){this.zpp_inner.y=n;n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},J.prototype.get_z=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.z},J.prototype.set_z=function(n){this.zpp_inner.z=n;n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.z},J.prototype.dispose=function(){this.zpp_pool=Vi.poolVec3,Vi.poolVec3=this},J.prototype.get_length=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();n=t*this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();t=this.zpp_inner.y,e=this.zpp_inner;null!=e._validate&&e._validate();e=n+t*this.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate();t=this.zpp_inner.z,n=this.zpp_inner;return null!=n._validate&&n._validate(),Math.sqrt(e+t*this.zpp_inner.z)},J.prototype.set_length=function(n){var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();t=e*this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();e=this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();i=t+e*this.zpp_inner.y,t=this.zpp_inner;null!=t._validate&&t._validate();e=this.zpp_inner.z,t=this.zpp_inner;null!=t._validate&&t._validate();n/=Math.sqrt(i+e*this.zpp_inner.z),i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.x=this.zpp_inner.x*n;e=this.zpp_inner;null!=e._validate&&e._validate();i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.y=this.zpp_inner.y*n;e=this.zpp_inner;null!=e._validate&&e._validate();i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.z=this.zpp_inner.z*n;e=this.zpp_inner;null!=e._validate&&e._validate();i=this.zpp_inner;null!=i._validate&&i._validate();n=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();i=n*this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();n=this.zpp_inner.y,e=this.zpp_inner;null!=e._validate&&e._validate();e=i+n*this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();n=this.zpp_inner.z,i=this.zpp_inner;return null!=i._validate&&i._validate(),Math.sqrt(e+n*this.zpp_inner.z)},J.prototype.lsq=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t=this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();n=t*this.zpp_inner.x,e=this.zpp_inner;null!=e._validate&&e._validate();t=this.zpp_inner.y,e=this.zpp_inner;null!=e._validate&&e._validate();e=n+t*this.zpp_inner.y,n=this.zpp_inner;null!=n._validate&&n._validate();t=this.zpp_inner.z,n=this.zpp_inner;return null!=n._validate&&n._validate(),e+t*this.zpp_inner.z},J.prototype.set=function(n){var t=n.zpp_inner;null!=t._validate&&t._validate();var e=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();t=n.zpp_inner.y,i=n.zpp_inner;return null!=i._validate&&i._validate(),this.setxyz(e,t,n.zpp_inner.z)},J.prototype.setxyz=function(n,t,e){this.zpp_inner.x=n;n=this.zpp_inner;null!=n._validate&&n._validate(),this.zpp_inner.y=t;t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.z=e;e=this.zpp_inner;return null!=e._validate&&e._validate(),this},J.prototype.xy=function(n){null==n&&(n=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i,p,t=this.zpp_inner.y;return null==Vi.poolVec2?i=new Cn:(i=Vi.poolVec2,Vi.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=e,p.y=t,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.x==e&&(null!=(p=i.zpp_inner)._validate&&p._validate(),i.zpp_inner.y==t)||(i.zpp_inner.x=e,i.zpp_inner.y=t,null!=(t=i.zpp_inner)._invalidate&&t._invalidate(t))),i.zpp_inner.weak=n,i},J.prototype.toString=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var t="{ x: "+this.zpp_inner.x+" y: ",n=this.zpp_inner;null!=n._validate&&n._validate();n=t+this.zpp_inner.y+" z: ",t=this.zpp_inner;return null!=t._validate&&t._validate(),n+this.zpp_inner.z+" }"},Object.defineProperty(J.prototype,"x",{get:J.prototype.get_x,set:J.prototype.set_x}),Object.defineProperty(J.prototype,"y",{get:J.prototype.get_y,set:J.prototype.set_y}),Object.defineProperty(J.prototype,"z",{get:J.prototype.get_z,set:J.prototype.set_z}),Object.defineProperty(J.prototype,"length",{get:J.prototype.get_length,set:J.prototype.set_length}),J.prototype.__class__=J;var H=nape.geom.Winding=function(){};H.__name__=["nape","geom","Winding"],H.UNDEFINED=null,H.get_UNDEFINED=function(){return null==Yi.Winding_UNDEFINED&&(Yi.internal=!0,Yi.Winding_UNDEFINED=new H,Yi.internal=!1),Yi.Winding_UNDEFINED},H.CLOCKWISE=null,H.get_CLOCKWISE=function(){return null==Yi.Winding_CLOCKWISE&&(Yi.internal=!0,Yi.Winding_CLOCKWISE=new H,Yi.internal=!1),Yi.Winding_CLOCKWISE},H.ANTICLOCKWISE=null,H.get_ANTICLOCKWISE=function(){return null==Yi.Winding_ANTICLOCKWISE&&(Yi.internal=!0,Yi.Winding_ANTICLOCKWISE=new H,Yi.internal=!1),Yi.Winding_ANTICLOCKWISE},H.prototype.toString=function(){return null==Yi.Winding_UNDEFINED&&(Yi.internal=!0,Yi.Winding_UNDEFINED=new H,Yi.internal=!1),this==Yi.Winding_UNDEFINED?"UNDEFINED":(null==Yi.Winding_CLOCKWISE&&(Yi.internal=!0,Yi.Winding_CLOCKWISE=new H,Yi.internal=!1),this==Yi.Winding_CLOCKWISE?"CLOCKWISE":(null==Yi.Winding_ANTICLOCKWISE&&(Yi.internal=!0,Yi.Winding_ANTICLOCKWISE=new H,Yi.internal=!1),this==Yi.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""))},Object.defineProperty(H,"UNDEFINED",{get:H.get_UNDEFINED}),Object.defineProperty(H,"CLOCKWISE",{get:H.get_CLOCKWISE}),Object.defineProperty(H,"ANTICLOCKWISE",{get:H.get_ANTICLOCKWISE}),H.prototype.__class__=H;var $=nape.phys.Interactor=function(){this.zpp_inner_i=null};$.__name__=["nape","phys","Interactor"],$.prototype.zpp_inner_i=null,$.prototype.get_id=function(){return this.zpp_inner_i.id},$.prototype.get_userData=function(){return null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={}),this.zpp_inner_i.userData},$.prototype.isShape=function(){return null!=this.zpp_inner_i.ishape},$.prototype.isBody=function(){return null!=this.zpp_inner_i.ibody},$.prototype.isCompound=function(){return null!=this.zpp_inner_i.icompound},$.prototype.get_castShape=function(){return null!=this.zpp_inner_i.ishape?this.zpp_inner_i.ishape.outer:null},$.prototype.get_castBody=function(){return null!=this.zpp_inner_i.ibody?this.zpp_inner_i.ibody.outer:null},$.prototype.get_castCompound=function(){return null!=this.zpp_inner_i.icompound?this.zpp_inner_i.icompound.outer:null},$.prototype.get_group=function(){return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},$.prototype.set_group=function(n){return this.zpp_inner_i.immutable_midstep("Interactor::group"),this.zpp_inner_i.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},$.prototype.get_cbTypes=function(){return null==this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes(),this.zpp_inner_i.wrap_cbTypes},$.prototype.toString=function(){return""},Object.defineProperty($.prototype,"id",{get:$.prototype.get_id}),Object.defineProperty($.prototype,"userData",{get:$.prototype.get_userData}),Object.defineProperty($.prototype,"castShape",{get:$.prototype.get_castShape}),Object.defineProperty($.prototype,"castBody",{get:$.prototype.get_castBody}),Object.defineProperty($.prototype,"castCompound",{get:$.prototype.get_castCompound}),Object.defineProperty($.prototype,"group",{get:$.prototype.get_group,set:$.prototype.set_group}),Object.defineProperty($.prototype,"cbTypes",{get:$.prototype.get_cbTypes}),$.prototype.__class__=$;var Q=nape.phys.Body=function(n,t){var e,i;this.debugDraw=!0,this.zpp_inner=null,$.call(this),this.zpp_inner=new Rt,((this.zpp_inner.outer=this).zpp_inner.outer_i=this).zpp_inner_i=this.zpp_inner,null!=t?(null!=(e=t.zpp_inner)._validate&&e._validate(),this.zpp_inner.posx=t.zpp_inner.x,null!=(e=t.zpp_inner)._validate&&e._validate(),this.zpp_inner.posy=t.zpp_inner.y):(this.zpp_inner.posx=0,this.zpp_inner.posy=0),n=null==n?(null==Yi.BodyType_DYNAMIC&&(Yi.internal=!0,Yi.BodyType_DYNAMIC=new tn,Yi.internal=!1),Yi.BodyType_DYNAMIC):n,this.zpp_inner.immutable_midstep("Body::type"),Rt.types[this.zpp_inner.type]!=n&&(null==Yi.BodyType_DYNAMIC&&(Yi.internal=!0,Yi.BodyType_DYNAMIC=new tn,Yi.internal=!1),1==(i=n==Yi.BodyType_DYNAMIC?2:(null==Yi.BodyType_KINEMATIC&&(Yi.internal=!0,Yi.BodyType_KINEMATIC=new tn,Yi.internal=!1),n==Yi.BodyType_KINEMATIC?3:1))&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,i):this.zpp_inner.type=i),null!=t&&t.zpp_inner.weak&&(i=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ip.zpp_pool,Ip.zpp_pool=i),this.zpp_inner_i.insert_cbtype(Sn.ANY_BODY.zpp_inner)};Q.__name__=["nape","phys","Body"],Q.__super__=$,Q.prototype=Object.create($.prototype),Q.prototype.zpp_inner=null,Q.prototype.debugDraw=null,Q.prototype.get_type=function(){return Rt.types[this.zpp_inner.type]},Q.prototype.set_type=function(n){return this.zpp_inner.immutable_midstep("Body::type"),Rt.types[this.zpp_inner.type]!=n&&(null==Yi.BodyType_DYNAMIC&&(Yi.internal=!0,Yi.BodyType_DYNAMIC=new tn,Yi.internal=!1),1==(n=n==Yi.BodyType_DYNAMIC?2:(null==Yi.BodyType_KINEMATIC&&(Yi.internal=!0,Yi.BodyType_KINEMATIC=new tn,Yi.internal=!1),n==Yi.BodyType_KINEMATIC?3:1))&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,n):this.zpp_inner.type=n),Rt.types[this.zpp_inner.type]},Q.prototype.get_isBullet=function(){return this.zpp_inner.bulletEnabled},Q.prototype.set_isBullet=function(n){return this.zpp_inner.bulletEnabled=n,this.zpp_inner.bulletEnabled},Q.prototype.get_disableCCD=function(){return this.zpp_inner.disableCCD},Q.prototype.set_disableCCD=function(n){return this.zpp_inner.disableCCD=n,this.zpp_inner.disableCCD},Q.prototype.integrate=function(n){if(this.zpp_inner.immutable_midstep("Body::space"),0==n)return this;var t=this.zpp_inner;t.sweepTime=0,t.sweep_angvel=t.angvel;var e,i,p=n-t.sweepTime;0!=p&&(t.sweepTime=n,t.posx+=t.velx*p,t.posy+=t.vely*p,0!=t.angvel&&(e=t.sweep_angvel*p,t.rot+=e,1e-4<e*e?(t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)):(n=1-(i=e*e)*i/8,i=((p=1-.5*i)*t.axisx+e*t.axisy)*n,t.axisy=(p*t.axisy-e*t.axisx)*n,t.axisx=i)));for(var l=t.shapes.head;null!=l;){var r=l.elt;1==r.type&&(r.polygon.invalidate_gverts(),r.polygon.invalidate_gaxi()),r.invalidate_worldCOM(),l=l.next}t.zip_worldCOM=!0,t.zip_axis=!0;for(var o=t.shapes.head;null!=o;){var a=o.elt;1==a.type&&(a.polygon.invalidate_gverts(),a.polygon.invalidate_gaxi()),a.invalidate_worldCOM(),o=o.next}return t.zip_worldCOM=!0,t.sweepTime=0,this},Q.prototype.isStatic=function(){return 1==this.zpp_inner.type},Q.prototype.isDynamic=function(){return 2==this.zpp_inner.type},Q.prototype.isKinematic=function(){return 3==this.zpp_inner.type},Q.prototype.get_shapes=function(){return this.zpp_inner.wrap_shapes},Q.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},Q.prototype.set_compound=function(n){return(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(this),null!=n&&((n=n.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?n.push(this):n.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},Q.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},Q.prototype.set_space=function(n){return this.zpp_inner.immutable_midstep("Body::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.component.woken=!1),null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this),null!=n&&((n=n.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?n.push(this):n.unshift(this))),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},Q.prototype.get_arbiters=function(){return null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0)),this.zpp_inner.wrap_arbiters},Q.prototype.get_isSleeping=function(){return this.zpp_inner.component.sleeping},Q.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=gi.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},Q.prototype.copy=function(){return this.zpp_inner.copy()},Q.prototype.get_position=function(){return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},Q.prototype.set_position=function(n){null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var t=this.zpp_inner.wrap_pos,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},Q.prototype.get_velocity=function(){return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},Q.prototype.set_velocity=function(n){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var t=this.zpp_inner.wrap_vel,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},Q.prototype.setVelocityFromTarget=function(n,t,e){var i=1/e;null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var p=this.zpp_inner.wrap_vel;null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var l=n.sub(this.zpp_inner.wrap_pos,!0).muleq(i),r=l.zpp_inner;null!=r._validate&&r._validate();var o=l.zpp_inner.x,e=l.zpp_inner;null!=e._validate&&e._validate();var a,r=l.zpp_inner.y,e=p.zpp_inner;null!=e._validate&&e._validate(),p.zpp_inner.x==o&&(null!=(e=p.zpp_inner)._validate&&e._validate(),p.zpp_inner.y==r)||(p.zpp_inner.x=o,p.zpp_inner.y=r,null!=(a=p.zpp_inner)._invalidate&&a._invalidate(a)),l.zpp_inner.weak&&(a=l.zpp_inner,l.zpp_inner.outer=null,l.zpp_inner=null,l.zpp_pool=Vi.poolVec2,Vi.poolVec2=l,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a);i=(t-this.zpp_inner.rot)*i;return this.zpp_inner.angvel!=i&&(this.zpp_inner.angvel=i,this.zpp_inner.wake()),n.zpp_inner.weak&&(i=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ip.zpp_pool,Ip.zpp_pool=i),this},Q.prototype.get_kinematicVel=function(){return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},Q.prototype.set_kinematicVel=function(n){null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel();var t=this.zpp_inner.wrap_kinvel,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},Q.prototype.get_surfaceVel=function(){return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},Q.prototype.set_surfaceVel=function(n){null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel();var t=this.zpp_inner.wrap_svel,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},Q.prototype.get_force=function(){return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},Q.prototype.set_force=function(n){null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce();var t=this.zpp_inner.wrap_force,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},Q.prototype.get_constraintVelocity=function(){return null==this.zpp_inner.wrapcvel&&this.zpp_inner.setup_cvel(),this.zpp_inner.wrapcvel},Q.prototype.get_rotation=function(){return this.zpp_inner.rot},Q.prototype.set_rotation=function(n){if(this.zpp_inner.immutable_midstep("Body::rotation"),this.zpp_inner.rot!=n){this.zpp_inner.rot=n;n=this.zpp_inner;n.zip_axis=!0;for(var t=n.shapes.head;null!=t;){var e=t.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),t=t.next}n.zip_worldCOM=!0,this.zpp_inner.wake()}return this.zpp_inner.rot},Q.prototype.get_angularVel=function(){return this.zpp_inner.angvel},Q.prototype.set_angularVel=function(n){return this.zpp_inner.angvel!=n&&(this.zpp_inner.angvel=n,this.zpp_inner.wake()),this.zpp_inner.angvel},Q.prototype.get_kinAngVel=function(){return this.zpp_inner.kinangvel},Q.prototype.set_kinAngVel=function(n){return this.zpp_inner.kinangvel!=n&&(this.zpp_inner.kinangvel=n,this.zpp_inner.wake()),this.zpp_inner.kinangvel},Q.prototype.get_torque=function(){return this.zpp_inner.torque},Q.prototype.set_torque=function(n){return this.zpp_inner.torque!=n&&(this.zpp_inner.torque=n,this.zpp_inner.wake()),this.zpp_inner.torque},Q.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},Q.prototype.get_allowMovement=function(){return!this.zpp_inner.nomove},Q.prototype.set_allowMovement=function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.nomove!=n&&(this.zpp_inner.nomove=!n,this.zpp_inner.invalidate_mass()),!this.zpp_inner.nomove},Q.prototype.get_allowRotation=function(){return!this.zpp_inner.norotate},Q.prototype.set_allowRotation=function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.norotate!=n&&(this.zpp_inner.norotate=!n,this.zpp_inner.invalidate_inertia()),!this.zpp_inner.norotate},Q.prototype.get_massMode=function(){null==Yi.MassMode_DEFAULT&&(Yi.internal=!0,Yi.MassMode_DEFAULT=new sn,Yi.internal=!1);var n=Yi.MassMode_DEFAULT;return null==Yi.MassMode_FIXED&&(Yi.internal=!0,Yi.MassMode_FIXED=new sn,Yi.internal=!1),[n,Yi.MassMode_FIXED][this.zpp_inner.massMode]},Q.prototype.set_massMode=function(n){this.zpp_inner.immutable_midstep("Body::massMode"),null==Yi.MassMode_DEFAULT&&(Yi.internal=!0,Yi.MassMode_DEFAULT=new sn,Yi.internal=!1),n=n==Yi.MassMode_DEFAULT?0:1,this.zpp_inner.massMode=n,this.zpp_inner.invalidate_mass(),null==Yi.MassMode_DEFAULT&&(Yi.internal=!0,Yi.MassMode_DEFAULT=new sn,Yi.internal=!1);n=Yi.MassMode_DEFAULT;return null==Yi.MassMode_FIXED&&(Yi.internal=!0,Yi.MassMode_FIXED=new sn,Yi.internal=!1),[n,Yi.MassMode_FIXED][this.zpp_inner.massMode]},Q.prototype.get_constraintMass=function(){return this.zpp_inner.world||this.zpp_inner.validate_mass(),this.zpp_inner.smass},Q.prototype.get_mass=function(){return this.zpp_inner.validate_mass(),this.zpp_inner.cmass},Q.prototype.set_mass=function(n){return this.zpp_inner.immutable_midstep("Body::mass"),this.zpp_inner.massMode=1,this.zpp_inner.cmass=n,this.zpp_inner.invalidate_mass(),this.zpp_inner.validate_mass(),this.zpp_inner.cmass},Q.prototype.get_gravMassMode=function(){null==Yi.GravMassMode_DEFAULT&&(Yi.internal=!0,Yi.GravMassMode_DEFAULT=new rn,Yi.internal=!1);var n=Yi.GravMassMode_DEFAULT;null==Yi.GravMassMode_FIXED&&(Yi.internal=!0,Yi.GravMassMode_FIXED=new rn,Yi.internal=!1);var t=Yi.GravMassMode_FIXED;return null==Yi.GravMassMode_SCALED&&(Yi.internal=!0,Yi.GravMassMode_SCALED=new rn,Yi.internal=!1),[n,t,Yi.GravMassMode_SCALED][this.zpp_inner.massMode]},Q.prototype.set_gravMassMode=function(n){this.zpp_inner.immutable_midstep("Body::gravMassMode"),null==Yi.GravMassMode_SCALED&&(Yi.internal=!0,Yi.GravMassMode_SCALED=new rn,Yi.internal=!1),t=n==Yi.GravMassMode_SCALED?2:(null==Yi.GravMassMode_DEFAULT&&(Yi.internal=!0,Yi.GravMassMode_DEFAULT=new rn,Yi.internal=!1),n==Yi.GravMassMode_DEFAULT?0:1),this.zpp_inner.gravMassMode=t,this.zpp_inner.invalidate_gravMass(),null==Yi.GravMassMode_DEFAULT&&(Yi.internal=!0,Yi.GravMassMode_DEFAULT=new rn,Yi.internal=!1);n=Yi.GravMassMode_DEFAULT;null==Yi.GravMassMode_FIXED&&(Yi.internal=!0,Yi.GravMassMode_FIXED=new rn,Yi.internal=!1);var t=Yi.GravMassMode_FIXED;return null==Yi.GravMassMode_SCALED&&(Yi.internal=!0,Yi.GravMassMode_SCALED=new rn,Yi.internal=!1),[n,t,Yi.GravMassMode_SCALED][this.zpp_inner.massMode]},Q.prototype.get_gravMass=function(){return this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},Q.prototype.set_gravMass=function(n){return this.zpp_inner.immutable_midstep("Body::gravMass"),this.zpp_inner.gravMassMode=1,this.zpp_inner.gravMass=n,this.zpp_inner.invalidate_gravMass(),this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},Q.prototype.get_gravMassScale=function(){return this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},Q.prototype.set_gravMassScale=function(n){return this.zpp_inner.immutable_midstep("Body::gravMassScale"),this.zpp_inner.gravMassMode=2,this.zpp_inner.gravMassScale=n,this.zpp_inner.invalidate_gravMassScale(),this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},Q.prototype.get_inertiaMode=function(){null==Yi.InertiaMode_DEFAULT&&(Yi.internal=!0,Yi.InertiaMode_DEFAULT=new on,Yi.internal=!1);var n=Yi.InertiaMode_DEFAULT;return null==Yi.InertiaMode_FIXED&&(Yi.internal=!0,Yi.InertiaMode_FIXED=new on,Yi.internal=!1),[n,Yi.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},Q.prototype.set_inertiaMode=function(n){this.zpp_inner.immutable_midstep("Body::inertiaMode"),null==Yi.InertiaMode_FIXED&&(Yi.internal=!0,Yi.InertiaMode_FIXED=new on,Yi.internal=!1),n=n==Yi.InertiaMode_FIXED?1:0,this.zpp_inner.inertiaMode=n,this.zpp_inner.invalidate_inertia(),null==Yi.InertiaMode_DEFAULT&&(Yi.internal=!0,Yi.InertiaMode_DEFAULT=new on,Yi.internal=!1);n=Yi.InertiaMode_DEFAULT;return null==Yi.InertiaMode_FIXED&&(Yi.internal=!0,Yi.InertiaMode_FIXED=new on,Yi.internal=!1),[n,Yi.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},Q.prototype.get_constraintInertia=function(){return this.zpp_inner.world||this.zpp_inner.validate_inertia(),this.zpp_inner.sinertia},Q.prototype.get_inertia=function(){return this.zpp_inner.validate_inertia(),this.zpp_inner.cinertia},Q.prototype.set_inertia=function(n){return this.zpp_inner.immutable_midstep("Body::inertia"),this.zpp_inner.inertiaMode=1,this.zpp_inner.cinertia=n,this.zpp_inner.invalidate_inertia(),this.zpp_inner.validate_inertia(),this.zpp_inner.cinertia},Q.prototype.connectedBodies=function(n,t){return null==n&&(n=-1),this.zpp_inner.connectedBodies(n,t)},Q.prototype.interactingBodies=function(n,t,e){return null==t&&(t=-1),n=null==n?Qt.COL|Qt.SENSOR|Qt.FLUID:(null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),n==Yi.InteractionType_COLLISION?Qt.COL:(null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),n==Yi.InteractionType_SENSOR?Qt.SENSOR:Qt.FLUID)),this.zpp_inner.interactingBodies(n,t,e)},Q.prototype.crushFactor=function(){var n,t=0;null==Vi.poolVec2?c=new Cn:(c=Vi.poolVec2,Vi.poolVec2=c.zpp_pool,c.zpp_pool=null),null==c.zpp_inner?(null==Ip.zpp_pool?n=new Ip:(n=Ip.zpp_pool,Ip.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=!1,n.x=0,n.y=0,c.zpp_inner=n,c.zpp_inner.outer=c):(null!=(n=c.zpp_inner)._validate&&n._validate(),0==c.zpp_inner.x&&(null!=(s=c.zpp_inner)._validate&&s._validate(),0==c.zpp_inner.y)||(c.zpp_inner.x=0,c.zpp_inner.y=0,null!=(z=c.zpp_inner)._invalidate&&z._invalidate(z))),c.zpp_inner.weak=!1;var e=c;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var i=this.zpp_inner.wrap_arbiters.iterator();;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,!(i.zpp_i<p||(i.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;var l=i.zpp_inner.at(i.zpp_i++).totalImpulse(this),r=l.xy();e.addeq(r);var o=r.zpp_inner;null!=o._validate&&o._validate();var a=r.zpp_inner.x,p=r.zpp_inner;null!=p._validate&&p._validate();o=a*r.zpp_inner.x,p=r.zpp_inner;null!=p._validate&&p._validate();a=r.zpp_inner.y,p=r.zpp_inner;null!=p._validate&&p._validate(),t+=Math.sqrt(o+a*r.zpp_inner.y);a=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Vi.poolVec2,Vi.poolVec2=r,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a,l.dispose()}null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=gi.get(this.zpp_inner.constraints,!0));var s=this.zpp_inner.wrap_constraints;s.zpp_inner.valmod();for(var _=Kn.get(s);;){_.zpp_inner.zpp_inner.valmod();var h=_.zpp_inner;h.zpp_inner.valmod(),h.zpp_inner.zip_length&&(h.zpp_inner.zip_length=!1,h.zpp_inner.user_length=h.zpp_inner.inner.length);var u=h.zpp_inner.user_length;if(_.zpp_critical=!0,!(_.zpp_i<u||(_.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=_).zpp_inner=null,!1)))break;_.zpp_critical=!1;var x=_.zpp_inner.at(_.zpp_i++).bodyImpulse(this),d=x.xy();e.addeq(d);var y=d.zpp_inner;null!=y._validate&&y._validate();h=d.zpp_inner.x,u=d.zpp_inner;null!=u._validate&&u._validate();y=h*d.zpp_inner.x,u=d.zpp_inner;null!=u._validate&&u._validate();h=d.zpp_inner.y,u=d.zpp_inner;null!=u._validate&&u._validate(),t+=Math.sqrt(y+h*d.zpp_inner.y);h=d.zpp_inner;d.zpp_inner.outer=null,d.zpp_inner=null,d.zpp_pool=Vi.poolVec2,Vi.poolVec2=d,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Ip.zpp_pool,Ip.zpp_pool=h,x.dispose()}var z=e.zpp_inner;null!=z._validate&&z._validate();var c=e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();z=c*e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();c=e.zpp_inner.y,s=e.zpp_inner;null!=s._validate&&s._validate();z=t-Math.sqrt(z+c*e.zpp_inner.y);this.zpp_inner.validate_mass();c=z/(this.zpp_inner.cmass*(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.pre_dt),z=e.zpp_inner;return e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=Ip.zpp_pool,Ip.zpp_pool=z,c},Q.prototype.localPointToWorld=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));var i=0,p=n.zpp_inner;null!=p._validate&&p._validate();e=this.zpp_inner.axisy*n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate(),o=e-this.zpp_inner.axisx*n.zpp_inner.y;p=n.zpp_inner;null!=p._validate&&p._validate();e=n.zpp_inner.x*this.zpp_inner.axisx,p=n.zpp_inner;null!=p._validate&&p._validate(),i=e+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e);var l,r,o=o+this.zpp_inner.posx,i=i+this.zpp_inner.posy;return null==Vi.poolVec2?l=new Cn:(l=Vi.poolVec2,Vi.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner?(null==Ip.zpp_pool?r=new Ip:(r=Ip.zpp_pool,Ip.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=o,r.y=i,l.zpp_inner=r,l.zpp_inner.outer=l):(null!=(r=l.zpp_inner)._validate&&r._validate(),l.zpp_inner.x==o&&(null!=(r=l.zpp_inner)._validate&&r._validate(),l.zpp_inner.y==i)||(l.zpp_inner.x=o,l.zpp_inner.y=i,null!=(i=l.zpp_inner)._invalidate&&i._invalidate(i))),l.zpp_inner.weak=t,l},Q.prototype.worldPointToLocal=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));var i,p,l=0,r=0,e=n.zpp_inner;null!=e._validate&&e._validate(),r=n.zpp_inner.x-this.zpp_inner.posx;var o,a,e=n.zpp_inner;return null!=e._validate&&e._validate(),p=n.zpp_inner.y-this.zpp_inner.posy,i=r*this.zpp_inner.axisy+p*this.zpp_inner.axisx,l=p*this.zpp_inner.axisy-r*this.zpp_inner.axisx,n.zpp_inner.weak&&(r=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ip.zpp_pool,Ip.zpp_pool=r),null==Vi.poolVec2?o=new Cn:(o=Vi.poolVec2,Vi.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner?(null==Ip.zpp_pool?a=new Ip:(a=Ip.zpp_pool,Ip.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=i,a.y=l,o.zpp_inner=a,o.zpp_inner.outer=o):(null!=(a=o.zpp_inner)._validate&&a._validate(),o.zpp_inner.x==i&&(null!=(a=o.zpp_inner)._validate&&a._validate(),o.zpp_inner.y==l)||(o.zpp_inner.x=i,o.zpp_inner.y=l,null!=(l=o.zpp_inner)._invalidate&&l._invalidate(l))),o.zpp_inner.weak=t,o},Q.prototype.localVectorToWorld=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));var i,p=0,l=n.zpp_inner;null!=l._validate&&l._validate();e=this.zpp_inner.axisy*n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate(),i=e-this.zpp_inner.axisx*n.zpp_inner.y;l=n.zpp_inner;null!=l._validate&&l._validate();var r,o,e=n.zpp_inner.x*this.zpp_inner.axisx,l=n.zpp_inner;return null!=l._validate&&l._validate(),p=e+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e),null==Vi.poolVec2?r=new Cn:(r=Vi.poolVec2,Vi.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ip.zpp_pool?o=new Ip:(o=Ip.zpp_pool,Ip.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=i,o.y=p,r.zpp_inner=o,r.zpp_inner.outer=r):(null!=(o=r.zpp_inner)._validate&&o._validate(),r.zpp_inner.x==i&&(null!=(o=r.zpp_inner)._validate&&o._validate(),r.zpp_inner.y==p)||(r.zpp_inner.x=i,r.zpp_inner.y=p,null!=(p=r.zpp_inner)._invalidate&&p._invalidate(p))),r.zpp_inner.weak=t,r},Q.prototype.worldVectorToLocal=function(n,t){null==t&&(t=!1);var e=this.zpp_inner;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));var i,p=0,l=n.zpp_inner;null!=l._validate&&l._validate();e=n.zpp_inner.x*this.zpp_inner.axisy,l=n.zpp_inner;null!=l._validate&&l._validate(),i=e+n.zpp_inner.y*this.zpp_inner.axisx;l=n.zpp_inner;null!=l._validate&&l._validate();var r,o,e=n.zpp_inner.y*this.zpp_inner.axisy,l=n.zpp_inner;return null!=l._validate&&l._validate(),p=e-n.zpp_inner.x*this.zpp_inner.axisx,n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e),null==Vi.poolVec2?r=new Cn:(r=Vi.poolVec2,Vi.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ip.zpp_pool?o=new Ip:(o=Ip.zpp_pool,Ip.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=i,o.y=p,r.zpp_inner=o,r.zpp_inner.outer=r):(null!=(o=r.zpp_inner)._validate&&o._validate(),r.zpp_inner.x==i&&(null!=(o=r.zpp_inner)._validate&&o._validate(),r.zpp_inner.y==p)||(r.zpp_inner.x=i,r.zpp_inner.y=p,null!=(p=r.zpp_inner)._invalidate&&p._invalidate(p))),r.zpp_inner.weak=t,r},Q.prototype.applyImpulse=function(n,t,e){if(null==e&&(e=!1),e&&this.zpp_inner.component.sleeping)return n.zpp_inner.weak&&(p=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p),null!=t&&t.zpp_inner.weak&&(l=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),this;this.zpp_inner.validate_mass();var i=this.zpp_inner.imass,p=n.zpp_inner;null!=p._validate&&p._validate(),this.zpp_inner.velx+=n.zpp_inner.x*i;var l=n.zpp_inner;return null!=l._validate&&l._validate(),this.zpp_inner.vely+=n.zpp_inner.y*i,null!=t&&(l=p=0,null!=(i=t.zpp_inner)._validate&&i._validate(),p=t.zpp_inner.x-this.zpp_inner.posx,null!=(i=t.zpp_inner)._validate&&i._validate(),l=t.zpp_inner.y-this.zpp_inner.posy,this.zpp_inner.validate_inertia(),null!=(i=n.zpp_inner)._validate&&i._validate(),i=n.zpp_inner.y*p,null!=(p=n.zpp_inner)._validate&&p._validate(),this.zpp_inner.angvel+=(i-n.zpp_inner.x*l)*this.zpp_inner.iinertia,t.zpp_inner.weak&&(l=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l)),e||2==this.zpp_inner.type&&this.zpp_inner.wake(),n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e),this},Q.prototype.applyAngularImpulse=function(n,t){return null==t&&(t=!1),t&&this.zpp_inner.component.sleeping||(this.zpp_inner.validate_inertia(),this.zpp_inner.angvel+=n*this.zpp_inner.iinertia,t||2==this.zpp_inner.type&&this.zpp_inner.wake()),this},Q.prototype.translateShapes=function(n){this.zpp_inner.immutable_midstep("Body::translateShapes()");var t=n.zpp_inner.weak;n.zpp_inner.weak=!1;for(var e=this.zpp_inner.shapes.head;null!=e;)e.elt.outer.translate(n),e=e.next;return n.zpp_inner.weak=t,n.zpp_inner.weak&&(t=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t),this},Q.prototype.rotateShapes=function(n){this.zpp_inner.immutable_midstep("Body::rotateShapes()");for(var t=this.zpp_inner.shapes.head;null!=t;)t.elt.outer.rotate(n),t=t.next;return this},Q.prototype.scaleShapes=function(n,t){this.zpp_inner.immutable_midstep("Body::scaleShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;)e.elt.outer.scale(n,t),e=e.next;return this},Q.prototype.transformShapes=function(n){this.zpp_inner.immutable_midstep("Body::transformShapes()");for(var t=this.zpp_inner.shapes.head;null!=t;)t.elt.outer.transform(n),t=t.next;return this},Q.prototype.align=function(){this.zpp_inner.immutable_midstep("Body::align()"),this.zpp_inner.validate_localCOM();var n,t=-this.zpp_inner.localCOMx,e=-this.zpp_inner.localCOMy;null==Vi.poolVec2?p=new Cn:(p=Vi.poolVec2,Vi.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==Ip.zpp_pool?n=new Ip:(n=Ip.zpp_pool,Ip.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=!1,n.x=t,n.y=e,p.zpp_inner=n,p.zpp_inner.outer=p):(null!=(n=p.zpp_inner)._validate&&n._validate(),p.zpp_inner.x==t&&(null!=(n=p.zpp_inner)._validate&&n._validate(),p.zpp_inner.y==e)||(p.zpp_inner.x=t,p.zpp_inner.y=e,null!=(i=p.zpp_inner)._invalidate&&i._invalidate(i))),p.zpp_inner.weak=!1;var i=p;this.translateShapes(i);var p=this.localVectorToWorld(i);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos.subeq(p),this.zpp_inner.pre_posx<1/0&&(null!=(l=p.zpp_inner)._validate&&l._validate(),this.zpp_inner.pre_posx-=p.zpp_inner.x,null!=(l=p.zpp_inner)._validate&&l._validate(),this.zpp_inner.pre_posy-=p.zpp_inner.y);var l=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Vi.poolVec2,Vi.poolVec2=i,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l;l=p.zpp_inner;return p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Vi.poolVec2,Vi.poolVec2=p,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l,this},Q.prototype.rotate=function(n,t){var e=n.zpp_inner.weak;n.zpp_inner.weak=!1,null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var i=this.zpp_inner.wrap_pos.sub(n);i.rotate(t);var p=n.add(i,!0);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var l=this.zpp_inner.wrap_pos,r=p.zpp_inner;null!=r._validate&&r._validate();var o=p.zpp_inner.x,a=p.zpp_inner;null!=a._validate&&a._validate();r=p.zpp_inner.y,a=l.zpp_inner;null!=a._validate&&a._validate(),l.zpp_inner.x==o&&(null!=(a=l.zpp_inner)._validate&&a._validate(),l.zpp_inner.y==r)||(l.zpp_inner.x=o,l.zpp_inner.y=r,null!=(l=l.zpp_inner)._invalidate&&l._invalidate(l)),p.zpp_inner.weak&&(s=p.zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Vi.poolVec2,Vi.poolVec2=p,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ip.zpp_pool,Ip.zpp_pool=s),null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var s=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=Vi.poolVec2,Vi.poolVec2=i,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ip.zpp_pool,Ip.zpp_pool=s;s=this,t=s.zpp_inner.rot+t;if(s.zpp_inner.immutable_midstep("Body::rotation"),s.zpp_inner.rot!=t){s.zpp_inner.rot=t;t=s.zpp_inner;t.zip_axis=!0;for(var _=t.shapes.head;null!=_;){var h=_.elt;1==h.type&&(h.polygon.invalidate_gverts(),h.polygon.invalidate_gaxi()),h.invalidate_worldCOM(),_=_.next}t.zip_worldCOM=!0,s.zpp_inner.wake()}return n.zpp_inner.weak=e,n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e),this},Q.prototype.setShapeMaterials=function(n){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");for(var t=this.zpp_inner.shapes.head;null!=t;){var e=t.elt.outer;e.zpp_inner.immutable_midstep("Shape::material"),e.zpp_inner.setMaterial(n.zpp_inner),e.zpp_inner.material.wrapper(),t=t.next}return this},Q.prototype.setShapeFilters=function(n){this.zpp_inner.immutable_midstep("Body::setShapeFilters()");for(var t=this.zpp_inner.shapes.head;null!=t;){var e=t.elt.outer;e.zpp_inner.immutable_midstep("Shape::filter"),e.zpp_inner.setFilter(n.zpp_inner),e.zpp_inner.filter.wrapper(),t=t.next}return this},Q.prototype.setShapeFluidProperties=function(n){this.zpp_inner.immutable_midstep("Body::setShapeFluidProperties()");for(var t=this.zpp_inner.shapes.head;null!=t;){var e=t.elt.outer;e.zpp_inner.setFluid(n.zpp_inner),e.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==e.zpp_inner.fluidProperties&&e.zpp_inner.setFluid((new ln).zpp_inner),e.zpp_inner.fluidProperties.wrapper(),t=t.next}return this},Q.prototype.get_localCOM=function(){var n,t,e,i;return null==this.zpp_inner.wrap_localCOM&&(n=this.zpp_inner.localCOMx,i=this.zpp_inner.localCOMy,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=n,t.zpp_inner.y=i,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.zpp_inner.wrap_localCOM=t,this.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_localCOM.zpp_inner._validate=X(o=this.zpp_inner,o.getlocalCOM)),this.zpp_inner.wrap_localCOM},Q.prototype.get_worldCOM=function(){var n,t,e,i;return null==this.zpp_inner.wrap_worldCOM&&(n=this.zpp_inner.worldCOMx,i=this.zpp_inner.worldCOMy,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=n,t.zpp_inner.y=i,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=t,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=X(o=this.zpp_inner,o.getworldCOM)),this.zpp_inner.wrap_worldCOM},Q.prototype.normalImpulse=function(n,t){null==t&&(t=!1);var e=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<r||(l.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var o=l.zpp_inner.at(l.zpp_i++).zpp_inner;o.type==Qt.COL&&(null!=n&&o.b2!=n.zpp_inner&&o.b1!=n.zpp_inner||(null!=(r=(o=((r=o.wrapper()).zpp_inner.type==Qt.COL?r.zpp_inner.colarb.outer_zn:null).normalImpulse(this,t)).zpp_inner)._validate&&r._validate(),e+=o.zpp_inner.x,null!=(r=o.zpp_inner)._validate&&r._validate(),i+=o.zpp_inner.y,null!=(r=o.zpp_inner)._validate&&r._validate(),p+=o.zpp_inner.z,o.dispose()))}return J.get(e,i,p)},Q.prototype.tangentImpulse=function(n,t){null==t&&(t=!1);var e=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<r||(l.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var o=l.zpp_inner.at(l.zpp_i++).zpp_inner;o.type==Qt.COL&&(null!=n&&o.b2!=n.zpp_inner&&o.b1!=n.zpp_inner||(null!=(r=(o=((r=o.wrapper()).zpp_inner.type==Qt.COL?r.zpp_inner.colarb.outer_zn:null).tangentImpulse(this,t)).zpp_inner)._validate&&r._validate(),e+=o.zpp_inner.x,null!=(r=o.zpp_inner)._validate&&r._validate(),i+=o.zpp_inner.y,null!=(r=o.zpp_inner)._validate&&r._validate(),p+=o.zpp_inner.z,o.dispose()))}return J.get(e,i,p)},Q.prototype.totalContactsImpulse=function(n,t){null==t&&(t=!1);var e=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<r||(l.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var o=l.zpp_inner.at(l.zpp_i++).zpp_inner;o.type==Qt.COL&&(null!=n&&o.b2!=n.zpp_inner&&o.b1!=n.zpp_inner||(null!=(r=(o=((r=o.wrapper()).zpp_inner.type==Qt.COL?r.zpp_inner.colarb.outer_zn:null).totalImpulse(this,t)).zpp_inner)._validate&&r._validate(),e+=o.zpp_inner.x,null!=(r=o.zpp_inner)._validate&&r._validate(),i+=o.zpp_inner.y,null!=(r=o.zpp_inner)._validate&&r._validate(),p+=o.zpp_inner.z,o.dispose()))}return J.get(e,i,p)},Q.prototype.rollingImpulse=function(n,t){null==t&&(t=!1);var e=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var i=this.zpp_inner.wrap_arbiters.iterator();;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,!(i.zpp_i<p||(i.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;p=i.zpp_inner.at(i.zpp_i++).zpp_inner;p.type==Qt.COL&&(null!=n&&p.b2!=n.zpp_inner&&p.b1!=n.zpp_inner||(e+=((p=p.wrapper()).zpp_inner.type==Qt.COL?p.zpp_inner.colarb.outer_zn:null).rollingImpulse(this,t)))}return e},Q.prototype.buoyancyImpulse=function(n){var t=0,e=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1;var r=p.zpp_inner.at(p.zpp_i++).zpp_inner;r.type==Qt.FLUID&&(null!=n&&r.b2!=n.zpp_inner&&r.b1!=n.zpp_inner||(null!=(l=(r=((l=r.wrapper()).zpp_inner.type==Qt.FLUID?l.zpp_inner.fluidarb.outer_zn:null).buoyancyImpulse(this)).zpp_inner)._validate&&l._validate(),t+=r.zpp_inner.x,null!=(l=r.zpp_inner)._validate&&l._validate(),e+=r.zpp_inner.y,null!=(l=r.zpp_inner)._validate&&l._validate(),i+=r.zpp_inner.z,r.dispose()))}return J.get(t,e,i)},Q.prototype.dragImpulse=function(n){var t=0,e=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1;var r=p.zpp_inner.at(p.zpp_i++).zpp_inner;r.type==Qt.FLUID&&(null!=n&&r.b2!=n.zpp_inner&&r.b1!=n.zpp_inner||(null!=(l=(r=((l=r.wrapper()).zpp_inner.type==Qt.FLUID?l.zpp_inner.fluidarb.outer_zn:null).dragImpulse(this)).zpp_inner)._validate&&l._validate(),t+=r.zpp_inner.x,null!=(l=r.zpp_inner)._validate&&l._validate(),e+=r.zpp_inner.y,null!=(l=r.zpp_inner)._validate&&l._validate(),i+=r.zpp_inner.z,r.dispose()))}return J.get(t,e,i)},Q.prototype.totalFluidImpulse=function(n){var t=0,e=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1;var r=p.zpp_inner.at(p.zpp_i++).zpp_inner;r.type==Qt.FLUID&&(null!=n&&r.b2!=n.zpp_inner&&r.b1!=n.zpp_inner||(null!=(l=(r=((l=r.wrapper()).zpp_inner.type==Qt.FLUID?l.zpp_inner.fluidarb.outer_zn:null).totalImpulse(this)).zpp_inner)._validate&&l._validate(),t+=r.zpp_inner.x,null!=(l=r.zpp_inner)._validate&&l._validate(),e+=r.zpp_inner.y,null!=(l=r.zpp_inner)._validate&&l._validate(),i+=r.zpp_inner.z,r.dispose()))}return J.get(t,e,i)},Q.prototype.constraintsImpulse=function(){for(var n=0,t=0,e=0,i=this.zpp_inner.constraints.head;null!=i;){var p=i.elt.outer.bodyImpulse(this),l=p.zpp_inner;null!=l._validate&&l._validate(),n+=p.zpp_inner.x;l=p.zpp_inner;null!=l._validate&&l._validate(),t+=p.zpp_inner.y;l=p.zpp_inner;null!=l._validate&&l._validate(),e+=p.zpp_inner.z,p.dispose(),i=i.next}return J.get(n,t,e)},Q.prototype.totalImpulse=function(n,t){null==t&&(t=!1);var e=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=Ni.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,!(l.zpp_i<r||(l.zpp_next=Wn.zpp_pool,(Wn.zpp_pool=l).zpp_inner=null,!1)))break;l.zpp_critical=!1;var o=l.zpp_inner.at(l.zpp_i++).zpp_inner;o.type!=Qt.SENSOR&&(null!=n&&o.b2!=n.zpp_inner&&o.b1!=n.zpp_inner||(null!=(o=(r=o.wrapper().totalImpulse(this,t)).zpp_inner)._validate&&o._validate(),e+=r.zpp_inner.x,null!=(o=r.zpp_inner)._validate&&o._validate(),i+=r.zpp_inner.y,null!=(o=r.zpp_inner)._validate&&o._validate(),p+=r.zpp_inner.z,r.dispose()))}for(var a=this.zpp_inner.constraints.head;null!=a;){var s,_=a.elt;_.active&&(null!=(_=(s=_.outer.bodyImpulse(this)).zpp_inner)._validate&&_._validate(),e+=s.zpp_inner.x,null!=(_=s.zpp_inner)._validate&&_._validate(),i+=s.zpp_inner.y,null!=(_=s.zpp_inner)._validate&&_._validate(),p+=s.zpp_inner.z,s.dispose()),a=a.next}return J.get(e,i,p)},Q.prototype.contains=function(n){for(var t=n.zpp_inner.weak,e=n.zpp_inner.weak=!1,i=this.zpp_inner.shapes.head;null!=i;){if(i.elt.outer.contains(n)){e=!0;break}i=i.next}return n.zpp_inner.weak=t,n.zpp_inner.weak&&(t=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t),e},Q.prototype.toString=function(){return(this.zpp_inner.world?"(space::world":"("+(2==this.zpp_inner.type?"dynamic":1==this.zpp_inner.type?"static":"kinematic"))+")#"+this.zpp_inner_i.id},Object.defineProperty(Q.prototype,"type",{get:Q.prototype.get_type,set:Q.prototype.set_type}),Object.defineProperty(Q.prototype,"isBullet",{get:Q.prototype.get_isBullet,set:Q.prototype.set_isBullet}),Object.defineProperty(Q.prototype,"disableCCD",{get:Q.prototype.get_disableCCD,set:Q.prototype.set_disableCCD}),Object.defineProperty(Q.prototype,"shapes",{get:Q.prototype.get_shapes}),Object.defineProperty(Q.prototype,"compound",{get:Q.prototype.get_compound,set:Q.prototype.set_compound}),Object.defineProperty(Q.prototype,"space",{get:Q.prototype.get_space,set:Q.prototype.set_space}),Object.defineProperty(Q.prototype,"arbiters",{get:Q.prototype.get_arbiters}),Object.defineProperty(Q.prototype,"isSleeping",{get:Q.prototype.get_isSleeping}),Object.defineProperty(Q.prototype,"constraints",{get:Q.prototype.get_constraints}),Object.defineProperty(Q.prototype,"position",{get:Q.prototype.get_position,set:Q.prototype.set_position}),Object.defineProperty(Q.prototype,"velocity",{get:Q.prototype.get_velocity,set:Q.prototype.set_velocity}),Object.defineProperty(Q.prototype,"kinematicVel",{get:Q.prototype.get_kinematicVel,set:Q.prototype.set_kinematicVel}),Object.defineProperty(Q.prototype,"surfaceVel",{get:Q.prototype.get_surfaceVel,set:Q.prototype.set_surfaceVel}),Object.defineProperty(Q.prototype,"force",{get:Q.prototype.get_force,set:Q.prototype.set_force}),Object.defineProperty(Q.prototype,"constraintVelocity",{get:Q.prototype.get_constraintVelocity}),Object.defineProperty(Q.prototype,"rotation",{get:Q.prototype.get_rotation,set:Q.prototype.set_rotation}),Object.defineProperty(Q.prototype,"angularVel",{get:Q.prototype.get_angularVel,set:Q.prototype.set_angularVel}),Object.defineProperty(Q.prototype,"kinAngVel",{get:Q.prototype.get_kinAngVel,set:Q.prototype.set_kinAngVel}),Object.defineProperty(Q.prototype,"torque",{get:Q.prototype.get_torque,set:Q.prototype.set_torque}),Object.defineProperty(Q.prototype,"bounds",{get:Q.prototype.get_bounds}),Object.defineProperty(Q.prototype,"allowMovement",{get:Q.prototype.get_allowMovement,set:Q.prototype.set_allowMovement}),Object.defineProperty(Q.prototype,"allowRotation",{get:Q.prototype.get_allowRotation,set:Q.prototype.set_allowRotation}),Object.defineProperty(Q.prototype,"massMode",{get:Q.prototype.get_massMode,set:Q.prototype.set_massMode}),Object.defineProperty(Q.prototype,"constraintMass",{get:Q.prototype.get_constraintMass}),Object.defineProperty(Q.prototype,"mass",{get:Q.prototype.get_mass,set:Q.prototype.set_mass}),Object.defineProperty(Q.prototype,"gravMassMode",{get:Q.prototype.get_gravMassMode,set:Q.prototype.set_gravMassMode}),Object.defineProperty(Q.prototype,"gravMass",{get:Q.prototype.get_gravMass,set:Q.prototype.set_gravMass}),Object.defineProperty(Q.prototype,"gravMassScale",{get:Q.prototype.get_gravMassScale,set:Q.prototype.set_gravMassScale}),Object.defineProperty(Q.prototype,"inertiaMode",{get:Q.prototype.get_inertiaMode,set:Q.prototype.set_inertiaMode}),Object.defineProperty(Q.prototype,"constraintInertia",{get:Q.prototype.get_constraintInertia}),Object.defineProperty(Q.prototype,"inertia",{get:Q.prototype.get_inertia,set:Q.prototype.set_inertia}),Object.defineProperty(Q.prototype,"localCOM",{get:Q.prototype.get_localCOM}),Object.defineProperty(Q.prototype,"worldCOM",{get:Q.prototype.get_worldCOM}),Q.prototype.__class__=Q;var nt=nape.phys.BodyIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};nt.__name__=["nape","phys","BodyIterator"],nt.get=function(n){var t,e=null==nt.zpp_pool?(wi.internal=!0,t=new nt,wi.internal=!1,t):(e=nt.zpp_pool,nt.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},nt.prototype.zpp_inner=null,nt.prototype.zpp_i=null,nt.prototype.zpp_critical=null,nt.prototype.zpp_next=null,nt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=nt.zpp_pool,(nt.zpp_pool=this).zpp_inner=null,!1)},nt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},nt.prototype.__class__=nt;var nn=nape.phys.BodyList=function(){this.zpp_inner=null,this.zpp_inner=new wi,this.zpp_inner.outer=this};nn.__name__=["nape","phys","BodyList"],nn.fromArray=function(n){for(var t=new nn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},nn.prototype.zpp_inner=null,nn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},nn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},nn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},nn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},nn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},nn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer},nn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer},nn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},nn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},nn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},nn.prototype.empty=function(){return null==this.zpp_inner.inner.head},nn.prototype.iterator=function(){return this.zpp_inner.valmod(),nt.get(this)},nn.prototype.copy=function(n){null==n&&(n=!1);var t=new nn;this.zpp_inner.valmod();for(var e=nt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=nt.zpp_pool,(nt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},nn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=nt.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=nt.zpp_pool,(nt.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},nn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=nt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=nt.zpp_pool,(nt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},nn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=nt.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=nt.zpp_pool,(nt.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=nt.zpp_pool,(nt.zpp_pool=t).zpp_inner=null;break}}return this},nn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(nn.prototype,"length",{get:nn.prototype.get_length}),nn.prototype.__class__=nn;var tn=nape.phys.BodyType=function(){};tn.__name__=["nape","phys","BodyType"],tn.STATIC=null,tn.get_STATIC=function(){return null==Yi.BodyType_STATIC&&(Yi.internal=!0,Yi.BodyType_STATIC=new tn,Yi.internal=!1),Yi.BodyType_STATIC},tn.DYNAMIC=null,tn.get_DYNAMIC=function(){return null==Yi.BodyType_DYNAMIC&&(Yi.internal=!0,Yi.BodyType_DYNAMIC=new tn,Yi.internal=!1),Yi.BodyType_DYNAMIC},tn.KINEMATIC=null,tn.get_KINEMATIC=function(){return null==Yi.BodyType_KINEMATIC&&(Yi.internal=!0,Yi.BodyType_KINEMATIC=new tn,Yi.internal=!1),Yi.BodyType_KINEMATIC},tn.prototype.toString=function(){return null==Yi.BodyType_STATIC&&(Yi.internal=!0,Yi.BodyType_STATIC=new tn,Yi.internal=!1),this==Yi.BodyType_STATIC?"STATIC":(null==Yi.BodyType_DYNAMIC&&(Yi.internal=!0,Yi.BodyType_DYNAMIC=new tn,Yi.internal=!1),this==Yi.BodyType_DYNAMIC?"DYNAMIC":(null==Yi.BodyType_KINEMATIC&&(Yi.internal=!0,Yi.BodyType_KINEMATIC=new tn,Yi.internal=!1),this==Yi.BodyType_KINEMATIC?"KINEMATIC":""))},Object.defineProperty(tn,"STATIC",{get:tn.get_STATIC}),Object.defineProperty(tn,"DYNAMIC",{get:tn.get_DYNAMIC}),Object.defineProperty(tn,"KINEMATIC",{get:tn.get_KINEMATIC}),tn.prototype.__class__=tn;var en=nape.phys.Compound=function(){this.zpp_inner=null,$.call(this),this.zpp_inner=new Zt,((this.zpp_inner.outer=this).zpp_inner.outer_i=this).zpp_inner_i=this.zpp_inner,this.zpp_inner.insert_cbtype(Sn.ANY_COMPOUND.zpp_inner)};en.__name__=["nape","phys","Compound"],en.__super__=$,en.prototype=Object.create($.prototype),en.prototype.zpp_inner=null,en.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},en.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},en.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},en.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},en.prototype.set_compound=function(n){return this.zpp_inner.immutable_midstep("Compound::compound"),(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(this),null!=n&&((n=n.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?n.push(this):n.unshift(this))),null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},en.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},en.prototype.set_space=function(n){return this.zpp_inner.immutable_midstep("Compound::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this),null!=n&&((n=n.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?n.push(this):n.unshift(this))),null==this.zpp_inner.space?null:this.zpp_inner.space.outer},en.prototype.toString=function(){return"Compound"+this.zpp_inner_i.id},en.prototype.copy=function(){return this.zpp_inner.copy()},en.prototype.breakApart=function(){this.zpp_inner.breakApart()},en.prototype.visitBodies=function(n){var t=this.zpp_inner.wrap_bodies;t.zpp_inner.valmod();for(var e=nt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=nt.zpp_pool,(nt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}t=this.zpp_inner.wrap_compounds;t.zpp_inner.valmod();for(var p=tt.get(t);;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);l=l.zpp_inner.user_length;if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=tt.zpp_pool,(tt.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1,p.zpp_inner.at(p.zpp_i++).visitBodies(n)}},en.prototype.visitConstraints=function(n){var t=this.zpp_inner.wrap_constraints;t.zpp_inner.valmod();for(var e=Kn.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}t=this.zpp_inner.wrap_compounds;t.zpp_inner.valmod();for(var p=tt.get(t);;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);l=l.zpp_inner.user_length;if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=tt.zpp_pool,(tt.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1,p.zpp_inner.at(p.zpp_i++).visitConstraints(n)}},en.prototype.visitCompounds=function(n){var t=this.zpp_inner.wrap_compounds;t.zpp_inner.valmod();for(var e=tt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=tt.zpp_pool,(tt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);n(i),i.visitCompounds(n)}},en.prototype.COM=function(n){var t,e,i;null==n&&(n=!1),null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),0==t.zpp_inner.x&&(null!=(i=t.zpp_inner)._validate&&i._validate(),0==t.zpp_inner.y)||(t.zpp_inner.x=0,t.zpp_inner.y=0,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=n;var l=t,r=0;return this.visitBodies(function(n){var t,e,i,p;null!=n.zpp_inner.wrap_shapes.zpp_inner.inner.head&&(null==n.zpp_inner.wrap_worldCOM&&(t=n.zpp_inner.worldCOMx,i=n.zpp_inner.worldCOMy,null==Vi.poolVec2?p=new Cn:(p=Vi.poolVec2,Vi.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=t,e.y=i,p.zpp_inner=e,p.zpp_inner.outer=p):(null!=(e=p.zpp_inner)._validate&&e._validate(),p.zpp_inner.x==t&&(null!=(e=p.zpp_inner)._validate&&e._validate(),p.zpp_inner.y==i)||(p.zpp_inner.x=t,p.zpp_inner.y=i,null!=(i=p.zpp_inner)._invalidate&&i._invalidate(i))),p.zpp_inner.weak=!1,n.zpp_inner.wrap_worldCOM=p,n.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,n.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,n.zpp_inner.wrap_worldCOM.zpp_inner._validate=X(o=n.zpp_inner,o.getworldCOM)),p=n.zpp_inner.wrap_worldCOM,n.zpp_inner.validate_mass(),l.addeq(p.mul(n.zpp_inner.cmass,!0)),n.zpp_inner.validate_mass(),r+=n.zpp_inner.cmass)}),l.muleq(1/r),l},en.prototype.translate=function(t){var n,e=t.zpp_inner.weak;return t.zpp_inner.weak=!1,this.visitBodies(function(n){null==n.zpp_inner.wrap_pos&&n.zpp_inner.setupPosition(),n.zpp_inner.wrap_pos.addeq(t)}),t.zpp_inner.weak=e,t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,(e=t).zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n),this},en.prototype.rotate=function(t,e){var n,i=t.zpp_inner.weak;return t.zpp_inner.weak=!1,this.visitBodies(function(n){n.rotate(t,e)}),t.zpp_inner.weak=i,t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,(i=t).zpp_pool=Vi.poolVec2,Vi.poolVec2=i,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n),this},Object.defineProperty(en.prototype,"bodies",{get:en.prototype.get_bodies}),Object.defineProperty(en.prototype,"constraints",{get:en.prototype.get_constraints}),Object.defineProperty(en.prototype,"compounds",{get:en.prototype.get_compounds}),Object.defineProperty(en.prototype,"compound",{get:en.prototype.get_compound,set:en.prototype.set_compound}),Object.defineProperty(en.prototype,"space",{get:en.prototype.get_space,set:en.prototype.set_space}),en.prototype.__class__=en;var tt=nape.phys.CompoundIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};tt.__name__=["nape","phys","CompoundIterator"],tt.get=function(n){var t,e=null==tt.zpp_pool?(Ci.internal=!0,t=new tt,Ci.internal=!1,t):(e=tt.zpp_pool,tt.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},tt.prototype.zpp_inner=null,tt.prototype.zpp_i=null,tt.prototype.zpp_critical=null,tt.prototype.zpp_next=null,tt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=tt.zpp_pool,(tt.zpp_pool=this).zpp_inner=null,!1)},tt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},tt.prototype.__class__=tt;var pn=nape.phys.CompoundList=function(){this.zpp_inner=null,this.zpp_inner=new Ci,this.zpp_inner.outer=this};pn.__name__=["nape","phys","CompoundList"],pn.fromArray=function(n){for(var t=new pn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},pn.prototype.zpp_inner=null,pn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},pn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},pn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},pn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},pn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},pn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer},pn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer},pn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},pn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},pn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},pn.prototype.empty=function(){return null==this.zpp_inner.inner.head},pn.prototype.iterator=function(){return this.zpp_inner.valmod(),tt.get(this)},pn.prototype.copy=function(n){null==n&&(n=!1);var t=new pn;this.zpp_inner.valmod();for(var e=tt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=tt.zpp_pool,(tt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},pn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=tt.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=tt.zpp_pool,(tt.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},pn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=tt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=tt.zpp_pool,(tt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},pn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=tt.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=tt.zpp_pool,(tt.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=tt.zpp_pool,(tt.zpp_pool=t).zpp_inner=null;break}}return this},pn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(pn.prototype,"length",{get:pn.prototype.get_length}),pn.prototype.__class__=pn;var ln=nape.phys.FluidProperties=function(n,t){null==t&&(t=1),null==n&&(n=1),(this.zpp_inner=null)==Bt.zpp_pool?this.zpp_inner=new Bt:(this.zpp_inner=Bt.zpp_pool,Bt.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),n!=1e3*(this.zpp_inner.outer=this).zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),t!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=+t,this.zpp_inner.invalidate())};ln.__name__=["nape","phys","FluidProperties"],ln.prototype.zpp_inner=null,ln.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},ln.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=Ii.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},ln.prototype.copy=function(){var n=new ln(1e3*this.zpp_inner.density,this.zpp_inner.viscosity);null!=this.zpp_inner.userData&&(n.zpp_inner.userData=a.copy(this.zpp_inner.userData));var t,e,i,p,l,r=this.zpp_inner.wrap_gravity;return null==r?null!=n.zpp_inner.wrap_gravity&&(n.zpp_inner.wrap_gravity.zpp_inner._inuse=!1,p=(e=n.zpp_inner.wrap_gravity).zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p,n.zpp_inner.wrap_gravity=null):(null==n.zpp_inner.wrap_gravity&&n.zpp_inner.getgravity(),t=n.zpp_inner.wrap_gravity,null!=(i=r.zpp_inner)._validate&&i._validate(),e=r.zpp_inner.x,null!=(p=r.zpp_inner)._validate&&p._validate(),i=r.zpp_inner.y,null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.x==e&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=e,t.zpp_inner.y=i,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),r.zpp_inner.weak&&(l=r.zpp_inner,r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=Vi.poolVec2,Vi.poolVec2=r,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l)),n},ln.prototype.get_density=function(){return 1e3*this.zpp_inner.density},ln.prototype.set_density=function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),1e3*this.zpp_inner.density},ln.prototype.get_viscosity=function(){return this.zpp_inner.viscosity},ln.prototype.set_viscosity=function(n){return n!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=+n,this.zpp_inner.invalidate()),this.zpp_inner.viscosity},ln.prototype.get_gravity=function(){return this.zpp_inner.wrap_gravity},ln.prototype.set_gravity=function(n){var t,e,i,p,l;return null==n?null!=this.zpp_inner.wrap_gravity&&(this.zpp_inner.wrap_gravity.zpp_inner._inuse=!1,p=(e=this.zpp_inner.wrap_gravity).zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p,this.zpp_inner.wrap_gravity=null):(null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),t=this.zpp_inner.wrap_gravity,null!=(i=n.zpp_inner)._validate&&i._validate(),e=n.zpp_inner.x,null!=(p=n.zpp_inner)._validate&&p._validate(),i=n.zpp_inner.y,null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.x==e&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=e,t.zpp_inner.y=i,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l)),this.zpp_inner.wrap_gravity},ln.prototype.toString=function(){return"{ density: "+1e3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+i.string(this.zpp_inner.wrap_gravity)+" }"},Object.defineProperty(ln.prototype,"userData",{get:ln.prototype.get_userData}),Object.defineProperty(ln.prototype,"shapes",{get:ln.prototype.get_shapes}),Object.defineProperty(ln.prototype,"density",{get:ln.prototype.get_density,set:ln.prototype.set_density}),Object.defineProperty(ln.prototype,"viscosity",{get:ln.prototype.get_viscosity,set:ln.prototype.set_viscosity}),Object.defineProperty(ln.prototype,"gravity",{get:ln.prototype.get_gravity,set:ln.prototype.set_gravity}),ln.prototype.__class__=ln;var rn=nape.phys.GravMassMode=function(){};rn.__name__=["nape","phys","GravMassMode"],rn.DEFAULT=null,rn.get_DEFAULT=function(){return null==Yi.GravMassMode_DEFAULT&&(Yi.internal=!0,Yi.GravMassMode_DEFAULT=new rn,Yi.internal=!1),Yi.GravMassMode_DEFAULT},rn.FIXED=null,rn.get_FIXED=function(){return null==Yi.GravMassMode_FIXED&&(Yi.internal=!0,Yi.GravMassMode_FIXED=new rn,Yi.internal=!1),Yi.GravMassMode_FIXED},rn.SCALED=null,rn.get_SCALED=function(){return null==Yi.GravMassMode_SCALED&&(Yi.internal=!0,Yi.GravMassMode_SCALED=new rn,Yi.internal=!1),Yi.GravMassMode_SCALED},rn.prototype.toString=function(){return null==Yi.GravMassMode_DEFAULT&&(Yi.internal=!0,Yi.GravMassMode_DEFAULT=new rn,Yi.internal=!1),this==Yi.GravMassMode_DEFAULT?"DEFAULT":(null==Yi.GravMassMode_FIXED&&(Yi.internal=!0,Yi.GravMassMode_FIXED=new rn,Yi.internal=!1),this==Yi.GravMassMode_FIXED?"FIXED":(null==Yi.GravMassMode_SCALED&&(Yi.internal=!0,Yi.GravMassMode_SCALED=new rn,Yi.internal=!1),this==Yi.GravMassMode_SCALED?"SCALED":""))},Object.defineProperty(rn,"DEFAULT",{get:rn.get_DEFAULT}),Object.defineProperty(rn,"FIXED",{get:rn.get_FIXED}),Object.defineProperty(rn,"SCALED",{get:rn.get_SCALED}),rn.prototype.__class__=rn;var on=nape.phys.InertiaMode=function(){};on.__name__=["nape","phys","InertiaMode"],on.DEFAULT=null,on.get_DEFAULT=function(){return null==Yi.InertiaMode_DEFAULT&&(Yi.internal=!0,Yi.InertiaMode_DEFAULT=new on,Yi.internal=!1),Yi.InertiaMode_DEFAULT},on.FIXED=null,on.get_FIXED=function(){return null==Yi.InertiaMode_FIXED&&(Yi.internal=!0,Yi.InertiaMode_FIXED=new on,Yi.internal=!1),Yi.InertiaMode_FIXED},on.prototype.toString=function(){return null==Yi.InertiaMode_DEFAULT&&(Yi.internal=!0,Yi.InertiaMode_DEFAULT=new on,Yi.internal=!1),this==Yi.InertiaMode_DEFAULT?"DEFAULT":(null==Yi.InertiaMode_FIXED&&(Yi.internal=!0,Yi.InertiaMode_FIXED=new on,Yi.internal=!1),this==Yi.InertiaMode_FIXED?"FIXED":"")},Object.defineProperty(on,"DEFAULT",{get:on.get_DEFAULT}),Object.defineProperty(on,"FIXED",{get:on.get_FIXED}),on.prototype.__class__=on;var et=nape.phys.InteractorIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};et.__name__=["nape","phys","InteractorIterator"],et.get=function(n){var t,e=null==et.zpp_pool?(Mi.internal=!0,t=new et,Mi.internal=!1,t):(e=et.zpp_pool,et.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},et.prototype.zpp_inner=null,et.prototype.zpp_i=null,et.prototype.zpp_critical=null,et.prototype.zpp_next=null,et.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=et.zpp_pool,(et.zpp_pool=this).zpp_inner=null,!1)},et.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},et.prototype.__class__=et;var an=nape.phys.InteractorList=function(){this.zpp_inner=null,this.zpp_inner=new Mi,this.zpp_inner.outer=this};an.__name__=["nape","phys","InteractorList"],an.fromArray=function(n){for(var t=new an,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},an.prototype.zpp_inner=null,an.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},an.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner_i)},an.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},an.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner_i):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},an.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)):this.zpp_inner.inner.add(n.zpp_inner_i),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},an.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer_i},an.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer_i,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer_i},an.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},an.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner_i){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner_i),this.zpp_inner.invalidate()),t},an.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},an.prototype.empty=function(){return null==this.zpp_inner.inner.head},an.prototype.iterator=function(){return this.zpp_inner.valmod(),et.get(this)},an.prototype.copy=function(n){null==n&&(n=!1);var t=new an;this.zpp_inner.valmod();for(var e=et.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=et.zpp_pool,(et.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},an.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=et.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=et.zpp_pool,(et.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},an.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=et.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=et.zpp_pool,(et.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},an.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=et.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=et.zpp_pool,(et.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=et.zpp_pool,(et.zpp_pool=t).zpp_inner=null;break}}return this},an.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(an.prototype,"length",{get:an.prototype.get_length}),an.prototype.__class__=an;var sn=nape.phys.MassMode=function(){};sn.__name__=["nape","phys","MassMode"],sn.DEFAULT=null,sn.get_DEFAULT=function(){return null==Yi.MassMode_DEFAULT&&(Yi.internal=!0,Yi.MassMode_DEFAULT=new sn,Yi.internal=!1),Yi.MassMode_DEFAULT},sn.FIXED=null,sn.get_FIXED=function(){return null==Yi.MassMode_FIXED&&(Yi.internal=!0,Yi.MassMode_FIXED=new sn,Yi.internal=!1),Yi.MassMode_FIXED},sn.prototype.toString=function(){return null==Yi.MassMode_DEFAULT&&(Yi.internal=!0,Yi.MassMode_DEFAULT=new sn,Yi.internal=!1),this==Yi.MassMode_DEFAULT?"DEFAULT":(null==Yi.MassMode_FIXED&&(Yi.internal=!0,Yi.MassMode_FIXED=new sn,Yi.internal=!1),this==Yi.MassMode_FIXED?"FIXED":"")},Object.defineProperty(sn,"DEFAULT",{get:sn.get_DEFAULT}),Object.defineProperty(sn,"FIXED",{get:sn.get_FIXED}),sn.prototype.__class__=sn;var _n=nape.phys.Material=function(n,t,e,i,p){null==p&&(p=.001),null==i&&(i=1),null==e&&(e=2),null==t&&(t=1),null==n&&(n=0),(this.zpp_inner=null)==Gt.zpp_pool?this.zpp_inner=new Gt:(this.zpp_inner=Gt.zpp_pool,Gt.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),n!=(this.zpp_inner.outer=this).zpp_inner.elasticity&&(this.zpp_inner.elasticity=+n,this.zpp_inner.invalidate(Gt.WAKE|Gt.ARBITERS)),t!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=+t,this.zpp_inner.invalidate(Gt.WAKE|Gt.ANGDRAG|Gt.ARBITERS)),e!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=+e,this.zpp_inner.invalidate(Gt.WAKE|Gt.ARBITERS)),i!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=i/1e3,this.zpp_inner.invalidate(Gt.WAKE|Gt.PROPS)),p!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=+p,this.zpp_inner.invalidate(Gt.WAKE|Gt.ARBITERS))};_n.__name__=["nape","phys","Material"],_n.wood=function(){return new _n(.4,.2,.38,.7,.005)},_n.steel=function(){return new _n(.2,.57,.74,7.8,.001)},_n.ice=function(){return new _n(.3,.03,.1,.9,1e-4)},_n.rubber=function(){return new _n(.8,1,1.4,1.5,.01)},_n.glass=function(){return new _n(.4,.4,.94,2.6,.002)},_n.sand=function(){return new _n(-1,.45,.6,1.6,16)},_n.prototype.zpp_inner=null,_n.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},_n.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=Ii.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},_n.prototype.copy=function(){var n=new _n(this.zpp_inner.elasticity,this.zpp_inner.dynamicFriction,this.zpp_inner.staticFriction,1e3*this.zpp_inner.density,this.zpp_inner.rollingFriction);return null!=this.zpp_inner.userData&&(n.zpp_inner.userData=a.copy(this.zpp_inner.userData)),n},_n.prototype.get_elasticity=function(){return this.zpp_inner.elasticity},_n.prototype.set_elasticity=function(n){return n!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=+n,this.zpp_inner.invalidate(Gt.WAKE|Gt.ARBITERS)),this.zpp_inner.elasticity},_n.prototype.get_dynamicFriction=function(){return this.zpp_inner.dynamicFriction},_n.prototype.set_dynamicFriction=function(n){return n!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=+n,this.zpp_inner.invalidate(Gt.WAKE|Gt.ANGDRAG|Gt.ARBITERS)),this.zpp_inner.dynamicFriction},_n.prototype.get_staticFriction=function(){return this.zpp_inner.staticFriction},_n.prototype.set_staticFriction=function(n){return n!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=+n,this.zpp_inner.invalidate(Gt.WAKE|Gt.ARBITERS)),this.zpp_inner.staticFriction},_n.prototype.get_density=function(){return 1e3*this.zpp_inner.density},_n.prototype.set_density=function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate(Gt.WAKE|Gt.PROPS)),1e3*this.zpp_inner.density},_n.prototype.get_rollingFriction=function(){return this.zpp_inner.rollingFriction},_n.prototype.set_rollingFriction=function(n){return n!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=+n,this.zpp_inner.invalidate(Gt.WAKE|Gt.ARBITERS)),this.zpp_inner.rollingFriction},_n.prototype.toString=function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1e3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},Object.defineProperty(_n.prototype,"userData",{get:_n.prototype.get_userData}),Object.defineProperty(_n.prototype,"shapes",{get:_n.prototype.get_shapes}),Object.defineProperty(_n.prototype,"elasticity",{get:_n.prototype.get_elasticity,set:_n.prototype.set_elasticity}),Object.defineProperty(_n.prototype,"dynamicFriction",{get:_n.prototype.get_dynamicFriction,set:_n.prototype.set_dynamicFriction}),Object.defineProperty(_n.prototype,"staticFriction",{get:_n.prototype.get_staticFriction,set:_n.prototype.set_staticFriction}),Object.defineProperty(_n.prototype,"density",{get:_n.prototype.get_density,set:_n.prototype.set_density}),Object.defineProperty(_n.prototype,"rollingFriction",{get:_n.prototype.get_rollingFriction,set:_n.prototype.set_rollingFriction}),_n.prototype.__class__=_n;var hn=nape.shape.Shape=function(){this.zpp_inner=null,$.call(this)};hn.__name__=["nape","shape","Shape"],hn.__super__=$,hn.prototype=Object.create($.prototype),hn.prototype.zpp_inner=null,hn.prototype.get_type=function(){return qt.types[this.zpp_inner.type]},hn.prototype.isCircle=function(){return 0==this.zpp_inner.type},hn.prototype.isPolygon=function(){return 1==this.zpp_inner.type},hn.prototype.get_body=function(){return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},hn.prototype.set_body=function(n){return this.zpp_inner.immutable_midstep("Shape::body"),(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null)!=n&&(null!=this.zpp_inner.body&&(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null).zpp_inner.wrap_shapes.remove(this),null!=n&&((n=n.zpp_inner.wrap_shapes).zpp_inner.reverse_flag?n.push(this):n.unshift(this))),null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},hn.prototype.get_castCircle=function(){return 0==this.zpp_inner.type?this.zpp_inner.circle.outer_zn:null},hn.prototype.get_castPolygon=function(){return 1==this.zpp_inner.type?this.zpp_inner.polygon.outer_zn:null},hn.prototype.get_worldCOM=function(){var n,t,e,i;return null==this.zpp_inner.wrap_worldCOM&&(n=this.zpp_inner.worldCOMx,i=this.zpp_inner.worldCOMy,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=n,t.zpp_inner.y=i,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=t,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=X(o=this.zpp_inner,o.getworldCOM)),this.zpp_inner.wrap_worldCOM},hn.prototype.get_localCOM=function(){return null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle:this.zpp_inner.polygon).setupLocalCOM(),this.zpp_inner.wrap_localCOM},hn.prototype.set_localCOM=function(n){this.zpp_inner.immutable_midstep("Body::localCOM"),null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle:this.zpp_inner.polygon).setupLocalCOM();var t=this.zpp_inner.wrap_localCOM,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle:this.zpp_inner.polygon).setupLocalCOM(),this.zpp_inner.wrap_localCOM},hn.prototype.get_area=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.area},hn.prototype.get_inertia=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.inertia},hn.prototype.get_angDrag=function(){return this.zpp_inner.validate_angDrag(),this.zpp_inner.angDrag},hn.prototype.get_material=function(){return this.zpp_inner.material.wrapper()},hn.prototype.set_material=function(n){return this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(n.zpp_inner),this.zpp_inner.material.wrapper()},hn.prototype.get_filter=function(){return this.zpp_inner.filter.wrapper()},hn.prototype.set_filter=function(n){return this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(n.zpp_inner),this.zpp_inner.filter.wrapper()},hn.prototype.get_fluidProperties=function(){return this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new ln).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},hn.prototype.set_fluidProperties=function(n){return this.zpp_inner.setFluid(n.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new ln).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},hn.prototype.get_fluidEnabled=function(){return this.zpp_inner.fluidEnabled},hn.prototype.set_fluidEnabled=function(n){return this.zpp_inner.immutable_midstep("Shape::fluidEnabled"),(this.zpp_inner.fluidEnabled=n)&&null==this.zpp_inner.fluidProperties&&(this.zpp_inner.setFluid((new ln).zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new ln).zpp_inner),this.zpp_inner.fluidProperties.wrapper()),this.zpp_inner.wake(),this.zpp_inner.fluidEnabled},hn.prototype.get_sensorEnabled=function(){return this.zpp_inner.sensorEnabled},hn.prototype.set_sensorEnabled=function(n){return this.zpp_inner.immutable_midstep("Shape::sensorEnabled"),this.zpp_inner.sensorEnabled=n,this.zpp_inner.wake(),this.zpp_inner.sensorEnabled},hn.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},hn.prototype.translate=function(n){var t,e,i;return this.zpp_inner.immutable_midstep("Shape::translate()"),0<n.lsq()&&(0==this.zpp_inner.type?(null!=(t=n.zpp_inner)._validate&&t._validate(),e=n.zpp_inner.x,null!=(t=n.zpp_inner)._validate&&t._validate(),this.zpp_inner.circle.__translate(e,n.zpp_inner.y)):(null!=(e=n.zpp_inner)._validate&&e._validate(),i=n.zpp_inner.x,null!=(e=n.zpp_inner)._validate&&e._validate(),this.zpp_inner.polygon.__translate(i,n.zpp_inner.y))),n.zpp_inner.weak&&(i=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ip.zpp_pool,Ip.zpp_pool=i),this},hn.prototype.scale=function(n,t){var e;return this.zpp_inner.immutable_midstep("Shape::scale()"),0==this.zpp_inner.type?(e=n*n-t*t)*e<jp.epsilon*jp.epsilon&&this.zpp_inner.circle.__scale(n,t):this.zpp_inner.polygon.__scale(n,t),this},hn.prototype.rotate=function(n){var t;return this.zpp_inner.immutable_midstep("Shape::rotate()"),n%(2*Math.PI)!=0&&(t=Math.cos(n),n=Math.sin(n),(0==this.zpp_inner.type?this.zpp_inner.circle:this.zpp_inner.polygon).__rotate(n,t)),this},hn.prototype.transform=function(n){return this.zpp_inner.immutable_midstep("Shape::transform()"),0==this.zpp_inner.type?n.equiorthogonal()&&this.zpp_inner.circle.__transform(n):this.zpp_inner.polygon.__transform(n),this},hn.prototype.contains=function(n){yt.validateShape(this.zpp_inner);var t=n.zpp_inner;null!=t._validate&&t._validate();var e=Ep.shapeContains(this.zpp_inner,n.zpp_inner);return n.zpp_inner.weak&&(t=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t),e},hn.prototype.copy=function(){return this.zpp_inner.copy()},hn.prototype.toString=function(){return(0==this.zpp_inner.type?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},Object.defineProperty(hn.prototype,"type",{get:hn.prototype.get_type}),Object.defineProperty(hn.prototype,"body",{get:hn.prototype.get_body,set:hn.prototype.set_body}),Object.defineProperty(hn.prototype,"castCircle",{get:hn.prototype.get_castCircle}),Object.defineProperty(hn.prototype,"castPolygon",{get:hn.prototype.get_castPolygon}),Object.defineProperty(hn.prototype,"worldCOM",{get:hn.prototype.get_worldCOM}),Object.defineProperty(hn.prototype,"localCOM",{get:hn.prototype.get_localCOM,set:hn.prototype.set_localCOM}),Object.defineProperty(hn.prototype,"area",{get:hn.prototype.get_area}),Object.defineProperty(hn.prototype,"inertia",{get:hn.prototype.get_inertia}),Object.defineProperty(hn.prototype,"angDrag",{get:hn.prototype.get_angDrag}),Object.defineProperty(hn.prototype,"material",{get:hn.prototype.get_material,set:hn.prototype.set_material}),Object.defineProperty(hn.prototype,"filter",{get:hn.prototype.get_filter,set:hn.prototype.set_filter}),Object.defineProperty(hn.prototype,"fluidProperties",{get:hn.prototype.get_fluidProperties,set:hn.prototype.set_fluidProperties}),Object.defineProperty(hn.prototype,"fluidEnabled",{get:hn.prototype.get_fluidEnabled,set:hn.prototype.set_fluidEnabled}),Object.defineProperty(hn.prototype,"sensorEnabled",{get:hn.prototype.get_sensorEnabled,set:hn.prototype.set_sensorEnabled}),Object.defineProperty(hn.prototype,"bounds",{get:hn.prototype.get_bounds}),hn.prototype.__class__=hn;var un=nape.shape.Circle=function(n,t,e,i){this.zpp_inner_zn=null,hn.call(this),this.zpp_inner_zn=new Ut,((this.zpp_inner_zn.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,(this.zpp_inner_i.outer_i=this).zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),null==t?(this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0):(null!=(n=t.zpp_inner)._validate&&n._validate(),this.zpp_inner.localCOMx=t.zpp_inner.x,null!=(n=t.zpp_inner)._validate&&n._validate(),this.zpp_inner.localCOMy=t.zpp_inner.y,t.zpp_inner.weak&&(n=t.zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n)),null==e?null==Gt.zpp_pool?this.zpp_inner.material=new Gt:(this.zpp_inner.material=Gt.zpp_pool,Gt.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(e.zpp_inner),this.zpp_inner.material.wrapper()),null==i?null==st.zpp_pool?this.zpp_inner.filter=new st:(this.zpp_inner.filter=st.zpp_pool,st.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(i.zpp_inner),this.zpp_inner.filter.wrapper()),this.zpp_inner_i.insert_cbtype(Sn.ANY_SHAPE.zpp_inner)};un.__name__=["nape","shape","Circle"],un.__super__=hn,un.prototype=Object.create(hn.prototype),un.prototype.zpp_inner_zn=null,un.prototype.get_radius=function(){return this.zpp_inner_zn.radius},un.prototype.set_radius=function(n){return this.zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),this.zpp_inner_zn.radius},Object.defineProperty(un.prototype,"radius",{get:un.prototype.get_radius,set:un.prototype.set_radius}),un.prototype.__class__=un;var xn=nape.shape.Edge=function(){this.zpp_inner=null};xn.__name__=["nape","shape","Edge"],xn.prototype.zpp_inner=null,xn.prototype.get_polygon=function(){return this.zpp_inner.polygon.outer_zn},xn.prototype.get_localNormal=function(){return null==this.zpp_inner.wrap_lnorm&&this.zpp_inner.getlnorm(),this.zpp_inner.wrap_lnorm},xn.prototype.get_worldNormal=function(){return null==this.zpp_inner.wrap_gnorm&&this.zpp_inner.getgnorm(),this.zpp_inner.wrap_gnorm},xn.prototype.get_length=function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.length},xn.prototype.get_localProjection=function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.lprojection},xn.prototype.get_worldProjection=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}e=o.elt;e.gp0=a,e.gp1=n.gverts.next,e.gnormx=n.body.axisy*e.lnormx-n.body.axisx*e.lnormy,e.gnormy=e.lnormx*n.body.axisx+e.lnormy*n.body.axisy,e.gprojection=n.body.posx*e.gnormx+n.body.posy*e.gnormy+e.lprojection,null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy),e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy,e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy}return this.zpp_inner.gprojection},xn.prototype.get_localVertex1=function(){this.zpp_inner.polygon.validate_laxi();var n,t=this.zpp_inner.lp0;return null==t.outer&&(t.outer=new Cn,null!=(n=t.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n,t.outer.zpp_inner=t),t.outer},xn.prototype.get_localVertex2=function(){this.zpp_inner.polygon.validate_laxi();var n,t=this.zpp_inner.lp1;return null==t.outer&&(t.outer=new Cn,null!=(n=t.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n,t.outer.zpp_inner=t),t.outer},xn.prototype.get_worldVertex1=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}t=o.elt;t.gp0=a,t.gp1=n.gverts.next,t.gnormx=n.body.axisy*t.lnormx-n.body.axisx*t.lnormy,t.gnormy=t.lnormx*n.body.axisx+t.lnormy*n.body.axisy,t.gprojection=n.body.posx*t.gnormx+n.body.posy*t.gnormy+t.lprojection,null!=t.wrap_gnorm&&(t.wrap_gnorm.zpp_inner.x=t.gnormx,t.wrap_gnorm.zpp_inner.y=t.gnormy),t.tp0=t.gp0.y*t.gnormx-t.gp0.x*t.gnormy,t.tp1=t.gp1.y*t.gnormx-t.gp1.x*t.gnormy}e=this.zpp_inner.gp0;return null==e.outer&&(e.outer=new Cn,null!=(t=e.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,e.outer.zpp_inner=e),e.outer},xn.prototype.get_worldVertex2=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}t=o.elt;t.gp0=a,t.gp1=n.gverts.next,t.gnormx=n.body.axisy*t.lnormx-n.body.axisx*t.lnormy,t.gnormy=t.lnormx*n.body.axisx+t.lnormy*n.body.axisy,t.gprojection=n.body.posx*t.gnormx+n.body.posy*t.gnormy+t.lprojection,null!=t.wrap_gnorm&&(t.wrap_gnorm.zpp_inner.x=t.gnormx,t.wrap_gnorm.zpp_inner.y=t.gnormy),t.tp0=t.gp0.y*t.gnormx-t.gp0.x*t.gnormy,t.tp1=t.gp1.y*t.gnormx-t.gp1.x*t.gnormy}e=this.zpp_inner.gp1;return null==e.outer&&(e.outer=new Cn,null!=(t=e.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,e.outer.zpp_inner=e),e.outer},xn.prototype.toString=function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } }";var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}e=o.elt;e.gp0=a,e.gp1=n.gverts.next,e.gnormx=n.body.axisy*e.lnormx-n.body.axisx*e.lnormy,e.gnormy=e.lnormx*n.body.axisx+e.lnormy*n.body.axisy,e.gprojection=n.body.posx*e.gnormx+n.body.posy*e.gnormy+e.lprojection,null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy),e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy,e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy}return"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } worldNormal : { x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" } }"},Object.defineProperty(xn.prototype,"polygon",{get:xn.prototype.get_polygon}),Object.defineProperty(xn.prototype,"localNormal",{get:xn.prototype.get_localNormal}),Object.defineProperty(xn.prototype,"worldNormal",{get:xn.prototype.get_worldNormal}),Object.defineProperty(xn.prototype,"length",{get:xn.prototype.get_length}),Object.defineProperty(xn.prototype,"localProjection",{get:xn.prototype.get_localProjection}),Object.defineProperty(xn.prototype,"worldProjection",{get:xn.prototype.get_worldProjection}),Object.defineProperty(xn.prototype,"localVertex1",{get:xn.prototype.get_localVertex1}),Object.defineProperty(xn.prototype,"localVertex2",{get:xn.prototype.get_localVertex2}),Object.defineProperty(xn.prototype,"worldVertex1",{get:xn.prototype.get_worldVertex1}),Object.defineProperty(xn.prototype,"worldVertex2",{get:xn.prototype.get_worldVertex2}),xn.prototype.__class__=xn;var it=nape.shape.EdgeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};it.__name__=["nape","shape","EdgeIterator"],it.get=function(n){var t,e=null==it.zpp_pool?(Ei.internal=!0,t=new it,Ei.internal=!1,t):(e=it.zpp_pool,it.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},it.prototype.zpp_inner=null,it.prototype.zpp_i=null,it.prototype.zpp_critical=null,it.prototype.zpp_next=null,it.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=it.zpp_pool,(it.zpp_pool=this).zpp_inner=null,!1)},it.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},it.prototype.__class__=it;var dn=nape.shape.EdgeList=function(){this.zpp_inner=null,this.zpp_inner=new Ei,this.zpp_inner.outer=this};dn.__name__=["nape","shape","EdgeList"],dn.fromArray=function(n){for(var t=new dn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},dn.prototype.zpp_inner=null,dn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},dn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},dn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n==this.zpp_inner.user_length-1||(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-2-n)),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},dn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},dn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},dn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.wrapper()},dn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).wrapper(),null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.wrapper()},dn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},dn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},dn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},dn.prototype.empty=function(){return null==this.zpp_inner.inner.head},dn.prototype.iterator=function(){return this.zpp_inner.valmod(),it.get(this)},dn.prototype.copy=function(n){null==n&&(n=!1);var t=new dn;this.zpp_inner.valmod();for(var e=it.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=it.zpp_pool,(it.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},dn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=it.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=it.zpp_pool,(it.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},dn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=it.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=it.zpp_pool,(it.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},dn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=it.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=it.zpp_pool,(it.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=it.zpp_pool,(it.zpp_pool=t).zpp_inner=null;break}}return this},dn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(dn.prototype,"length",{get:dn.prototype.get_length}),dn.prototype.__class__=dn;var yn=nape.shape.Polygon=function(n,t,e){if(this.zpp_inner_zn=null,hn.call(this),this.zpp_inner_zn=new Wt,((this.zpp_inner_zn.outer=this).zpp_inner_zn.outer_zn=this).zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,n instanceof Array&&null==n.__enum__)for(var i=n,p=0;p<i.length;){var l=i[p];++p;var r=l;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var o=this.zpp_inner_zn.wrap_lverts,a=r.zpp_inner;null!=a._validate&&a._validate();l=r.zpp_inner.x,a=r.zpp_inner;null!=a._validate&&a._validate();var s,_,a=r.zpp_inner.y;null==Vi.poolVec2?s=new Cn:(s=Vi.poolVec2,Vi.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner?(null==Ip.zpp_pool?_=new Ip:(_=Ip.zpp_pool,Ip.zpp_pool=_.next,_.next=null),_.weak=!1,_._immutable=!1,_.x=l,_.y=a,s.zpp_inner=_,s.zpp_inner.outer=s):(null!=(r=s.zpp_inner)._validate&&r._validate(),s.zpp_inner.x==l&&(null!=(r=s.zpp_inner)._validate&&r._validate(),s.zpp_inner.y==a)||(s.zpp_inner.x=l,s.zpp_inner.y=a,null!=(a=s.zpp_inner)._invalidate&&a._invalidate(a))),s.zpp_inner.weak=!1,o.push(s)}else if(D.__instanceof(n,Y))for(var h=n.iterator();;){h.zpp_inner.zpp_inner.valmod();var u=h.zpp_inner.zpp_gl();if(h.zpp_critical=!0,!(h.zpp_i<u||(h.zpp_next=Qn.zpp_pool,(Qn.zpp_pool=h).zpp_inner=null,!1)))break;h.zpp_critical=!1;var x=h.zpp_inner.at(h.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var d=this.zpp_inner_zn.wrap_lverts,y=x.zpp_inner;null!=y._validate&&y._validate();u=x.zpp_inner.x,y=x.zpp_inner;null!=y._validate&&y._validate();var z,c,y=x.zpp_inner.y;null==Vi.poolVec2?z=new Cn:(z=Vi.poolVec2,Vi.poolVec2=z.zpp_pool,z.zpp_pool=null),null==z.zpp_inner?(null==Ip.zpp_pool?c=new Ip:(c=Ip.zpp_pool,Ip.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=u,c.y=y,z.zpp_inner=c,z.zpp_inner.outer=z):(null!=(x=z.zpp_inner)._validate&&x._validate(),z.zpp_inner.x==u&&(null!=(x=z.zpp_inner)._validate&&x._validate(),z.zpp_inner.y==y)||(z.zpp_inner.x=u,z.zpp_inner.y=y,null!=(y=z.zpp_inner)._invalidate&&y._invalidate(y))),z.zpp_inner.weak=!1,d.push(z)}else if(D.__instanceof(n,xe)){var v=n.zpp_inner.vertices;if(null!=v)for(var m=v;;){var f,b,g=m.x,w=m.y;null==Vi.poolVec2?f=new Cn:(f=Vi.poolVec2,Vi.poolVec2=f.zpp_pool,f.zpp_pool=null),null==f.zpp_inner?(null==Ip.zpp_pool?b=new Ip:(b=Ip.zpp_pool,Ip.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=g,b.y=w,f.zpp_inner=b,f.zpp_inner.outer=f):(null!=(M=f.zpp_inner)._validate&&M._validate(),f.zpp_inner.x==g&&(null!=(C=f.zpp_inner)._validate&&C._validate(),f.zpp_inner.y==w)||(f.zpp_inner.x=g,f.zpp_inner.y=w,null!=(k=f.zpp_inner)._invalidate&&k._invalidate(k))),f.zpp_inner.weak=!1;var M=f,m=m.next;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var C=this.zpp_inner_zn.wrap_lverts,g=M.zpp_inner;null!=g._validate&&g._validate();var w=M.zpp_inner.x,k=M.zpp_inner;null!=k._validate&&k._validate();var O,P,g=M.zpp_inner.y;null==Vi.poolVec2?O=new Cn:(O=Vi.poolVec2,Vi.poolVec2=O.zpp_pool,O.zpp_pool=null),null==O.zpp_inner?(null==Ip.zpp_pool?P=new Ip:(P=Ip.zpp_pool,Ip.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=w,P.y=g,O.zpp_inner=P,O.zpp_inner.outer=O):(null!=(k=O.zpp_inner)._validate&&k._validate(),O.zpp_inner.x==w&&(null!=(k=O.zpp_inner)._validate&&k._validate(),O.zpp_inner.y==g)||(O.zpp_inner.x=w,O.zpp_inner.y=g,null!=(g=O.zpp_inner)._invalidate&&g._invalidate(g))),O.zpp_inner.weak=!1,C.push(O);C=M.zpp_inner;M.zpp_inner.outer=null,M.zpp_inner=null;M=M;M.zpp_pool=Vi.poolVec2,Vi.poolVec2=M;C=C;if(null!=C.outer&&(C.outer.zpp_inner=null,C.outer=null),C._isimmutable=null,C._validate=null,C._invalidate=null,C.next=Ip.zpp_pool,Ip.zpp_pool=C,m==v)break}}if(n instanceof Array&&null==n.__enum__)for(var S=n,A=0;A<S.length;){var j=S[A],E=!!j.zpp_inner.weak&&(E=j.zpp_inner,j.zpp_inner.outer=null,j.zpp_inner=null,(j=j).zpp_pool=Vi.poolVec2,Vi.poolVec2=j,null!=(E=E).outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=Ip.zpp_pool,Ip.zpp_pool=E,!0);E?S.splice(A,1):++A}else if(D.__instanceof(n,Y)){n=n;null!=n.zpp_inner._validate&&n.zpp_inner._validate();for(var I=n.zpp_inner.inner,T=null,N=I.head;null!=N;){var L,V=N.elt;V.outer.zpp_inner.weak?(N=I.erase(T),V.outer.zpp_inner.weak&&(V=(L=V.outer).zpp_inner,L.zpp_inner.outer=null,L.zpp_inner=null,(L=L).zpp_pool=Vi.poolVec2,Vi.poolVec2=L,null!=(V=V).outer&&(V.outer.zpp_inner=null,V.outer=null),V._isimmutable=null,V._validate=null,V._invalidate=null,V.next=Ip.zpp_pool,Ip.zpp_pool=V)):N=(T=N).next}}null==t?null==Gt.zpp_pool?this.zpp_inner.material=new Gt:(this.zpp_inner.material=Gt.zpp_pool,Gt.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(t.zpp_inner),this.zpp_inner.material.wrapper()),null==e?null==st.zpp_pool?this.zpp_inner.filter=new st:(this.zpp_inner.filter=st.zpp_pool,st.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(e.zpp_inner),this.zpp_inner.filter.wrapper()),this.zpp_inner_i.insert_cbtype(Sn.ANY_SHAPE.zpp_inner)};yn.__name__=["nape","shape","Polygon"],yn.__super__=hn,yn.prototype=Object.create(hn.prototype),yn.rect=function(n,t,e,i,p){var l;null==p&&(p=!1),null==Vi.poolVec2?a=new Cn:(a=Vi.poolVec2,Vi.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner?(null==Ip.zpp_pool?l=new Ip:(l=Ip.zpp_pool,Ip.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=t,a.zpp_inner=l,a.zpp_inner.outer=a):(null!=(l=a.zpp_inner)._validate&&l._validate(),a.zpp_inner.x==n&&(null!=(l=a.zpp_inner)._validate&&l._validate(),a.zpp_inner.y==t)||(a.zpp_inner.x=n,a.zpp_inner.y=t,null!=(o=a.zpp_inner)._invalidate&&o._invalidate(o))),a.zpp_inner.weak=p;var r,o=a,a=n+e;null==Vi.poolVec2?h=new Cn:(h=Vi.poolVec2,Vi.poolVec2=h.zpp_pool,h.zpp_pool=null),null==h.zpp_inner?(null==Ip.zpp_pool?r=new Ip:(r=Ip.zpp_pool,Ip.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=a,r.y=t,h.zpp_inner=r,h.zpp_inner.outer=h):(null!=(r=h.zpp_inner)._validate&&r._validate(),h.zpp_inner.x==a&&(null!=(r=h.zpp_inner)._validate&&r._validate(),h.zpp_inner.y==t)||(h.zpp_inner.x=a,h.zpp_inner.y=t,null!=(_=h.zpp_inner)._invalidate&&_._invalidate(_))),h.zpp_inner.weak=p;var s,_=h,h=n+e,e=t+i;null==Vi.poolVec2?d=new Cn:(d=Vi.poolVec2,Vi.poolVec2=d.zpp_pool,d.zpp_pool=null),null==d.zpp_inner?(null==Ip.zpp_pool?s=new Ip:(s=Ip.zpp_pool,Ip.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=h,s.y=e,d.zpp_inner=s,d.zpp_inner.outer=d):(null!=(s=d.zpp_inner)._validate&&s._validate(),d.zpp_inner.x==h&&(null!=(s=d.zpp_inner)._validate&&s._validate(),d.zpp_inner.y==e)||(d.zpp_inner.x=h,d.zpp_inner.y=e,null!=(e=d.zpp_inner)._invalidate&&e._invalidate(e))),d.zpp_inner.weak=p;var u,x,d=d,i=t+i;return null==Vi.poolVec2?u=new Cn:(u=Vi.poolVec2,Vi.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner?(null==Ip.zpp_pool?x=new Ip:(x=Ip.zpp_pool,Ip.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=n,x.y=i,u.zpp_inner=x,u.zpp_inner.outer=u):(null!=(x=u.zpp_inner)._validate&&x._validate(),u.zpp_inner.x==n&&(null!=(x=u.zpp_inner)._validate&&x._validate(),u.zpp_inner.y==i)||(u.zpp_inner.x=n,u.zpp_inner.y=i,null!=(i=u.zpp_inner)._invalidate&&i._invalidate(i))),u.zpp_inner.weak=p,[o,_,d,u]},yn.box=function(n,t,e){return null==e&&(e=!1),yn.rect(-n/2,-t/2,n,t,e)},yn.regular=function(n,t,e,i,p){null==p&&(p=!1),null==i&&(i=0);for(var l=[],r=2*Math.PI/e,o=0;o<e;){var a,s,_=o++*r+i,h=Math.cos(_)*n,u=Math.sin(_)*t;null==Vi.poolVec2?a=new Cn:(a=Vi.poolVec2,Vi.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner?(null==Ip.zpp_pool?s=new Ip:(s=Ip.zpp_pool,Ip.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=h,s.y=u,a.zpp_inner=s,a.zpp_inner.outer=a):(null!=(_=a.zpp_inner)._validate&&_._validate(),a.zpp_inner.x==h&&(null!=(_=a.zpp_inner)._validate&&_._validate(),a.zpp_inner.y==u)||(a.zpp_inner.x=h,a.zpp_inner.y=u,null!=(u=a.zpp_inner)._invalidate&&u._invalidate(u))),a.zpp_inner.weak=p,l.push(a)}return l},yn.prototype.zpp_inner_zn=null,yn.prototype.get_localVerts=function(){return null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts(),this.zpp_inner_zn.wrap_lverts},yn.prototype.get_worldVerts=function(){return null==this.zpp_inner_zn.wrap_gverts&&this.zpp_inner_zn.getgverts(),this.zpp_inner_zn.wrap_gverts},yn.prototype.get_edges=function(){return null==this.zpp_inner_zn.wrap_edges&&this.zpp_inner_zn.getedges(),this.zpp_inner_zn.wrap_edges},yn.prototype.validity=function(){return this.zpp_inner_zn.valid()},Object.defineProperty(yn.prototype,"localVerts",{get:yn.prototype.get_localVerts}),Object.defineProperty(yn.prototype,"worldVerts",{get:yn.prototype.get_worldVerts}),Object.defineProperty(yn.prototype,"edges",{get:yn.prototype.get_edges}),yn.prototype.__class__=yn;var pt=nape.shape.ShapeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};pt.__name__=["nape","shape","ShapeIterator"],pt.get=function(n){var t,e=null==pt.zpp_pool?(Ii.internal=!0,t=new pt,Ii.internal=!1,t):(e=pt.zpp_pool,pt.zpp_pool=e.zpp_next,e);return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},pt.prototype.zpp_inner=null,pt.prototype.zpp_i=null,pt.prototype.zpp_critical=null,pt.prototype.zpp_next=null,pt.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);n=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=pt.zpp_pool,(pt.zpp_pool=this).zpp_inner=null,!1)},pt.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},pt.prototype.__class__=pt;var zn=nape.shape.ShapeList=function(){this.zpp_inner=null,this.zpp_inner=new Ii,this.zpp_inner.outer=this};zn.__name__=["nape","shape","ShapeList"],zn.fromArray=function(n){for(var t=new zn,e=0;e<n.length;){var i=n[e];++e,t.push(i)}return t},zn.prototype.zpp_inner=null,zn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},zn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},zn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},zn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},zn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var t,e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(t=null==this.zpp_inner.inner.head?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},zn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()):(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=(e=(null==(n=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:n.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(n)),this.zpp_inner.invalidate(),e.outer},zn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n,t,e=null;return this.zpp_inner.reverse_flag?(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=(e=(null==(t=1==this.zpp_inner.user_length?null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)))?this.zpp_inner.inner.head:t.next).elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)):(t=(e=this.zpp_inner.inner.head.elt).outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()),this.zpp_inner.invalidate(),e.outer},zn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},zn.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),t=!1;for(var e=this.zpp_inner.inner.head;null!=e;){if(e.elt==n.zpp_inner){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},zn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},zn.prototype.empty=function(){return null==this.zpp_inner.inner.head},zn.prototype.iterator=function(){return this.zpp_inner.valmod(),pt.get(this)},zn.prototype.copy=function(n){null==n&&(n=!1);var t=new zn;this.zpp_inner.valmod();for(var e=pt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=pt.zpp_pool,(pt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t.push(n?null:i)}return t},zn.prototype.merge=function(n){n.zpp_inner.valmod();for(var t=pt.get(n);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=pt.zpp_pool,(pt.zpp_pool=t).zpp_inner=null,!1)))break;t.zpp_critical=!1;e=t.zpp_inner.at(t.zpp_i++);this.has(e)||(this.zpp_inner.reverse_flag?this.push(e):this.unshift(e))}},zn.prototype.toString=function(){var n="[",t=!0;this.zpp_inner.valmod();for(var e=pt.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=pt.zpp_pool,(pt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);t||(n+=","),n+=null==i?"NULL":i.toString(),t=!1}return n+"]"},zn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var t=pt.get(this);;){t.zpp_inner.zpp_inner.valmod();var e=t.zpp_inner;e.zpp_inner.valmod(),e.zpp_inner.zip_length&&(e.zpp_inner.zip_length=!1,e.zpp_inner.user_length=e.zpp_inner.inner.length);e=e.zpp_inner.user_length;if(t.zpp_critical=!0,!(t.zpp_i<e||(t.zpp_next=pt.zpp_pool,(pt.zpp_pool=t).zpp_inner=null,!1)))break;try{t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}catch(n){t.zpp_next=pt.zpp_pool,(pt.zpp_pool=t).zpp_inner=null;break}}return this},zn.prototype.filter=function(n){for(var t=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t<this.zpp_inner.user_length;){var e=this.at(t);try{n(e)?++t:this.remove(e)}catch(n){break}}return this},Object.defineProperty(zn.prototype,"length",{get:zn.prototype.get_length}),zn.prototype.__class__=zn;var cn=nape.shape.ShapeType=function(){};cn.__name__=["nape","shape","ShapeType"],cn.CIRCLE=null,cn.get_CIRCLE=function(){return null==Yi.ShapeType_CIRCLE&&(Yi.internal=!0,Yi.ShapeType_CIRCLE=new cn,Yi.internal=!1),Yi.ShapeType_CIRCLE},cn.POLYGON=null,cn.get_POLYGON=function(){return null==Yi.ShapeType_POLYGON&&(Yi.internal=!0,Yi.ShapeType_POLYGON=new cn,Yi.internal=!1),Yi.ShapeType_POLYGON},cn.prototype.toString=function(){return null==Yi.ShapeType_CIRCLE&&(Yi.internal=!0,Yi.ShapeType_CIRCLE=new cn,Yi.internal=!1),this==Yi.ShapeType_CIRCLE?"CIRCLE":(null==Yi.ShapeType_POLYGON&&(Yi.internal=!0,Yi.ShapeType_POLYGON=new cn,Yi.internal=!1),this==Yi.ShapeType_POLYGON?"POLYGON":"")},Object.defineProperty(cn,"CIRCLE",{get:cn.get_CIRCLE}),Object.defineProperty(cn,"POLYGON",{get:cn.get_POLYGON}),cn.prototype.__class__=cn;var vn=nape.shape.ValidationResult=function(){};vn.__name__=["nape","shape","ValidationResult"],vn.VALID=null,vn.get_VALID=function(){return null==Yi.ValidationResult_VALID&&(Yi.internal=!0,Yi.ValidationResult_VALID=new vn,Yi.internal=!1),Yi.ValidationResult_VALID},vn.DEGENERATE=null,vn.get_DEGENERATE=function(){return null==Yi.ValidationResult_DEGENERATE&&(Yi.internal=!0,Yi.ValidationResult_DEGENERATE=new vn,Yi.internal=!1),Yi.ValidationResult_DEGENERATE},vn.CONCAVE=null,vn.get_CONCAVE=function(){return null==Yi.ValidationResult_CONCAVE&&(Yi.internal=!0,Yi.ValidationResult_CONCAVE=new vn,Yi.internal=!1),Yi.ValidationResult_CONCAVE},vn.SELF_INTERSECTING=null,vn.get_SELF_INTERSECTING=function(){return null==Yi.ValidationResult_SELF_INTERSECTING&&(Yi.internal=!0,Yi.ValidationResult_SELF_INTERSECTING=new vn,Yi.internal=!1),Yi.ValidationResult_SELF_INTERSECTING},vn.prototype.toString=function(){return null==Yi.ValidationResult_VALID&&(Yi.internal=!0,Yi.ValidationResult_VALID=new vn,Yi.internal=!1),this==Yi.ValidationResult_VALID?"VALID":(null==Yi.ValidationResult_DEGENERATE&&(Yi.internal=!0,Yi.ValidationResult_DEGENERATE=new vn,Yi.internal=!1),this==Yi.ValidationResult_DEGENERATE?"DEGENERATE":(null==Yi.ValidationResult_CONCAVE&&(Yi.internal=!0,Yi.ValidationResult_CONCAVE=new vn,Yi.internal=!1),this==Yi.ValidationResult_CONCAVE?"CONCAVE":(null==Yi.ValidationResult_SELF_INTERSECTING&&(Yi.internal=!0,Yi.ValidationResult_SELF_INTERSECTING=new vn,Yi.internal=!1),this==Yi.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")))},Object.defineProperty(vn,"VALID",{get:vn.get_VALID}),Object.defineProperty(vn,"DEGENERATE",{get:vn.get_DEGENERATE}),Object.defineProperty(vn,"CONCAVE",{get:vn.get_CONCAVE}),Object.defineProperty(vn,"SELF_INTERSECTING",{get:vn.get_SELF_INTERSECTING}),vn.prototype.__class__=vn;var mn=nape.space.Broadphase=function(){};mn.__name__=["nape","space","Broadphase"],mn.DYNAMIC_AABB_TREE=null,mn.get_DYNAMIC_AABB_TREE=function(){return null==Yi.Broadphase_DYNAMIC_AABB_TREE&&(Yi.internal=!0,Yi.Broadphase_DYNAMIC_AABB_TREE=new mn,Yi.internal=!1),Yi.Broadphase_DYNAMIC_AABB_TREE},mn.SWEEP_AND_PRUNE=null,mn.get_SWEEP_AND_PRUNE=function(){return null==Yi.Broadphase_SWEEP_AND_PRUNE&&(Yi.internal=!0,Yi.Broadphase_SWEEP_AND_PRUNE=new mn,Yi.internal=!1),Yi.Broadphase_SWEEP_AND_PRUNE},mn.prototype.toString=function(){return null==Yi.Broadphase_DYNAMIC_AABB_TREE&&(Yi.internal=!0,Yi.Broadphase_DYNAMIC_AABB_TREE=new mn,Yi.internal=!1),this==Yi.Broadphase_DYNAMIC_AABB_TREE?"DYNAMIC_AABB_TREE":(null==Yi.Broadphase_SWEEP_AND_PRUNE&&(Yi.internal=!0,Yi.Broadphase_SWEEP_AND_PRUNE=new mn,Yi.internal=!1),this==Yi.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"")},Object.defineProperty(mn,"DYNAMIC_AABB_TREE",{get:mn.get_DYNAMIC_AABB_TREE}),Object.defineProperty(mn,"SWEEP_AND_PRUNE",{get:mn.get_SWEEP_AND_PRUNE}),mn.prototype.__class__=mn,(y=nape.space.Space=function(n,t){this.zpp_inner=null,this.zpp_inner=new ie(null==n?null:n.zpp_inner,t),this.zpp_inner.outer=this,null!=n&&n.zpp_inner.weak&&(t=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t)}).__name__=["nape","space","Space"],y.prototype.zpp_inner=null,y.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},y.prototype.get_gravity=function(){return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},y.prototype.set_gravity=function(n){null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var t=this.zpp_inner.wrap_gravity,e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,e=n.zpp_inner.y,p=t.zpp_inner;return null!=p._validate&&p._validate(),t.zpp_inner.x==i&&(null!=(p=t.zpp_inner)._validate&&p._validate(),t.zpp_inner.y==e)||(t.zpp_inner.x=i,t.zpp_inner.y=e,null!=(l=t.zpp_inner)._invalidate&&l._invalidate(l)),n.zpp_inner.weak&&(l=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l),null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},y.prototype.get_broadphase=function(){return this.zpp_inner.bphase.is_sweep?(null==Yi.Broadphase_SWEEP_AND_PRUNE&&(Yi.internal=!0,Yi.Broadphase_SWEEP_AND_PRUNE=new mn,Yi.internal=!1),Yi.Broadphase_SWEEP_AND_PRUNE):(null==Yi.Broadphase_DYNAMIC_AABB_TREE&&(Yi.internal=!0,Yi.Broadphase_DYNAMIC_AABB_TREE=new mn,Yi.internal=!1),Yi.Broadphase_DYNAMIC_AABB_TREE)},y.prototype.get_sortContacts=function(){return this.zpp_inner.sortcontacts},y.prototype.set_sortContacts=function(n){return this.zpp_inner.sortcontacts=n,this.zpp_inner.sortcontacts},y.prototype.get_worldAngularDrag=function(){return this.zpp_inner.global_ang_drag},y.prototype.set_worldAngularDrag=function(n){return this.zpp_inner.global_ang_drag=n,this.zpp_inner.global_ang_drag},y.prototype.get_worldLinearDrag=function(){return this.zpp_inner.global_lin_drag},y.prototype.set_worldLinearDrag=function(n){return this.zpp_inner.global_lin_drag=n,this.zpp_inner.global_lin_drag},y.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},y.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},y.prototype.get_liveBodies=function(){return this.zpp_inner.wrap_live},y.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},y.prototype.get_liveConstraints=function(){return this.zpp_inner.wrap_livecon},y.prototype.visitBodies=function(n){var t=this.zpp_inner.wrap_bodies;t.zpp_inner.valmod();for(var e=nt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=nt.zpp_pool,(nt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}t=this.zpp_inner.wrap_compounds;t.zpp_inner.valmod();for(var p=tt.get(t);;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);l=l.zpp_inner.user_length;if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=tt.zpp_pool,(tt.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1,p.zpp_inner.at(p.zpp_i++).visitBodies(n)}},y.prototype.visitConstraints=function(n){var t=this.zpp_inner.wrap_constraints;t.zpp_inner.valmod();for(var e=Kn.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=Kn.zpp_pool,(Kn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}t=this.zpp_inner.wrap_compounds;t.zpp_inner.valmod();for(var p=tt.get(t);;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);l=l.zpp_inner.user_length;if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=tt.zpp_pool,(tt.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1,p.zpp_inner.at(p.zpp_i++).visitConstraints(n)}},y.prototype.visitCompounds=function(n){var t=this.zpp_inner.wrap_compounds;t.zpp_inner.valmod();for(var e=tt.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);i=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<i||(e.zpp_next=tt.zpp_pool,(tt.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);n(i),i.visitCompounds(n)}},y.prototype.get_world=function(){return this.zpp_inner.__static},y.prototype.get_arbiters=function(){var n;return null==this.zpp_inner.wrap_arbiters&&((n=new ht).space=this.zpp_inner,this.zpp_inner.wrap_arbiters=n),this.zpp_inner.wrap_arbiters},y.prototype.get_listeners=function(){return this.zpp_inner.wrap_listeners},y.prototype.clear=function(){this.zpp_inner.clear()},y.prototype.step=function(n,t,e){null==e&&(e=10),null==t&&(t=10),this.zpp_inner.step(n,t,e)},y.prototype.get_timeStamp=function(){return this.zpp_inner.stamp},y.prototype.get_elapsedTime=function(){return this.zpp_inner.time},y.prototype.interactionType=function(n,t){if(1==(null!=n.zpp_inner.body?n.zpp_inner.body.outer:null).zpp_inner.type&&1==(null!=t.zpp_inner.body?t.zpp_inner.body.outer:null).zpp_inner.type)return null;if((null!=n.zpp_inner.body?n.zpp_inner.body.outer:null)==(null!=t.zpp_inner.body?t.zpp_inner.body.outer:null))return null;for(var e,i,p,n=n.zpp_inner,t=t.zpp_inner,l=n.body,r=t.body,o=!1,a=l.constraints.head;null!=a;){var s=a.elt;if(s.ignore&&s.pair_exists(l.id,r.id)){o=!0;break}a=a.next}if(o)e=!1;else{for(var _=n;null!=_&&null==_.group;)_=null!=_.ishape?_.ishape.body:(null!=_.icompound?_.icompound:_.ibody).compound;var h,u=null==_?null:_.group;if(null==u)h=!1;else{for(var x=t;null!=x&&null==x.group;)x=null!=x.ishape?x.ishape.body:(null!=x.icompound?x.icompound:x.ibody).compound;var d=null==x?null:x.group;if(null==d)h=!1;else{for(var y=!1;null!=u&&null!=d;){if(u==d){y=u.ignore;break}u.depth<d.depth?d=d.group:u=u.group}h=y}}e=!h}switch(e?!(!n.sensorEnabled&&!t.sensorEnabled)&&(p=n.filter,i=t.filter,0!=(p.sensorMask&i.sensorGroup)&&0!=(i.sensorMask&p.sensorGroup))?2:!!(!(!n.fluidEnabled&&!t.fluidEnabled)&&(i=n.filter,p=t.filter,0!=(i.fluidMask&p.fluidGroup)&&0!=(p.fluidMask&i.fluidGroup)))&&!(0==l.imass&&0==r.imass&&0==l.iinertia&&0==r.iinertia)?0:(n=n.filter,t=t.filter,0!=(n.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&n.collisionGroup)&&!(0==l.imass&&0==r.imass&&0==l.iinertia&&0==r.iinertia)?1:-1):-1){case 0:return null==Yi.InteractionType_FLUID&&(Yi.internal=!0,Yi.InteractionType_FLUID=new z,Yi.internal=!1),Yi.InteractionType_FLUID;case 1:return null==Yi.InteractionType_COLLISION&&(Yi.internal=!0,Yi.InteractionType_COLLISION=new z,Yi.internal=!1),Yi.InteractionType_COLLISION;case 2:return null==Yi.InteractionType_SENSOR&&(Yi.internal=!0,Yi.InteractionType_SENSOR=new z,Yi.internal=!1),Yi.InteractionType_SENSOR;default:return null}},y.prototype.shapesUnderPoint=function(n,t,e){var i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();t=this.zpp_inner.shapesUnderPoint(p,n.zpp_inner.y,null==t?null:t.zpp_inner,e);return n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e),t},y.prototype.bodiesUnderPoint=function(n,t,e){var i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();t=this.zpp_inner.bodiesUnderPoint(p,n.zpp_inner.y,null==t?null:t.zpp_inner,e);return n.zpp_inner.weak&&(e=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e),t},y.prototype.shapesInAABB=function(n,t,e,i,p){return null==e&&(e=!0),null==t&&(t=!1),this.zpp_inner.shapesInAABB(n,e,t,null==i?null:i.zpp_inner,p)},y.prototype.bodiesInAABB=function(n,t,e,i,p){return null==e&&(e=!0),null==t&&(t=!1),this.zpp_inner.bodiesInAABB(n,e,t,null==i?null:i.zpp_inner,p)},y.prototype.shapesInCircle=function(n,t,e,i,p){null==e&&(e=!1);i=this.zpp_inner.shapesInCircle(n,t,e,null==i?null:i.zpp_inner,p);return n.zpp_inner.weak&&(p=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p),i},y.prototype.bodiesInCircle=function(n,t,e,i,p){null==e&&(e=!1);i=this.zpp_inner.bodiesInCircle(n,t,e,null==i?null:i.zpp_inner,p);return n.zpp_inner.weak&&(p=n.zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p),i},y.prototype.shapesInShape=function(n,t,e,i){return null==t&&(t=!1),this.zpp_inner.shapesInShape(n.zpp_inner,t,null==e?null:e.zpp_inner,i)},y.prototype.bodiesInShape=function(n,t,e,i){return null==t&&(t=!1),this.zpp_inner.bodiesInShape(n.zpp_inner,t,null==e?null:e.zpp_inner,i)},y.prototype.shapesInBody=function(n,t,e){var i=null==e?new zn:e,n=n.zpp_inner.wrap_shapes;n.zpp_inner.valmod();for(var p=pt.get(n);;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);l=l.zpp_inner.user_length;if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=pt.zpp_pool,(pt.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1,this.shapesInShape(p.zpp_inner.at(p.zpp_i++),!1,t,i)}return i},y.prototype.bodiesInBody=function(n,t,e){var i=null==e?new nn:e,n=n.zpp_inner.wrap_shapes;n.zpp_inner.valmod();for(var p=pt.get(n);;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);l=l.zpp_inner.user_length;if(p.zpp_critical=!0,!(p.zpp_i<l||(p.zpp_next=pt.zpp_pool,(pt.zpp_pool=p).zpp_inner=null,!1)))break;p.zpp_critical=!1,this.bodiesInShape(p.zpp_inner.at(p.zpp_i++),!1,t,i)}return i},y.prototype.convexCast=function(n,t,e,i){return null==e&&(e=!1),this.zpp_inner.convexCast(n.zpp_inner,t,i,e)},y.prototype.convexMultiCast=function(n,t,e,i,p){return null==e&&(e=!1),this.zpp_inner.convexMultiCast(n.zpp_inner,t,i,e,p)},y.prototype.rayCast=function(n,t,e){return null==t&&(t=!1),this.zpp_inner.rayCast(n,t,e)},y.prototype.rayMultiCast=function(n,t,e,i){return null==t&&(t=!1),this.zpp_inner.rayMultiCast(n,t,e,i)},Object.defineProperty(y.prototype,"userData",{get:y.prototype.get_userData}),Object.defineProperty(y.prototype,"gravity",{get:y.prototype.get_gravity,set:y.prototype.set_gravity}),Object.defineProperty(y.prototype,"broadphase",{get:y.prototype.get_broadphase}),Object.defineProperty(y.prototype,"sortContacts",{get:y.prototype.get_sortContacts,set:y.prototype.set_sortContacts}),Object.defineProperty(y.prototype,"worldAngularDrag",{get:y.prototype.get_worldAngularDrag,set:y.prototype.set_worldAngularDrag}),Object.defineProperty(y.prototype,"worldLinearDrag",{get:y.prototype.get_worldLinearDrag,set:y.prototype.set_worldLinearDrag}),Object.defineProperty(y.prototype,"compounds",{get:y.prototype.get_compounds}),Object.defineProperty(y.prototype,"bodies",{get:y.prototype.get_bodies}),Object.defineProperty(y.prototype,"liveBodies",{get:y.prototype.get_liveBodies}),Object.defineProperty(y.prototype,"constraints",{get:y.prototype.get_constraints}),Object.defineProperty(y.prototype,"liveConstraints",{get:y.prototype.get_liveConstraints}),Object.defineProperty(y.prototype,"world",{get:y.prototype.get_world}),Object.defineProperty(y.prototype,"arbiters",{get:y.prototype.get_arbiters}),Object.defineProperty(y.prototype,"listeners",{get:y.prototype.get_listeners}),Object.defineProperty(y.prototype,"timeStamp",{get:y.prototype.get_timeStamp}),Object.defineProperty(y.prototype,"elapsedTime",{get:y.prototype.get_elapsedTime}),y.prototype.__class__=y,(l=nape.util.Debug=function(){}).__name__=["nape","util","Debug"],l.version=function(){return"Nape 2.0.19"},l.clearObjectPools=function(){for(;null!=Kn.zpp_pool;){var n=Kn.zpp_pool.zpp_next;Kn.zpp_pool.zpp_next=null,Kn.zpp_pool=n}for(;null!=et.zpp_pool;){var t=et.zpp_pool.zpp_next;et.zpp_pool.zpp_next=null,et.zpp_pool=t}for(;null!=nt.zpp_pool;){var e=nt.zpp_pool.zpp_next;nt.zpp_pool.zpp_next=null,nt.zpp_pool=e}for(;null!=tt.zpp_pool;){var i=tt.zpp_pool.zpp_next;tt.zpp_pool.zpp_next=null,tt.zpp_pool=i}for(;null!=Un.zpp_pool;){var p=Un.zpp_pool.zpp_next;Un.zpp_pool.zpp_next=null,Un.zpp_pool=p}for(;null!=qn.zpp_pool;){var l=qn.zpp_pool.zpp_next;qn.zpp_pool.zpp_next=null,qn.zpp_pool=l}for(;null!=Xn.zpp_pool;){var r=Xn.zpp_pool.zpp_next;Xn.zpp_pool.zpp_next=null,Xn.zpp_pool=r}for(;null!=Hn.zpp_pool;){var o=Hn.zpp_pool.zpp_next;Hn.zpp_pool.zpp_next=null,Hn.zpp_pool=o}for(;null!=Qn.zpp_pool;){var a=Qn.zpp_pool.zpp_next;Qn.zpp_pool.zpp_next=null,Qn.zpp_pool=a}for(;null!=$n.zpp_pool;){var s=$n.zpp_pool.zpp_next;$n.zpp_pool.zpp_next=null,$n.zpp_pool=s}for(;null!=pt.zpp_pool;){var _=pt.zpp_pool.zpp_next;pt.zpp_pool.zpp_next=null,pt.zpp_pool=_}for(;null!=it.zpp_pool;){var h=it.zpp_pool.zpp_next;it.zpp_pool.zpp_next=null,it.zpp_pool=h}for(;null!=Yn.zpp_pool;){var u=Yn.zpp_pool.zpp_next;Yn.zpp_pool.zpp_next=null,Yn.zpp_pool=u}for(;null!=Wn.zpp_pool;){var x=Wn.zpp_pool.zpp_next;Wn.zpp_pool.zpp_next=null,Wn.zpp_pool=x}for(;null!=Jn.zpp_pool;){var d=Jn.zpp_pool.zpp_next;Jn.zpp_pool.zpp_next=null,Jn.zpp_pool=d}for(;null!=Ge.zpp_pool;){var y=Ge.zpp_pool.next;Ge.zpp_pool.next=null,Ge.zpp_pool=y}for(;null!=qe.zpp_pool;){var z=qe.zpp_pool.next;qe.zpp_pool.next=null,qe.zpp_pool=z}for(;null!=Gt.zpp_pool;){var c=Gt.zpp_pool.next;Gt.zpp_pool.next=null,Gt.zpp_pool=c}for(;null!=Ue.zpp_pool;){var v=Ue.zpp_pool.next;Ue.zpp_pool.next=null,Ue.zpp_pool=v}for(;null!=Bt.zpp_pool;){var m=Bt.zpp_pool.next;Bt.zpp_pool.next=null,Bt.zpp_pool=m}for(;null!=Ke.zpp_pool;){var f=Ke.zpp_pool.next;Ke.zpp_pool.next=null,Ke.zpp_pool=f}for(;null!=We.zpp_pool;){var b=We.zpp_pool.next;We.zpp_pool.next=null,We.zpp_pool=b}for(;null!=Ye.zpp_pool;){var g=Ye.zpp_pool.next;Ye.zpp_pool.next=null,Ye.zpp_pool=g}for(;null!=tp.zpp_pool;){var w=tp.zpp_pool.next;tp.zpp_pool.next=null,tp.zpp_pool=w}for(;null!=Di.zpp_pool;){var M=Di.zpp_pool.next;Di.zpp_pool.next=null,Di.zpp_pool=M}for(;null!=Wi.zpp_pool;){var C=Wi.zpp_pool.next;Wi.zpp_pool.next=null,Wi.zpp_pool=C}for(;null!=ep.zpp_pool;){var k=ep.zpp_pool.next;ep.zpp_pool.next=null,ep.zpp_pool=k}for(;null!=Je.zpp_pool;){var O=Je.zpp_pool.next;Je.zpp_pool.next=null,Je.zpp_pool=O}for(;null!=ip.zpp_pool;){var P=ip.zpp_pool.next;ip.zpp_pool.next=null,ip.zpp_pool=P}for(;null!=Xe.zpp_pool;){var S=Xe.zpp_pool.next;Xe.zpp_pool.next=null,Xe.zpp_pool=S}for(;null!=lt.zpp_pool;){var A=lt.zpp_pool.next;lt.zpp_pool.next=null,lt.zpp_pool=A}for(;null!=Ki.zpp_pool;){var j=Ki.zpp_pool.next;Ki.zpp_pool.next=null,Ki.zpp_pool=j}for(;null!=He.zpp_pool;){var E=He.zpp_pool.next;He.zpp_pool.next=null,He.zpp_pool=E}for(;null!=$e.zpp_pool;){var I=$e.zpp_pool.next;$e.zpp_pool.next=null,$e.zpp_pool=I}for(;null!=ii.zpp_pool;){var T=ii.zpp_pool.next;ii.zpp_pool.next=null,ii.zpp_pool=T}for(;null!=ct.zpp_pool;){var N=ct.zpp_pool.next;ct.zpp_pool.next=null,ct.zpp_pool=N}for(;null!=mt.zpp_pool;){var L=mt.zpp_pool.next;mt.zpp_pool.next=null,mt.zpp_pool=L}for(;null!=Fi.zpp_pool;){var V=Fi.zpp_pool.next;Fi.zpp_pool.next=null,Fi.zpp_pool=V}for(;null!=ye.zpp_pool;){var D=ye.zpp_pool.next;ye.zpp_pool.next=null,ye.zpp_pool=D}for(;null!=ze.zpp_pool;){var F=ze.zpp_pool.next;ze.zpp_pool.next=null,ze.zpp_pool=F}for(;null!=Qe.zpp_pool;){var R=Qe.zpp_pool.next;Qe.zpp_pool.next=null,Qe.zpp_pool=R}for(;null!=ni.zpp_pool;){var Z=ni.zpp_pool.next;ni.zpp_pool.next=null,ni.zpp_pool=Z}for(;null!=Ip.zpp_pool;){var B=Ip.zpp_pool.next;Ip.zpp_pool.next=null,Ip.zpp_pool=B}for(;null!=ti.zpp_pool;){var G=ti.zpp_pool.next;ti.zpp_pool.next=null,ti.zpp_pool=G}for(;null!=gt.zpp_pool;){var q=gt.zpp_pool.next;gt.zpp_pool.next=null,gt.zpp_pool=q}for(;null!=Ri.zpp_pool;){var U=Ri.zpp_pool.next;Ri.zpp_pool.next=null,Ri.zpp_pool=U}for(;null!=At.zpp_pool;){var K=At.zpp_pool.next;At.zpp_pool.next=null,At.zpp_pool=K}for(;null!=jt.zpp_pool;){var W=jt.zpp_pool.next;jt.zpp_pool.next=null,jt.zpp_pool=W}for(;null!=wt.zpp_pool;){var Y=wt.zpp_pool.next;wt.zpp_pool.next=null,wt.zpp_pool=Y}for(;null!=ei.zpp_pool;){var J=ei.zpp_pool.next;ei.zpp_pool.next=null,ei.zpp_pool=J}for(;null!=ri.zpp_pool;){var X=ri.zpp_pool.next;ri.zpp_pool.next=null,ri.zpp_pool=X}for(;null!=Nt.zpp_pool;){var H=Nt.zpp_pool.next;Nt.zpp_pool.next=null,Nt.zpp_pool=H}for(;null!=Zi.zpp_pool;){var $=Zi.zpp_pool.next;Zi.zpp_pool.next=null,Zi.zpp_pool=$}for(;null!=oi.zpp_pool;){var Q=oi.zpp_pool.next;oi.zpp_pool.next=null,oi.zpp_pool=Q}for(;null!=Lt.zpp_pool;){var nn=Lt.zpp_pool.next;Lt.zpp_pool.next=null,Lt.zpp_pool=nn}for(;null!=Bi.zpp_pool;){var tn=Bi.zpp_pool.next;Bi.zpp_pool.next=null,Bi.zpp_pool=tn}for(;null!=Ct.zpp_pool;){var en=Ct.zpp_pool.next;Ct.zpp_pool.next=null,Ct.zpp_pool=en}for(;null!=kt.zpp_pool;){var pn=kt.zpp_pool.next;kt.zpp_pool.next=null,kt.zpp_pool=pn}for(;null!=Gi.zpp_pool;){var ln=Gi.zpp_pool.next;Gi.zpp_pool.next=null,Gi.zpp_pool=ln}for(;null!=qi.zpp_pool;){var rn=qi.zpp_pool.next;qi.zpp_pool.next=null,qi.zpp_pool=rn}for(;null!=Ot.zpp_pool;){var on=Ot.zpp_pool.next;Ot.zpp_pool.next=null,Ot.zpp_pool=on}for(;null!=se.zpp_pool;){var an=se.zpp_pool.next;se.zpp_pool.next=null,se.zpp_pool=an}for(;null!=It.zpp_pool;){var sn=It.zpp_pool.next;It.zpp_pool.next=null,It.zpp_pool=sn}for(;null!=ai.zpp_pool;){var _n=ai.zpp_pool.next;ai.zpp_pool.next=null,ai.zpp_pool=_n}for(;null!=si.zpp_pool;){var hn=si.zpp_pool.next;si.zpp_pool.next=null,si.zpp_pool=hn}for(;null!=vt.zpp_pool;){var un=vt.zpp_pool.next;vt.zpp_pool.next=null,vt.zpp_pool=un}for(;null!=pi.zpp_pool;){var xn=pi.zpp_pool.next;pi.zpp_pool.next=null,pi.zpp_pool=xn}for(;null!=_i.zpp_pool;){var dn=_i.zpp_pool.next;_i.zpp_pool.next=null,_i.zpp_pool=dn}for(;null!=Kt.zpp_pool;){var yn=Kt.zpp_pool.next;Kt.zpp_pool.next=null,Kt.zpp_pool=yn}for(;null!=hi.zpp_pool;){var zn=hi.zpp_pool.next;hi.zpp_pool.next=null,hi.zpp_pool=zn}for(;null!=ui.zpp_pool;){var cn=ui.zpp_pool.next;ui.zpp_pool.next=null,ui.zpp_pool=cn}for(;null!=pe.zpp_pool;){var vn=pe.zpp_pool.next;pe.zpp_pool.next=null,pe.zpp_pool=vn}for(;null!=Jt.zpp_pool;){var mn=Jt.zpp_pool.next;Jt.zpp_pool.next=null,Jt.zpp_pool=mn}for(;null!=Xt.zpp_pool;){var fn=Xt.zpp_pool.next;Xt.zpp_pool.next=null,Xt.zpp_pool=fn}for(;null!=xi.zpp_pool;){var bn=xi.zpp_pool.next;xi.zpp_pool.next=null,xi.zpp_pool=bn}for(;null!=$i.zpp_pool;){var gn=$i.zpp_pool.next;$i.zpp_pool.next=null,$i.zpp_pool=gn}for(;null!=di.zpp_pool;){var wn=di.zpp_pool.next;di.zpp_pool.next=null,di.zpp_pool=wn}for(;null!=ne.zpp_pool;){var Mn=ne.zpp_pool.next;ne.zpp_pool.next=null,ne.zpp_pool=Mn}for(;null!=te.zpp_pool;){var Cn=te.zpp_pool.next;te.zpp_pool.next=null,te.zpp_pool=Cn}for(;null!=np.zpp_pool;){var kn=np.zpp_pool.next;np.zpp_pool.next=null,np.zpp_pool=kn}for(;null!=Ji.zpp_pool;){var On=Ji.zpp_pool.next;Ji.zpp_pool.next=null,Ji.zpp_pool=On}for(;null!=Xi.zpp_pool;){var Pn=Xi.zpp_pool.next;Xi.zpp_pool.next=null,Xi.zpp_pool=Pn}for(;null!=op.zpp_pool;){var Sn=op.zpp_pool.next;op.zpp_pool.next=null,op.zpp_pool=Sn}for(;null!=pp.zpp_pool;){var An=pp.zpp_pool.next;pp.zpp_pool.next=null,pp.zpp_pool=An}for(;null!=Hi.zpp_pool;){var jn=Hi.zpp_pool.next;Hi.zpp_pool.next=null,Hi.zpp_pool=jn}for(;null!=lp.zpp_pool;){var En=lp.zpp_pool.next;lp.zpp_pool.next=null,lp.zpp_pool=En}for(;null!=yi.zpp_pool;){var In=yi.zpp_pool.next;yi.zpp_pool.next=null,yi.zpp_pool=In}for(;null!=rp.zpp_pool;){var Tn=rp.zpp_pool.next;rp.zpp_pool.next=null,rp.zpp_pool=Tn}for(;null!=zi.zpp_pool;){var Nn=zi.zpp_pool.next;zi.zpp_pool.next=null,zi.zpp_pool=Nn}for(;null!=ci.zpp_pool;){var Ln=ci.zpp_pool.next;ci.zpp_pool.next=null,ci.zpp_pool=Ln}for(;null!=st.zpp_pool;){var Vn=st.zpp_pool.next;st.zpp_pool.next=null,st.zpp_pool=Vn}for(;null!=vi.zpp_pool;){var Dn=vi.zpp_pool.next;vi.zpp_pool.next=null,vi.zpp_pool=Dn}for(;null!=mi.zpp_pool;){var Fn=mi.zpp_pool.next;mi.zpp_pool.next=null,mi.zpp_pool=Fn}for(;null!=fi.zpp_pool;){var Rn=fi.zpp_pool.next;fi.zpp_pool.next=null,fi.zpp_pool=Rn}for(;null!=Vi.poolGeomPoly;){var Zn=Vi.poolGeomPoly.zpp_pool;Vi.poolGeomPoly.zpp_pool=null,Vi.poolGeomPoly=Zn}for(;null!=Vi.poolVec2;){var Bn=Vi.poolVec2.zpp_pool;Vi.poolVec2.zpp_pool=null,Vi.poolVec2=Bn}for(;null!=Vi.poolVec3;){var Gn=Vi.poolVec3.zpp_pool;Vi.poolVec3.zpp_pool=null,Vi.poolVec3=Gn}},l.prototype.__class__=l,(x=sandbox.Main=function(){}).__name__=["sandbox","Main"],x.main=function(){},x.prototype.__class__=x,(y=zpp_nape.ZPP_Const=function(){}).__name__=["zpp_nape","ZPP_Const"],y.POSINF=function(){return 1/0},y.NEGINF=function(){return-1/0},y.prototype.__class__=y;var fn=zpp_nape.ZPP_ID=function(){};fn.__name__=["zpp_nape","ZPP_ID"],fn.Constraint=function(){return fn._Constraint++},fn.Interactor=function(){return fn._Interactor++},fn.CbType=function(){return fn._CbType++},fn.CbSet=function(){return fn._CbSet++},fn.Listener=function(){return fn._Listener++},fn.ZPP_SimpleVert=function(){return fn._ZPP_SimpleVert++},fn.ZPP_SimpleSeg=function(){return fn._ZPP_SimpleSeg++},fn.Space=function(){return fn._Space++},fn.InteractionGroup=function(){return fn._InteractionGroup++},fn.prototype.__class__=fn;var lt=zpp_nape.callbacks.ZPP_Callback=function(){this.constraint=null,this.body=null,this.pre_swapped=!1,this.pre_arbiter=null,this.wrap_arbiters=null,this.set=null,this.int2=null,this.int1=null,this.length=0,this.prev=null,this.next=null,this.index=0,this.space=null,this.listener=null,this.event=0,this.outer_int=null,this.outer_con=null,this.outer_body=null,this.length=0};lt.__name__=["zpp_nape","callbacks","ZPP_Callback"],lt.prototype.outer_body=null,lt.prototype.outer_con=null,lt.prototype.outer_int=null,lt.prototype.wrapper_body=function(){return null==this.outer_body&&(this.outer_body=new e,this.outer_body.zpp_inner=this),this.outer_body},lt.prototype.wrapper_con=function(){return null==this.outer_con&&(this.outer_con=new r,this.outer_con.zpp_inner=this),this.outer_con},lt.prototype.wrapper_int=function(){return null==this.outer_int&&(this.outer_int=new d,this.outer_int.zpp_inner=this),null==this.wrap_arbiters?this.wrap_arbiters=Ni.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null,this.outer_int},lt.prototype.event=null,lt.prototype.listener=null,lt.prototype.space=null,lt.prototype.index=null,lt.prototype.next=null,lt.prototype.prev=null,lt.prototype.length=null,lt.prototype.push=function(n){null!=this.prev?this.prev.next=n:this.next=n,n.prev=this.prev,n.next=null,this.prev=n,this.length++},lt.prototype.push_rev=function(n){null!=this.next?this.next.prev=n:this.prev=n,n.next=this.next,n.prev=null,this.next=n,this.length++},lt.prototype.pop=function(){var n=this.next;return this.next=n.next,null==this.next?this.prev=null:this.next.prev=null,this.length--,n},lt.prototype.pop_rev=function(){var n=this.prev;return this.prev=n.prev,null==this.prev?this.next=null:this.prev.next=null,this.length--,n},lt.prototype.empty=function(){return null==this.next},lt.prototype.clear=function(){for(;!this.empty();)this.pop()},lt.prototype.splice=function(n){var t=n.next;return null==n.prev?(this.next=n.next,null!=this.next?this.next.prev=null:this.prev=null):(n.prev.next=n.next,null!=n.next?n.next.prev=n.prev:this.prev=n.prev),this.length--,t},lt.prototype.rotateL=function(){this.push(this.pop())},lt.prototype.rotateR=function(){this.push_rev(this.pop_rev())},lt.prototype.cycleNext=function(n){return(null==n.next?this:n).next},lt.prototype.cyclePrev=function(n){return(null==n.prev?this:n).prev},lt.prototype.at=function(n){for(var t=this.next;0!=n--;)t=t.next;return t},lt.prototype.rev_at=function(n){for(var t=this.prev;0!=n--;)t=t.prev;return t},lt.prototype.free=function(){this.int1=this.int2=null,this.body=null,this.constraint=null,(this.listener=null)!=this.wrap_arbiters&&(this.wrap_arbiters.zpp_inner.inner=null),this.set=null},lt.prototype.alloc=function(){},lt.prototype.int1=null,lt.prototype.int2=null,lt.prototype.set=null,lt.prototype.wrap_arbiters=null,lt.prototype.pre_arbiter=null,lt.prototype.pre_swapped=null,lt.prototype.genarbs=function(){null==this.wrap_arbiters?this.wrap_arbiters=Ni.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null},lt.prototype.body=null,lt.prototype.constraint=null,lt.prototype.__class__=lt;var Ki=zpp_nape.callbacks.ZPP_CbSet=function(){this.wrap_constraints=null,this.constraints=null,this.wrap_interactors=null,this.interactors=null,this.zip_conlisteners=!1,this.conlisteners=null,this.zip_bodylisteners=!1,this.bodylisteners=null,this.zip_listeners=!1,this.listeners=null,this.cbpairs=null,this.manager=null,this.id=0,this.next=null,this.count=0,this.cbTypes=null,this.cbTypes=new In,this.listeners=new bn,this.zip_listeners=!0,this.bodylisteners=new gn,this.zip_bodylisteners=!0,this.conlisteners=new wn,this.zip_conlisteners=!0,this.constraints=new kn,this.interactors=new On,this.id=fn.CbSet(),this.cbpairs=new be};Ki.__name__=["zpp_nape","callbacks","ZPP_CbSet"],Ki.setlt=function(n,t){for(var e=n.cbTypes.head,i=t.cbTypes.head;null!=e&&null!=i;){var p=e.elt,l=i.elt;if(p.id<l.id)return!0;if(l.id<p.id)return!1;e=e.next,i=i.next}return null!=i&&null==e},Ki.get=function(n){var t;null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null);for(var e=null,i=n.head;null!=i;){var p=i.elt,e=t.cbTypes.insert(e,p);p.cbsets.add(t),i=i.next}return t},Ki.compatible=function(n,t,e){var i=n.options1,p=t.cbTypes;if(!(!i.nonemptyintersection(p,i.includes)||i.nonemptyintersection(p,i.excludes))&&(l=n.options2,i=e.cbTypes,!!l.nonemptyintersection(i,l.includes)&&!l.nonemptyintersection(i,l.excludes)))return!0;var l=n.options2,t=t.cbTypes;if(!l.nonemptyintersection(t,l.includes)||l.nonemptyintersection(t,l.excludes))return!1;n=n.options1,e=e.cbTypes;return!!n.nonemptyintersection(e,n.includes)&&!n.nonemptyintersection(e,n.excludes)},Ki.empty_intersection=function(n,t){for(var e,i=null,p=(n.cbpairs.length<t.cbpairs.length?n:t).cbpairs.head;null!=p;){var l=p.elt;if(l.a==n&&l.b==t||l.a==t&&l.b==n){i=l;break}p=p.next}return null==i&&(null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.zip_listeners=!0,Ki.setlt(n,t)?(e.a=n,e.b=t):(e.a=t,e.b=n),i=e,n.cbpairs.add(i),t!=n&&t.cbpairs.add(i)),i.zip_listeners&&(i.zip_listeners=!1,i.__validate()),null==i.listeners.head},Ki.single_intersection=function(n,t,e){for(var i=null,p=(n.cbpairs.length<t.cbpairs.length?n:t).cbpairs.head;null!=p;){var l=p.elt;if(l.a==n&&l.b==t||l.a==t&&l.b==n){i=l;break}p=p.next}null==i&&(null==Wi.zpp_pool?r=new Wi:(r=Wi.zpp_pool,Wi.zpp_pool=r.next,r.next=null),r.zip_listeners=!0,Ki.setlt(n,t)?(r.a=n,r.b=t):(r.a=t,r.b=n),i=r,n.cbpairs.add(i),t!=n&&t.cbpairs.add(i)),i.zip_listeners&&(i.zip_listeners=!1,i.__validate());var r=i.listeners.head;return null!=r&&r.elt==e&&null==r.next},Ki.find_all=function(n,t,e,i){for(var p,l=null,r=(n.cbpairs.length<t.cbpairs.length?n:t).cbpairs.head;null!=r;){var o=r.elt;if(o.a==n&&o.b==t||o.a==t&&o.b==n){l=o;break}r=r.next}null==l&&(null==Wi.zpp_pool?p=new Wi:(p=Wi.zpp_pool,Wi.zpp_pool=p.next,p.next=null),p.zip_listeners=!0,Ki.setlt(n,t)?(p.a=n,p.b=t):(p.a=t,p.b=n),l=p,n.cbpairs.add(l),t!=n&&t.cbpairs.add(l)),l.zip_listeners&&(l.zip_listeners=!1,l.__validate());for(var a=l.listeners.head;null!=a;){var s=a.elt;s.event==e&&i(s),a=a.next}},Ki.prototype.cbTypes=null,Ki.prototype.count=null,Ki.prototype.next=null,Ki.prototype.id=null,Ki.prototype.manager=null,Ki.prototype.cbpairs=null,Ki.prototype.increment=function(){this.count++},Ki.prototype.decrement=function(){return 0==--this.count},Ki.prototype.invalidate_pairs=function(){for(var n=this.cbpairs.head;null!=n;)n.elt.zip_listeners=!0,n=n.next},Ki.prototype.listeners=null,Ki.prototype.zip_listeners=null,Ki.prototype.invalidate_listeners=function(){this.zip_listeners=!0,this.invalidate_pairs()},Ki.prototype.validate_listeners=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners())},Ki.prototype.realvalidate_listeners=function(){this.listeners.clear();for(var n=this.cbTypes.head;null!=n;){for(var t=null,e=this.listeners.head,i=n.elt.listeners.head;null!=i;){var p,l,r=i.elt;null!=e&&e.elt==r?(i=i.next,e=(t=e).next):null==e||(p=e.elt,!(r.precedence<=p.precedence)||r.precedence==p.precedence&&r.id>p.id)?(r.space==this.manager.space&&(p=this.listeners,null==ep.zpp_pool?l=new ep:(l=ep.zpp_pool,ep.zpp_pool=l.next,l.next=null),l.elt=r,r=l,null==t?(r.next=p.head,p.head=r):(r.next=t.next,t.next=r),p.pushmod=p.modified=!0,p.length++,t=r),i=i.next):e=(t=e).next}n=n.next}},Ki.prototype.bodylisteners=null,Ki.prototype.zip_bodylisteners=null,Ki.prototype.invalidate_bodylisteners=function(){this.zip_bodylisteners=!0},Ki.prototype.validate_bodylisteners=function(){this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners())},Ki.prototype.realvalidate_bodylisteners=function(){this.bodylisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var t=null,e=this.bodylisteners.head,i=n.elt.bodylisteners.head;null!=i;){var p,l,r=i.elt;null!=e&&e.elt==r?(i=i.next,e=(t=e).next):null==e||(p=e.elt,!(r.precedence<=p.precedence)||r.precedence==p.precedence&&r.id>p.id)?(!(p=r.options).nonemptyintersection(this.cbTypes,p.excludes)&&r.space==this.manager.space&&(p=this.bodylisteners,null==Xe.zpp_pool?l=new Xe:(l=Xe.zpp_pool,Xe.zpp_pool=l.next,l.next=null),l.elt=r,r=l,null==t?(r.next=p.head,p.head=r):(r.next=t.next,t.next=r),p.pushmod=p.modified=!0,p.length++,t=r),i=i.next):e=(t=e).next}n=n.next}},Ki.prototype.conlisteners=null,Ki.prototype.zip_conlisteners=null,Ki.prototype.invalidate_conlisteners=function(){this.zip_conlisteners=!0},Ki.prototype.validate_conlisteners=function(){this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},Ki.prototype.realvalidate_conlisteners=function(){this.conlisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var t=null,e=this.conlisteners.head,i=n.elt.conlisteners.head;null!=i;){var p,l,r=i.elt;null!=e&&e.elt==r?(i=i.next,e=(t=e).next):null==e||(p=e.elt,!(r.precedence<=p.precedence)||r.precedence==p.precedence&&r.id>p.id)?(!(p=r.options).nonemptyintersection(this.cbTypes,p.excludes)&&r.space==this.manager.space&&(p=this.conlisteners,null==$e.zpp_pool?l=new $e:(l=$e.zpp_pool,$e.zpp_pool=l.next,l.next=null),l.elt=r,r=l,null==t?(r.next=p.head,p.head=r):(r.next=t.next,t.next=r),p.pushmod=p.modified=!0,p.length++,t=r),i=i.next):e=(t=e).next}n=n.next}},Ki.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners()),this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners()),this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},Ki.prototype.interactors=null,Ki.prototype.wrap_interactors=null,Ki.prototype.constraints=null,Ki.prototype.wrap_constraints=null,Ki.prototype.addConstraint=function(n){this.constraints.add(n)},Ki.prototype.addInteractor=function(n){this.interactors.add(n)},Ki.prototype.remConstraint=function(n){this.constraints.remove(n)},Ki.prototype.remInteractor=function(n){this.interactors.remove(n)},Ki.prototype.free=function(){for(this.listeners.clear(),this.zip_listeners=!0,this.bodylisteners.clear(),this.zip_bodylisteners=!0,this.conlisteners.clear(),this.zip_conlisteners=!0;null!=this.cbTypes.head;)this.cbTypes.pop_unsafe().cbsets.remove(this)},Ki.prototype.alloc=function(){},Ki.prototype.__class__=Ki;var Wi=zpp_nape.callbacks.ZPP_CbSetPair=function(){this.listeners=null,this.zip_listeners=!1,this.next=null,this.b=null,this.a=null,this.listeners=new bn};Wi.__name__=["zpp_nape","callbacks","ZPP_CbSetPair"],Wi.get=function(n,t){var e;return null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.zip_listeners=!0,Ki.setlt(n,t)?(e.a=n,e.b=t):(e.a=t,e.b=n),e},Wi.setlt=function(n,t){return!!Ki.setlt(n.a,t.a)||n.a==t.a&&Ki.setlt(n.b,t.b)},Wi.prototype.a=null,Wi.prototype.b=null,Wi.prototype.next=null,Wi.prototype.free=function(){this.a=this.b=null,this.listeners.clear()},Wi.prototype.alloc=function(){this.zip_listeners=!0},Wi.prototype.compatible=function(n){var t=n.options1,e=this.a.cbTypes;if(!(!t.nonemptyintersection(e,t.includes)||t.nonemptyintersection(e,t.excludes))&&(p=n.options2,i=this.b.cbTypes,!!p.nonemptyintersection(i,p.includes)&&!p.nonemptyintersection(i,p.excludes)))return!0;var i=n.options2,p=this.a.cbTypes;if(!i.nonemptyintersection(p,i.includes)||i.nonemptyintersection(p,i.excludes))return!1;i=n.options1,n=this.b.cbTypes;return!!i.nonemptyintersection(n,i.includes)&&!i.nonemptyintersection(n,i.excludes)},Wi.prototype.zip_listeners=null,Wi.prototype.listeners=null,Wi.prototype.invalidate=function(){this.zip_listeners=!0},Wi.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.__validate())},Wi.prototype.__validate=function(){this.listeners.clear();for(var n=this.a.listeners.head,t=this.b.listeners.head;null!=n&&null!=t;){var e,i,p,l,r=n.elt,o=t.elt;r==o?(e=r.options1,i=this.a.cbTypes,(!!(!(!e.nonemptyintersection(i,e.includes)||e.nonemptyintersection(i,e.excludes))&&(p=r.options2,l=this.b.cbTypes,!!p.nonemptyintersection(l,p.includes)&&!p.nonemptyintersection(l,p.excludes)))||(l=r.options2,p=this.a.cbTypes,!(!l.nonemptyintersection(p,l.includes)||l.nonemptyintersection(p,l.excludes))&&(p=r.options1,l=this.b.cbTypes,!!p.nonemptyintersection(l,p.includes)&&!p.nonemptyintersection(l,p.excludes))))&&this.listeners.add(r),n=n.next,t=t.next):r.precedence>o.precedence||r.precedence==o.precedence&&r.id>o.id?n=n.next:t=t.next}},Wi.prototype.empty_intersection=function(){return null==this.listeners.head},Wi.prototype.single_intersection=function(n){var t=this.listeners.head;return null!=t&&t.elt==n&&null==t.next},Wi.prototype.forall=function(n,t){for(var e=this.listeners.head;null!=e;){var i=e.elt;i.event==n&&t(i),e=e.next}},Wi.prototype.__class__=Wi;var bn=zpp_nape.util.ZNPList_ZPP_InteractionListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};bn.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionListener"],bn.prototype.head=null,bn.prototype.begin=function(){return this.head},bn.prototype.modified=null,bn.prototype.pushmod=null,bn.prototype.length=null,bn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},bn.prototype.add=function(n){null==ep.zpp_pool?t=new ep:(t=ep.zpp_pool,ep.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},bn.prototype.inlined_add=function(n){null==ep.zpp_pool?t=new ep:(t=ep.zpp_pool,ep.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},bn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},bn.prototype.insert=function(n,t){null==ep.zpp_pool?e=new ep:(e=ep.zpp_pool,ep.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},bn.prototype.inlined_insert=function(n,t){null==ep.zpp_pool?e=new ep:(e=ep.zpp_pool,ep.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},bn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ep.zpp_pool,ep.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},bn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ep.zpp_pool,ep.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},bn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},bn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},bn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ep.zpp_pool,ep.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},bn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},bn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ep.zpp_pool,ep.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},bn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ep.zpp_pool,ep.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},bn.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ep.zpp_pool,ep.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},bn.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ep.zpp_pool,ep.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},bn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},bn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ep.zpp_pool,ep.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},bn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ep.zpp_pool,ep.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},bn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},bn.prototype.empty=function(){return null==this.head},bn.prototype.size=function(){return this.length},bn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},bn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},bn.prototype.front=function(){return this.head.elt},bn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},bn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},bn.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},bn.prototype.__class__=bn;var gn=zpp_nape.util.ZNPList_ZPP_BodyListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};gn.__name__=["zpp_nape","util","ZNPList_ZPP_BodyListener"],gn.prototype.head=null,gn.prototype.begin=function(){return this.head},gn.prototype.modified=null,gn.prototype.pushmod=null,gn.prototype.length=null,gn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},gn.prototype.add=function(n){null==Xe.zpp_pool?t=new Xe:(t=Xe.zpp_pool,Xe.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},gn.prototype.inlined_add=function(n){null==Xe.zpp_pool?t=new Xe:(t=Xe.zpp_pool,Xe.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},gn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},gn.prototype.insert=function(n,t){null==Xe.zpp_pool?e=new Xe:(e=Xe.zpp_pool,Xe.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},gn.prototype.inlined_insert=function(n,t){null==Xe.zpp_pool?e=new Xe:(e=Xe.zpp_pool,Xe.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},gn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Xe.zpp_pool,Xe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},gn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Xe.zpp_pool,Xe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},gn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},gn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},gn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Xe.zpp_pool,Xe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},gn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},gn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Xe.zpp_pool,Xe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},gn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Xe.zpp_pool,Xe.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},gn.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Xe.zpp_pool,Xe.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},gn.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Xe.zpp_pool,Xe.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},gn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},gn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Xe.zpp_pool,Xe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},gn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Xe.zpp_pool,Xe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},gn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},gn.prototype.empty=function(){return null==this.head},gn.prototype.size=function(){return this.length},gn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},gn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},gn.prototype.front=function(){return this.head.elt},gn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},gn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},gn.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},gn.prototype.__class__=gn;var wn=zpp_nape.util.ZNPList_ZPP_ConstraintListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};wn.__name__=["zpp_nape","util","ZNPList_ZPP_ConstraintListener"],wn.prototype.head=null,wn.prototype.begin=function(){return this.head},wn.prototype.modified=null,wn.prototype.pushmod=null,wn.prototype.length=null,wn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},wn.prototype.add=function(n){null==$e.zpp_pool?t=new $e:(t=$e.zpp_pool,$e.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},wn.prototype.inlined_add=function(n){null==$e.zpp_pool?t=new $e:(t=$e.zpp_pool,$e.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},wn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},wn.prototype.insert=function(n,t){null==$e.zpp_pool?e=new $e:(e=$e.zpp_pool,$e.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},wn.prototype.inlined_insert=function(n,t){null==$e.zpp_pool?e=new $e:(e=$e.zpp_pool,$e.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},wn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=$e.zpp_pool,$e.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},wn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=$e.zpp_pool,$e.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},wn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},wn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},wn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=$e.zpp_pool,$e.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},wn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},wn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=$e.zpp_pool,$e.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},wn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=$e.zpp_pool,$e.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},wn.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=$e.zpp_pool,$e.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},wn.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=$e.zpp_pool,$e.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},wn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},wn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=$e.zpp_pool,$e.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},wn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=$e.zpp_pool,$e.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},wn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},wn.prototype.empty=function(){return null==this.head},wn.prototype.size=function(){return this.length},wn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},wn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},wn.prototype.front=function(){return this.head.elt},wn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},wn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},wn.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},wn.prototype.__class__=wn;var kn=zpp_nape.util.ZNPList_ZPP_Constraint=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};kn.__name__=["zpp_nape","util","ZNPList_ZPP_Constraint"],kn.prototype.head=null,kn.prototype.begin=function(){return this.head},kn.prototype.modified=null,kn.prototype.pushmod=null,kn.prototype.length=null,kn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},kn.prototype.add=function(n){null==We.zpp_pool?t=new We:(t=We.zpp_pool,We.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},kn.prototype.inlined_add=function(n){null==We.zpp_pool?t=new We:(t=We.zpp_pool,We.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},kn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},kn.prototype.insert=function(n,t){null==We.zpp_pool?e=new We:(e=We.zpp_pool,We.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},kn.prototype.inlined_insert=function(n,t){null==We.zpp_pool?e=new We:(e=We.zpp_pool,We.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},kn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=We.zpp_pool,We.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},kn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=We.zpp_pool,We.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},kn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},kn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},kn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=We.zpp_pool,We.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},kn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},kn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=We.zpp_pool,We.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},kn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=We.zpp_pool,We.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},kn.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=We.zpp_pool,We.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},kn.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=We.zpp_pool,We.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},kn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},kn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=We.zpp_pool,We.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},kn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=We.zpp_pool,We.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},kn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},kn.prototype.empty=function(){return null==this.head},kn.prototype.size=function(){return this.length},kn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},kn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},kn.prototype.front=function(){return this.head.elt},kn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},kn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},kn.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},kn.prototype.__class__=kn;var On=zpp_nape.util.ZNPList_ZPP_Interactor=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};On.__name__=["zpp_nape","util","ZNPList_ZPP_Interactor"],On.prototype.head=null,On.prototype.begin=function(){return this.head},On.prototype.modified=null,On.prototype.pushmod=null,On.prototype.length=null,On.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},On.prototype.add=function(n){null==ip.zpp_pool?t=new ip:(t=ip.zpp_pool,ip.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},On.prototype.inlined_add=function(n){null==ip.zpp_pool?t=new ip:(t=ip.zpp_pool,ip.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},On.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},On.prototype.insert=function(n,t){null==ip.zpp_pool?e=new ip:(e=ip.zpp_pool,ip.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},On.prototype.inlined_insert=function(n,t){null==ip.zpp_pool?e=new ip:(e=ip.zpp_pool,ip.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},On.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ip.zpp_pool,ip.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},On.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ip.zpp_pool,ip.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},On.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},On.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},On.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ip.zpp_pool,ip.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},On.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},On.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ip.zpp_pool,ip.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},On.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ip.zpp_pool,ip.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},On.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ip.zpp_pool,ip.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},On.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ip.zpp_pool,ip.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},On.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},On.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ip.zpp_pool,ip.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},On.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ip.zpp_pool,ip.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},On.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},On.prototype.empty=function(){return null==this.head},On.prototype.size=function(){return this.length},On.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},On.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},On.prototype.front=function(){return this.head.elt},On.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},On.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},On.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},On.prototype.__class__=On;var Pn=zpp_nape.util.ZNPList_ZPP_CbSet=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Pn.__name__=["zpp_nape","util","ZNPList_ZPP_CbSet"],Pn.prototype.head=null,Pn.prototype.begin=function(){return this.head},Pn.prototype.modified=null,Pn.prototype.pushmod=null,Pn.prototype.length=null,Pn.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Pn.prototype.add=function(n){null==Je.zpp_pool?t=new Je:(t=Je.zpp_pool,Je.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Pn.prototype.inlined_add=function(n){null==Je.zpp_pool?t=new Je:(t=Je.zpp_pool,Je.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Pn.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Pn.prototype.insert=function(n,t){null==Je.zpp_pool?e=new Je:(e=Je.zpp_pool,Je.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Pn.prototype.inlined_insert=function(n,t){null==Je.zpp_pool?e=new Je:(e=Je.zpp_pool,Je.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Pn.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Je.zpp_pool,Je.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pn.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Je.zpp_pool,Je.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pn.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Pn.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Pn.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Je.zpp_pool,Je.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Pn.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Pn.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Je.zpp_pool,Je.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Pn.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Je.zpp_pool,Je.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Pn.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Je.zpp_pool,Je.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Pn.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Je.zpp_pool,Je.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Pn.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Pn.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Je.zpp_pool,Je.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pn.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Je.zpp_pool,Je.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pn.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Pn.prototype.empty=function(){return null==this.head},Pn.prototype.size=function(){return this.length},Pn.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Pn.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Pn.prototype.front=function(){return this.head.elt},Pn.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Pn.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Pn.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Pn.prototype.__class__=Pn;var Sn=zpp_nape.callbacks.ZPP_CbType=function(){this.conlisteners=null,this.bodylisteners=null,this.listeners=null,this.cbsets=null,this.id=0,this.userData=null,this.outer=null,this.id=fn.CbType(),this.listeners=new bn,this.bodylisteners=new gn,this.conlisteners=new wn,this.constraints=new kn,this.interactors=new On,this.cbsets=new Pn};Sn.__name__=["zpp_nape","callbacks","ZPP_CbType"],Sn.setlt=function(n,t){return n.id<t.id},Sn.prototype.outer=null,Sn.prototype.userData=null,Sn.prototype.id=null,Sn.prototype.cbsets=null,Sn.prototype.interactors=null,Sn.prototype.wrap_interactors=null,Sn.prototype.constraints=null,Sn.prototype.wrap_constraints=null,Sn.prototype.addConstraint=function(n){this.constraints.add(n)},Sn.prototype.addInteractor=function(n){this.interactors.add(n)},Sn.prototype.remConstraint=function(n){this.constraints.remove(n)},Sn.prototype.remInteractor=function(n){this.interactors.remove(n)},Sn.prototype.listeners=null,Sn.prototype.addint=function(n){for(var t=null,e=this.listeners.head;null!=e;){var i=e.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=(t=e).next}var p=this.listeners;null==ep.zpp_pool?l=new ep:(l=ep.zpp_pool,ep.zpp_pool=l.next,l.next=null),l.elt=n;var l=l;null==t?(l.next=p.head,p.head=l):(l.next=t.next,t.next=l),p.pushmod=p.modified=!0,p.length++;for(var r=this.cbsets.head;null!=r;){var o=r.elt;o.zip_listeners=!0,o.invalidate_pairs(),r=r.next}},Sn.prototype.removeint=function(n){this.listeners.remove(n);for(var t=this.cbsets.head;null!=t;){var e=t.elt;e.zip_listeners=!0,e.invalidate_pairs(),t=t.next}},Sn.prototype.invalidateint=function(){for(var n=this.cbsets.head;null!=n;){var t=n.elt;t.zip_listeners=!0,t.invalidate_pairs(),n=n.next}},Sn.prototype.bodylisteners=null,Sn.prototype.addbody=function(n){for(var t=null,e=this.bodylisteners.head;null!=e;){var i=e.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=(t=e).next}var p=this.bodylisteners;null==Xe.zpp_pool?l=new Xe:(l=Xe.zpp_pool,Xe.zpp_pool=l.next,l.next=null),l.elt=n;var l=l;null==t?(l.next=p.head,p.head=l):(l.next=t.next,t.next=l),p.pushmod=p.modified=!0,p.length++;for(var r=this.cbsets.head;null!=r;)r.elt.zip_bodylisteners=!0,r=r.next},Sn.prototype.removebody=function(n){this.bodylisteners.remove(n);for(var t=this.cbsets.head;null!=t;)t.elt.zip_bodylisteners=!0,t=t.next},Sn.prototype.invalidatebody=function(){for(var n=this.cbsets.head;null!=n;)n.elt.zip_bodylisteners=!0,n=n.next},Sn.prototype.conlisteners=null,Sn.prototype.addconstraint=function(n){for(var t=null,e=this.conlisteners.head;null!=e;){var i=e.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=(t=e).next}var p=this.conlisteners;null==$e.zpp_pool?l=new $e:(l=$e.zpp_pool,$e.zpp_pool=l.next,l.next=null),l.elt=n;var l=l;null==t?(l.next=p.head,p.head=l):(l.next=t.next,t.next=l),p.pushmod=p.modified=!0,p.length++;for(var r=this.cbsets.head;null!=r;)r.elt.zip_conlisteners=!0,r=r.next},Sn.prototype.removeconstraint=function(n){this.conlisteners.remove(n);for(var t=this.cbsets.head;null!=t;)t.elt.zip_conlisteners=!0,t=t.next},Sn.prototype.invalidateconstraint=function(){for(var n=this.cbsets.head;null!=n;)n.elt.zip_conlisteners=!0,n=n.next},Sn.prototype.__class__=Sn;var Yi=zpp_nape.util.ZPP_Flags=function(){};Yi.__name__=["zpp_nape","util","ZPP_Flags"],Yi.GravMassMode_DEFAULT=null,Yi.GravMassMode_FIXED=null,Yi.GravMassMode_SCALED=null,Yi.InertiaMode_DEFAULT=null,Yi.InertiaMode_FIXED=null,Yi.MassMode_DEFAULT=null,Yi.MassMode_FIXED=null,Yi.BodyType_STATIC=null,Yi.BodyType_DYNAMIC=null,Yi.BodyType_KINEMATIC=null,Yi.ListenerType_BODY=null,Yi.PreFlag_ACCEPT=null,Yi.ListenerType_CONSTRAINT=null,Yi.PreFlag_IGNORE=null,Yi.ListenerType_INTERACTION=null,Yi.PreFlag_ACCEPT_ONCE=null,Yi.ListenerType_PRE=null,Yi.PreFlag_IGNORE_ONCE=null,Yi.CbEvent_BEGIN=null,Yi.InteractionType_COLLISION=null,Yi.CbEvent_ONGOING=null,Yi.InteractionType_SENSOR=null,Yi.CbEvent_END=null,Yi.InteractionType_FLUID=null,Yi.CbEvent_WAKE=null,Yi.InteractionType_ANY=null,Yi.CbEvent_SLEEP=null,Yi.CbEvent_BREAK=null,Yi.CbEvent_PRE=null,Yi.Winding_UNDEFINED=null,Yi.Winding_CLOCKWISE=null,Yi.Winding_ANTICLOCKWISE=null,Yi.ValidationResult_VALID=null,Yi.ValidationResult_DEGENERATE=null,Yi.ValidationResult_CONCAVE=null,Yi.ValidationResult_SELF_INTERSECTING=null,Yi.ShapeType_CIRCLE=null,Yi.ShapeType_POLYGON=null,Yi.Broadphase_DYNAMIC_AABB_TREE=null,Yi.Broadphase_SWEEP_AND_PRUNE=null,Yi.ArbiterType_COLLISION=null,Yi.ArbiterType_SENSOR=null,Yi.ArbiterType_FLUID=null,Yi.prototype.__class__=Yi;var An=zpp_nape.callbacks.ZPP_Listener=function(){this.space=null,this.interaction=null,this.constraint=null,this.body=null,this.precedence=0,this.event=0,this.type=0,this.id=0,this.outer=null,this.id=fn.Listener()};An.__name__=["zpp_nape","callbacks","ZPP_Listener"],An.setlt=function(n,t){return!(n.precedence<=t.precedence)||n.precedence==t.precedence&&n.id>t.id},An.prototype.outer=null,An.prototype.id=null,An.prototype.type=null,An.prototype.event=null,An.prototype.precedence=null,An.prototype.body=null,An.prototype.constraint=null,An.prototype.interaction=null,An.prototype.space=null,An.prototype.swapEvent=function(n){},An.prototype.invalidate_precedence=function(){},An.prototype.addedToSpace=function(){},An.prototype.removedFromSpace=function(){},An.prototype.__class__=An;var jn=zpp_nape.callbacks.ZPP_BodyListener=function(n,t,e){this.handler=null,this.options=null,this.outer_zn=null,An.call(this),this.event=t,this.handler=e,(this.body=this).type=0,this.options=n.zpp_inner};jn.__name__=["zpp_nape","callbacks","ZPP_BodyListener"],jn.__super__=An,jn.prototype=Object.create(An.prototype),jn.prototype.outer_zn=null,jn.prototype.options=null,jn.prototype.handler=null,jn.prototype.addedToSpace=function(){this.options.handler=X(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var t=n.elt,e=null,i=t.bodylisteners.head;null!=i;){var p=i.elt;if(this.precedence>p.precedence||this.precedence==p.precedence&&this.id>p.id)break;i=(e=i).next}var l,r=t.bodylisteners;null==Xe.zpp_pool?l=new Xe:(l=Xe.zpp_pool,Xe.zpp_pool=l.next,l.next=null),l.elt=this;var o=l;null==e?(o.next=r.head,r.head=o):(o.next=e.next,e.next=o),r.pushmod=r.modified=!0,r.length++;for(var a=t.cbsets.head;null!=a;)a.elt.zip_bodylisteners=!0,a=a.next;n=n.next}},jn.prototype.removedFromSpace=function(){for(var n=this.options.includes.head;null!=n;){var t=n.elt;t.bodylisteners.remove(this);for(var e=t.cbsets.head;null!=e;)e.elt.zip_bodylisteners=!0,e=e.next;n=n.next}this.options.handler=null},jn.prototype.cbtype_change=function(n,t,e){this.removedFromSpace();var i=this.options;if(t)if(e){for(var p=null,l=i.includes.head;null!=l&&!(n.id<l.elt.id);)l=(p=l).next;t=i.includes;null==Ge.zpp_pool?r=new Ge:(r=Ge.zpp_pool,Ge.zpp_pool=r.next,r.next=null),r.elt=n;var r=r;null==p?(r.next=t.head,t.head=r):(r.next=p.next,p.next=r),t.pushmod=t.modified=!0,t.length++}else i.includes.remove(n);else if(e){for(var o=null,a=i.excludes.head;null!=a&&!(n.id<a.elt.id);)a=(o=a).next;e=i.excludes;null==Ge.zpp_pool?s=new Ge:(s=Ge.zpp_pool,Ge.zpp_pool=s.next,s.next=null),s.elt=n;var s=s;null==o?(s.next=e.head,e.head=s):(s.next=o.next,o.next=s),e.pushmod=e.modified=!0,e.length++}else i.excludes.remove(n);this.addedToSpace()},jn.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},jn.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},jn.prototype.__class__=jn;var En=zpp_nape.callbacks.ZPP_ConstraintListener=function(n,t,e){this.handler=null,this.options=null,this.outer_zn=null,An.call(this),this.event=t,this.handler=e,(this.constraint=this).type=1,this.options=n.zpp_inner};En.__name__=["zpp_nape","callbacks","ZPP_ConstraintListener"],En.__super__=An,En.prototype=Object.create(An.prototype),En.prototype.outer_zn=null,En.prototype.options=null,En.prototype.handler=null,En.prototype.addedToSpace=function(){this.options.handler=X(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var t=n.elt,e=null,i=t.conlisteners.head;null!=i;){var p=i.elt;if(this.precedence>p.precedence||this.precedence==p.precedence&&this.id>p.id)break;i=(e=i).next}var l,r=t.conlisteners;null==$e.zpp_pool?l=new $e:(l=$e.zpp_pool,$e.zpp_pool=l.next,l.next=null),l.elt=this;var o=l;null==e?(o.next=r.head,r.head=o):(o.next=e.next,e.next=o),r.pushmod=r.modified=!0,r.length++;for(var a=t.cbsets.head;null!=a;)a.elt.zip_conlisteners=!0,a=a.next;n=n.next}},En.prototype.removedFromSpace=function(){for(var n=this.options.includes.head;null!=n;){var t=n.elt;t.conlisteners.remove(this);for(var e=t.cbsets.head;null!=e;)e.elt.zip_conlisteners=!0,e=e.next;n=n.next}this.options.handler=null},En.prototype.cbtype_change=function(n,t,e){this.removedFromSpace();var i=this.options;if(t)if(e){for(var p=null,l=i.includes.head;null!=l&&!(n.id<l.elt.id);)l=(p=l).next;t=i.includes;null==Ge.zpp_pool?r=new Ge:(r=Ge.zpp_pool,Ge.zpp_pool=r.next,r.next=null),r.elt=n;var r=r;null==p?(r.next=t.head,t.head=r):(r.next=p.next,p.next=r),t.pushmod=t.modified=!0,t.length++}else i.includes.remove(n);else if(e){for(var o=null,a=i.excludes.head;null!=a&&!(n.id<a.elt.id);)a=(o=a).next;e=i.excludes;null==Ge.zpp_pool?s=new Ge:(s=Ge.zpp_pool,Ge.zpp_pool=s.next,s.next=null),s.elt=n;var s=s;null==o?(s.next=e.head,e.head=s):(s.next=o.next,o.next=s),e.pushmod=e.modified=!0,e.length++}else i.excludes.remove(n);this.addedToSpace()},En.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},En.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},En.prototype.__class__=En;var In=zpp_nape.util.ZNPList_ZPP_CbType=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};In.__name__=["zpp_nape","util","ZNPList_ZPP_CbType"],In.prototype.head=null,In.prototype.begin=function(){return this.head},In.prototype.modified=null,In.prototype.pushmod=null,In.prototype.length=null,In.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},In.prototype.add=function(n){null==Ge.zpp_pool?t=new Ge:(t=Ge.zpp_pool,Ge.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},In.prototype.inlined_add=function(n){null==Ge.zpp_pool?t=new Ge:(t=Ge.zpp_pool,Ge.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},In.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},In.prototype.insert=function(n,t){null==Ge.zpp_pool?e=new Ge:(e=Ge.zpp_pool,Ge.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},In.prototype.inlined_insert=function(n,t){null==Ge.zpp_pool?e=new Ge:(e=Ge.zpp_pool,Ge.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},In.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},In.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},In.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},In.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},In.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ge.zpp_pool,Ge.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},In.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},In.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ge.zpp_pool,Ge.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},In.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ge.zpp_pool,Ge.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},In.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Ge.zpp_pool,Ge.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},In.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Ge.zpp_pool,Ge.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},In.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},In.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},In.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},In.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},In.prototype.empty=function(){return null==this.head},In.prototype.size=function(){return this.length},In.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},In.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},In.prototype.front=function(){return this.head.elt},In.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},In.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},In.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},In.prototype.__class__=In;var Dt=zpp_nape.callbacks.ZPP_InteractionListener=function(n,t,e,i){this.handlerp=null,this.pure=!1,this.allowSleepingCallbacks=!1,this.handleri=null,this.options2=null,this.options1=null,this.itype=0,this.outer_znp=null,this.outer_zni=null,An.call(this),this.type=i,(this.interaction=this).event=e,this.options1=n.zpp_inner,this.options2=t.zpp_inner,this.allowSleepingCallbacks=!1};Dt.__name__=["zpp_nape","callbacks","ZPP_InteractionListener"],Dt.__super__=An,Dt.prototype=Object.create(An.prototype),Dt.prototype.outer_zni=null,Dt.prototype.outer_znp=null,Dt.prototype.itype=null,Dt.prototype.options1=null,Dt.prototype.options2=null,Dt.prototype.handleri=null,Dt.prototype.allowSleepingCallbacks=null,Dt.prototype.pure=null,Dt.prototype.handlerp=null,Dt.prototype.setInteractionType=function(n){this.itype=n},Dt.prototype.wake=function(){for(var n=this.options1.includes.head,t=this.options2.includes.head;null!=n&&null!=t;){var e=n.elt,i=t.elt;if(e==i){for(var p=e.interactors.head;null!=p;)p.elt.wake(),p=p.next;n=n.next,t=t.next}else if(e.id<i.id){for(var l=e.interactors.head;null!=l;)l.elt.wake(),l=l.next;n=n.next}else{for(var r=i.interactors.head;null!=r;)r.elt.wake(),r=r.next;t=t.next}}for(;null!=n;){for(var o=n.elt.interactors.head;null!=o;)o.elt.wake(),o=o.next;n=n.next}for(;null!=t;){for(var a=t.elt.interactors.head;null!=a;)a.elt.wake(),a=a.next;t=t.next}},Dt.prototype.CbSetset=function(n,t,e){for(var i=Dt.UCbSet,p=Dt.VCbSet,l=Dt.WCbSet,r=n.head,o=t.head;null!=r&&null!=o;){var a,s,_,h,u=r.elt,x=o.elt;u==x?(null==Je.zpp_pool?a=new Je:(a=Je.zpp_pool,Je.zpp_pool=a.next,a.next=null),a.elt=u,(s=a).next=l.head,l.head=s,l.modified=!0,l.length++,r=r.next,o=o.next):Ki.setlt(u,x)?(null==Je.zpp_pool?_=new Je:(_=Je.zpp_pool,Je.zpp_pool=_.next,_.next=null),_.elt=u,(u=_).next=i.head,i.head=u,i.modified=!0,i.length++,r=r.next):(null==Je.zpp_pool?h=new Je:(h=Je.zpp_pool,Je.zpp_pool=h.next,h.next=null),h.elt=x,(x=h).next=p.head,p.head=x,p.modified=!0,p.length++,o=o.next)}for(;null!=r;){var d,y=r.elt;null==Je.zpp_pool?d=new Je:(d=Je.zpp_pool,Je.zpp_pool=d.next,d.next=null),d.elt=y;y=d;y.next=i.head,i.head=y,i.modified=!0,i.length++,r=r.next}for(;null!=o;){var z,c=o.elt;null==Je.zpp_pool?z=new Je:(z=Je.zpp_pool,Je.zpp_pool=z.next,z.next=null),z.elt=c;c=z;c.next=p.head,p.head=c,p.modified=!0,p.length++,o=o.next}for(;null!=i.head;)for(var v=i.pop_unsafe(),m=t.head;null!=m;)e(v,m.elt),m=m.next;for(;null!=p.head;)for(var f=p.pop_unsafe(),b=l.head;null!=b;)e(f,b.elt),b=b.next;for(;null!=l.head;){var g=l.pop_unsafe();e(g,g);for(var w=l.head;null!=w;)e(g,w.elt),w=w.next}},Dt.prototype.CbTypeset=function(n,t,e){for(var i=Dt.UCbType,p=Dt.VCbType,l=Dt.WCbType,r=n.head,o=t.head;null!=r&&null!=o;){var a,s,_,h,u=r.elt,x=o.elt;u==x?(null==Ge.zpp_pool?a=new Ge:(a=Ge.zpp_pool,Ge.zpp_pool=a.next,a.next=null),a.elt=u,(s=a).next=l.head,l.head=s,l.modified=!0,l.length++,r=r.next,o=o.next):u.id<x.id?(null==Ge.zpp_pool?_=new Ge:(_=Ge.zpp_pool,Ge.zpp_pool=_.next,_.next=null),_.elt=u,(u=_).next=i.head,i.head=u,i.modified=!0,i.length++,r=r.next):(null==Ge.zpp_pool?h=new Ge:(h=Ge.zpp_pool,Ge.zpp_pool=h.next,h.next=null),h.elt=x,(x=h).next=p.head,p.head=x,p.modified=!0,p.length++,o=o.next)}for(;null!=r;){var d,y=r.elt;null==Ge.zpp_pool?d=new Ge:(d=Ge.zpp_pool,Ge.zpp_pool=d.next,d.next=null),d.elt=y;y=d;y.next=i.head,i.head=y,i.modified=!0,i.length++,r=r.next}for(;null!=o;){var z,c=o.elt;null==Ge.zpp_pool?z=new Ge:(z=Ge.zpp_pool,Ge.zpp_pool=z.next,z.next=null),z.elt=c;c=z;c.next=p.head,p.head=c,p.modified=!0,p.length++,o=o.next}for(;null!=i.head;)for(var v=i.pop_unsafe(),m=t.head;null!=m;)e(v,m.elt),m=m.next;for(;null!=p.head;)for(var f=p.pop_unsafe(),b=l.head;null!=b;)e(f,b.elt),b=b.next;for(;null!=l.head;){var g=l.pop_unsafe();e(g,g);for(var w=l.head;null!=w;)e(g,w.elt),w=w.next}},Dt.prototype.with_uniquesets=function(n){var t,e=this;null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.lt=Wi.setlt;for(var i=this.options2.includes,p=Dt.UCbType,l=Dt.VCbType,r=Dt.WCbType,o=this.options1.includes.head,a=i.head;null!=o&&null!=a;){var s,_,h,u,x=o.elt,d=a.elt;x==d?(null==Ge.zpp_pool?s=new Ge:(s=Ge.zpp_pool,Ge.zpp_pool=s.next,s.next=null),s.elt=x,(_=s).next=r.head,r.head=_,r.modified=!0,r.length++,o=o.next,a=a.next):x.id<d.id?(null==Ge.zpp_pool?h=new Ge:(h=Ge.zpp_pool,Ge.zpp_pool=h.next,h.next=null),h.elt=x,(x=h).next=p.head,p.head=x,p.modified=!0,p.length++,o=o.next):(null==Ge.zpp_pool?u=new Ge:(u=Ge.zpp_pool,Ge.zpp_pool=u.next,u.next=null),u.elt=d,(d=u).next=l.head,l.head=d,l.modified=!0,l.length++,a=a.next)}for(;null!=o;){var y,z=o.elt;null==Ge.zpp_pool?y=new Ge:(y=Ge.zpp_pool,Ge.zpp_pool=y.next,y.next=null),y.elt=z;z=y;z.next=p.head,p.head=z,p.modified=!0,p.length++,o=o.next}for(;null!=a;){var c,v=a.elt;null==Ge.zpp_pool?c=new Ge:(c=Ge.zpp_pool,Ge.zpp_pool=c.next,c.next=null),c.elt=v;v=c;v.next=l.head,l.head=v,l.modified=!0,l.length++,a=a.next}for(;null!=p.head;)for(var m=p.pop_unsafe(),f=i.head;null!=f;){for(var b=f.elt.cbsets,g=Dt.UCbSet,w=Dt.VCbSet,M=Dt.WCbSet,C=m.cbsets.head,k=b.head;null!=C&&null!=k;){var O,P,S,A,j=C.elt,E=k.elt;j==E?(null==Je.zpp_pool?O=new Je:(O=Je.zpp_pool,Je.zpp_pool=O.next,O.next=null),O.elt=j,(P=O).next=M.head,M.head=P,M.modified=!0,M.length++,C=C.next,k=k.next):Ki.setlt(j,E)?(null==Je.zpp_pool?S=new Je:(S=Je.zpp_pool,Je.zpp_pool=S.next,S.next=null),S.elt=j,(j=S).next=g.head,g.head=j,g.modified=!0,g.length++,C=C.next):(null==Je.zpp_pool?A=new Je:(A=Je.zpp_pool,Je.zpp_pool=A.next,A.next=null),A.elt=E,(E=A).next=w.head,w.head=E,w.modified=!0,w.length++,k=k.next)}for(;null!=C;){var I,T=C.elt;null==Je.zpp_pool?I=new Je:(I=Je.zpp_pool,Je.zpp_pool=I.next,I.next=null),I.elt=T;T=I;T.next=g.head,g.head=T,g.modified=!0,g.length++,C=C.next}for(;null!=k;){var N,L=k.elt;null==Je.zpp_pool?N=new Je:(N=Je.zpp_pool,Je.zpp_pool=N.next,N.next=null),N.elt=L;L=N;L.next=w.head,w.head=L,w.modified=!0,w.length++,k=k.next}for(;null!=g.head;)for(var V=g.pop_unsafe(),D=b.head;null!=D;){var F,R=D.elt;V.validate(),R.validate(),Ki.single_intersection(V,R,e)&&(null==Wi.zpp_pool?F=new Wi:(F=Wi.zpp_pool,Wi.zpp_pool=F.next,F.next=null),F.zip_listeners=!0,Ki.setlt(V,R)?(F.a=V,F.b=R):(F.a=R,F.b=V),t.try_insert(F)),D=D.next}for(;null!=w.head;)for(var Z=w.pop_unsafe(),B=M.head;null!=B;){var G,q=B.elt;Z.validate(),q.validate(),Ki.single_intersection(Z,q,e)&&(null==Wi.zpp_pool?G=new Wi:(G=Wi.zpp_pool,Wi.zpp_pool=G.next,G.next=null),G.zip_listeners=!0,Ki.setlt(Z,q)?(G.a=Z,G.b=q):(G.a=q,G.b=Z),t.try_insert(G)),B=B.next}for(;null!=M.head;){var U,K=M.pop_unsafe();K.validate(),K.validate(),Ki.single_intersection(K,K,e)&&(null==Wi.zpp_pool?U=new Wi:(U=Wi.zpp_pool,Wi.zpp_pool=U.next,U.next=null),U.zip_listeners=!0,Ki.setlt(K,K),U.a=K,U.b=K,t.try_insert(U));for(var W=M.head;null!=W;){var Y,J=W.elt;K.validate(),J.validate(),Ki.single_intersection(K,J,e)&&(null==Wi.zpp_pool?Y=new Wi:(Y=Wi.zpp_pool,Wi.zpp_pool=Y.next,Y.next=null),Y.zip_listeners=!0,Ki.setlt(K,J)?(Y.a=K,Y.b=J):(Y.a=J,Y.b=K),t.try_insert(Y)),W=W.next}}f=f.next}for(;null!=l.head;)for(var X=l.pop_unsafe(),H=r.head;null!=H;){for(var $=H.elt.cbsets,Q=Dt.UCbSet,nn=Dt.VCbSet,tn=Dt.WCbSet,en=X.cbsets.head,pn=$.head;null!=en&&null!=pn;){var ln,rn,on,an,sn=en.elt,_n=pn.elt;sn==_n?(null==Je.zpp_pool?ln=new Je:(ln=Je.zpp_pool,Je.zpp_pool=ln.next,ln.next=null),ln.elt=sn,(rn=ln).next=tn.head,tn.head=rn,tn.modified=!0,tn.length++,en=en.next,pn=pn.next):Ki.setlt(sn,_n)?(null==Je.zpp_pool?on=new Je:(on=Je.zpp_pool,Je.zpp_pool=on.next,on.next=null),on.elt=sn,(sn=on).next=Q.head,Q.head=sn,Q.modified=!0,Q.length++,en=en.next):(null==Je.zpp_pool?an=new Je:(an=Je.zpp_pool,Je.zpp_pool=an.next,an.next=null),an.elt=_n,(_n=an).next=nn.head,nn.head=_n,nn.modified=!0,nn.length++,pn=pn.next)}for(;null!=en;){var hn,un=en.elt;null==Je.zpp_pool?hn=new Je:(hn=Je.zpp_pool,Je.zpp_pool=hn.next,hn.next=null),hn.elt=un;un=hn;un.next=Q.head,Q.head=un,Q.modified=!0,Q.length++,en=en.next}for(;null!=pn;){var xn,dn=pn.elt;null==Je.zpp_pool?xn=new Je:(xn=Je.zpp_pool,Je.zpp_pool=xn.next,xn.next=null),xn.elt=dn;dn=xn;dn.next=nn.head,nn.head=dn,nn.modified=!0,nn.length++,pn=pn.next}for(;null!=Q.head;)for(var yn=Q.pop_unsafe(),zn=$.head;null!=zn;){var cn,vn=zn.elt;yn.validate(),vn.validate(),Ki.single_intersection(yn,vn,e)&&(null==Wi.zpp_pool?cn=new Wi:(cn=Wi.zpp_pool,Wi.zpp_pool=cn.next,cn.next=null),cn.zip_listeners=!0,Ki.setlt(yn,vn)?(cn.a=yn,cn.b=vn):(cn.a=vn,cn.b=yn),t.try_insert(cn)),zn=zn.next}for(;null!=nn.head;)for(var mn=nn.pop_unsafe(),fn=tn.head;null!=fn;){var bn,gn=fn.elt;mn.validate(),gn.validate(),Ki.single_intersection(mn,gn,e)&&(null==Wi.zpp_pool?bn=new Wi:(bn=Wi.zpp_pool,Wi.zpp_pool=bn.next,bn.next=null),bn.zip_listeners=!0,Ki.setlt(mn,gn)?(bn.a=mn,bn.b=gn):(bn.a=gn,bn.b=mn),t.try_insert(bn)),fn=fn.next}for(;null!=tn.head;){var wn,Mn=tn.pop_unsafe();Mn.validate(),Mn.validate(),Ki.single_intersection(Mn,Mn,e)&&(null==Wi.zpp_pool?wn=new Wi:(wn=Wi.zpp_pool,Wi.zpp_pool=wn.next,wn.next=null),wn.zip_listeners=!0,Ki.setlt(Mn,Mn),wn.a=Mn,wn.b=Mn,t.try_insert(wn));for(var Cn=tn.head;null!=Cn;){var kn,On=Cn.elt;Mn.validate(),On.validate(),Ki.single_intersection(Mn,On,e)&&(null==Wi.zpp_pool?kn=new Wi:(kn=Wi.zpp_pool,Wi.zpp_pool=kn.next,kn.next=null),kn.zip_listeners=!0,Ki.setlt(Mn,On)?(kn.a=Mn,kn.b=On):(kn.a=On,kn.b=Mn),t.try_insert(kn)),Cn=Cn.next}}H=H.next}for(;null!=r.head;){for(var Pn=r.pop_unsafe(),Sn=Pn.cbsets,An=Dt.UCbSet,jn=Dt.VCbSet,En=Dt.WCbSet,In=Pn.cbsets.head,Tn=Sn.head;null!=In&&null!=Tn;){var Nn,Ln,Vn,Dn,Fn=In.elt,Rn=Tn.elt;Fn==Rn?(null==Je.zpp_pool?Nn=new Je:(Nn=Je.zpp_pool,Je.zpp_pool=Nn.next,Nn.next=null),Nn.elt=Fn,(Ln=Nn).next=En.head,En.head=Ln,En.modified=!0,En.length++,In=In.next,Tn=Tn.next):Ki.setlt(Fn,Rn)?(null==Je.zpp_pool?Vn=new Je:(Vn=Je.zpp_pool,Je.zpp_pool=Vn.next,Vn.next=null),Vn.elt=Fn,(Fn=Vn).next=An.head,An.head=Fn,An.modified=!0,An.length++,In=In.next):(null==Je.zpp_pool?Dn=new Je:(Dn=Je.zpp_pool,Je.zpp_pool=Dn.next,Dn.next=null),Dn.elt=Rn,(Rn=Dn).next=jn.head,jn.head=Rn,jn.modified=!0,jn.length++,Tn=Tn.next)}for(;null!=In;){var Zn,Bn=In.elt;null==Je.zpp_pool?Zn=new Je:(Zn=Je.zpp_pool,Je.zpp_pool=Zn.next,Zn.next=null),Zn.elt=Bn;Bn=Zn;Bn.next=An.head,An.head=Bn,An.modified=!0,An.length++,In=In.next}for(;null!=Tn;){var Gn,qn=Tn.elt;null==Je.zpp_pool?Gn=new Je:(Gn=Je.zpp_pool,Je.zpp_pool=Gn.next,Gn.next=null),Gn.elt=qn;qn=Gn;qn.next=jn.head,jn.head=qn,jn.modified=!0,jn.length++,Tn=Tn.next}for(;null!=An.head;)for(var Un=An.pop_unsafe(),Kn=Sn.head;null!=Kn;){var Wn,Yn=Kn.elt;Un.validate(),Yn.validate(),Ki.single_intersection(Un,Yn,e)&&(null==Wi.zpp_pool?Wn=new Wi:(Wn=Wi.zpp_pool,Wi.zpp_pool=Wn.next,Wn.next=null),Wn.zip_listeners=!0,Ki.setlt(Un,Yn)?(Wn.a=Un,Wn.b=Yn):(Wn.a=Yn,Wn.b=Un),t.try_insert(Wn)),Kn=Kn.next}for(;null!=jn.head;)for(var Jn=jn.pop_unsafe(),Xn=En.head;null!=Xn;){var Hn,$n=Xn.elt;Jn.validate(),$n.validate(),Ki.single_intersection(Jn,$n,e)&&(null==Wi.zpp_pool?Hn=new Wi:(Hn=Wi.zpp_pool,Wi.zpp_pool=Hn.next,Hn.next=null),Hn.zip_listeners=!0,Ki.setlt(Jn,$n)?(Hn.a=Jn,Hn.b=$n):(Hn.a=$n,Hn.b=Jn),t.try_insert(Hn)),Xn=Xn.next}for(;null!=En.head;){var Qn,nt=En.pop_unsafe();nt.validate(),nt.validate(),Ki.single_intersection(nt,nt,e)&&(null==Wi.zpp_pool?Qn=new Wi:(Qn=Wi.zpp_pool,Wi.zpp_pool=Qn.next,Qn.next=null),Qn.zip_listeners=!0,Ki.setlt(nt,nt),Qn.a=nt,Qn.b=nt,t.try_insert(Qn));for(var tt=En.head;null!=tt;){var et,it=tt.elt;nt.validate(),it.validate(),Ki.single_intersection(nt,it,e)&&(null==Wi.zpp_pool?et=new Wi:(et=Wi.zpp_pool,Wi.zpp_pool=et.next,et.next=null),et.zip_listeners=!0,Ki.setlt(nt,it)?(et.a=nt,et.b=it):(et.a=it,et.b=nt),t.try_insert(et)),tt=tt.next}}for(var pt=r.head;null!=pt;){for(var lt=pt.elt.cbsets,rt=Dt.UCbSet,ot=Dt.VCbSet,at=Dt.WCbSet,st=Pn.cbsets.head,_t=lt.head;null!=st&&null!=_t;){var ht,ut,xt,dt,yt=st.elt,zt=_t.elt;yt==zt?(null==Je.zpp_pool?ht=new Je:(ht=Je.zpp_pool,Je.zpp_pool=ht.next,ht.next=null),ht.elt=yt,(ut=ht).next=at.head,at.head=ut,at.modified=!0,at.length++,st=st.next,_t=_t.next):Ki.setlt(yt,zt)?(null==Je.zpp_pool?xt=new Je:(xt=Je.zpp_pool,Je.zpp_pool=xt.next,xt.next=null),xt.elt=yt,(yt=xt).next=rt.head,rt.head=yt,rt.modified=!0,rt.length++,st=st.next):(null==Je.zpp_pool?dt=new Je:(dt=Je.zpp_pool,Je.zpp_pool=dt.next,dt.next=null),dt.elt=zt,(zt=dt).next=ot.head,ot.head=zt,ot.modified=!0,ot.length++,_t=_t.next)}for(;null!=st;){var ct,vt=st.elt;null==Je.zpp_pool?ct=new Je:(ct=Je.zpp_pool,Je.zpp_pool=ct.next,ct.next=null),ct.elt=vt;vt=ct;vt.next=rt.head,rt.head=vt,rt.modified=!0,rt.length++,st=st.next}for(;null!=_t;){var mt,ft=_t.elt;null==Je.zpp_pool?mt=new Je:(mt=Je.zpp_pool,Je.zpp_pool=mt.next,mt.next=null),mt.elt=ft;ft=mt;ft.next=ot.head,ot.head=ft,ot.modified=!0,ot.length++,_t=_t.next}for(;null!=rt.head;)for(var bt=rt.pop_unsafe(),gt=lt.head;null!=gt;){var wt,Mt=gt.elt;bt.validate(),Mt.validate(),Ki.single_intersection(bt,Mt,e)&&(null==Wi.zpp_pool?wt=new Wi:(wt=Wi.zpp_pool,Wi.zpp_pool=wt.next,wt.next=null),wt.zip_listeners=!0,Ki.setlt(bt,Mt)?(wt.a=bt,wt.b=Mt):(wt.a=Mt,wt.b=bt),t.try_insert(wt)),gt=gt.next}for(;null!=ot.head;)for(var Ct=ot.pop_unsafe(),kt=at.head;null!=kt;){var Ot,Pt=kt.elt;Ct.validate(),Pt.validate(),Ki.single_intersection(Ct,Pt,e)&&(null==Wi.zpp_pool?Ot=new Wi:(Ot=Wi.zpp_pool,Wi.zpp_pool=Ot.next,Ot.next=null),Ot.zip_listeners=!0,Ki.setlt(Ct,Pt)?(Ot.a=Ct,Ot.b=Pt):(Ot.a=Pt,Ot.b=Ct),t.try_insert(Ot)),kt=kt.next}for(;null!=at.head;){var St,At=at.pop_unsafe();At.validate(),At.validate(),Ki.single_intersection(At,At,e)&&(null==Wi.zpp_pool?St=new Wi:(St=Wi.zpp_pool,Wi.zpp_pool=St.next,St.next=null),St.zip_listeners=!0,Ki.setlt(At,At),St.a=At,St.b=At,t.try_insert(St));for(var jt=at.head;null!=jt;){var Et,It=jt.elt;At.validate(),It.validate(),Ki.single_intersection(At,It,e)&&(null==Wi.zpp_pool?Et=new Wi:(Et=Wi.zpp_pool,Wi.zpp_pool=Et.next,Et.next=null),Et.zip_listeners=!0,Ki.setlt(At,It)?(Et.a=At,Et.b=It):(Et.a=It,Et.b=At),t.try_insert(Et)),jt=jt.next}}pt=pt.next}}if(null!=t.parent){for(var Tt,Nt,Lt=t.parent;null!=Lt;)Lt=null!=Lt.prev?Lt.prev:null!=Lt.next?Lt.next:(Nt=Lt.data,n?e.space.freshListenerType(Nt.a,Nt.b):e.space.nullListenerType(Nt.a,Nt.b),Nt.a=Nt.b=null,Nt.listeners.clear(),Nt.next=Wi.zpp_pool,Wi.zpp_pool=Nt,null!=(Tt=Lt.parent)&&(Lt==Tt.prev?Tt.prev=null:Tt.next=null,Lt.parent=null),(Nt=Lt).data=null,Nt.lt=null,Nt.swapped=null,Nt.next=Fi.zpp_pool,Fi.zpp_pool=Nt,Tt);t.parent=null}var Vt=t;Vt.data=null,Vt.lt=null,Vt.swapped=null,Vt.next=Fi.zpp_pool,Fi.zpp_pool=Vt},Dt.prototype.with_union=function(n){for(var t=this.options1.includes.head,e=this.options2.includes.head;null!=t&&null!=e;){var i=t.elt,p=e.elt;i==p?(n(i),t=t.next,e=e.next):i.id<p.id?(n(i),t=t.next):(n(p),e=e.next)}for(;null!=t;)n(t.elt),t=t.next;for(;null!=e;)n(e.elt),e=e.next},Dt.prototype.addedToSpace=function(){for(var n=this,t=3==this.type,e=this.options1.includes.head,i=this.options2.includes.head;null!=e&&null!=i;){var p=e.elt,l=i.elt;if(p==l){for(var r=null,o=p.listeners.head;null!=o;){var a=o.elt;if(n.precedence>a.precedence||n.precedence==a.precedence&&n.id>a.id)break;o=(r=o).next}var s,_=p.listeners;null==ep.zpp_pool?s=new ep:(s=ep.zpp_pool,ep.zpp_pool=s.next,s.next=null),s.elt=n;var h=s;null==r?(h.next=_.head,_.head=h):(h.next=r.next,r.next=h),_.pushmod=_.modified=!0,_.length++;for(var u=p.cbsets.head;null!=u;){var x=u.elt;x.zip_listeners=!0,x.invalidate_pairs(),u=u.next}if(t)for(var d=p.interactors.head;null!=d;)d.elt.wake(),d=d.next;e=e.next,i=i.next}else if(p.id<l.id){for(var y=null,z=p.listeners.head;null!=z;){var c=z.elt;if(n.precedence>c.precedence||n.precedence==c.precedence&&n.id>c.id)break;z=(y=z).next}var v,m=p.listeners;null==ep.zpp_pool?v=new ep:(v=ep.zpp_pool,ep.zpp_pool=v.next,v.next=null),v.elt=n;_=v;null==y?(_.next=m.head,m.head=_):(_.next=y.next,y.next=_),m.pushmod=m.modified=!0,m.length++;for(var f=p.cbsets.head;null!=f;){var b=f.elt;b.zip_listeners=!0,b.invalidate_pairs(),f=f.next}if(t)for(var g=p.interactors.head;null!=g;)g.elt.wake(),g=g.next;e=e.next}else{for(var w=null,M=l.listeners.head;null!=M;){var C=M.elt;if(n.precedence>C.precedence||n.precedence==C.precedence&&n.id>C.id)break;M=(w=M).next}var k,m=l.listeners;null==ep.zpp_pool?k=new ep:(k=ep.zpp_pool,ep.zpp_pool=k.next,k.next=null),k.elt=n;p=k;null==w?(p.next=m.head,m.head=p):(p.next=w.next,w.next=p),m.pushmod=m.modified=!0,m.length++;for(var O=l.cbsets.head;null!=O;){var P=O.elt;P.zip_listeners=!0,P.invalidate_pairs(),O=O.next}if(t)for(var S=l.interactors.head;null!=S;)S.elt.wake(),S=S.next;i=i.next}}for(;null!=e;){for(var A=e.elt,j=null,E=A.listeners.head;null!=E;){var I=E.elt;if(n.precedence>I.precedence||n.precedence==I.precedence&&n.id>I.id)break;E=(j=E).next}var T,N=A.listeners;null==ep.zpp_pool?T=new ep:(T=ep.zpp_pool,ep.zpp_pool=T.next,T.next=null),T.elt=n;var L=T;null==j?(L.next=N.head,N.head=L):(L.next=j.next,j.next=L),N.pushmod=N.modified=!0,N.length++;for(var V=A.cbsets.head;null!=V;){var D=V.elt;D.zip_listeners=!0,D.invalidate_pairs(),V=V.next}if(t)for(var F=A.interactors.head;null!=F;)F.elt.wake(),F=F.next;e=e.next}for(;null!=i;){for(var R=i.elt,Z=null,B=R.listeners.head;null!=B;){var G=B.elt;if(n.precedence>G.precedence||n.precedence==G.precedence&&n.id>G.id)break;B=(Z=B).next}var q,U=R.listeners;null==ep.zpp_pool?q=new ep:(q=ep.zpp_pool,ep.zpp_pool=q.next,q.next=null),q.elt=n;var K=q;null==Z?(K.next=U.head,U.head=K):(K.next=Z.next,Z.next=K),U.pushmod=U.modified=!0,U.length++;for(var W=R.cbsets.head;null!=W;){var Y=W.elt;Y.zip_listeners=!0,Y.invalidate_pairs(),W=W.next}if(t)for(var J=R.interactors.head;null!=J;)J.elt.wake(),J=J.next;i=i.next}this.options1.handler=X(this,this.cbtype_change1),this.options2.handler=X(this,this.cbtype_change2),this.with_uniquesets(!0)},Dt.prototype.removedFromSpace=function(){this.with_uniquesets(!1);for(var n=3==this.type,t=this.options1.includes.head,e=this.options2.includes.head;null!=t&&null!=e;){var i=t.elt,p=e.elt;if(i==p){i.listeners.remove(this);for(var l=i.cbsets.head;null!=l;){var r=l.elt;r.zip_listeners=!0,r.invalidate_pairs(),l=l.next}if(n)for(var o=i.interactors.head;null!=o;)o.elt.wake(),o=o.next;t=t.next,e=e.next}else if(i.id<p.id){i.listeners.remove(this);for(var a=i.cbsets.head;null!=a;){var s=a.elt;s.zip_listeners=!0,s.invalidate_pairs(),a=a.next}if(n)for(var _=i.interactors.head;null!=_;)_.elt.wake(),_=_.next;t=t.next}else{p.listeners.remove(this);for(var h=p.cbsets.head;null!=h;){var u=h.elt;u.zip_listeners=!0,u.invalidate_pairs(),h=h.next}if(n)for(var x=p.interactors.head;null!=x;)x.elt.wake(),x=x.next;e=e.next}}for(;null!=t;){var d=t.elt;d.listeners.remove(this);for(var y=d.cbsets.head;null!=y;){var z=y.elt;z.zip_listeners=!0,z.invalidate_pairs(),y=y.next}if(n)for(var c=d.interactors.head;null!=c;)c.elt.wake(),c=c.next;t=t.next}for(;null!=e;){var v=e.elt;v.listeners.remove(this);for(var m=v.cbsets.head;null!=m;){var f=m.elt;f.zip_listeners=!0,f.invalidate_pairs(),m=m.next}if(n)for(var b=v.interactors.head;null!=b;)b.elt.wake(),b=b.next;e=e.next}this.options1.handler=null,this.options2.handler=null},Dt.prototype.invalidate_precedence=function(){var n=this;if(null!=this.space){for(var t=3==this.type,e=this.options1.includes.head,i=this.options2.includes.head;null!=e&&null!=i;){var p=e.elt,l=i.elt;if(p==l){p.listeners.remove(n);for(var r=p.cbsets.head;null!=r;){var o=r.elt;o.zip_listeners=!0,o.invalidate_pairs(),r=r.next}for(var a=null,s=p.listeners.head;null!=s;){var _=s.elt;if(n.precedence>_.precedence||n.precedence==_.precedence&&n.id>_.id)break;s=(a=s).next}var h,u=p.listeners;null==ep.zpp_pool?h=new ep:(h=ep.zpp_pool,ep.zpp_pool=h.next,h.next=null),h.elt=n;var x=h;null==a?(x.next=u.head,u.head=x):(x.next=a.next,a.next=x),u.pushmod=u.modified=!0,u.length++;for(var d=p.cbsets.head;null!=d;){var y=d.elt;y.zip_listeners=!0,y.invalidate_pairs(),d=d.next}if(t)for(var z=p.interactors.head;null!=z;)z.elt.wake(),z=z.next;e=e.next,i=i.next}else if(p.id<l.id){p.listeners.remove(n);for(var c=p.cbsets.head;null!=c;){var v=c.elt;v.zip_listeners=!0,v.invalidate_pairs(),c=c.next}for(var m=null,f=p.listeners.head;null!=f;){var b=f.elt;if(n.precedence>b.precedence||n.precedence==b.precedence&&n.id>b.id)break;f=(m=f).next}var g,w=p.listeners;null==ep.zpp_pool?g=new ep:(g=ep.zpp_pool,ep.zpp_pool=g.next,g.next=null),g.elt=n;u=g;null==m?(u.next=w.head,w.head=u):(u.next=m.next,m.next=u),w.pushmod=w.modified=!0,w.length++;for(var M=p.cbsets.head;null!=M;){var C=M.elt;C.zip_listeners=!0,C.invalidate_pairs(),M=M.next}if(t)for(var k=p.interactors.head;null!=k;)k.elt.wake(),k=k.next;e=e.next}else{l.listeners.remove(n);for(var O=l.cbsets.head;null!=O;){var P=O.elt;P.zip_listeners=!0,P.invalidate_pairs(),O=O.next}for(var S=null,A=l.listeners.head;null!=A;){var j=A.elt;if(n.precedence>j.precedence||n.precedence==j.precedence&&n.id>j.id)break;A=(S=A).next}var E,w=l.listeners;null==ep.zpp_pool?E=new ep:(E=ep.zpp_pool,ep.zpp_pool=E.next,E.next=null),E.elt=n;p=E;null==S?(p.next=w.head,w.head=p):(p.next=S.next,S.next=p),w.pushmod=w.modified=!0,w.length++;for(var I=l.cbsets.head;null!=I;){var T=I.elt;T.zip_listeners=!0,T.invalidate_pairs(),I=I.next}if(t)for(var N=l.interactors.head;null!=N;)N.elt.wake(),N=N.next;i=i.next}}for(;null!=e;){var L=e.elt;L.listeners.remove(n);for(var V=L.cbsets.head;null!=V;){var D=V.elt;D.zip_listeners=!0,D.invalidate_pairs(),V=V.next}for(var F=null,R=L.listeners.head;null!=R;){var Z=R.elt;if(n.precedence>Z.precedence||n.precedence==Z.precedence&&n.id>Z.id)break;R=(F=R).next}var B,G=L.listeners;null==ep.zpp_pool?B=new ep:(B=ep.zpp_pool,ep.zpp_pool=B.next,B.next=null),B.elt=n;var q=B;null==F?(q.next=G.head,G.head=q):(q.next=F.next,F.next=q),G.pushmod=G.modified=!0,G.length++;for(var U=L.cbsets.head;null!=U;){var K=U.elt;K.zip_listeners=!0,K.invalidate_pairs(),U=U.next}if(t)for(var W=L.interactors.head;null!=W;)W.elt.wake(),W=W.next;e=e.next}for(;null!=i;){var Y=i.elt;Y.listeners.remove(n);for(var J=Y.cbsets.head;null!=J;){var X=J.elt;X.zip_listeners=!0,X.invalidate_pairs(),J=J.next}for(var H=null,$=Y.listeners.head;null!=$;){var Q=$.elt;if(n.precedence>Q.precedence||n.precedence==Q.precedence&&n.id>Q.id)break;$=(H=$).next}var nn,tn=Y.listeners;null==ep.zpp_pool?nn=new ep:(nn=ep.zpp_pool,ep.zpp_pool=nn.next,nn.next=null),nn.elt=n;var en=nn;null==H?(en.next=tn.head,tn.head=en):(en.next=H.next,H.next=en),tn.pushmod=tn.modified=!0,tn.length++;for(var pn=Y.cbsets.head;null!=pn;){var ln=pn.elt;ln.zip_listeners=!0,ln.invalidate_pairs(),pn=pn.next}if(t)for(var rn=Y.interactors.head;null!=rn;)rn.elt.wake(),rn=rn.next;i=i.next}}},Dt.prototype.cbtype_change1=function(n,t,e){this.cbtype_change(this.options1,n,t,e)},Dt.prototype.cbtype_change2=function(n,t,e){this.cbtype_change(this.options2,n,t,e)},Dt.prototype.cbtype_change=function(n,t,e,i){if(this.removedFromSpace(),e)if(i){for(var p=null,l=n.includes.head;null!=l&&!(t.id<l.elt.id);)l=(p=l).next;e=n.includes;null==Ge.zpp_pool?r=new Ge:(r=Ge.zpp_pool,Ge.zpp_pool=r.next,r.next=null),r.elt=t;var r=r;null==p?(r.next=e.head,e.head=r):(r.next=p.next,p.next=r),e.pushmod=e.modified=!0,e.length++}else n.includes.remove(t);else if(i){for(var o=null,a=n.excludes.head;null!=a&&!(t.id<a.elt.id);)a=(o=a).next;i=n.excludes;null==Ge.zpp_pool?s=new Ge:(s=Ge.zpp_pool,Ge.zpp_pool=s.next,s.next=null),s.elt=t;var s=s;null==o?(s.next=i.head,i.head=s):(s.next=o.next,o.next=s),i.pushmod=i.modified=!0,i.length++}else n.excludes.remove(t);this.addedToSpace()},Dt.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},Dt.prototype.__class__=Dt;var Tn=zpp_nape.callbacks.ZPP_OptionType=function(){this.wrap_excludes=null,this.wrap_includes=null,this.excludes=null,this.includes=null,this.handler=null,this.outer=null,this.includes=new In,this.excludes=new In};Tn.__name__=["zpp_nape","callbacks","ZPP_OptionType"],Tn.argument=function(n){return null==n?new m:D.__instanceof(n,m)?n:(new m).including(n)},Tn.prototype.outer=null,Tn.prototype.handler=null,Tn.prototype.includes=null,Tn.prototype.excludes=null,Tn.prototype.wrap_includes=null,Tn.prototype.wrap_excludes=null,Tn.prototype.setup_includes=function(){this.wrap_includes=Oi.get(this.includes,!0)},Tn.prototype.setup_excludes=function(){this.wrap_excludes=Oi.get(this.excludes,!0)},Tn.prototype.excluded=function(n){return this.nonemptyintersection(n,this.excludes)},Tn.prototype.included=function(n){return this.nonemptyintersection(n,this.includes)},Tn.prototype.compatible=function(n){return!!this.nonemptyintersection(n,this.includes)&&!this.nonemptyintersection(n,this.excludes)},Tn.prototype.nonemptyintersection=function(n,t){for(var e=!1,i=n.head,p=t.head;null!=p&&null!=i;){var l=p.elt,r=i.elt;if(l==r){e=!0;break}l.id<r.id?p=p.next:i=i.next}return e},Tn.prototype.effect_change=function(n,t,e){if(t)if(e){for(var i=null,p=this.includes.head;null!=p&&!(n.id<p.elt.id);)p=(i=p).next;t=this.includes;null==Ge.zpp_pool?l=new Ge:(l=Ge.zpp_pool,Ge.zpp_pool=l.next,l.next=null),l.elt=n;var l=l;null==i?(l.next=t.head,t.head=l):(l.next=i.next,i.next=l),t.pushmod=t.modified=!0,t.length++}else this.includes.remove(n);else if(e){for(var r=null,o=this.excludes.head;null!=o&&!(n.id<o.elt.id);)o=(r=o).next;e=this.excludes;null==Ge.zpp_pool?a=new Ge:(a=Ge.zpp_pool,Ge.zpp_pool=a.next,a.next=null),a.elt=n;var a=a;null==r?(a.next=e.head,e.head=a):(a.next=r.next,r.next=a),e.pushmod=e.modified=!0,e.length++}else this.excludes.remove(n)},Tn.prototype.append_type=function(n,t){if(n==this.includes){if(!this.includes.has(t))if(this.excludes.has(t))null!=this.handler?this.handler(t,!1,!1):this.excludes.remove(t);else if(null!=this.handler)this.handler(t,!0,!0);else{for(var e=null,i=this.includes.head;null!=i&&!(t.id<i.elt.id);)i=(e=i).next;var p=this.includes;null==Ge.zpp_pool?l=new Ge:(l=Ge.zpp_pool,Ge.zpp_pool=l.next,l.next=null),l.elt=t;var l=l;null==e?(l.next=p.head,p.head=l):(l.next=e.next,e.next=l),p.pushmod=p.modified=!0,p.length++}}else if(!this.excludes.has(t))if(this.includes.has(t))null!=this.handler?this.handler(t,!0,!1):this.includes.remove(t);else if(null!=this.handler)this.handler(t,!1,!0);else{for(var r=null,o=this.excludes.head;null!=o&&!(t.id<o.elt.id);)o=(r=o).next;p=this.excludes;null==Ge.zpp_pool?a=new Ge:(a=Ge.zpp_pool,Ge.zpp_pool=a.next,a.next=null),a.elt=t;var a=a;null==r?(a.next=p.head,p.head=a):(a.next=r.next,r.next=a),p.pushmod=p.modified=!0,p.length++}},Tn.prototype.set=function(n){if(n!=this){for(;null!=this.includes.head;)this.append_type(this.excludes,this.includes.head.elt);for(;null!=this.excludes.head;)this.append_type(this.includes,this.excludes.head.elt);for(var t=n.excludes.head;null!=t;)this.append_type(this.excludes,t.elt),t=t.next;for(var e=n.includes.head;null!=e;)this.append_type(this.includes,e.elt),e=e.next}return this},Tn.prototype.append=function(n,t){if(D.__instanceof(t,h))this.append_type(n,t.zpp_inner);else if(D.__instanceof(t,u)){var e=t;e.zpp_inner.valmod();for(var i=qn.get(e);;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner;p.zpp_inner.valmod(),p.zpp_inner.zip_length&&(p.zpp_inner.zip_length=!1,p.zpp_inner.user_length=p.zpp_inner.inner.length);p=p.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<p||(i.zpp_next=qn.zpp_pool,(qn.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1,this.append_type(n,i.zpp_inner.at(i.zpp_i++).zpp_inner)}}else if(t instanceof Array&&null==t.__enum__)for(var l=t,r=0;r<l.length;){var o=l[r];++r;this.append_type(n,o.zpp_inner)}},Tn.prototype.__class__=Tn;var Nn=zpp_nape.constraint.ZPP_Constraint=function(){this.pre_dt=0,this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.__velocity=!1,this.ignore=!1,this.component=null,this.removeOnBreak=!1,this.breakUnderError=!1,this.breakUnderForce=!1,this.maxError=0,this.maxForce=0,this.damping=0,this.frequency=0,this.stiff=!1,this.active=!1,this.space=null,this.compound=null,this.userData=null,this.id=0,this.outer=null,this.__velocity=!1,this.id=fn.Constraint(),this.stiff=!0,this.active=!0,this.ignore=!1,this.frequency=10,this.damping=1,this.maxForce=1/0,this.maxError=1/0,this.breakUnderForce=!1,this.removeOnBreak=!0,this.pre_dt=-1,this.cbTypes=new In};Nn.__name__=["zpp_nape","constraint","ZPP_Constraint"],Nn.prototype.outer=null,Nn.prototype.clear=function(){},Nn.prototype.id=null,Nn.prototype.userData=null,Nn.prototype.compound=null,Nn.prototype.space=null,Nn.prototype.active=null,Nn.prototype.stiff=null,Nn.prototype.frequency=null,Nn.prototype.damping=null,Nn.prototype.maxForce=null,Nn.prototype.maxError=null,Nn.prototype.breakUnderForce=null,Nn.prototype.breakUnderError=null,Nn.prototype.removeOnBreak=null,Nn.prototype.component=null,Nn.prototype.ignore=null,Nn.prototype.__velocity=null,Nn.prototype.immutable_midstep=function(n){},Nn.prototype.cbTypes=null,Nn.prototype.cbSet=null,Nn.prototype.wrap_cbTypes=null,Nn.prototype.setupcbTypes=function(){this.wrap_cbTypes=Oi.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=X(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=X(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},Nn.prototype.wrap_cbTypes_subber=function(n){n=n.zpp_inner;this.cbTypes.has(n)&&(null!=this.space&&(this.dealloc_cbSet(),n.constraints.remove(this)),this.cbTypes.remove(n),null!=this.space&&(this.alloc_cbSet(),this.wake()))},Nn.prototype.wrap_cbTypes_adder=function(n){return this.insert_cbtype(n.zpp_inner),!1},Nn.prototype.insert_cbtype=function(n){if(!this.cbTypes.has(n)){null!=this.space&&(this.dealloc_cbSet(),n.constraints.add(this));for(var t=null,e=this.cbTypes.head;null!=e&&!(n.id<e.elt.id);)e=(t=e).next;var i=this.cbTypes;null==Ge.zpp_pool?p=new Ge:(p=Ge.zpp_pool,Ge.zpp_pool=p.next,p.next=null),p.elt=n;var p=p;null==t?(p.next=i.head,i.head=p):(p.next=t.next,t.next=p),i.pushmod=i.modified=!0,i.length++,null!=this.space&&(this.alloc_cbSet(),this.wake())}},Nn.prototype.alloc_cbSet=function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},Nn.prototype.dealloc_cbSet=function(){if(null!=this.cbSet){if(this.cbSet.constraints.remove(this),0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var n=this.cbSet;for(n.listeners.clear(),n.zip_listeners=!0,n.bodylisteners.clear(),n.zip_bodylisteners=!0,n.conlisteners.clear(),n.zip_conlisteners=!0;null!=n.cbTypes.head;)n.cbTypes.pop_unsafe().cbsets.remove(n);n.next=Ki.zpp_pool,Ki.zpp_pool=n}this.cbSet=null}},Nn.prototype.activate=function(){null!=this.space&&this.activeInSpace()},Nn.prototype.deactivate=function(){null!=this.space&&this.inactiveOrOutSpace()},Nn.prototype.addedToSpace=function(){this.active&&this.activeInSpace(),this.activeBodies();for(var n=this.cbTypes.head;null!=n;)n.elt.constraints.add(this),n=n.next},Nn.prototype.removedFromSpace=function(){this.active&&this.inactiveOrOutSpace(),this.inactiveBodies();for(var n=this.cbTypes.head;null!=n;)n.elt.constraints.remove(this),n=n.next},Nn.prototype.activeInSpace=function(){this.alloc_cbSet(),null==te.zpp_pool?this.component=new te:(this.component=te.zpp_pool,te.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!1,this.component.constraint=this},Nn.prototype.inactiveOrOutSpace=function(){this.dealloc_cbSet();var n=this.component;n.body=null,n.constraint=null,n.next=te.zpp_pool,te.zpp_pool=n,this.component=null},Nn.prototype.activeBodies=function(){},Nn.prototype.inactiveBodies=function(){},Nn.prototype.clearcache=function(){},Nn.prototype.validate=function(){},Nn.prototype.wake_connected=function(){},Nn.prototype.forest=function(){},Nn.prototype.pair_exists=function(n,t){return!1},Nn.prototype.broken=function(){},Nn.prototype.warmStart=function(){},Nn.prototype.pre_dt=null,Nn.prototype.preStep=function(n){return!1},Nn.prototype.applyImpulseVel=function(){return!1},Nn.prototype.applyImpulsePos=function(){return!1},Nn.prototype.wake=function(){null!=this.space&&this.space.wake_constraint(this)},Nn.prototype.draw=function(n){},Nn.prototype.copy=function(n,t){return null},Nn.prototype.copyto=function(n){var t=this.outer;null==t.zpp_inner.wrap_cbTypes&&t.zpp_inner.setupcbTypes();var e=t.zpp_inner.wrap_cbTypes;e.zpp_inner.valmod();for(var i=qn.get(e);;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner;p.zpp_inner.valmod(),p.zpp_inner.zip_length&&(p.zpp_inner.zip_length=!1,p.zpp_inner.user_length=p.zpp_inner.inner.length);var l=p.zpp_inner.user_length;if(i.zpp_critical=!0,!(i.zpp_i<l||(i.zpp_next=qn.zpp_pool,(qn.zpp_pool=i).zpp_inner=null,!1)))break;i.zpp_critical=!1;p=i.zpp_inner.at(i.zpp_i++);null==n.zpp_inner.wrap_cbTypes&&n.zpp_inner.setupcbTypes();l=n.zpp_inner.wrap_cbTypes;l.zpp_inner.reverse_flag?l.push(p):l.unshift(p)}n.zpp_inner.removeOnBreak=t.zpp_inner.removeOnBreak;e=t.zpp_inner.breakUnderError;n.zpp_inner.breakUnderError!=e&&(n.zpp_inner.breakUnderError=e,n.zpp_inner.wake());e=t.zpp_inner.breakUnderForce;n.zpp_inner.breakUnderForce!=e&&(n.zpp_inner.breakUnderForce=e,n.zpp_inner.wake());e=t.zpp_inner.maxError;n.zpp_inner.maxError!=e&&(n.zpp_inner.maxError=e,n.zpp_inner.wake());e=t.zpp_inner.maxForce;n.zpp_inner.maxForce!=e&&(n.zpp_inner.maxForce=e,n.zpp_inner.wake());e=t.zpp_inner.damping;n.zpp_inner.damping!=e&&(n.zpp_inner.damping=e,n.zpp_inner.stiff||n.zpp_inner.wake());e=t.zpp_inner.frequency;n.zpp_inner.frequency!=e&&(n.zpp_inner.frequency=e,n.zpp_inner.stiff||n.zpp_inner.wake());e=t.zpp_inner.stiff;n.zpp_inner.stiff!=e&&(n.zpp_inner.stiff=e,n.zpp_inner.wake());e=t.zpp_inner.ignore;n.zpp_inner.ignore!=e&&(n.zpp_inner.ignore=e,n.zpp_inner.wake());t=t.zpp_inner.active;n.zpp_inner.active!=t&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.woken=!1),n.zpp_inner.clearcache(),t?(n.zpp_inner.active=t,n.zpp_inner.activate(),null!=n.zpp_inner.space&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.sleeping=!0),n.zpp_inner.space.wake_constraint(n.zpp_inner,!0))):(null!=n.zpp_inner.space&&(n.zpp_inner.wake(),n.zpp_inner.space.live_constraints.remove(n.zpp_inner)),n.zpp_inner.active=t,n.zpp_inner.deactivate()))},Nn.prototype.__class__=Nn;var Ln=zpp_nape.constraint.ZPP_AngleJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.scale=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=0,this.outer_zn=null,Nn.call(this),this.ratio=1,this.jAcc=0,this.slack=!1,this.jMax=1/0,this.stepped=!1};Ln.__name__=["zpp_nape","constraint","ZPP_AngleJoint"],Ln.__super__=Nn,Ln.prototype=Object.create(Nn.prototype),Ln.prototype.outer_zn=null,Ln.prototype.ratio=null,Ln.prototype.jointMin=null,Ln.prototype.jointMax=null,Ln.prototype.slack=null,Ln.prototype.equal=null,Ln.prototype.scale=null,Ln.prototype.is_slack=function(){var n,t=this.ratio*this.b2.rot-this.b1.rot;return this.equal?(n=!1,this.scale=1):n=t<this.jointMin?!(this.scale=-1):t>this.jointMax?(t-=this.jointMax,!(this.scale=1)):!(t=this.scale=0),n},Ln.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?J.get(0,0,-this.scale*this.jAcc):J.get(0,0,this.ratio*this.scale*this.jAcc):J.get(0,0,0)},Ln.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Ln.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Ln.prototype.b1=null,Ln.prototype.b2=null,Ln.prototype.kMass=null,Ln.prototype.jAcc=null,Ln.prototype.jMax=null,Ln.prototype.gamma=null,Ln.prototype.bias=null,Ln.prototype.stepped=null,Ln.prototype.copy=function(n,t){var e=new g(null,null,this.jointMin,this.jointMax,this.ratio);if(this.copyto(e),null!=n&&null!=this.b1){for(var i=null,p=0;p<n.length;){var l=n[p];if(++p,l.id==this.b1.id){i=l.bc;break}}null!=i?e.zpp_inner_zn.b1=i.zpp_inner:t.push(Vn.todo(this.b1.id,function(n){e.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b2.id){r=a.bc;break}}null!=r?e.zpp_inner_zn.b2=r.zpp_inner:t.push(Vn.todo(this.b2.id,function(n){e.zpp_inner_zn.b2=n.zpp_inner}))}return e},Ln.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: AngleJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new p("Error: AngleJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},Ln.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Ln.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},Ln.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},Ln.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1,this.slack=!1},Ln.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax;var e=this.ratio*this.b2.rot-this.b1.rot;this.equal?(e-=this.jointMax,this.slack=!1,this.scale=1):e<this.jointMin?(e=this.jointMin-e,this.scale=-1,this.slack=!1):e>this.jointMax?(e-=this.jointMax,this.scale=1,this.slack=!1):(e=this.scale=0,this.slack=!0);var i=e;if(!this.slack){if(this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&i*i>this.maxError*this.maxError)return!0;var p=2*Math.PI*this.frequency;this.gamma=1/(n*p*(2*this.damping+p*n));e=1/(1+this.gamma),p=n*p*p*this.gamma;this.gamma*=e,this.kMass*=e,this.bias=-i*p,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=t,this.jMax=this.maxForce*n}return!1},Ln.prototype.warmStart=function(){this.slack||(this.b1.angvel-=this.scale*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*this.jAcc)},Ln.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-this.scale*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel))-this.jAcc*this.gamma,t=this.jAcc;return this.jAcc+=n,!this.equal&&0<this.jAcc&&(this.jAcc=0),!(!this.breakUnderForce||!(this.jAcc>this.jMax||this.jAcc<-this.jMax))||(this.stiff||(this.jAcc>this.jMax?this.jAcc=this.jMax:this.jAcc<-this.jMax&&(this.jAcc=-this.jMax)),n=this.jAcc-t,this.b1.angvel-=this.scale*this.b1.iinertia*n,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*n,!1)},Ln.prototype.applyImpulsePos=function(){var n=this.ratio*this.b2.rot-this.b1.rot;if(this.equal?(n-=this.jointMax,e=!1,this.scale=1):e=n<this.jointMin?(n=this.jointMin-n,!(this.scale=-1)):n>this.jointMax?(n-=this.jointMax,!(this.scale=1)):!(n=this.scale=0),t=n,!e){if(this.breakUnderError&&t*t>this.maxError*this.maxError)return!0;var t,e,i,p,l=-(t*=.5)*this.kMass;(this.equal||l<0)&&(n=this.b1,e=-this.scale*l*this.b1.iinertia,n.rot+=e,1e-4<e*e?(n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)):(i=1-(p=e*e)*p/8,p=((t=1-.5*p)*n.axisx+e*n.axisy)*i,n.axisy=(t*n.axisy-e*n.axisx)*i,n.axisx=p),e=this.b2,i=this.ratio*this.scale*l*this.b2.iinertia,e.rot+=i,1e-4<i*i?(e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)):(p=1-(n=i*i)*n/8,n=((l=1-.5*n)*e.axisx+i*e.axisy)*p,e.axisy=(l*e.axisy-i*e.axisx)*p,e.axisx=n))}return!1},Ln.prototype.draw=function(n){},Ln.prototype.__class__=Ln;var Vn=zpp_nape.constraint.ZPP_CopyHelper=function(){this.cb=null,this.bc=null,this.id=0};Vn.__name__=["zpp_nape","constraint","ZPP_CopyHelper"],Vn.dict=function(n,t){var e=new Vn;return e.id=n,e.bc=t,e},Vn.todo=function(n,t){var e=new Vn;return e.id=n,e.cb=t,e},Vn.prototype.id=null,Vn.prototype.bc=null,Vn.prototype.cb=null,Vn.prototype.__class__=Vn;var Dn=zpp_nape.constraint.ZPP_DistanceJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx2=0,this.cx1=0,this.ny=0,this.nx=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.outer_zn=null,Nn.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=0};Dn.__name__=["zpp_nape","constraint","ZPP_DistanceJoint"],Dn.__super__=Nn,Dn.prototype=Object.create(Nn.prototype),Dn.prototype.outer_zn=null,Dn.prototype.jointMin=null,Dn.prototype.jointMax=null,Dn.prototype.slack=null,Dn.prototype.equal=null,Dn.prototype.is_slack=function(){this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var n,t=0,e=0,i=(t=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx))*t+(e=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely))*e;return i<jp.epsilon||(t*=n=1/(i=Math.sqrt(i)),e*=n,!this.equal&&(!(i<this.jointMin)&&(i>this.jointMax?(i-=this.jointMax,!1):!(i=0))))},Dn.prototype.nx=null,Dn.prototype.ny=null,Dn.prototype.cx1=null,Dn.prototype.cx2=null,Dn.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?J.get(-this.jAcc*this.nx,-this.jAcc*this.ny,-this.cx1*this.jAcc):J.get(this.jAcc*this.nx,this.jAcc*this.ny,this.cx2*this.jAcc):J.get(0,0,0)},Dn.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Dn.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Dn.prototype.b1=null,Dn.prototype.a1localx=null,Dn.prototype.a1localy=null,Dn.prototype.a1relx=null,Dn.prototype.a1rely=null,Dn.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Dn.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},Dn.prototype.setup_a1=function(){var n,t,e=this.a1localx,i=this.a1localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=X(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=X(this,this.invalidate_a1)},Dn.prototype.wrap_a1=null,Dn.prototype.b2=null,Dn.prototype.a2localx=null,Dn.prototype.a2localy=null,Dn.prototype.a2relx=null,Dn.prototype.a2rely=null,Dn.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Dn.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},Dn.prototype.setup_a2=function(){var n,t,e=this.a2localx,i=this.a2localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=X(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=X(this,this.invalidate_a2)},Dn.prototype.wrap_a2=null,Dn.prototype.kMass=null,Dn.prototype.jAcc=null,Dn.prototype.jMax=null,Dn.prototype.gamma=null,Dn.prototype.bias=null,Dn.prototype.stepped=null,Dn.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,e=this.outer_zn;null==e.zpp_inner_zn.wrap_a2&&e.zpp_inner_zn.setup_a2();var p=new M(null,null,i,e.zpp_inner_zn.wrap_a2,this.jointMin,this.jointMax);if(this.copyto(p),null!=n&&null!=this.b1){for(var l=null,r=0;r<n.length;){var o=n[r];if(++r,o.id==this.b1.id){l=o.bc;break}}null!=l?p.zpp_inner_zn.b1=l.zpp_inner:t.push(Vn.todo(this.b1.id,function(n){p.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var a=null,s=0;s<n.length;){var _=n[s];if(++s,_.id==this.b2.id){a=_.bc;break}}null!=a?p.zpp_inner_zn.b2=a.zpp_inner:t.push(Vn.todo(this.b2.id,function(n){p.zpp_inner_zn.b2=n.zpp_inner}))}return p},Dn.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: DistanceJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new p("Error: DistanceJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},Dn.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Dn.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},Dn.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},Dn.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},Dn.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.nx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.ny=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var e=this.nx*this.nx+this.ny*this.ny;e<jp.epsilon?(this.nx=0,e=this.ny=0,this.slack=!0):(p=1/(e=Math.sqrt(e)),this.nx*=p,this.ny*=p,this.equal?(e-=this.jointMax,this.slack=!1):e<this.jointMin?(e=this.jointMin-e,this.nx=-this.nx,this.ny=-this.ny,this.slack=!1):e>this.jointMax?(e-=this.jointMax,this.slack=!1):(this.nx=0,e=this.ny=0,this.slack=!0));var i=e;if(!this.slack){if(this.cx1=this.ny*this.a1relx-this.nx*this.a1rely,this.cx2=this.ny*this.a2relx-this.nx*this.a2rely,this.kMass=this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&i*i>this.maxError*this.maxError)return!0;var p=2*Math.PI*this.frequency;this.gamma=1/(n*p*(2*this.damping+p*n));e=1/(1+this.gamma),p=n*p*p*this.gamma;this.gamma*=e,this.kMass*=e,this.bias=-i*p,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=t,this.jMax=this.maxForce*n}return!1},Dn.prototype.warmStart=function(){var n;this.slack||(n=this.b1.imass*this.jAcc,this.b1.velx-=this.nx*n,this.b1.vely-=this.ny*n,n=this.b2.imass*this.jAcc,this.b2.velx+=this.nx*n,this.b2.vely+=this.ny*n,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc)},Dn.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-(this.nx*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.ny*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1))-this.jAcc*this.gamma,t=this.jAcc;if(this.jAcc+=n,!this.equal&&0<this.jAcc&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),n=this.jAcc-t;t=this.b1.imass*n;this.b1.velx-=this.nx*t,this.b1.vely-=this.ny*t;t=this.b2.imass*n;return this.b2.velx+=this.nx*t,this.b2.vely+=this.ny*t,this.b1.angvel-=this.cx1*this.b1.iinertia*n,this.b2.angvel+=this.cx2*this.b2.iinertia*n,!1},Dn.prototype.applyImpulsePos=function(){var n=0,t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,n=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,e=0,i=0,e=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,p=0,l=0,r=(p=this.b2.posx+e-(this.b1.posx+t))*p+(l=this.b2.posy+i-(this.b1.posy+n))*l,o=r<jp.epsilon?!(r=l=p=0):(p*=a=1/(r=Math.sqrt(r)),l*=a,this.equal?(r-=this.jointMax,!1):r<this.jointMin?(r=this.jointMin-r,p=-p,l=-l,!1):r>this.jointMax?(r-=this.jointMax,!1):!(r=l=p=0)),a=r;if(!o){if(this.breakUnderError&&a*a>this.maxError*this.maxError)return!0;if(a*a<jp.constraintLinearSlop*jp.constraintLinearSlop)return!1;6<(a*=.5)*a&&((r=this.b1.smass+this.b2.smass)>jp.epsilon&&(_=-a*(r=.75/r),(this.equal||_<0)&&(o=_*this.b1.imass,this.b1.posx-=p*o,this.b1.posy-=l*o,r=_*this.b2.imass,this.b2.posx+=p*r,this.b2.posy+=l*r,(o=(p=this.b2.posx+e-(this.b1.posx+t))*p+(l=this.b2.posy+i-(this.b1.posy+n))*l)<jp.epsilon?o=l=p=0:(p*=r=1/(o=Math.sqrt(o)),l*=r,this.equal?o-=this.jointMax:o<this.jointMin?(o=this.jointMin-o,p=-p,l=-l):o>this.jointMax?o-=this.jointMax:o=l=p=0),a=o,a*=.5))),n=l*t-p*n,e=l*e-p*i;var s,_,h,i=this.b1.smass+this.b2.smass+n*n*this.b1.sinertia+e*e*this.b2.sinertia;0!=i&&(i=1/i),_=-a*i,(this.equal||_<0)&&(i=this.b1.imass*_,this.b1.posx-=p*i,this.b1.posy-=l*i,i=this.b2.imass*_,this.b2.posx+=p*i,this.b2.posy+=l*i,l=this.b1,i=-n*this.b1.iinertia*_,l.rot+=i,1e-4<i*i?(l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot)):(s=1-(h=i*i)*h/8,h=((n=1-.5*h)*l.axisx+i*l.axisy)*s,l.axisy=(n*l.axisy-i*l.axisx)*s,l.axisx=h),s=this.b2,l=e*this.b2.iinertia*_,s.rot+=l,1e-4<l*l?(s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)):(e=1-(h=l*l)*h/8,h=((_=1-.5*h)*s.axisx+l*s.axisy)*e,s.axisy=(_*s.axisy-l*s.axisx)*e,s.axisx=h))}return!1},Dn.prototype.draw=function(n){},Dn.prototype.__class__=Dn;var Fn=zpp_nape.constraint.ZPP_LineJoint=function(){this.biasy=0,this.biasx=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_n=null,this.nrely=0,this.nrelx=0,this.nlocaly=0,this.nlocalx=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.cx2=0,this.cx1=0,this.dot2=0,this.dot1=0,this.equal=!1,this.jointMax=0,this.jointMin=0,this.scale=0,this.outer_zn=null,Nn.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.nlocalx=0,this.nlocaly=0,this.nrelx=0,this.nrely=0,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.jointMin=-1/0,this.jointMax=1/0,this.stepped=!1};Fn.__name__=["zpp_nape","constraint","ZPP_LineJoint"],Fn.__super__=Nn,Fn.prototype=Object.create(Nn.prototype),Fn.prototype.outer_zn=null,Fn.prototype.scale=null,Fn.prototype.jointMin=null,Fn.prototype.jointMax=null,Fn.prototype.equal=null,Fn.prototype.dot1=null,Fn.prototype.dot2=null,Fn.prototype.cx1=null,Fn.prototype.cx2=null,Fn.prototype.bodyImpulse=function(n){if(this.stepped){var t=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,e=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy;return n==this.b1?J.get(-t,-e,this.scale*this.cx1*e-this.dot1*t):J.get(t,e,this.scale*this.cx1*e-this.dot1*t)}return J.get(0,0,0)},Fn.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Fn.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Fn.prototype.b1=null,Fn.prototype.a1localx=null,Fn.prototype.a1localy=null,Fn.prototype.a1relx=null,Fn.prototype.a1rely=null,Fn.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Fn.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},Fn.prototype.setup_a1=function(){var n,t,e=this.a1localx,i=this.a1localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=X(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=X(this,this.invalidate_a1)},Fn.prototype.wrap_a1=null,Fn.prototype.b2=null,Fn.prototype.a2localx=null,Fn.prototype.a2localy=null,Fn.prototype.a2relx=null,Fn.prototype.a2rely=null,Fn.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Fn.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},Fn.prototype.setup_a2=function(){var n,t,e=this.a2localx,i=this.a2localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=X(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=X(this,this.invalidate_a2)},Fn.prototype.wrap_a2=null,Fn.prototype.zip_n=null,Fn.prototype.nlocalx=null,Fn.prototype.nlocaly=null,Fn.prototype.nrelx=null,Fn.prototype.nrely=null,Fn.prototype.validate_n=function(){this.wrap_n.zpp_inner.x=this.nlocalx,this.wrap_n.zpp_inner.y=this.nlocaly},Fn.prototype.invalidate_n=function(n){this.immutable_midstep("Constraint::n"),this.nlocalx=n.x,this.nlocaly=n.y,this.zip_n=!0,this.wake()},Fn.prototype.setup_n=function(){var n,t,e=this.nlocalx,i=this.nlocaly;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_n=n,this.wrap_n.zpp_inner._inuse=!0,this.wrap_n.zpp_inner._validate=X(this,this.validate_n),this.wrap_n.zpp_inner._invalidate=X(this,this.invalidate_n)},Fn.prototype.wrap_n=null,Fn.prototype.validate_norm=function(){var n;this.zip_n&&(this.zip_n=!1,n=1/Math.sqrt(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly),this.nlocalx*=n,this.nlocaly*=n)},Fn.prototype.kMassa=null,Fn.prototype.kMassb=null,Fn.prototype.kMassc=null,Fn.prototype.jAccx=null,Fn.prototype.jAccy=null,Fn.prototype.jMax=null,Fn.prototype.gamma=null,Fn.prototype.biasx=null,Fn.prototype.biasy=null,Fn.prototype.stepped=null,Fn.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();e=p.zpp_inner_zn.wrap_a2,p=this.outer_zn;null==p.zpp_inner_zn.wrap_n&&p.zpp_inner_zn.setup_n();var l=new C(null,null,i,e,p.zpp_inner_zn.wrap_n,this.jointMin,this.jointMax);if(this.copyto(l),null!=n&&null!=this.b1){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b1.id){r=a.bc;break}}null!=r?l.zpp_inner_zn.b1=r.zpp_inner:t.push(Vn.todo(this.b1.id,function(n){l.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var s=null,_=0;_<n.length;){var h=n[_];if(++_,h.id==this.b2.id){s=h.bc;break}}null!=s?l.zpp_inner_zn.b2=s.zpp_inner:t.push(Vn.todo(this.b2.id,function(n){l.zpp_inner_zn.b2=n.zpp_inner}))}return l},Fn.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new p("Error: DistanceJoint must have jointMin <= jointMax");if(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly<jp.epsilon)throw new p("Error: DistanceJoint direction must be non-degenerate");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},Fn.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Fn.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},Fn.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},Fn.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},Fn.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.equal=this.jointMin==this.jointMax,this.stepped=!0,this.validate_norm(),this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.nrelx=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,this.nrely=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e=0,i=0,p=this.b2.posx+this.a2relx-this.b1.posx-this.a1relx,l=(e=this.b2.posy+this.a2rely-this.b1.posy-this.a1rely)*this.nrelx-p*this.nrely,i=this.nrelx*p+this.nrely*e;this.equal?(i-=this.jointMin,this.scale=1):i>this.jointMax?(i-=this.jointMax,this.scale=1):i<this.jointMin?(i=this.jointMin-i,this.scale=-1):(i=0,this.scale=0);var r=0,o=0,r=p+this.a1relx,o=e+this.a1rely;this.dot1=this.nrelx*r+this.nrely*o,this.cx1=o*this.nrelx-r*this.nrely,this.dot2=this.nrelx*this.a2relx+this.nrely*this.a2rely,this.cx2=this.a2rely*this.nrelx-this.a2relx*this.nrely,this.kMassa=this.b1.smass+this.b2.smass+this.dot1*this.dot1*this.b1.sinertia+this.dot2*this.dot2*this.b2.sinertia,this.kMassb=-this.scale*(this.dot1*this.cx1*this.b1.sinertia+this.dot2*this.cx2*this.b2.sinertia),this.kMassc=this.scale*this.scale*(this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia);o=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(0!=(1&(a=o!=o?(this.kMassa=this.kMassb=this.kMassc=0,3):0==o?((r=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,r=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,r|=2),this.kMassb=0,r):(o=1/o,a=this.kMassc*o,this.kMassc=this.kMassa*o,this.kMassa=a,this.kMassb*=-o,0)))&&(this.jAccx=0),0!=(2&a)&&(this.jAccy=0),this.stiff)this.gamma=0,this.biasx=0,this.biasy=0;else{if(this.breakUnderError&&l*l+i*i>this.maxError*this.maxError)return!0;o=2*Math.PI*this.frequency;this.gamma=1/(n*o*(2*this.damping+o*n));var a=1/(1+this.gamma),o=n*o*o*this.gamma;this.gamma*=a,this.kMassa*=a,this.kMassb*=a,this.kMassc*=a,this.biasx=l,this.biasy=i;i=-o;this.biasx*=i,this.biasy*=i;o=this.maxError,i=this.biasx*this.biasx+this.biasy*this.biasy;o*o<i&&(i=o*(1/Math.sqrt(i)),this.biasx*=i,this.biasy*=i)}return this.jAccx*=t,this.jAccy*=t,this.jMax=this.maxForce*n,!1},Fn.prototype.warmStart=function(){var n=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,t=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy,e=this.b1.imass;this.b1.velx-=n*e,this.b1.vely-=t*e;e=this.b2.imass;this.b2.velx+=n*e,this.b2.vely+=t*e,this.b1.angvel+=(this.scale*this.cx1*this.jAccy-this.dot1*this.jAccx)*this.b1.iinertia,this.b2.angvel+=(this.dot2*this.jAccx-this.scale*this.cx2*this.jAccy)*this.b2.iinertia},Fn.prototype.applyImpulseVel=function(){var n=0,t=0,n=this.b2.velx-this.b1.velx,t=this.b2.vely-this.b1.vely;n+=this.b2.kinvelx-this.b1.kinvelx,p=(t+=this.b2.kinvely-this.b1.kinvely)*this.nrelx-n*this.nrely+(this.b2.angvel+this.b2.kinangvel)*this.dot2-(this.b1.angvel+this.b1.kinangvel)*this.dot1,l=this.scale*(this.nrelx*n+this.nrely*t-(this.b2.angvel+this.b2.kinangvel)*this.cx2+(this.b1.angvel+this.b1.kinangvel)*this.cx1);var e=this.biasx-p,i=this.biasy-l,n=this.kMassa*e+this.kMassb*i;i=this.kMassb*e+this.kMassc*i,e=n;t=this.gamma;e-=this.jAccx*t,i-=this.jAccy*t;var p=this.jAccx,l=this.jAccy;if(this.jAccx+=e,this.jAccy+=i,0<this.jAccy&&(this.jAccy=0),this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(n=this.jMax)*n<(t=this.jAccx*this.jAccx+this.jAccy*this.jAccy)&&(r=n*(1/Math.sqrt(t)),this.jAccx*=r,this.jAccy*=r);e=this.jAccx-p,i=this.jAccy-l;var r=this.scale*this.nrelx*i-this.nrely*e,p=this.nrelx*e+this.scale*this.nrely*i,l=this.b1.imass;this.b1.velx-=r*l,this.b1.vely-=p*l;l=this.b2.imass;return this.b2.velx+=r*l,this.b2.vely+=p*l,this.b1.angvel+=(this.scale*this.cx1*i-this.dot1*e)*this.b1.iinertia,this.b2.angvel+=(this.dot2*e-this.scale*this.cx2*i)*this.b2.iinertia,!1},Fn.prototype.applyImpulsePos=function(){var n=0,n=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,t=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,e=0,i=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,p=0,p=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,l=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,r=0,o=0,a=0,s=0,r=this.b2.posx+p-this.b1.posx-i,a=(o=this.b2.posy+l-this.b1.posy-e)*n-r*t,s=n*r+t*o,_=this.equal?(s-=this.jointMin,1):s>this.jointMax?(s-=this.jointMax,1):s<this.jointMin?(s=this.jointMin-s,-1):s=0;if(this.breakUnderError&&a*a+s*s>this.maxError*this.maxError)return!0;if(a*a+s*s<jp.constraintLinearSlop*jp.constraintLinearSlop)return!1;var h=0,u=0;6<(a*=.5)*a+(s*=.5)*s&&((x=this.b1.smass+this.b2.smass)>jp.epsilon&&(y=(x=.8/x)*(t*a-_*n*s),z=x*(n*a*_-t*a),d=this.b1.imass,this.b1.posx-=y*d,this.b1.posy-=z*d,c=this.b2.imass,this.b2.posx+=y*c,this.b2.posy+=z*c,r=this.b2.posx+p-this.b1.posx-i,a=(o=this.b2.posy+l-this.b1.posy-e)*n-r*t,s=n*r+t*o,_=this.equal?(s-=this.jointMin,1):s>this.jointMax?(s-=this.jointMax,1):s<this.jointMin?(s=this.jointMin-s,-1):s=0,a*=.5,s*=.5));var x=0,d=0,y=0,z=0,c=0,e=n*(z=r+i)+t*(c=o+e),c=c*n-z*t,z=n*p+t*l,p=l*n-p*t,x=this.b1.smass+this.b2.smass+e*e*this.b1.sinertia+z*z*this.b2.sinertia,d=-_*(e*c*this.b1.sinertia+z*p*this.b2.sinertia);h=-a,u=-s;s=x*(y=_*_*(this.b1.smass+this.b2.smass+c*c*this.b1.sinertia+p*p*this.b2.sinertia))-d*d;s!=s?h=u=0:0==s?(0!=x?h/=x:h=0,0!=y?u/=y:u=0):(v=(s=1/s)*(y*h-d*u),u=s*(x*u-d*h),h=v),0<u&&(u=0);var v=_*n*u-t*h,n=n*h+_*t*u,t=this.b1.imass;this.b1.posx-=v*t,this.b1.posy-=n*t;t=this.b2.imass;this.b2.posx+=v*t,this.b2.posy+=n*t;n=this.b1,t=(_*c*u-e*h)*this.b1.iinertia;n.rot+=t,1e-4<t*t?(n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)):(c=1-(m=t*t)*m/8,m=((e=1-.5*m)*n.axisx+t*n.axisy)*c,n.axisy=(e*n.axisy-t*n.axisx)*c,n.axisx=m);var m=this.b2,h=(z*h-_*p*u)*this.b2.iinertia;return m.rot+=h,1e-4<h*h?(m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)):(p=1-(_=h*h)*_/8,_=((u=1-.5*_)*m.axisx+h*m.axisy)*p,m.axisy=(u*m.axisy-h*m.axisx)*p,m.axisx=_),!1},Fn.prototype.draw=function(n){},Fn.prototype.__class__=Fn;var Rn=zpp_nape.constraint.ZPP_MotorJoint=function(){this.stepped=!1,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.rate=0,this.ratio=0,this.outer_zn=null,Nn.call(this),this.jAcc=0,this.stepped=!1,this.__velocity=!0};Rn.__name__=["zpp_nape","constraint","ZPP_MotorJoint"],Rn.__super__=Nn,Rn.prototype=Object.create(Nn.prototype),Rn.prototype.outer_zn=null,Rn.prototype.ratio=null,Rn.prototype.rate=null,Rn.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?J.get(0,0,-this.jAcc):J.get(0,0,this.ratio*this.jAcc):J.get(0,0,0)},Rn.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Rn.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Rn.prototype.b1=null,Rn.prototype.b2=null,Rn.prototype.kMass=null,Rn.prototype.jAcc=null,Rn.prototype.jMax=null,Rn.prototype.stepped=null,Rn.prototype.copy=function(n,t){var e=new k(null,null,this.rate,this.ratio);if(this.copyto(e),null!=n&&null!=this.b1){for(var i=null,p=0;p<n.length;){var l=n[p];if(++p,l.id==this.b1.id){i=l.bc;break}}null!=i?e.zpp_inner_zn.b1=i.zpp_inner:t.push(Vn.todo(this.b1.id,function(n){e.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b2.id){r=a.bc;break}}null!=r?e.zpp_inner_zn.b2=r.zpp_inner:t.push(Vn.todo(this.b2.id,function(n){e.zpp_inner_zn.b2=n.zpp_inner}))}return e},Rn.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: MotorJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},Rn.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Rn.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},Rn.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},Rn.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},Rn.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;return this.pre_dt=n,this.stepped=!0,this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,this.kMass=1/this.kMass,this.jAcc*=t,this.jMax=this.maxForce*n,!1},Rn.prototype.warmStart=function(){this.b1.angvel-=this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.b2.iinertia*this.jAcc},Rn.prototype.applyImpulseVel=function(){var n=-this.kMass*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel-this.rate),t=this.jAcc;if(this.jAcc+=n,this.breakUnderForce){if(this.jAcc>this.jMax||this.jAcc<-this.jMax)return!0}else this.jAcc<-this.jMax?this.jAcc=-this.jMax:this.jAcc>this.jMax&&(this.jAcc=this.jMax);return n=this.jAcc-t,this.b1.angvel-=this.b1.iinertia*n,this.b2.angvel+=this.ratio*this.b2.iinertia*n,!1},Rn.prototype.applyImpulsePos=function(){return!1},Rn.prototype.__class__=Rn;var Zn=zpp_nape.constraint.ZPP_PivotJoint=function(){this.stepped=!1,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Nn.call(this),this.stepped=!1,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};Zn.__name__=["zpp_nape","constraint","ZPP_PivotJoint"],Zn.__super__=Nn,Zn.prototype=Object.create(Nn.prototype),Zn.prototype.outer_zn=null,Zn.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?J.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely)):J.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely):J.get(0,0,0)},Zn.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Zn.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Zn.prototype.b1=null,Zn.prototype.a1localx=null,Zn.prototype.a1localy=null,Zn.prototype.a1relx=null,Zn.prototype.a1rely=null,Zn.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Zn.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},Zn.prototype.setup_a1=function(){var n,t,e=this.a1localx,i=this.a1localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=X(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=X(this,this.invalidate_a1)},Zn.prototype.wrap_a1=null,Zn.prototype.b2=null,Zn.prototype.a2localx=null,Zn.prototype.a2localy=null,Zn.prototype.a2relx=null,Zn.prototype.a2rely=null,Zn.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Zn.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},Zn.prototype.setup_a2=function(){var n,t,e=this.a2localx,i=this.a2localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=X(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=X(this,this.invalidate_a2)},Zn.prototype.wrap_a2=null,Zn.prototype.kMassa=null,Zn.prototype.kMassb=null,Zn.prototype.kMassc=null,Zn.prototype.jAccx=null,Zn.prototype.jAccy=null,Zn.prototype.jMax=null,Zn.prototype.gamma=null,Zn.prototype.biasx=null,Zn.prototype.biasy=null,Zn.prototype.stepped=null,Zn.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,e=this.outer_zn;null==e.zpp_inner_zn.wrap_a2&&e.zpp_inner_zn.setup_a2();var p=new O(null,null,i,e.zpp_inner_zn.wrap_a2);if(this.copyto(p),null!=n&&null!=this.b1){for(var l=null,r=0;r<n.length;){var o=n[r];if(++r,o.id==this.b1.id){l=o.bc;break}}null!=l?p.zpp_inner_zn.b1=l.zpp_inner:t.push(Vn.todo(this.b1.id,function(n){p.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var a=null,s=0;s<n.length;){var _=n[s];if(++s,_.id==this.b2.id){a=_.bc;break}}null!=a?p.zpp_inner_zn.b2=a.zpp_inner:t.push(Vn.todo(this.b2.id,function(n){p.zpp_inner_zn.b2=n.zpp_inner}))}return p},Zn.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: PivotJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: PivotJoint cannot be simulated with body1 == body2 (body1=body2="+this.b1.outer.toString()+")");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")")},Zn.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Zn.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},Zn.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},Zn.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},Zn.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e,i=this.b1.smass+this.b2.smass;this.kMassa=i,this.kMassb=0,this.kMassc=i,0!=this.b1.sinertia&&(e=this.a1relx*this.b1.sinertia,i=this.a1rely*this.b1.sinertia,this.kMassa+=i*this.a1rely,this.kMassb+=-i*this.a1relx,this.kMassc+=e*this.a1relx),0!=this.b2.sinertia&&(p=this.a2relx*this.b2.sinertia,l=this.a2rely*this.b2.sinertia,this.kMassa+=l*this.a2rely,this.kMassb+=-l*this.a2relx,this.kMassc+=p*this.a2relx);var p,l=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(0!=(1&(r=l!=l?(this.kMassa=this.kMassb=this.kMassc=0,3):0==l?((p=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,p=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,p|=2),this.kMassb=0,p):(l=1/l,r=this.kMassc*l,this.kMassc=this.kMassa*l,this.kMassa=r,this.kMassb*=-l,0)))&&(this.jAccx=0),0!=(2&r)&&(this.jAccy=0),this.stiff)this.biasx=0,this.biasy=0,this.gamma=0;else{var l=2*Math.PI*this.frequency;this.gamma=1/(n*l*(2*this.damping+l*n));var r=1/(1+this.gamma),l=n*l*l*this.gamma;if(this.gamma*=r,this.kMassa*=r,this.kMassb*=r,this.kMassc*=r,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;r=-l;this.biasx*=r,this.biasy*=r;l=this.maxError,r=this.biasx*this.biasx+this.biasy*this.biasy;l*l<r&&(r=l*(1/Math.sqrt(r)),this.biasx*=r,this.biasy*=r)}return this.jAccx*=t,this.jAccy*=t,this.jMax=this.maxForce*n,!1},Zn.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;n=this.b2.imass;this.b2.velx+=this.jAccx*n,this.b2.vely+=this.jAccy*n,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*this.b2.iinertia},Zn.prototype.applyImpulseVel=function(){var n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),t=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),e=this.biasx-n,i=this.biasy-t,p=this.kMassa*e+this.kMassb*i;i=this.kMassb*e+this.kMassc*i,e=p;var l=this.gamma;e-=this.jAccx*l,i-=this.jAccy*l;n=this.jAccx,t=this.jAccy;if(this.jAccx+=e,this.jAccy+=i,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else this.stiff||(p=this.jMax)*p<(l=this.jAccx*this.jAccx+this.jAccy*this.jAccy)&&(l=p*(1/Math.sqrt(l)),this.jAccx*=l,this.jAccy*=l);e=this.jAccx-n,i=this.jAccy-t;t=this.b1.imass;this.b1.velx-=e*t,this.b1.vely-=i*t;t=this.b2.imass;return this.b2.velx+=e*t,this.b2.vely+=i*t,this.b1.angvel-=(i*this.a1relx-e*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(i*this.a2relx-e*this.a2rely)*this.b2.iinertia,!1},Zn.prototype.applyImpulsePos=function(){var n=0,t=0,n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,e=0,i=0,e=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,p=0,l=0,p=this.b2.posx+e-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+t);if(this.breakUnderError&&p*p+l*l>this.maxError*this.maxError)return!0;if(p*p+l*l<jp.constraintLinearSlop*jp.constraintLinearSlop)return!1;var r=0,o=0;6<(p*=.5)*p+(l*=.5)*l&&((_=this.b1.smass+this.b2.smass)>jp.epsilon&&(400<(h=(r=-p*(_=.75/_))*r+(o=-l*_)*o)&&(r*=u=1/Math.sqrt(h)*20,o*=u),x=this.b1.imass,this.b1.posx-=r*x,this.b1.posy-=o*x,a=this.b2.imass,this.b2.posx+=r*a,this.b2.posy+=o*a,p=this.b2.posx+e-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+t),p*=.5,l*=.5));var a,s,_=0,h=0,u=0,x=this.b1.smass+this.b2.smass,u=_=x;(h=0)!=this.b1.sinertia&&(s=n*this.b1.sinertia,_=x+(a=t*this.b1.sinertia)*t,h+=-a*n,u=x+s*n),0!=this.b2.sinertia&&(x=e*this.b2.sinertia,_+=(s=i*this.b2.sinertia)*i,h+=-s*e,u+=x*e);l=(r=-p)*r+(o=-l)*o;36<l&&(r*=d=1/Math.sqrt(l)*6,o*=d);var d=_*u-h*h;d!=d?r=o=0:0==d?(0!=_?r/=_:r=0,0!=u?o/=u:o=0):(y=(d=1/d)*(u*r-h*o),o=d*(_*o-h*r),r=y);h=this.b1.imass;this.b1.posx-=r*h,this.b1.posy-=o*h;var y=this.b2.imass;this.b2.posx+=r*y,this.b2.posy+=o*y;h=this.b1,y=-(o*n-r*t)*this.b1.iinertia;h.rot+=y,1e-4<y*y?(h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot)):(n=1-(z=y*y)*z/8,z=((t=1-.5*z)*h.axisx+y*h.axisy)*n,h.axisy=(t*h.axisy-y*h.axisx)*n,h.axisx=z);var z=this.b2,o=(o*e-r*i)*this.b2.iinertia;return z.rot+=o,1e-4<o*o?(z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)):(r=1-(e=o*o)*e/8,e=((i=1-.5*e)*z.axisx+o*z.axisy)*r,z.axisy=(i*z.axisy-o*z.axisx)*r,z.axisx=e),!1},Zn.prototype.draw=function(n){},Zn.prototype.__class__=Zn;var Bn=zpp_nape.constraint.ZPP_PulleyJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a4=null,this.a4rely=0,this.a4relx=0,this.a4localy=0,this.a4localx=0,this.b4=null,this.wrap_a3=null,this.a3rely=0,this.a3relx=0,this.a3localy=0,this.a3localx=0,this.b3=null,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx4=0,this.cx3=0,this.cx2=0,this.cx1=0,this.n34y=0,this.n34x=0,this.n12y=0,this.n12x=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=1,this.outer_zn=null,Nn.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.a3localx=0,this.a3localy=0,this.a3relx=0,this.a3rely=0,this.a4localx=0,this.a4localy=0,this.a4relx=0,this.a4rely=0,this.n12x=1,this.n12y=0,this.n34x=1,this.n34y=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=this.cx3=this.cx4=0};Bn.__name__=["zpp_nape","constraint","ZPP_PulleyJoint"],Bn.__super__=Nn,Bn.prototype=Object.create(Nn.prototype),Bn.prototype.outer_zn=null,Bn.prototype.ratio=null,Bn.prototype.jointMin=null,Bn.prototype.jointMax=null,Bn.prototype.slack=null,Bn.prototype.equal=null,Bn.prototype.is_slack=function(){this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var n=0,t=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),e=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),i=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),n=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely),e=Math.sqrt(t*t+e*e),n=Math.sqrt(i*i+n*n);0==n&&Math.sqrt(0);n=e+this.ratio*n;return!this.equal&&(!(n<this.jointMin)&&(n>this.jointMax?(n-=this.jointMax,!1):!(n=0)))},Bn.prototype.n12x=null,Bn.prototype.n12y=null,Bn.prototype.n34x=null,Bn.prototype.n34y=null,Bn.prototype.cx1=null,Bn.prototype.cx2=null,Bn.prototype.cx3=null,Bn.prototype.cx4=null,Bn.prototype.bodyImpulse=function(n){if(this.stepped){var t,e,i=J.get();return n==this.b1&&(null!=(t=i.zpp_inner)._validate&&t._validate(),i.zpp_inner.x=i.zpp_inner.x-this.jAcc*this.n12x,null!=(t=i.zpp_inner)._validate&&t._validate(),null!=(t=i.zpp_inner)._validate&&t._validate(),i.zpp_inner.y=i.zpp_inner.y-this.jAcc*this.n12y,null!=(t=i.zpp_inner)._validate&&t._validate(),null!=(t=i.zpp_inner)._validate&&t._validate(),i.zpp_inner.z=i.zpp_inner.z-this.cx1*this.jAcc,null!=(t=i.zpp_inner)._validate&&t._validate()),n==this.b2&&(null!=(e=i.zpp_inner)._validate&&e._validate(),i.zpp_inner.x=i.zpp_inner.x+this.jAcc*this.n12x,null!=(e=i.zpp_inner)._validate&&e._validate(),null!=(e=i.zpp_inner)._validate&&e._validate(),i.zpp_inner.y=i.zpp_inner.y+this.jAcc*this.n12y,null!=(e=i.zpp_inner)._validate&&e._validate(),null!=(e=i.zpp_inner)._validate&&e._validate(),i.zpp_inner.z=i.zpp_inner.z+this.cx2*this.jAcc,null!=(e=i.zpp_inner)._validate&&e._validate()),n==this.b3&&(null!=(e=i.zpp_inner)._validate&&e._validate(),i.zpp_inner.x=i.zpp_inner.x-this.jAcc*this.n34x,null!=(e=i.zpp_inner)._validate&&e._validate(),null!=(e=i.zpp_inner)._validate&&e._validate(),i.zpp_inner.y=i.zpp_inner.y-this.jAcc*this.n34y,null!=(e=i.zpp_inner)._validate&&e._validate(),null!=(e=i.zpp_inner)._validate&&e._validate(),i.zpp_inner.z=i.zpp_inner.z-this.cx3*this.jAcc,null!=(e=i.zpp_inner)._validate&&e._validate()),n==this.b4&&(null!=(n=i.zpp_inner)._validate&&n._validate(),i.zpp_inner.x=i.zpp_inner.x+this.jAcc*this.n34x,null!=(n=i.zpp_inner)._validate&&n._validate(),null!=(n=i.zpp_inner)._validate&&n._validate(),i.zpp_inner.y=i.zpp_inner.y+this.jAcc*this.n34y,null!=(n=i.zpp_inner)._validate&&n._validate(),null!=(n=i.zpp_inner)._validate&&n._validate(),i.zpp_inner.z=i.zpp_inner.z+this.cx4*this.jAcc,null!=(n=i.zpp_inner)._validate&&n._validate()),i}return J.get(0,0,0)},Bn.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.add(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.add(this)},Bn.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.remove(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.remove(this)},Bn.prototype.b1=null,Bn.prototype.a1localx=null,Bn.prototype.a1localy=null,Bn.prototype.a1relx=null,Bn.prototype.a1rely=null,Bn.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Bn.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},Bn.prototype.setup_a1=function(){var n,t,e=this.a1localx,i=this.a1localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=X(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=X(this,this.invalidate_a1)},Bn.prototype.wrap_a1=null,Bn.prototype.b2=null,Bn.prototype.a2localx=null,Bn.prototype.a2localy=null,Bn.prototype.a2relx=null,Bn.prototype.a2rely=null,Bn.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Bn.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},Bn.prototype.setup_a2=function(){var n,t,e=this.a2localx,i=this.a2localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=X(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=X(this,this.invalidate_a2)},Bn.prototype.wrap_a2=null,Bn.prototype.b3=null,Bn.prototype.a3localx=null,Bn.prototype.a3localy=null,Bn.prototype.a3relx=null,Bn.prototype.a3rely=null,Bn.prototype.validate_a3=function(){this.wrap_a3.zpp_inner.x=this.a3localx,this.wrap_a3.zpp_inner.y=this.a3localy},Bn.prototype.invalidate_a3=function(n){this.immutable_midstep("Constraint::a3"),this.a3localx=n.x,this.a3localy=n.y,this.wake()},Bn.prototype.setup_a3=function(){var n,t,e=this.a3localx,i=this.a3localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a3=n,this.wrap_a3.zpp_inner._inuse=!0,this.wrap_a3.zpp_inner._validate=X(this,this.validate_a3),this.wrap_a3.zpp_inner._invalidate=X(this,this.invalidate_a3)},Bn.prototype.wrap_a3=null,Bn.prototype.b4=null,Bn.prototype.a4localx=null,Bn.prototype.a4localy=null,Bn.prototype.a4relx=null,Bn.prototype.a4rely=null,Bn.prototype.validate_a4=function(){this.wrap_a4.zpp_inner.x=this.a4localx,this.wrap_a4.zpp_inner.y=this.a4localy},Bn.prototype.invalidate_a4=function(n){this.immutable_midstep("Constraint::a4"),this.a4localx=n.x,this.a4localy=n.y,this.wake()},Bn.prototype.setup_a4=function(){var n,t,e=this.a4localx,i=this.a4localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a4=n,this.wrap_a4.zpp_inner._inuse=!0,this.wrap_a4.zpp_inner._validate=X(this,this.validate_a4),this.wrap_a4.zpp_inner._invalidate=X(this,this.invalidate_a4)},Bn.prototype.wrap_a4=null,Bn.prototype.kMass=null,Bn.prototype.jAcc=null,Bn.prototype.jMax=null,Bn.prototype.gamma=null,Bn.prototype.bias=null,Bn.prototype.stepped=null,Bn.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=p.zpp_inner_zn.wrap_a2,e=this.outer_zn;null==e.zpp_inner_zn.wrap_a3&&e.zpp_inner_zn.setup_a3();p=e.zpp_inner_zn.wrap_a3,e=this.outer_zn;null==e.zpp_inner_zn.wrap_a4&&e.zpp_inner_zn.setup_a4();var r=new P(null,null,null,null,i,l,p,e.zpp_inner_zn.wrap_a4,this.jointMin,this.jointMax,this.ratio);if(this.copyto(r),null!=n&&null!=this.b1){for(var o=null,a=0;a<n.length;){var s=n[a];if(++a,s.id==this.b1.id){o=s.bc;break}}null!=o?r.zpp_inner_zn.b1=o.zpp_inner:t.push(Vn.todo(this.b1.id,function(n){r.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var _=null,h=0;h<n.length;){var u=n[h];if(++h,u.id==this.b2.id){_=u.bc;break}}null!=_?r.zpp_inner_zn.b2=_.zpp_inner:t.push(Vn.todo(this.b2.id,function(n){r.zpp_inner_zn.b2=n.zpp_inner}))}if(null!=n&&null!=this.b3){for(var x=null,d=0;d<n.length;){var y=n[d];if(++d,y.id==this.b3.id){x=y.bc;break}}null!=x?r.zpp_inner_zn.b3=x.zpp_inner:t.push(Vn.todo(this.b3.id,function(n){r.zpp_inner_zn.b3=n.zpp_inner}))}if(null!=n&&null!=this.b4){for(var z=null,c=0;c<n.length;){var v=n[c];if(++c,v.id==this.b4.id){z=v.bc;break}}null!=z?r.zpp_inner_zn.b4=z.zpp_inner:t.push(Vn.todo(this.b4.id,function(n){r.zpp_inner_zn.b4=n.zpp_inner}))}return r},Bn.prototype.validate=function(){if(null==this.b1||null==this.b2||null==this.b3||null==this.b4)throw new p("Error: PulleyJoint cannot be simulated with null bodies");if(this.b1==this.b2||this.b3==this.b4)throw new p("Error: PulleyJoint cannot have body1==body2 or body3==body4");if(this.b1.space!=this.space||this.b2.space!=this.space||this.b3.space!=this.space||this.b4.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new p("Error: PulleyJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic");if(2!=this.b3.type&&2!=this.b4.type)throw new p("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic")},Bn.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake(),null!=this.b3&&2==this.b3.type&&this.b3.wake(),null!=this.b4&&2==this.b4.type&&this.b4.wake()},Bn.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}if(2==this.b3.type){var f,b;if(this.b3.component==this.b3.component.parent)f=this.b3.component;else{for(var g=this.b3.component,w=null;g!=g.parent;){var M=g.parent;g.parent=w,w=g,g=M}for(;null!=w;){var C=w.parent;w.parent=g,w=C}f=g}if(this.component==this.component.parent)b=this.component;else{for(var k=this.component,O=null;k!=k.parent;){var P=k.parent;k.parent=O,O=k,k=P}for(;null!=O;){var S=O.parent;O.parent=k,O=S}b=k}f!=b&&(f.rank<b.rank?f.parent=b:f.rank>b.rank?b.parent=f:(b.parent=f).rank++)}if(2==this.b4.type){var A,j;if(this.b4.component==this.b4.component.parent)A=this.b4.component;else{for(var E=this.b4.component,I=null;E!=E.parent;){var T=E.parent;E.parent=I,I=E,E=T}for(;null!=I;){var N=I.parent;I.parent=E,I=N}A=E}if(this.component==this.component.parent)j=this.component;else{for(var L=this.component,V=null;L!=L.parent;){var D=L.parent;L.parent=V,V=L,L=D}for(;null!=V;){var F=V.parent;V.parent=L,V=F}j=L}A!=j&&(A.rank<j.rank?A.parent=j:A.rank>j.rank?j.parent=A:(j.parent=A).rank++)}},Bn.prototype.pair_exists=function(n,t){return this.b1.id==n&&(this.b2.id==t||this.b3.id==t||this.b4.id==t)||this.b2.id==n&&(this.b3.id==t||this.b4.id==t||this.b1.id==t)||this.b3.id==n&&(this.b4.id==t||this.b1.id==t||this.b2.id==t)||this.b4.id==n&&(this.b1.id==t||this.b2.id==t||this.b3.id==t)},Bn.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},Bn.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var e,i=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),p=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),l=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),r=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely),o=Math.sqrt(i*i+p*p),a=Math.sqrt(l*l+r*r);0!=o&&(e=1/o,this.n12x=i*e,this.n12y=p*e),0!=a?(e=1/a,this.n34x=l*e,this.n34y=r*e,e=this.ratio,this.n34x*=e,this.n34y*=e):(s=this.ratio/Math.sqrt(this.n34x*this.n34x+this.n34y*this.n34y),this.n34x*=s,this.n34y*=s);var s=o+this.ratio*a;this.equal?(s-=this.jointMax,this.slack=!1):s<this.jointMin?(s=this.jointMin-s,this.n12x=-this.n12x,this.n12y=-this.n12y,this.n34x=-this.n34x,this.n34y=-this.n34y,this.slack=!1):s>this.jointMax?(s-=this.jointMax,this.slack=!1):(this.n12x=0,this.n12y=0,this.n34x=0,s=this.n34y=0,this.slack=!0);o=s;if(!this.slack){this.cx1=this.n12y*this.a1relx-this.n12x*this.a1rely,this.cx2=this.n12y*this.a2relx-this.n12x*this.a2rely,this.cx3=this.n34y*this.a3relx-this.n34x*this.a3rely,this.cx4=this.n34y*this.a4relx-this.n34x*this.a4rely;a=this.b1.smass+this.b2.smass+this.ratio*this.ratio*(this.b3.smass+this.b4.smass)+this.b1.sinertia*this.cx1*this.cx1+this.b2.sinertia*this.cx2*this.cx2+this.b3.sinertia*this.cx3*this.cx3+this.b4.sinertia*this.cx4*this.cx4;if(this.b1==this.b4&&(a-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx4*this.b1.sinertia)),this.b1==this.b3&&(a+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx3*this.b1.sinertia)),this.b2==this.b3&&(a-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx3*this.b2.sinertia)),this.b2==this.b4&&(a+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx4*this.b2.sinertia)),this.kMass=a,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&o*o>this.maxError*this.maxError)return!0;var s=2*Math.PI*this.frequency;this.gamma=1/(n*s*(2*this.damping+s*n));a=1/(1+this.gamma),s=n*s*s*this.gamma;this.gamma*=a,this.kMass*=a,this.bias=-o*s,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=t,this.jMax=this.maxForce*n}return!1},Bn.prototype.warmStart=function(){var n;this.slack||(n=this.b1.imass*this.jAcc,this.b1.velx-=this.n12x*n,this.b1.vely-=this.n12y*n,n=this.b2.imass*this.jAcc,this.b2.velx+=this.n12x*n,this.b2.vely+=this.n12y*n,n=this.b3.imass*this.jAcc,this.b3.velx-=this.n34x*n,this.b3.vely-=this.n34y*n,n=this.b4.imass*this.jAcc,this.b4.velx+=this.n34x*n,this.b4.vely+=this.n34y*n,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc,this.b3.angvel-=this.cx3*this.b3.iinertia*this.jAcc,this.b4.angvel+=this.cx4*this.b4.iinertia*this.jAcc)},Bn.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-(this.n12x*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.n12y*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+this.n34x*(this.b4.velx+this.b4.kinvelx-this.b3.velx-this.b3.kinvelx)+this.n34y*(this.b4.vely+this.b4.kinvely-this.b3.vely-this.b3.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1+(this.b4.angvel+this.b4.kinangvel)*this.cx4-(this.b3.angvel+this.b3.kinangvel)*this.cx3))-this.jAcc*this.gamma,t=this.jAcc;if(this.jAcc+=n,!this.equal&&0<this.jAcc&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),n=this.jAcc-t;t=this.b1.imass*n;this.b1.velx-=this.n12x*t,this.b1.vely-=this.n12y*t;t=this.b2.imass*n;this.b2.velx+=this.n12x*t,this.b2.vely+=this.n12y*t;t=this.b3.imass*n;this.b3.velx-=this.n34x*t,this.b3.vely-=this.n34y*t;t=this.b4.imass*n;return this.b4.velx+=this.n34x*t,this.b4.vely+=this.n34y*t,this.b1.angvel-=this.cx1*this.b1.iinertia*n,this.b2.angvel+=this.cx2*this.b2.iinertia*n,this.b3.angvel-=this.cx3*this.b3.iinertia*n,this.b4.angvel+=this.cx4*this.b4.iinertia*n,!1},Bn.prototype.applyImpulsePos=function(){var n=0,t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,n=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,e=0,i=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,e=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,p=0,l=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,p=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,r=0,o=0,r=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,o=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy,a=0,s=0,_=0,h=0;a=this.n12x,s=this.n12y,_=this.n34x,h=this.n34y;var u=0,x=0,u=this.b2.posx+i-(this.b1.posx+t),d=this.b2.posy+e-(this.b1.posy+n),y=this.b4.posx+r-(this.b3.posx+l),x=this.b4.posy+o-(this.b3.posy+p),z=Math.sqrt(u*u+d*d),c=Math.sqrt(y*y+x*x);0!=z&&(a=u*(u=1/z),s=d*u),0!=c?(_=y*(b=1/c),h=x*b,_*=g=this.ratio,h*=g):(_*=f=this.ratio/Math.sqrt(_*_+h*h),h*=f);var v,m,f,x=z+this.ratio*c,b=this.equal?(x-=this.jointMax,!1):x<this.jointMin?(x=this.jointMin-x,a=-a,s=-s,_=-_,h=-h,!1):x>this.jointMax?(x-=this.jointMax,!1):!(x=h=_=s=a=0),g=x;if(!b){if(this.breakUnderError&&g*g>this.maxError*this.maxError)return!0;if(g*g<jp.constraintLinearSlop*jp.constraintLinearSlop)return!1;6<(g*=.5)*g&&((f=this.b1.smass+this.b2.smass)>jp.epsilon&&(O=-g*(f=.75/f),(this.equal||O<0)&&(z=O*this.b1.imass,this.b1.posx-=a*z,this.b1.posy-=s*z,c=O*this.b2.imass,this.b2.posx+=a*c,this.b2.posy+=s*c,x=O*this.b3.imass,this.b3.posx-=_*x,this.b3.posy-=h*x,b=O*this.b4.imass,this.b4.posx+=_*b,this.b4.posy+=h*b,x=c=z=f=0,f=this.b2.posx+i-(this.b1.posx+t),z=this.b2.posy+e-(this.b1.posy+n),c=this.b4.posx+r-(this.b3.posx+l),x=this.b4.posy+o-(this.b3.posy+p),0!=(b=Math.sqrt(f*f+z*z))&&(a=f*(m=1/b),s=z*m),0!=(m=Math.sqrt(c*c+x*x))?(_=c*(v=1/m),h=x*v,_*=v=this.ratio,h*=v):(_*=v=this.ratio/Math.sqrt(_*_+h*h),h*=v),m=b+this.ratio*m,this.equal?m-=this.jointMax:m<this.jointMin?(m=this.jointMin-m,a=-a,s=-s,_=-_,h=-h):m>this.jointMax?m-=this.jointMax:m=h=_=s=a=0,g=m,g*=.5))),n=s*t-a*n,e=s*i-a*e,p=h*l-_*p,r=h*r-_*o;o=this.b1.smass+this.b2.smass+this.ratio*this.ratio*(this.b3.smass+this.b4.smass)+this.b1.sinertia*n*n+this.b2.sinertia*e*e+this.b3.sinertia*p*p+this.b4.sinertia*r*r;this.b1==this.b4&&(o-=2*((a*_+s*h)*this.b1.smass+n*r*this.b1.sinertia)),this.b1==this.b3&&(o+=2*((a*_+s*h)*this.b1.smass+n*p*this.b1.sinertia)),this.b2==this.b3&&(o-=2*((a*_+s*h)*this.b2.smass+e*p*this.b2.sinertia)),this.b2==this.b4&&(o+=2*((a*_+s*h)*this.b2.smass+e*r*this.b2.sinertia));var w,M,C,k,O,P,o=o;0!=o&&(o=1/o),O=-g*o,(this.equal||O<0)&&(o=this.b1.imass*O,this.b1.posx-=a*o,this.b1.posy-=s*o,o=this.b2.imass*O,this.b2.posx+=a*o,this.b2.posy+=s*o,o=this.b3.imass*O,this.b3.posx-=_*o,this.b3.posy-=h*o,o=this.b4.imass*O,this.b4.posx+=_*o,this.b4.posy+=h*o,h=this.b1,o=-n*this.b1.iinertia*O,h.rot+=o,1e-4<o*o?(h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot)):(k=1-(w=o*o)*w/8,w=((n=1-.5*w)*h.axisx+o*h.axisy)*k,h.axisy=(n*h.axisy-o*h.axisx)*k,h.axisx=w),k=this.b2,h=e*this.b2.iinertia*O,k.rot+=h,1e-4<h*h?(k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot)):(w=1-(M=h*h)*M/8,M=((e=1-.5*M)*k.axisx+h*k.axisy)*w,k.axisy=(e*k.axisy-h*k.axisx)*w,k.axisx=M),k=this.b3,M=-p*this.b3.iinertia*O,k.rot+=M,1e-4<M*M?(k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot)):(C=1-(P=M*M)*P/8,P=((p=1-.5*P)*k.axisx+M*k.axisy)*C,k.axisy=(p*k.axisy-M*k.axisx)*C,k.axisx=P),C=this.b4,k=r*this.b4.iinertia*O,C.rot+=k,1e-4<k*k?(C.axisx=Math.sin(C.rot),C.axisy=Math.cos(C.rot)):(r=1-(P=k*k)*P/8,P=((O=1-.5*P)*C.axisx+k*C.axisy)*r,C.axisy=(O*C.axisy-k*C.axisx)*r,C.axisx=P))}return!1},Bn.prototype.draw=function(n){},Bn.prototype.__class__=Bn;var Gn=zpp_nape.constraint.ZPP_UserConstraint=function(n,t){this.jOld=null,this.J=null,this.vec3=null,this.Keff=null,this.jMax=0,this.velonly=!1,this.gamma=0,this.soft=0,this.y=null,this.L=null,this.stepped=!1,this.bias=null,this.jAcc=null,this.dim=0,this.bodies=null,this.outer_zn=null,Nn.call(this),this.bodies=[],this.dim=n,this.velonly=t,this.jAcc=[],this.bias=[],this.L=[],this.J=[],this.jOld=[],this.y=[],this.Keff=[],this.vec3=J.get(0,0,0);for(var e=0;e<n;){var i=e++;this.J[i]=this.jOld[i]=this.y[i]=0,this.bias[i]=0;for(var p=this.jAcc[i]=0;p<n;)this.L[i*n+p++]=0}this.stepped=!1};Gn.__name__=["zpp_nape","constraint","ZPP_UserConstraint"],Gn.__super__=Nn,Gn.prototype=Object.create(Nn.prototype),Gn.prototype.outer_zn=null,Gn.prototype.bindVec2_invalidate=function(n){this.outer_zn.__invalidate()},Gn.prototype.bodies=null,Gn.prototype.dim=null,Gn.prototype.jAcc=null,Gn.prototype.bias=null,Gn.prototype.addBody=function(n){for(var t=null,e=0,i=this.bodies;e<i.length;){var p=i[e];if(++e,p.body==n){t=p;break}}null==t?(this.bodies.push(new rt(1,n)),this.active&&null!=this.space&&null!=n&&n.constraints.add(this)):t.cnt++},Gn.prototype.remBody=function(n){for(var t=null,e=0|this.bodies.length,i=0;i<e;){var p=this.bodies[i];if(p.body==n){p.cnt--,0==p.cnt&&(0<e&&(this.bodies[i]=this.bodies[e-1]),this.bodies.pop(),this.active&&null!=this.space&&null!=n&&n.constraints.remove(this)),t=p;break}++i}return null!=t},Gn.prototype.bodyImpulse=function(n){for(var t=0,e=this.dim;t<e;){var i=t++;this.J[i]=this.jAcc[i]}var p=J.get(0,0,0);return this.stepped&&this.outer_zn.__impulse(this.J,n.outer,p),p},Gn.prototype.activeBodies=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];++n,null!=e.body&&e.body.constraints.add(this)}},Gn.prototype.inactiveBodies=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];++n,null!=e.body&&e.body.constraints.remove(this)}},Gn.prototype.stepped=null,Gn.prototype.copy=function(n,t){throw this.copyto(this.outer_zn.__copy()),new p("not done yet")},Gn.prototype.validate=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];if(++n,e.body.space!=this.space)throw new p("Error: Constraints must have each body within the same sapce to which the constraint has been assigned")}this.outer_zn.__validate()},Gn.prototype.wake_connected=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];++n,2==e.body.type&&e.body.wake()}},Gn.prototype.forest=function(){for(var n=0,t=this.bodies;n<t.length;){var e,i,p=t[n];if(++n,2==p.body.type){if(p.body.component==p.body.component.parent)e=p.body.component;else{for(var l=p.body.component,r=null;l!=l.parent;){var o=l.parent;l.parent=r,r=l,l=o}for(;null!=r;){var a=r.parent;r.parent=l,r=a}e=l}if(this.component==this.component.parent)i=this.component;else{for(var s=this.component,_=null;s!=s.parent;){var h=s.parent;s.parent=_,_=s,s=h}for(;null!=_;){var u=_.parent;_.parent=s,_=u}i=s}e!=i&&(e.rank<i.rank?e.parent=i:e.rank>i.rank?i.parent=e:(i.parent=e).rank++)}}},Gn.prototype.pair_exists=function(n,t){for(var e=!1,i=0|this.bodies.length,p=0;p<i;){for(var l=p++,r=this.bodies[l].body,o=1+l;o<i;){var a=this.bodies[o++].body;if(r.id==n&&a.id==t||r.id==t&&a.id==n){e=!0;break}}if(e)break}return e},Gn.prototype.broken=function(){this.outer_zn.__broken()},Gn.prototype.clearcache=function(){for(var n=0,t=this.dim;n<t;)this.jAcc[n++]=0;this.pre_dt=-1},Gn.prototype.lsq=function(n){for(var t=0,e=0,i=this.dim;e<i;){var p=e++;t+=n[p]*n[p]}return t},Gn.prototype._clamp=function(n,t){var e=this.lsq(n);if(t*t<e)for(var i=t/Math.sqrt(e),p=0,l=this.dim;p<l;)n[p++]*=i},Gn.prototype.L=null,Gn.prototype.solve=function(n){for(var t=0,e=0,i=this.dim;e<i;){for(var p=e++,l=0,r=0,o=p-1;r<o;){var a=r++;l+=this.L[p*this.dim+a]*this.L[p*this.dim+a]}var s=Math.sqrt(n[t++]-l);if(0!=(this.L[p*this.dim+p]=s)){s=1/s;for(var _=1+p,h=this.dim;_<h;){for(var u=_++,x=0,d=0,y=p-1;d<y;){var z=d++;x+=this.L[u*this.dim+z]*this.L[p*this.dim+z]}this.L[u*this.dim+p]=s*(n[t++]-x)}}else{for(var c=1+p,v=this.dim;c<v;)this.L[c++*this.dim+p]=0;t+=this.dim-p-1}}return this.L},Gn.prototype.y=null,Gn.prototype.transform=function(n,t){for(var e=0,i=this.dim;e<i;){var p=e++,l=t[p],r=n[p*this.dim+p];if(0!=r){for(var o=0;o<p;){var a=o++;l-=n[p*this.dim+a]*this.y[a]}this.y[p]=l/r}else this.y[p]=0}for(var s=0,_=this.dim;s<_;){var h=this.dim-1-s++,u=n[h*this.dim+h];if(0!=u){for(var x=this.y[h],d=1+h,y=this.dim;d<y;){var z=d++;x-=n[z*this.dim+h]*t[z]}t[h]=x/u}else t[h]=0}},Gn.prototype.soft=null,Gn.prototype.gamma=null,Gn.prototype.velonly=null,Gn.prototype.jMax=null,Gn.prototype.Keff=null,Gn.prototype.preStep=function(n){this.outer_zn.__validate(),-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;if(this.pre_dt=n,this.stepped=!0,this.outer_zn.__prepare(),this.outer_zn.__eff_mass(this.Keff),this.L=this.solve(this.Keff),this.stiff||this.velonly){for(var e=0,i=this.dim;e<i;)this.bias[e++]=0;this.gamma=0,this.soft=1}else{var p=2*Math.PI*this.frequency;this.gamma=1/(n*p*(2*this.damping+p*n));var l=1/(1+this.gamma),r=n*p*p*this.gamma;if(this.gamma*=l,this.soft=l,this.outer_zn.__position(this.bias),this.breakUnderError&&this.lsq(this.bias)>this.maxError*this.maxError)return!0;for(var o=0,a=this.dim;o<a;)this.bias[o++]*=-r;this._clamp(this.bias,this.maxError)}for(var s=0,_=this.dim;s<_;)this.jAcc[s++]*=t;return this.jMax=this.maxForce*n,!1},Gn.prototype.vec3=null,Gn.prototype.warmStart=function(){for(var n=0,t=this.bodies;n<t.length;){var e=t[n];++n;var i=e.body;this.outer_zn.__impulse(this.jAcc,i.outer,this.vec3);var p=i.imass,l=this.vec3,e=l.zpp_inner;null!=e._validate&&e._validate(),i.velx+=l.zpp_inner.x*p;e=this.vec3,l=e.zpp_inner;null!=l._validate&&l._validate(),i.vely+=e.zpp_inner.y*p;e=this.vec3,p=e.zpp_inner;null!=p._validate&&p._validate(),i.angvel+=e.zpp_inner.z*i.iinertia}},Gn.prototype.J=null,Gn.prototype.jOld=null,Gn.prototype.applyImpulseVel=function(){this.outer_zn.__velocity(this.J);for(var n=0,t=this.dim;n<t;){var e=n++;this.J[e]=this.bias[e]-this.J[e]}this.transform(this.L,this.J);for(var i=0,p=this.dim;i<p;){var l=i++;this.jOld[l]=this.jAcc[l],this.jAcc[l]+=this.J[l]=this.J[l]*this.soft-this.jAcc[l]*this.gamma}if(this.outer_zn.__clamp(this.jAcc),(this.breakUnderForce||!this.stiff)&&this.lsq(this.jAcc)>this.jMax*this.jMax){if(this.breakUnderForce)return!0;this.stiff||this._clamp(this.jAcc,this.jMax)}for(var r=0,o=this.dim;r<o;){var a=r++;this.J[a]=this.jAcc[a]-this.jOld[a]}for(var s=0,_=this.bodies;s<_.length;){var h=_[s];++s;var u=h.body;this.outer_zn.__impulse(this.J,u.outer,this.vec3);var x=u.imass,d=this.vec3,h=d.zpp_inner;null!=h._validate&&h._validate(),u.velx+=d.zpp_inner.x*x;h=this.vec3,d=h.zpp_inner;null!=d._validate&&d._validate(),u.vely+=h.zpp_inner.y*x;h=this.vec3,x=h.zpp_inner;null!=x._validate&&x._validate(),u.angvel+=h.zpp_inner.z*u.iinertia}return!1},Gn.prototype.applyImpulsePos=function(){if(this.velonly)return!1;this.outer_zn.__prepare(),this.outer_zn.__position(this.J);var n=this.lsq(this.J);if(this.breakUnderError&&n>this.maxError*this.maxError)return!0;if(n<jp.constraintLinearSlop*jp.constraintLinearSlop)return!1;for(var t=0,e=this.dim;t<e;)this.J[t++]*=-1;this.outer_zn.__eff_mass(this.Keff),this.transform(this.solve(this.Keff),this.J),this.outer_zn.__clamp(this.J);for(var i=0,p=this.bodies;i<p.length;){var l=p[i];++i;var r=l.body;this.outer_zn.__impulse(this.J,r.outer,this.vec3);var o=r.imass,a=this.vec3,s=a.zpp_inner;null!=s._validate&&s._validate(),r.posx+=a.zpp_inner.x*o;l=this.vec3,s=l.zpp_inner;null!=s._validate&&s._validate(),r.posy+=l.zpp_inner.y*o;a=this.vec3,s=a.zpp_inner;null!=s._validate&&s._validate();l=a.zpp_inner.z*r.iinertia;r.rot+=l,1e-4<l*l?(r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)):(s=1-(o=l*l)*o/8,o=((a=1-.5*o)*r.axisx+l*r.axisy)*s,r.axisy=(a*r.axisy-l*r.axisx)*s,r.axisx=o)}return!1},Gn.prototype.draw=function(n){this.outer_zn.__draw(n)},Gn.prototype.__class__=Gn;var rt=zpp_nape.constraint.ZPP_UserBody=function(n,t){this.body=null,this.cnt=0,this.cnt=n,this.body=t};rt.__name__=["zpp_nape","constraint","ZPP_UserBody"],rt.prototype.cnt=null,rt.prototype.body=null,rt.prototype.__class__=rt;var ot=zpp_nape.constraint.ZPP_WeldJoint=function(){this.stepped=!1,this.biasz=0,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccz=0,this.jAccy=0,this.jAccx=0,this.kMassf=0,this.kMasse=0,this.kMassc=0,this.kMassd=0,this.kMassb=0,this.kMassa=0,this.phase=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Nn.call(this),this.phase=0,this.jAccx=0,this.jAccy=0,this.jAccz=0,this.jMax=1/0,this.stepped=!1,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};ot.__name__=["zpp_nape","constraint","ZPP_WeldJoint"],ot.__super__=Nn,ot.prototype=Object.create(Nn.prototype),ot.prototype.outer_zn=null,ot.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?J.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)):J.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz):J.get(0,0,0)},ot.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},ot.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},ot.prototype.b1=null,ot.prototype.a1localx=null,ot.prototype.a1localy=null,ot.prototype.a1relx=null,ot.prototype.a1rely=null,ot.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},ot.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},ot.prototype.setup_a1=function(){var n,t,e=this.a1localx,i=this.a1localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=X(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=X(this,this.invalidate_a1)},ot.prototype.wrap_a1=null,ot.prototype.b2=null,ot.prototype.a2localx=null,ot.prototype.a2localy=null,ot.prototype.a2relx=null,ot.prototype.a2rely=null,ot.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},ot.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},ot.prototype.setup_a2=function(){var n,t,e=this.a2localx,i=this.a2localy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=X(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=X(this,this.invalidate_a2)},ot.prototype.wrap_a2=null,ot.prototype.phase=null,ot.prototype.kMassa=null,ot.prototype.kMassb=null,ot.prototype.kMassd=null,ot.prototype.kMassc=null,ot.prototype.kMasse=null,ot.prototype.kMassf=null,ot.prototype.jAccx=null,ot.prototype.jAccy=null,ot.prototype.jAccz=null,ot.prototype.jMax=null,ot.prototype.gamma=null,ot.prototype.biasx=null,ot.prototype.biasy=null,ot.prototype.biasz=null,ot.prototype.stepped=null,ot.prototype.copy=function(n,t){var e=this.outer_zn;null==e.zpp_inner_zn.wrap_a1&&e.zpp_inner_zn.setup_a1();var i=e.zpp_inner_zn.wrap_a1,e=this.outer_zn;null==e.zpp_inner_zn.wrap_a2&&e.zpp_inner_zn.setup_a2();var p=new S(null,null,i,e.zpp_inner_zn.wrap_a2);if(this.copyto(p),null!=n&&null!=this.b1){for(var l=null,r=0;r<n.length;){var o=n[r];if(++r,o.id==this.b1.id){l=o.bc;break}}null!=l?p.zpp_inner_zn.b1=l.zpp_inner:t.push(Vn.todo(this.b1.id,function(n){p.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var a=null,s=0;s<n.length;){var _=n[s];if(++s,_.id==this.b2.id){a=_.bc;break}}null!=a?p.zpp_inner_zn.b2=a.zpp_inner:t.push(Vn.todo(this.b2.id,function(n){p.zpp_inner_zn.b2=n.zpp_inner}))}return p},ot.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new p("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new p("Error: WeldJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new p("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new p("Error: Constraints cannot have both bodies non-dynamic")},ot.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},ot.prototype.forest=function(){if(2==this.b1.type){var n,t;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var p=e.parent;e.parent=i,i=e,e=p}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}if(this.component==this.component.parent)t=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}t=r}n!=t&&(n.rank<t.rank?n.parent=t:n.rank>t.rank?t.parent=n:(t.parent=n).rank++)}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var v=z.parent;z.parent=c,c=z,z=v}for(;null!=c;){var m=c.parent;c.parent=z,c=m}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_).rank++)}},ot.prototype.pair_exists=function(n,t){return this.b1.id==n&&this.b2.id==t||this.b1.id==t&&this.b2.id==n},ot.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.jAccz=0,this.pre_dt=-1},ot.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e=this.b1.smass+this.b2.smass;this.kMassa=e,this.kMassb=0,this.kMassd=e,this.kMassc=0,this.kMasse=0,(this.kMassf=0)!=this.b1.sinertia&&(p=this.a1relx*this.b1.sinertia,i=this.a1rely*this.b1.sinertia,this.kMassa+=i*this.a1rely,this.kMassb+=-i*this.a1relx,this.kMassd+=p*this.a1relx,this.kMassc+=-i,this.kMasse+=p,this.kMassf+=this.b1.sinertia),0!=this.b2.sinertia&&(r=this.a2relx*this.b2.sinertia,l=this.a2rely*this.b2.sinertia,this.kMassa+=l*this.a2rely,this.kMassb+=-l*this.a2relx,this.kMassd+=r*this.a2relx,this.kMassc+=-l,this.kMasse+=r,this.kMassf+=this.b2.sinertia);var i,p,l,r,o,e=this.kMassa*(this.kMassd*this.kMassf-this.kMasse*this.kMasse)+this.kMassb*(this.kMassc*this.kMasse-this.kMassb*this.kMassf)+this.kMassc*(this.kMassb*this.kMasse-this.kMassc*this.kMassd);if(0!=(1&(e=e!=e?(this.kMassa=0,this.kMassb=0,this.kMassd=0,this.kMassc=0,this.kMasse=0,this.kMassf=0,7):0==e?((o=0)!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,o=1),0!=this.kMassd?this.kMassd=1/this.kMassd:(this.kMassd=0,o|=2),0!=this.kMassf?this.kMassf=1/this.kMassf:(this.kMassf=0,o|=4),this.kMassb=this.kMassc=this.kMasse=0,o):(i=(e=1/e)*(this.kMassd*this.kMassf-this.kMasse*this.kMasse),p=e*(this.kMasse*this.kMassc-this.kMassb*this.kMassf),l=e*(this.kMassa*this.kMassf-this.kMassc*this.kMassc),r=e*(this.kMassb*this.kMasse-this.kMassc*this.kMassd),o=e*(this.kMassb*this.kMassc-this.kMassa*this.kMasse),a=this.kMassa*this.kMassd-this.kMassb*this.kMassb,this.kMassa=i,this.kMassb=p,this.kMassd=l,this.kMassc=r,this.kMasse=o,this.kMassf=e*a,0)))&&(this.jAccx=0),0!=(2&e)&&(this.jAccy=0),0!=(4&e)&&(this.jAccz=0),this.stiff)this.biasx=0,this.biasy=0,this.biasz=0,this.gamma=0;else{var a=2*Math.PI*this.frequency;this.gamma=1/(n*a*(2*this.damping+a*n));e=1/(1+this.gamma),a=n*a*a*this.gamma;if(this.gamma*=e,this.kMassa*=e,this.kMassb*=e,this.kMassd*=e,this.kMassc*=e,this.kMasse*=e,this.kMassf*=e,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.biasz=this.b2.rot-this.b1.rot-this.phase,this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz>this.maxError*this.maxError)return!0;e=-a;this.biasx*=e,this.biasy*=e,this.biasz*=e;a=this.maxError,e=this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz;a*a<e&&(e=a*(1/Math.sqrt(e)),this.biasx*=e,this.biasy*=e,this.biasz*=e)}return this.jAccx*=t,this.jAccy*=t,this.jAccz*=t,this.jMax=this.maxForce*n,!1},ot.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;n=this.b2.imass;this.b2.velx+=this.jAccx*n,this.b2.vely+=this.jAccy*n,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz)*this.b2.iinertia},ot.prototype.applyImpulseVel=function(){var n=0,n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),t=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.angvel+this.b2.kinangvel-this.b1.angvel-this.b1.kinangvel,i=this.biasx-n,p=this.biasy-t,l=this.biasz-e,r=this.kMassa*i+this.kMassb*p+this.kMassc*l,o=this.kMassb*i+this.kMassd*p+this.kMasse*l;l=this.kMassc*i+this.kMasse*p+this.kMassf*l,i=r,p=o;n=this.gamma;i-=this.jAccx*n,p-=this.jAccy*n,l-=this.jAccz*n;t=this.jAccx,e=this.jAccy,r=this.jAccz;if(this.jAccx+=i,this.jAccy+=p,this.jAccz+=l,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz>this.jMax*this.jMax)return!0}else this.stiff||(o=this.jMax)*o<(n=this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz)&&(n=o*(1/Math.sqrt(n)),this.jAccx*=n,this.jAccy*=n,this.jAccz*=n);i=this.jAccx-t,p=this.jAccy-e,l=this.jAccz-r;r=this.b1.imass;this.b1.velx-=i*r,this.b1.vely-=p*r;r=this.b2.imass;return this.b2.velx+=i*r,this.b2.vely+=p*r,this.b1.angvel-=(p*this.a1relx-i*this.a1rely+l)*this.b1.iinertia,this.b2.angvel+=(p*this.a2relx-i*this.a2rely+l)*this.b2.iinertia,!1},ot.prototype.applyImpulsePos=function(){var n=0,t=0,n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,e=0,i=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,e=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,p=0,l=0,r=0,p=this.b2.posx+i-(this.b1.posx+n),l=this.b2.posy+e-(this.b1.posy+t),r=this.b2.rot-this.b1.rot-this.phase,o=0,a=0,s=0;if(this.breakUnderError&&p*p+l*l+r*r>this.maxError*this.maxError)return!0;var _=!0;p*p+l*l<jp.constraintLinearSlop*jp.constraintLinearSlop&&(_=!1,l=p=0);var h=r*r,u=jp.constraintAngularSlop;if(h<u*u){if(!_)return!1;r=0}r*=.5,6<(p*=.5)*p+(l*=.5)*l&&((y=this.b1.smass+this.b2.smass)>jp.epsilon&&(400<(z=(o=-p*(y=.75/y))*o+(a=-l*y)*a)&&(o*=c=1/Math.sqrt(z)*20,a*=c),v=this.b1.imass,this.b1.posx-=o*v,this.b1.posy-=a*v,m=this.b2.imass,this.b2.posx+=o*m,this.b2.posy+=a*m,p=this.b2.posx+i-(this.b1.posx+n),l=this.b2.posy+e-(this.b1.posy+t),r=this.b2.rot-this.b1.rot-this.phase,p*=.5,l*=.5,r*=.5));var x,d,u=0,_=0,y=0,z=0,c=0,v=0,m=this.b1.smass+this.b2.smass,y=u=m;(v=c=z=_=0)!=this.b1.sinertia&&(d=n*this.b1.sinertia,u=m+(x=t*this.b1.sinertia)*t,_+=-x*n,y=m+d*n,z+=-x,c+=d,v+=this.b1.sinertia),0!=this.b2.sinertia&&(x=i*this.b2.sinertia,u+=(d=e*this.b2.sinertia)*e,_+=-d*i,y+=x*i,z+=-d,c+=x,v+=this.b2.sinertia),s=-r;l=(o=-p)*o+(a=-l)*a;36<l&&(o*=f=1/Math.sqrt(l)*6,a*=f);var f,l=u*(y*v-c*c)+_*(z*c-_*v)+z*(_*c-z*y);l!=l?o=a=s=0:0==l?(0!=u?o/=u:o=0,0!=y?a/=y:a=0,0!=v?s/=v:s=0):(b=(l=1/l)*(o*(y*v-c*c)+a*(g=c*z-_*v)+s*(f=_*c-z*y)),g=l*(o*g+a*(u*v-z*z)+s*(c=_*z-u*c)),s=l*(o*f+a*c+s*(u*y-_*_)),o=b,a=g);var b=this.b1.imass;this.b1.posx-=o*b,this.b1.posy-=a*b;var g=this.b2.imass;this.b2.posx+=o*g,this.b2.posy+=a*g;b=this.b1,g=-(a*n-o*t+s)*this.b1.iinertia;b.rot+=g,1e-4<g*g?(b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)):(n=1-(w=g*g)*w/8,w=((t=1-.5*w)*b.axisx+g*b.axisy)*n,b.axisy=(t*b.axisy-g*b.axisx)*n,b.axisx=w);var w=this.b2,i=(a*i-o*e+s)*this.b2.iinertia;return w.rot+=i,1e-4<i*i?(w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot)):(e=1-(o=i*i)*o/8,o=((s=1-.5*o)*w.axisx+i*w.axisy)*e,w.axisy=(s*w.axisy-i*w.axisx)*e,w.axisx=o),!1},ot.prototype.draw=function(n){},ot.prototype.__class__=ot;var Qt=zpp_nape.dynamics.ZPP_Arbiter=function(){this.sensorarb=null,this.fluidarb=null,this.colarb=null,this.type=0,this.pair=null,this.ws2=null,this.ws1=null,this.b2=null,this.b1=null,this.invalidated=!1,this.immState=0,this.fresh=!1,this.continuous=!1,this.presentable=!1,this.intchange=!1,this.present=0,this.sleeping=!1,this.cleared=!1,this.active=!1,this.endGenerated=0,this.sleep_stamp=0,this.up_stamp=0,this.stamp=0,this.di=0,this.id=0,this.hnext=null,this.outer=null};Qt.__name__=["zpp_nape","dynamics","ZPP_Arbiter"],Qt.prototype.outer=null,Qt.prototype.wrapper=function(){return null==this.outer&&(Qt.internal=!0,this.type==Qt.COL?(this.colarb.outer_zn=new I,this.outer=this.colarb.outer_zn):this.type==Qt.FLUID?(this.fluidarb.outer_zn=new L,this.outer=this.fluidarb.outer_zn):this.outer=new A,this.outer.zpp_inner=this,Qt.internal=!1),this.outer},Qt.prototype.inactiveme=function(){return!this.active},Qt.prototype.hnext=null,Qt.prototype.id=null,Qt.prototype.di=null,Qt.prototype.stamp=null,Qt.prototype.up_stamp=null,Qt.prototype.sleep_stamp=null,Qt.prototype.endGenerated=null,Qt.prototype.active=null,Qt.prototype.cleared=null,Qt.prototype.sleeping=null,Qt.prototype.present=null,Qt.prototype.intchange=null,Qt.prototype.presentable=null,Qt.prototype.continuous=null,Qt.prototype.fresh=null,Qt.prototype.immState=null,Qt.prototype.acting=function(){return!!this.active&&0!=(1&this.immState)},Qt.prototype.invalidated=null,Qt.prototype.b1=null,Qt.prototype.b2=null,Qt.prototype.ws1=null,Qt.prototype.ws2=null,Qt.prototype.pair=null,Qt.prototype.swap_features=function(){var n=this.b1;this.b1=this.b2,this.b2=n;n=this.ws1;this.ws1=this.ws2,this.ws2=n;n=this.colarb.s1;this.colarb.s1=this.colarb.s2,this.colarb.s2=n},Qt.prototype.type=null,Qt.prototype.colarb=null,Qt.prototype.fluidarb=null,Qt.prototype.sensorarb=null,Qt.prototype.lazyRetire=function(n,t){if(this.cleared=!0,null==t||this.b2==t)for(var e,i,p=this.b1.arbiters,l=null,r=p.head;null!=r;){if(r.elt==this){null==l?(i=(e=p.head).next,p.head=i,null==p.head&&(p.pushmod=!0)):(i=(e=l.next).next,null==(l.next=i)&&(p.pushmod=!0));var o=e;o.elt=null,o.next=tp.zpp_pool,tp.zpp_pool=o,p.modified=!0,p.length--,p.pushmod=!0;break}r=(l=r).next}if(null==t||this.b1==t)for(var a,s,_=this.b2.arbiters,h=null,u=_.head;null!=u;){if(u.elt==this){null==h?(s=(a=_.head).next,_.head=s,null==_.head&&(_.pushmod=!0)):(s=(a=h.next).next,null==(h.next=s)&&(_.pushmod=!0));var x=a;x.elt=null,x.next=tp.zpp_pool,tp.zpp_pool=x,_.modified=!0,_.length--,_.pushmod=!0;break}u=(h=u).next}null!=this.pair&&(this.pair.arb=null,this.pair=null),this.active=!1,n.f_arbiters.modified=!0},Qt.prototype.sup_assign=function(n,t,e,i){this.b1=n.body,this.ws1=n,this.b2=t.body,this.ws2=t,this.id=e,this.di=i;i=this.b1.arbiters;null==tp.zpp_pool?p=new tp:(p=tp.zpp_pool,tp.zpp_pool=p.next,p.next=null),p.elt=this;var p=p;p.next=i.head,i.head=p,i.modified=!0,i.length++;i=this.b2.arbiters;null==tp.zpp_pool?l=new tp:(l=tp.zpp_pool,tp.zpp_pool=l.next,l.next=null),l.elt=this;var l=l;l.next=i.head,i.head=l,i.modified=!0,i.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},Qt.prototype.sup_retire=function(){if(!this.cleared){for(var n,t,e=this.b1.arbiters,i=null,p=e.head;null!=p;){if(p.elt==this){null==i?(t=(n=e.head).next,e.head=t,null==e.head&&(e.pushmod=!0)):(t=(n=i.next).next,null==(i.next=t)&&(e.pushmod=!0));var l=n;l.elt=null,l.next=tp.zpp_pool,tp.zpp_pool=l,e.modified=!0,e.length--,e.pushmod=!0;break}p=(i=p).next}for(var r,o,a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){null==s?(o=(r=a.head).next,a.head=o,null==a.head&&(a.pushmod=!0)):(o=(r=s.next).next,null==(s.next=o)&&(a.pushmod=!0));var h=r;h.elt=null,h.next=tp.zpp_pool,tp.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0;break}_=(s=_).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1},Qt.prototype.__class__=Qt;var Ji=zpp_nape.dynamics.ZPP_SensorArbiter=function(){this.next=null,Qt.call(this),this.type=Qt.SENSOR,this.sensorarb=this};Ji.__name__=["zpp_nape","dynamics","ZPP_SensorArbiter"],Ji.__super__=Qt,Ji.prototype=Object.create(Qt.prototype),Ji.prototype.next=null,Ji.prototype.alloc=function(){},Ji.prototype.free=function(){},Ji.prototype.assign=function(n,t,e,i){this.b1=n.body,this.ws1=n,this.b2=t.body,this.ws2=t,this.id=e,this.di=i;i=this.b1.arbiters;null==tp.zpp_pool?p=new tp:(p=tp.zpp_pool,tp.zpp_pool=p.next,p.next=null),p.elt=this;var p=p;p.next=i.head,i.head=p,i.modified=!0,i.length++;i=this.b2.arbiters;null==tp.zpp_pool?l=new tp:(l=tp.zpp_pool,tp.zpp_pool=l.next,l.next=null),l.elt=this;var l=l;l.next=i.head,i.head=l,i.modified=!0,i.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},Ji.prototype.retire=function(){if(!this.cleared){for(var n,t,e=this.b1.arbiters,i=null,p=e.head;null!=p;){if(p.elt==this){null==i?(t=(n=e.head).next,e.head=t,null==e.head&&(e.pushmod=!0)):(t=(n=i.next).next,null==(i.next=t)&&(e.pushmod=!0));var l=n;l.elt=null,l.next=tp.zpp_pool,tp.zpp_pool=l,e.modified=!0,e.length--,e.pushmod=!0;break}p=(i=p).next}for(var r,o,a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){null==s?(o=(r=a.head).next,a.head=o,null==a.head&&(a.pushmod=!0)):(o=(r=s.next).next,null==(s.next=o)&&(a.pushmod=!0));var h=r;h.elt=null,h.next=tp.zpp_pool,tp.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0;break}_=(s=_).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;this.next=Ji.zpp_pool,Ji.zpp_pool=this},Ji.prototype.makemutable=function(){},Ji.prototype.makeimmutable=function(){},Ji.prototype.__class__=Ji;var Xi=zpp_nape.dynamics.ZPP_FluidArbiter=function(){this.pre_dt=0,this.mutable=!1,this.wrap_position=null,this.buoyy=0,this.buoyx=0,this.ny=0,this.nx=0,this.lgamma=0,this.dampy=0,this.dampx=0,this.vMassc=0,this.vMassb=0,this.vMassa=0,this.agamma=0,this.adamp=0,this.wMass=0,this.nodrag=!1,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0,this.overlap=0,this.centroidy=0,this.centroidx=0,this.next=null,this.outer_zn=null,Qt.call(this),this.type=Qt.FLUID,(this.fluidarb=this).buoyx=0,this.buoyy=0,this.pre_dt=-1};Xi.__name__=["zpp_nape","dynamics","ZPP_FluidArbiter"],Xi.__super__=Qt,Xi.prototype=Object.create(Qt.prototype),Xi.prototype.outer_zn=null,Xi.prototype.next=null,Xi.prototype.alloc=function(){},Xi.prototype.free=function(){},Xi.prototype.centroidx=null,Xi.prototype.centroidy=null,Xi.prototype.overlap=null,Xi.prototype.r1x=null,Xi.prototype.r1y=null,Xi.prototype.r2x=null,Xi.prototype.r2y=null,Xi.prototype.nodrag=null,Xi.prototype.wMass=null,Xi.prototype.adamp=null,Xi.prototype.agamma=null,Xi.prototype.vMassa=null,Xi.prototype.vMassb=null,Xi.prototype.vMassc=null,Xi.prototype.dampx=null,Xi.prototype.dampy=null,Xi.prototype.lgamma=null,Xi.prototype.nx=null,Xi.prototype.ny=null,Xi.prototype.buoyx=null,Xi.prototype.buoyy=null,Xi.prototype.position_validate=function(){this.wrap_position.zpp_inner.x=this.centroidx,this.wrap_position.zpp_inner.y=this.centroidy},Xi.prototype.position_invalidate=function(n){this.centroidx=n.x,this.centroidy=n.y},Xi.prototype.wrap_position=null,Xi.prototype.getposition=function(){var n,t,e;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),0==n.zpp_inner.x&&(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!this.mutable,this.wrap_position.zpp_inner._validate=X(this,this.position_validate),this.wrap_position.zpp_inner._invalidate=X(this,this.position_invalidate)},Xi.prototype.assign=function(n,t,e,i){this.b1=n.body,this.ws1=n,this.b2=t.body,this.ws2=t,this.id=e,this.di=i;i=this.b1.arbiters;null==tp.zpp_pool?p=new tp:(p=tp.zpp_pool,tp.zpp_pool=p.next,p.next=null),p.elt=this;var p=p;p.next=i.head,i.head=p,i.modified=!0,i.length++;i=this.b2.arbiters;null==tp.zpp_pool?l=new tp:(l=tp.zpp_pool,tp.zpp_pool=l.next,l.next=null),l.elt=this;var l=l;l.next=i.head,i.head=l,i.modified=!0,i.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.nx=0,this.ny=1,this.dampx=0,this.dampy=0,this.adamp=0},Xi.prototype.retire=function(){if(!this.cleared){for(var n,t,e=this.b1.arbiters,i=null,p=e.head;null!=p;){if(p.elt==this){null==i?(t=(n=e.head).next,e.head=t,null==e.head&&(e.pushmod=!0)):(t=(n=i.next).next,null==(i.next=t)&&(e.pushmod=!0));var l=n;l.elt=null,l.next=tp.zpp_pool,tp.zpp_pool=l,e.modified=!0,e.length--,e.pushmod=!0;break}p=(i=p).next}for(var r,o,a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){null==s?(o=(r=a.head).next,a.head=o,null==a.head&&(a.pushmod=!0)):(o=(r=s.next).next,null==(s.next=o)&&(a.pushmod=!0));var h=r;h.elt=null,h.next=tp.zpp_pool,tp.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0;break}_=(s=_).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;this.next=Xi.zpp_pool,(Xi.zpp_pool=this).pre_dt=-1},Xi.prototype.mutable=null,Xi.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!1)},Xi.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!0)},Xi.prototype.inject=function(n,t,e){this.overlap=n,this.centroidx=t,this.centroidy=e},Xi.prototype.pre_dt=null,Xi.prototype.preStep=function(n,t){-1==this.pre_dt&&(this.pre_dt=t);var e=t/this.pre_dt;this.pre_dt=t,this.r1x=this.centroidx-this.b1.posx,this.r1y=this.centroidy-this.b1.posy,this.r2x=this.centroidx-this.b2.posx,this.r2y=this.centroidy-this.b2.posy;var i,p,l,r,o,a=0,s=0,s=this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(a=this.ws1.fluidProperties.gravityx,this.ws1.fluidProperties.gravityy):(a=n.gravityx,n.gravityy),_=0,h=0,h=this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(_=this.ws2.fluidProperties.gravityx,this.ws2.fluidProperties.gravityy):(_=n.gravityx,n.gravityy),u=0,x=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled?(i=this.overlap*this.ws1.fluidProperties.density,(l=this.overlap*this.ws2.fluidProperties.density)<i?(u-=a*(r=i+l),x-=s*r):i<l?(u+=_*(p=i+l),x+=h*p):(r=n=0,n=a+_,r=s+h,n*=.5,r*=.5,this.ws1.worldCOMx*n+this.ws1.worldCOMy*r>this.ws2.worldCOMx*n+this.ws2.worldCOMy*r?(u-=n*(p=i+l),x-=r*p):(u+=n*(l=i+l),x+=r*l))):this.ws1.fluidEnabled?(u-=a*(a=this.overlap*this.ws1.fluidProperties.density),x-=s*a):this.ws2.fluidEnabled&&(u+=_*(o=this.overlap*this.ws2.fluidProperties.density),x+=h*o),u*=t,x*=t,this.buoyx=u,this.buoyy=x,2==this.b1.type&&(o=this.b1.imass,this.b1.velx-=u*o,this.b1.vely-=x*o,this.b1.angvel-=(x*this.r1x-u*this.r1y)*this.b1.iinertia),2==this.b2.type&&(d=this.b2.imass,this.b2.velx+=u*d,this.b2.vely+=x*d,this.b2.angvel+=(x*this.r2x-u*this.r2y)*this.b2.iinertia),this.ws1.fluidEnabled&&0!=this.ws1.fluidProperties.viscosity||this.ws2.fluidEnabled&&0!=this.ws2.fluidProperties.viscosity){this.nodrag=!1;var d=0;this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),d=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area),this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),d+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area),0!=d?(f=this.b1.sinertia+this.b2.sinertia,this.wMass=0!=f?1/f:0,d*=4e-4,z=2*Math.PI*d,this.agamma=1/(t*z*(2+z*t)),m=1/(1+this.agamma),this.agamma*=m,this.wMass*=m):(this.wMass=0,this.agamma=0);x=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel)),u=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));x*x+u*u<jp.epsilon*jp.epsilon||(x*=y=1/Math.sqrt(x*x+u*u),u*=y,this.nx=x,this.ny=u);var y,z,c,v,m,f=0;if(this.ws1.fluidEnabled){var b=-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area;if(0==this.ws2.type)f=0-b*this.ws2.circle.radius*jp.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{for(var g=0,w=0,M=this.ws2.polygon.edges.head;null!=M;){var C=M.elt;g+=C.length;C=b*C.length*(C.gnormx*this.nx+C.gnormy*this.ny);0<C&&(C*=-jp.fluidVacuumDrag),w-=.5*C*jp.fluidLinearDrag,M=M.next}f=w/g}}if(this.ws2.fluidEnabled){var k=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area;if(0==this.ws1.type)f-=k*this.ws1.circle.radius*jp.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{for(var O=0,P=0,S=this.ws1.polygon.edges.head;null!=S;){var A=S.elt;O+=A.length;A=k*A.length*(A.gnormx*this.nx+A.gnormy*this.ny);0<A&&(A*=-jp.fluidVacuumDrag),P-=.5*A*jp.fluidLinearDrag,S=S.next}f+=P/O}}0!=f?(m=z=d=0,m=d=y=this.b1.smass+this.b2.smass,(z=0)!=this.b1.sinertia&&(x=this.r1x*this.b1.sinertia,d=y+(u=this.r1y*this.b1.sinertia)*this.r1y,z+=-u*this.r1x,m=y+x*this.r1x),0!=this.b2.sinertia&&(v=this.r2x*this.b2.sinertia,d+=(c=this.r2y*this.b2.sinertia)*this.r2y,z+=-c*this.r2x,m+=v*this.r2x),(c=d*m-z*z)!=c?d=z=m=0:0==c?(d=0!=d?1/d:0,m=0!=m?1/m:0,z=0):(v=m*(c=1/c),m=d*c,d=v,z*=-c),this.vMassa=d,this.vMassb=z,this.vMassc=m,f=2*Math.PI*f,this.lgamma=1/(t*f*(2+f*t)),t=1/(1+this.lgamma),this.lgamma*=t,this.vMassa*=t,this.vMassb*=t,this.vMassc*=t):(this.vMassa=0,this.vMassb=0,this.vMassc=0,this.lgamma=0)}else this.nodrag=!0,this.dampx=0,this.dampy=0,this.adamp=0;this.dampx*=e,this.dampy*=e,this.adamp*=e},Xi.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.dampx*n,this.b1.vely-=this.dampy*n;n=this.b2.imass;this.b2.velx+=this.dampx*n,this.b2.vely+=this.dampy*n,this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y),this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y),this.b1.angvel-=this.adamp*this.b1.iinertia,this.b2.angvel+=this.adamp*this.b2.iinertia},Xi.prototype.applyImpulseVel=function(){var n,t,e,i,p;this.nodrag||(n=this.b1.angvel+this.b1.kinangvel,p=this.b2.angvel+this.b2.kinangvel,e=this.b1.velx+this.b1.kinvelx-this.r1y*n-(this.b2.velx+this.b2.kinvelx-this.r2y*p),t=this.b1.vely+this.b1.kinvely+this.r1x*n-(this.b2.vely+this.b2.kinvely+this.r2x*p),i=this.vMassa*e+this.vMassb*t,t=this.vMassb*e+this.vMassc*t,e=i,i=this.lgamma,e-=this.dampx*i,t-=this.dampy*i,this.dampx+=e,this.dampy+=t,i=this.b1.imass,this.b1.velx-=e*i,this.b1.vely-=t*i,i=this.b2.imass,this.b2.velx+=e*i,this.b2.vely+=t*i,this.b1.angvel-=this.b1.iinertia*(t*this.r1x-e*this.r1y),this.b2.angvel+=this.b2.iinertia*(t*this.r2x-e*this.r2y),p=(n-p)*this.wMass-this.adamp*this.agamma,this.adamp+=p,this.b1.angvel-=p*this.b1.iinertia,this.b2.angvel+=p*this.b2.iinertia)},Xi.prototype.__class__=Xi;var Hi=zpp_nape.dynamics.ZPP_ColArbiter=function(){this.pre_dt=0,this.mutable=!1,this.stat=!1,this.next=null,this.hpc2=!1,this.hc2=!1,this.oc2=null,this.c2=null,this.oc1=null,this.c1=null,this.__ref_vertex=0,this.__ref_edge2=null,this.__ref_edge1=null,this.biasCoef=0,this.rev=!1,this.radius=0,this.lproj=0,this.lnormy=0,this.lnormx=0,this.surfacey=0,this.surfacex=0,this.k2y=0,this.k2x=0,this.k1y=0,this.k1x=0,this.rt2b=0,this.rn2b=0,this.rt2a=0,this.rn2a=0,this.rt1b=0,this.rn1b=0,this.rt1a=0,this.rn1a=0,this.jrAcc=0,this.rMass=0,this.Kc=0,this.Kb=0,this.Ka=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_normal=null,this.ny=0,this.nx=0,this.innards=null,this.wrap_contacts=null,this.contacts=null,this.s2=null,this.s1=null,this.userdef_rfric=!1,this.userdef_restitution=!1,this.userdef_stat_fric=!1,this.userdef_dyn_fric=!1,this.rfric=0,this.restitution=0,this.stat_fric=0,this.dyn_fric=0,this.outer_zn=null,Qt.call(this),this.pre_dt=-1,this.contacts=new $i,this.innards=new at,this.type=Qt.COL,this.colarb=this};Hi.__name__=["zpp_nape","dynamics","ZPP_ColArbiter"],Hi.__super__=Qt,Hi.prototype=Object.create(Qt.prototype),Hi.prototype.outer_zn=null,Hi.prototype.dyn_fric=null,Hi.prototype.stat_fric=null,Hi.prototype.restitution=null,Hi.prototype.rfric=null,Hi.prototype.userdef_dyn_fric=null,Hi.prototype.userdef_stat_fric=null,Hi.prototype.userdef_restitution=null,Hi.prototype.userdef_rfric=null,Hi.prototype.s1=null,Hi.prototype.s2=null,Hi.prototype.contacts=null,Hi.prototype.wrap_contacts=null,Hi.prototype.innards=null,Hi.prototype.nx=null,Hi.prototype.ny=null,Hi.prototype.normal_validate=function(){if(this.cleared)throw new p("Error: Arbiter not currently in use");this.wrap_normal.zpp_inner.x=this.nx,this.wrap_normal.zpp_inner.y=this.ny,this.ws1.id>this.ws2.id&&(this.wrap_normal.zpp_inner.x=-this.wrap_normal.zpp_inner.x,this.wrap_normal.zpp_inner.y=-this.wrap_normal.zpp_inner.y)},Hi.prototype.wrap_normal=null,Hi.prototype.getnormal=function(){var n,t,e;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),0==n.zpp_inner.x&&(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=!1,this.wrap_normal=n,this.wrap_normal.zpp_inner._immutable=!0,this.wrap_normal.zpp_inner._inuse=!0,this.wrap_normal.zpp_inner._validate=X(this,this.normal_validate)},Hi.prototype.kMassa=null,Hi.prototype.kMassb=null,Hi.prototype.kMassc=null,Hi.prototype.Ka=null,Hi.prototype.Kb=null,Hi.prototype.Kc=null,Hi.prototype.rMass=null,Hi.prototype.jrAcc=null,Hi.prototype.rn1a=null,Hi.prototype.rt1a=null,Hi.prototype.rn1b=null,Hi.prototype.rt1b=null,Hi.prototype.rn2a=null,Hi.prototype.rt2a=null,Hi.prototype.rn2b=null,Hi.prototype.rt2b=null,Hi.prototype.k1x=null,Hi.prototype.k1y=null,Hi.prototype.k2x=null,Hi.prototype.k2y=null,Hi.prototype.surfacex=null,Hi.prototype.surfacey=null,Hi.prototype.ptype=null,Hi.prototype.lnormx=null,Hi.prototype.lnormy=null,Hi.prototype.lproj=null,Hi.prototype.radius=null,Hi.prototype.rev=null,Hi.prototype.biasCoef=null,Hi.prototype.__ref_edge1=null,Hi.prototype.__ref_edge2=null,Hi.prototype.__ref_vertex=null,Hi.prototype.c1=null,Hi.prototype.oc1=null,Hi.prototype.c2=null,Hi.prototype.oc2=null,Hi.prototype.hc2=null,Hi.prototype.hpc2=null,Hi.prototype.next=null,Hi.prototype.alloc=function(){},Hi.prototype.free=function(){this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null},Hi.prototype.stat=null,Hi.prototype.injectContact=function(n,t,e,i,p,l,r){null==r&&(r=!1);for(var o,a,s,_=null,h=this.contacts.next;null!=h;){if(l==h.hash){_=h;break}h=h.next}return null==_?(null==$i.zpp_pool?_=new $i:(_=$i.zpp_pool,$i.zpp_pool=_.next,_.next=null),(o=_.inner).jnAcc=o.jtAcc=0,_.hash=l,_.fresh=!0,(_.arbiter=this).jrAcc=0,a=this.contacts,_._inuse=!0,(s=_).next=a.next,a.next=s,a.modified=!0,a.length++,this.innards.add(o)):_.fresh=!1,_.px=n,_.py=t,this.nx=e,this.ny=i,_.dist=p,_.stamp=this.stamp,_.posOnly=r,_},Hi.prototype.assign=function(n,t,e,i){this.b1=n.body,this.ws1=n,this.b2=t.body,this.ws2=t,this.id=e,this.di=i;i=this.b1.arbiters;null==tp.zpp_pool?p=new tp:(p=tp.zpp_pool,tp.zpp_pool=p.next,p.next=null),p.elt=this;var p=p;p.next=i.head,i.head=p,i.modified=!0,i.length++;i=this.b2.arbiters;null==tp.zpp_pool?l=new tp:(l=tp.zpp_pool,tp.zpp_pool=l.next,l.next=null),l.elt=this;var l=l;l.next=i.head,i.head=l,i.modified=!0,i.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.s1=n,this.s2=t,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},Hi.prototype.calcProperties=function(){this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},Hi.prototype.validate_props=function(){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)))},Hi.prototype.retire=function(){if(!this.cleared){for(var n,t,e=this.b1.arbiters,i=null,p=e.head;null!=p;){if(p.elt==this){null==i?(t=(n=e.head).next,e.head=t,null==e.head&&(e.pushmod=!0)):(t=(n=i.next).next,null==(i.next=t)&&(e.pushmod=!0));var l=n;l.elt=null,l.next=tp.zpp_pool,tp.zpp_pool=l,e.modified=!0,e.length--,e.pushmod=!0;break}p=(i=p).next}for(var r,o,a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){null==s?(o=(r=a.head).next,a.head=o,null==a.head&&(a.pushmod=!0)):(o=(r=s.next).next,null==(s.next=o)&&(a.pushmod=!0));var h=r;h.elt=null,h.next=tp.zpp_pool,tp.zpp_pool=h,a.modified=!0,a.length--,a.pushmod=!0;break}_=(s=_).next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}for(this.b1=this.b2=null,this.active=!1,this.intchange=!1;null!=this.contacts.next;){var u=this.contacts,x=u.next;u.pop(),x.arbiter=null,x.next=$i.zpp_pool,$i.zpp_pool=x;u=this.innards,x=u.next;u.next=x.next,x._inuse=!1,null==u.next&&(u.pushmod=!0),u.modified=!0,u.length--}this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null,this.next=Hi.zpp_pool,(Hi.zpp_pool=this).pre_dt=-1},Hi.prototype.mutable=null,Hi.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!1),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!1)},Hi.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!0),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!0)},Hi.prototype.contacts_adder=function(n){return!1},Hi.prototype.contacts_subber=function(n){for(var t=null,e=null,i=this.innards.next,p=this.contacts.next;null!=p;){var l=p;if(l==n.zpp_inner){this.contacts.erase(t),this.innards.erase(e),l.arbiter=null,l.next=$i.zpp_pool,$i.zpp_pool=l;break}t=p,i=(e=i).next,p=p.next}},Hi.prototype.setupcontacts=function(){this.wrap_contacts=Li.get(this.contacts,!0),this.wrap_contacts.zpp_inner.immutable=!this.mutable,this.wrap_contacts.zpp_inner.adder=X(this,this.contacts_adder),this.wrap_contacts.zpp_inner.dontremove=!0,this.wrap_contacts.zpp_inner.subber=X(this,this.contacts_subber)},Hi.prototype.cleanupContacts=function(){var n=!0,t=null,e=null,i=this.innards.next;this.hc2=!1;for(var p,l=this.contacts.next;null!=l;){var r,o,a,s,_,h,u=l;u.stamp+jp.arbiterExpirationDelay<this.stamp?(_=this.contacts,null==t?(o=(r=_.next).next,_.next=o,null==_.next&&(_.pushmod=!0)):(o=(r=t.next).next,null==(t.next=o)&&(_.pushmod=!0)),r._inuse=!1,_.modified=!0,_.length--,_.pushmod=!0,l=o,h=this.innards,null==e?(s=(a=h.next).next,h.next=s,null==h.next&&(h.pushmod=!0)):(s=(a=e.next).next,null==(e.next=s)&&(h.pushmod=!0)),a._inuse=!1,h.modified=!0,h.length--,h.pushmod=!0,i=s,u.arbiter=null,u.next=$i.zpp_pool,$i.zpp_pool=u):(_=u.inner,h=u.active,u.active=u.stamp==this.stamp,u.active&&(n?(n=!1,this.c1=_,this.oc1=u):(this.hc2=!0,this.c2=_,this.oc2=u)),h!=u.active&&(this.contacts.modified=!0),t=l,i=(e=i).next,l=l.next)}return this.hc2?(this.hpc2=!0,this.oc1.posOnly?(p=this.c1,this.c1=this.c2,this.c2=p,p=this.oc1,this.oc1=this.oc2,this.oc2=p,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(n=!0)):this.hpc2=!1,n},Hi.prototype.pre_dt=null,Hi.prototype.preStep=function(n){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))),-1==this.pre_dt&&(this.pre_dt=n);var t=n/this.pre_dt;this.pre_dt=n;var e=this.b1.smass+this.b2.smass,i=!(this.hc2=!1);this.biasCoef=2!=this.b1.type||2!=this.b2.type?this.continuous?jp.contactContinuousStaticBiasCoef:jp.contactStaticBiasCoef:this.continuous?jp.contactContinuousBiasCoef:jp.contactBiasCoef,this.continuous=!1;for(var p,l,r=null,o=null,a=this.innards.next,s=this.contacts.next;null!=s;){var _,h,u,x,d,y,z,c,v,m=s;m.stamp+jp.arbiterExpirationDelay<this.stamp?(z=this.contacts,null==r?(h=(_=z.next).next,z.next=h,null==z.next&&(z.pushmod=!0)):(h=(_=r.next).next,null==(r.next=h)&&(z.pushmod=!0)),_._inuse=!1,z.modified=!0,z.length--,z.pushmod=!0,s=h,c=this.innards,null==o?(x=(u=c.next).next,c.next=x,null==c.next&&(c.pushmod=!0)):(x=(u=o.next).next,null==(o.next=x)&&(c.pushmod=!0)),u._inuse=!1,c.modified=!0,c.length--,c.pushmod=!0,a=x,m.arbiter=null,m.next=$i.zpp_pool,$i.zpp_pool=m):(d=m.inner,y=m.active,m.active=m.stamp==this.stamp,m.active&&(i?(i=!1,this.c1=d,this.oc1=m):(this.hc2=!0,this.c2=d,this.oc2=m),d.r2x=m.px-this.b2.posx,d.r2y=m.py-this.b2.posy,d.r1x=m.px-this.b1.posx,d.r1y=m.py-this.b1.posy,v=d.r2x*this.nx+d.r2y*this.ny,z=e+this.b2.sinertia*(v*v),c=d.r1x*this.nx+d.r1y*this.ny,z+=this.b1.sinertia*(c*c),d.tMass=z<jp.epsilon*jp.epsilon?0:1/z,v=this.ny*d.r2x-this.nx*d.r2y,c=e+this.b2.sinertia*(v*v),z=this.ny*d.r1x-this.nx*d.r1y,c+=this.b1.sinertia*(z*z),d.nMass=c<jp.epsilon*jp.epsilon?0:1/c,z=v=0,c=this.b2.angvel+this.b2.kinangvel,v=this.b2.velx+this.b2.kinvelx-d.r2y*c,z=this.b2.vely+this.b2.kinvely+d.r2x*c,c=this.b1.angvel+this.b1.kinangvel,v-=this.b1.velx+this.b1.kinvelx-d.r1y*c,z-=this.b1.vely+this.b1.kinvely+d.r1x*c,c=this.nx*v+this.ny*z,m.elasticity=this.restitution,d.bounce=c*m.elasticity,d.bounce>-jp.elasticThreshold&&(d.bounce=0),c=z*this.nx-v*this.ny,v=jp.staticFrictionThreshold,d.friction=v*v<c*c?this.dyn_fric:this.stat_fric,d.jnAcc*=t,d.jtAcc*=t),y!=m.active&&(this.contacts.modified=!0),r=s,a=(o=a).next,s=s.next)}return this.hc2?(this.hpc2=!0,this.oc1.posOnly?(p=this.c1,this.c1=this.c2,this.c2=p,p=this.oc1,this.oc1=this.oc2,this.oc2=p,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(i=!0)):this.hpc2=!1,this.jrAcc*=t,i||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel)),this.hc2&&(this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=e+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=e+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=e+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b,this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc<jp.illConditionedThreshold*(this.kMassa*this.kMassc-this.kMassb*this.kMassb)?(this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc,(l=this.kMassa*this.kMassc-this.kMassb*this.kMassb)!=l?this.kMassa=this.kMassb=this.kMassc=0:0==l?(0!=this.kMassa?this.kMassa=1/this.kMassa:this.kMassa=0,0!=this.kMassc?this.kMassc=1/this.kMassc:this.kMassc=0,this.kMassb=0):(l=1/l,p=this.kMassc*l,this.kMassc=this.kMassa*l,this.kMassa=p,this.kMassb*=-l)):(this.hc2=!1,this.oc2.dist<this.oc1.dist&&(l=this.c1,this.c1=this.c2,this.c2=l),this.oc2.active=!1,this.contacts.modified=!0)),this.surfacex=this.b2.svelx,this.surfacey=this.b2.svely,this.surfacex+=this.b1.svelx,this.surfacey+=this.b1.svely,this.surfacex=-this.surfacex,this.surfacey=-this.surfacey,this.rMass=this.b1.sinertia+this.b2.sinertia,0!=this.rMass&&(this.rMass=1/this.rMass),i},Hi.prototype.warmStart=function(){var n=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,t=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,e=this.b1.imass;this.b1.velx-=n*e,this.b1.vely-=t*e,this.b1.angvel-=this.b1.iinertia*(t*this.c1.r1x-n*this.c1.r1y);e=this.b2.imass;this.b2.velx+=n*e,this.b2.vely+=t*e,this.b2.angvel+=this.b2.iinertia*(t*this.c1.r2x-n*this.c1.r2y),this.hc2&&(e=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,t=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,n=this.b1.imass,this.b1.velx-=e*n,this.b1.vely-=t*n,this.b1.angvel-=this.b1.iinertia*(t*this.c2.r1x-e*this.c2.r1y),n=this.b2.imass,this.b2.velx+=e*n,this.b2.vely+=t*n,this.b2.angvel+=this.b2.iinertia*(t*this.c2.r2x-e*this.c2.r2y)),this.b2.angvel+=this.jrAcc*this.b2.iinertia,this.b1.angvel-=this.jrAcc*this.b1.iinertia},Hi.prototype.applyImpulseVel=function(){var n,t,e,i,p,l,r,o,a,s,_,h,u=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),x=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);e=(x*this.nx-u*this.ny+this.surfacex)*this.c1.tMass,(i=this.c1.friction*this.c1.jnAcc)<(l=(p=this.c1.jtAcc)-e)?l=i:l<-i&&(l=-i),e=l-p,this.c1.jtAcc=l,n=-this.ny*e,t=this.nx*e,this.b2.velx+=n*this.b2.imass,this.b2.vely+=t*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=t*this.b1.imass,this.b2.angvel+=this.rt1b*e*this.b2.iinertia,this.b1.angvel-=this.rt1a*e*this.b1.iinertia,this.hc2?(_=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),e=((h=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel))*this.nx-_*this.ny+this.surfacex)*this.c2.tMass,(i=this.c2.friction*this.c2.jnAcc)<(l=(p=this.c2.jtAcc)-e)?l=i:l<-i&&(l=-i),e=l-p,this.c2.jtAcc=l,n=-this.ny*e,t=this.nx*e,this.b2.velx+=n*this.b2.imass,this.b2.vely+=t*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=t*this.b1.imass,this.b2.angvel+=this.rt2b*e*this.b2.iinertia,this.b1.angvel-=this.rt2a*e*this.b1.iinertia,u=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),x=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),_=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),h=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),r=this.c1.jnAcc,o=this.c2.jnAcc,a=u*this.nx+x*this.ny+this.surfacey+this.c1.bounce-(this.Ka*r+this.Kb*o),s=_*this.nx+h*this.ny+this.surfacey+this.c2.bounce-(this.Kb*r+this.Kc*o),_=-(this.kMassa*a+this.kMassb*s),h=-(this.kMassb*a+this.kMassc*s),0<=_&&0<=h?(a=_-r,s=h-o,this.c1.jnAcc=_,this.c2.jnAcc=h):0<=(_=-this.c1.nMass*a)&&0<=this.Kb*_+s?(a=_-r,s=-o,this.c1.jnAcc=_,this.c2.jnAcc=0):0<=(h=-this.c2.nMass*s)&&0<=this.Kb*h+a?(a=-r,s=h-o,this.c1.jnAcc=0,this.c2.jnAcc=h):0<=a&&0<=s?(a=-r,s=-o,this.c1.jnAcc=this.c2.jnAcc=0):s=a=0,e=a+s,n=this.nx*e,t=this.ny*e,this.b2.velx+=n*this.b2.imass,this.b2.vely+=t*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=t*this.b1.imass,this.b2.angvel+=(this.rn1b*a+this.rn2b*s)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*a+this.rn2a*s)*this.b1.iinertia):(0!=this.radius&&(e=(this.b2.angvel-this.b1.angvel)*this.rMass,i=this.rfric*this.c1.jnAcc,p=this.jrAcc,this.jrAcc-=e,this.jrAcc>i?this.jrAcc=i:this.jrAcc<-i&&(this.jrAcc=-i),e=this.jrAcc-p,this.b2.angvel+=e*this.b2.iinertia,this.b1.angvel-=e*this.b1.iinertia),u=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),x=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),e=(this.c1.bounce+(this.nx*u+this.ny*x)+this.surfacey)*this.c1.nMass,(l=(p=this.c1.jnAcc)-e)<0&&(l=0),e=l-p,this.c1.jnAcc=l,n=this.nx*e,t=this.ny*e,this.b2.velx+=n*this.b2.imass,this.b2.vely+=t*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=t*this.b1.imass,this.b2.angvel+=this.rn1b*e*this.b2.iinertia,this.b1.angvel-=this.rn1a*e*this.b1.iinertia)},Hi.prototype.applyImpulsePos=function(){if(2==this.ptype){var n=this.c1,t=0,e=0;t=this.b2.axisy*n.lr2x-this.b2.axisx*n.lr2y,e=n.lr2x*this.b2.axisx+n.lr2y*this.b2.axisy,t+=this.b2.posx,e+=this.b2.posy;var i=0,p=0;i=this.b1.axisy*n.lr1x-this.b1.axisx*n.lr1y,p=n.lr1x*this.b1.axisx+n.lr1y*this.b1.axisy;var l=0,r=0,l=t-(i+=this.b1.posx),r=e-(p+=this.b1.posy),o=Math.sqrt(l*l+r*r),a=this.radius-jp.collisionSlop,n=o-a;l*this.nx+r*this.ny<0&&(l=-l,r=-r,n-=this.radius),n<0&&(o<jp.epsilon?0!=this.b1.smass?this.b1.posx+=10*jp.epsilon:this.b2.posx+=10*jp.epsilon:(l*=n=1/o,u=.5*(p+e),a=o-a,p=(r*=n)*(i=(n=.5*(i+t))-this.b1.posx)-l*(p=u-this.b1.posy),u=r*(t=n-this.b2.posx)-l*(e=u-this.b2.posy),0!=(e=this.b2.smass+u*u*this.b2.sinertia+this.b1.smass+p*p*this.b1.sinertia)&&(z=v=0,v=l*(x=-this.biasCoef*a/e),z=r*x,a=this.b1.imass,this.b1.posx-=v*a,this.b1.posy-=z*a,e=this.b1,r=-p*this.b1.iinertia*x,e.rot+=r,1e-4<r*r?(e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)):(a=1-(h=r*r)*h/8,h=((p=1-.5*h)*e.axisx+r*e.axisy)*a,e.axisy=(p*e.axisy-r*e.axisx)*a,e.axisx=h),h=this.b2.imass,this.b2.posx+=v*h,this.b2.posy+=z*h,v=this.b2,z=u*this.b2.iinertia*x,v.rot+=z,1e-4<z*z?(v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)):(c=1-(d=z*z)*d/8,m=((y=1-.5*d)*v.axisx+z*v.axisy)*c,v.axisy=(y*v.axisy-z*v.axisx)*c,v.axisx=m))))}else{var s=0,_=0,h=0,u=0,x=0,d=0;0==this.ptype?(s=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,_=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,f=this.lproj+(s*this.b1.posx+_*this.b1.posy),h=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,u=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy,h+=this.b2.posx,u+=this.b2.posy,this.hpc2&&(x=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,d=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy,x+=this.b2.posx,d+=this.b2.posy)):(s=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,_=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,f=this.lproj+(s*this.b2.posx+_*this.b2.posy),h=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,u=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy,h+=this.b1.posx,u+=this.b1.posy,this.hpc2&&(x=this.b1.axisy*this.c2.lr1x-this.b1.axisx*this.c2.lr1y,d=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy,x+=this.b1.posx,d+=this.b1.posy));var y=h*s+u*_-f-this.radius;y+=jp.collisionSlop;var z=0;if(this.hpc2&&(z=x*s+d*_-f-this.radius,z+=jp.collisionSlop),y<0||z<0){this.rev&&(s=-s,_=-_);var c=0,v=0,c=h-this.b1.posx,v=u-this.b1.posy,m=0,f=0,m=h-this.b2.posx,f=u-this.b2.posy;if(this.hpc2){var b=_*c-s*v,g=_*m-s*f,w=_*(x-this.b1.posx)-s*(d-this.b1.posy),M=_*(x-this.b2.posx)-s*(d-this.b2.posy),C=this.b1.smass+this.b2.smass;this.kMassa=C+this.b1.sinertia*b*b+this.b2.sinertia*g*g,this.kMassb=C+this.b1.sinertia*b*w+this.b2.sinertia*g*M,this.kMassc=C+this.b1.sinertia*w*w+this.b2.sinertia*M*M;for(var k=this.kMassa,O=this.kMassb,P=this.kMassc,S=y*this.biasCoef,A=z*this.biasCoef;;){var j=0,E=0;j=-(j=S),E=-(E=A);var I=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(I!=I?j=E=0:0==I?(0!=this.kMassa?j/=this.kMassa:j=0,0!=this.kMassc?E/=this.kMassc:E=0):(N=(I=1/I)*(this.kMassc*j-this.kMassb*E),E=I*(this.kMassa*E-this.kMassb*j),j=N),0<=j&&0<=E){var T=(j+E)*this.b1.imass;this.b1.posx-=s*T,this.b1.posy-=_*T;var I=this.b1,N=-this.b1.iinertia*(b*j+w*E);I.rot+=N,1e-4<N*N?(I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot)):(V=1-(L=N*N)*L/8,L=((T=1-.5*L)*I.axisx+N*I.axisy)*V,I.axisy=(T*I.axisy-N*I.axisx)*V,I.axisx=L);N=(j+E)*this.b2.imass;this.b2.posx+=s*N,this.b2.posy+=_*N;var L,V=this.b2,I=this.b2.iinertia*(g*j+M*E);V.rot+=I,1e-4<I*I?(V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot)):(L=1-(F=I*I)*F/8,F=((N=1-.5*F)*V.axisx+I*V.axisy)*L,V.axisy=(N*V.axisy-I*V.axisx)*L,V.axisx=F);break}if((E=0)<=(j=-S/k)&&0<=O*j+A){V=(j+E)*this.b1.imass;this.b1.posx-=s*V,this.b1.posy-=_*V;var D=this.b1,F=-this.b1.iinertia*(b*j+w*E);D.rot+=F,1e-4<F*F?(D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)):(R=1-(Z=F*F)*Z/8,Z=((V=1-.5*Z)*D.axisx+F*D.axisy)*R,D.axisy=(V*D.axisy-F*D.axisx)*R,D.axisx=Z);var R=(j+E)*this.b2.imass;this.b2.posx+=s*R,this.b2.posy+=_*R;var D=this.b2,Z=this.b2.iinertia*(g*j+M*E);D.rot+=Z,1e-4<Z*Z?(D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)):(B=1-(G=Z*Z)*G/8,G=((R=1-.5*G)*D.axisx+Z*D.axisy)*B,D.axisy=(R*D.axisy-Z*D.axisx)*B,D.axisx=G);break}if((j=0)<=(E=-A/P)&&0<=O*E+S){var B=(j+E)*this.b1.imass;this.b1.posx-=s*B,this.b1.posy-=_*B;var D=this.b1,G=-this.b1.iinertia*(b*j+w*E);D.rot+=G,1e-4<G*G?(D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)):(q=1-(U=G*G)*U/8,U=((B=1-.5*U)*D.axisx+G*D.axisy)*q,D.axisy=(B*D.axisy-G*D.axisx)*q,D.axisx=U);var q=(j+E)*this.b2.imass;this.b2.posx+=s*q,this.b2.posy+=_*q;var D=this.b2,U=this.b2.iinertia*(g*j+M*E);D.rot+=U,1e-4<U*U?(D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)):(j=1-(q=U*U)*q/8,q=((E=1-.5*q)*D.axisx+U*D.axisy)*j,D.axisy=(E*D.axisy-U*D.axisx)*j,D.axisx=q);break}break}}else{var K,d=_*c-s*v,C=_*m-s*f,z=this.b2.smass+C*C*this.b2.sinertia+this.b1.smass+d*d*this.b1.sinertia;0!=z&&(v=c=0,c=s*(m=-this.biasCoef*y/z),v=_*m,f=this.b1.imass,this.b1.posx-=c*f,this.b1.posy-=v*f,y=this.b1,z=-d*this.b1.iinertia*m,y.rot+=z,1e-4<z*z?(y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)):(f=1-(K=z*z)*K/8,K=((d=1-.5*K)*y.axisx+z*y.axisy)*f,y.axisy=(d*y.axisy-z*y.axisx)*f,y.axisx=K),K=this.b2.imass,this.b2.posx+=c*K,this.b2.posy+=v*K,c=this.b2,v=C*this.b2.iinertia*m,c.rot+=v,1e-4<v*v?(c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)):(C=1-(K=v*v)*K/8,K=((m=1-.5*K)*c.axisx+v*c.axisy)*C,c.axisy=(m*c.axisy-v*c.axisx)*C,c.axisx=K))}}}},Hi.prototype.__class__=Hi;var $i=zpp_nape.dynamics.ZPP_Contact=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.elasticity=0,this.dist=0,this.fresh=!1,this.hash=0,this.stamp=0,this.posOnly=!1,this.active=!1,this.inner=null,this.arbiter=null,this.wrap_position=null,this.py=0,this.px=0,this.outer=null,this.inner=new at};$i.__name__=["zpp_nape","dynamics","ZPP_Contact"],$i.prototype.outer=null,$i.prototype.wrapper=function(){return null==this.outer&&($i.internal=!0,this.outer=new T,$i.internal=!1,this.outer.zpp_inner=this),this.outer},$i.prototype.px=null,$i.prototype.py=null,$i.prototype.position_validate=function(){this.wrap_position.zpp_inner.x=this.px,this.wrap_position.zpp_inner.y=this.py},$i.prototype.wrap_position=null,$i.prototype.getposition=function(){var n,t,e;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),0==n.zpp_inner.x&&(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!0,this.wrap_position.zpp_inner._validate=X(this,this.position_validate)},$i.prototype.inactiveme=function(){return!(this.active&&null!=this.arbiter&&this.arbiter.active)},$i.prototype.arbiter=null,$i.prototype.inner=null,$i.prototype.active=null,$i.prototype.posOnly=null,$i.prototype.stamp=null,$i.prototype.hash=null,$i.prototype.fresh=null,$i.prototype.dist=null,$i.prototype.elasticity=null,$i.prototype.free=function(){this.arbiter=null},$i.prototype.alloc=function(){},$i.prototype.next=null,$i.prototype.elem=function(){return this},$i.prototype.begin=function(){return this.next},$i.prototype._inuse=null,$i.prototype.modified=null,$i.prototype.pushmod=null,$i.prototype.length=null,$i.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},$i.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},$i.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},$i.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},$i.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},$i.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},$i.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},$i.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},$i.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},$i.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},$i.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},$i.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},$i.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},$i.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},$i.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},$i.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},$i.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},$i.prototype.clear=function(){},$i.prototype.inlined_clear=function(){},$i.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},$i.prototype.empty=function(){return null==this.next},$i.prototype.size=function(){return this.length},$i.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},$i.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},$i.prototype.front=function(){return this.next},$i.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},$i.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},$i.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n:null},$i.prototype.__class__=$i;var at=zpp_nape.dynamics.ZPP_IContact=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.lr2y=0,this.lr2x=0,this.lr1y=0,this.lr1x=0,this.jtAcc=0,this.jnAcc=0,this.friction=0,this.bounce=0,this.tMass=0,this.nMass=0,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0};at.__name__=["zpp_nape","dynamics","ZPP_IContact"],at.prototype.r1x=null,at.prototype.r1y=null,at.prototype.r2x=null,at.prototype.r2y=null,at.prototype.nMass=null,at.prototype.tMass=null,at.prototype.bounce=null,at.prototype.friction=null,at.prototype.jnAcc=null,at.prototype.jtAcc=null,at.prototype.lr1x=null,at.prototype.lr1y=null,at.prototype.lr2x=null,at.prototype.lr2y=null,at.prototype.next=null,at.prototype.elem=function(){return this},at.prototype.begin=function(){return this.next},at.prototype._inuse=null,at.prototype.modified=null,at.prototype.pushmod=null,at.prototype.length=null,at.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},at.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},at.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},at.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},at.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},at.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},at.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},at.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},at.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},at.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},at.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},at.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},at.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},at.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},at.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},at.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},at.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},at.prototype.clear=function(){},at.prototype.inlined_clear=function(){},at.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},at.prototype.empty=function(){return null==this.next},at.prototype.size=function(){return this.length},at.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},at.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},at.prototype.front=function(){return this.next},at.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},at.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},at.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n:null},at.prototype.__class__=at;var st=zpp_nape.dynamics.ZPP_InteractionFilter=function(){this.fluidMask=0,this.fluidGroup=0,this.sensorMask=0,this.sensorGroup=0,this.collisionMask=0,this.collisionGroup=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ue,this.collisionGroup=this.sensorGroup=this.fluidGroup=1,this.collisionMask=this.sensorMask=this.fluidMask=-1};st.__name__=["zpp_nape","dynamics","ZPP_InteractionFilter"],st.prototype.next=null,st.prototype.userData=null,st.prototype.outer=null,st.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new V,(n=this.outer.zpp_inner).outer=null,n.next=st.zpp_pool,st.zpp_pool=n,this.outer.zpp_inner=this),this.outer},st.prototype.free=function(){this.outer=null},st.prototype.alloc=function(){},st.prototype.shapes=null,st.prototype.wrap_shapes=null,st.prototype.feature_cons=function(){this.shapes=new ue},st.prototype.addShape=function(n){this.shapes.add(n)},st.prototype.remShape=function(n){this.shapes.remove(n)},st.prototype.copy=function(){var n;return null==st.zpp_pool?n=new st:(n=st.zpp_pool,st.zpp_pool=n.next,n.next=null),n.collisionGroup=this.collisionGroup,n.collisionMask=this.collisionMask,n.sensorGroup=this.sensorGroup,n.sensorMask=this.sensorMask,n.fluidGroup=this.fluidGroup,n.fluidMask=this.fluidMask,n},st.prototype.collisionGroup=null,st.prototype.collisionMask=null,st.prototype.shouldCollide=function(n){return 0!=(this.collisionMask&n.collisionGroup)&&0!=(n.collisionMask&this.collisionGroup)},st.prototype.sensorGroup=null,st.prototype.sensorMask=null,st.prototype.shouldSense=function(n){return 0!=(this.sensorMask&n.sensorGroup)&&0!=(n.sensorMask&this.sensorGroup)},st.prototype.fluidGroup=null,st.prototype.fluidMask=null,st.prototype.shouldFlow=function(n){return 0!=(this.fluidMask&n.fluidGroup)&&0!=(n.fluidMask&this.fluidGroup)},st.prototype.invalidate=function(){for(var n=this.shapes.head;null!=n;)n.elt.invalidate_filter(),n=n.next},st.prototype.__class__=st;var _t=zpp_nape.dynamics.ZPP_InteractionGroup=function(){this.depth=0,this.wrap_interactors=null,this.interactors=null,this.wrap_groups=null,this.groups=null,this.group=null,this.ignore=!1,this.outer=null,this.depth=0,this.groups=new De,this.interactors=new On};_t.__name__=["zpp_nape","dynamics","ZPP_InteractionGroup"],_t.prototype.outer=null,_t.prototype.ignore=null,_t.prototype.group=null,_t.prototype.setGroup=function(n){this.group!=n&&(null!=this.group&&(this.group.groups.remove(this),this.depth=0,this.group.invalidate(!0)),null!=(this.group=n)?(n.groups.add(this),this.depth=n.depth+1,n.invalidate(!0)):this.invalidate(!0))},_t.prototype.groups=null,_t.prototype.wrap_groups=null,_t.prototype.interactors=null,_t.prototype.wrap_interactors=null,_t.prototype.depth=null,_t.prototype.invalidate=function(n){if(null==n&&(n=!1),n||this.ignore){for(var t=this.interactors.head;null!=t;){var e=t.elt;(null!=e.ibody?e.ibody:null!=e.ishape?e.ishape.body:e.icompound).wake(),t=t.next}for(var i=this.groups.head;null!=i;)i.elt.invalidate(n),i=i.next}},_t.prototype.addGroup=function(n){this.groups.add(n),n.depth=this.depth+1},_t.prototype.remGroup=function(n){this.groups.remove(n),n.depth=0},_t.prototype.addInteractor=function(n){this.interactors.add(n)},_t.prototype.remInteractor=function(n,t){null==t&&(t=-1),this.interactors.remove(n)},_t.prototype.__class__=_t;var ht=zpp_nape.dynamics.ZPP_SpaceArbiterList=function(){this.at_index_3=0,this.at_index_2=0,this.at_index_1=0,this.at_index_0=0,this.ite_3=null,this.ite_2=null,this.ite_1=null,this.ite_0=null,this.lengths=null,this.zip_length=!1,this._length=0,this.space=null,j.call(this),this.at_index_0=0,this.at_index_1=0,this.at_index_2=0,this.at_index_3=0,this.zip_length=!0,this._length=0,this.lengths=[];for(var n=0;n<4;)++n,this.lengths.push(0)};ht.__name__=["zpp_nape","dynamics","ZPP_SpaceArbiterList"],ht.__super__=j,ht.prototype=Object.create(j.prototype),ht.prototype.space=null,ht.prototype._length=null,ht.prototype.zip_length=null,ht.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){for(var n=this._length=0,t=this.space.c_arbiters_true.head;null!=t;)t.elt.active&&++n,t=t.next;this.lengths[0]=n,this._length+=n;for(var e=0,i=this.space.c_arbiters_false.head;null!=i;)i.elt.active&&++e,i=i.next;this.lengths[1]=e,this._length+=e;for(var p=0,l=this.space.f_arbiters.head;null!=l;)l.elt.active&&++p,l=l.next;this.lengths[2]=p,this._length+=p;for(var r=0,o=this.space.s_arbiters.head;null!=o;)o.elt.active&&++r,o=o.next;this.lengths[3]=r,this._length+=r,this.zip_length=!1}return this._length},ht.prototype.lengths=null,ht.prototype.ite_0=null,ht.prototype.ite_1=null,ht.prototype.ite_2=null,ht.prototype.ite_3=null,ht.prototype.at_index_0=null,ht.prototype.at_index_1=null,ht.prototype.at_index_2=null,ht.prototype.at_index_3=null,ht.prototype.zpp_vm=function(){var n=!1;this.space.c_arbiters_true.modified&&(n=!0,this.space.c_arbiters_true.modified=!1),this.space.c_arbiters_false.modified&&(n=!0,this.space.c_arbiters_false.modified=!1),this.space.f_arbiters.modified&&(n=!0,this.space.f_arbiters.modified=!1),this.space.s_arbiters.modified&&(n=!0,this.space.s_arbiters.modified=!1),n&&(this.zip_length=!0,this._length=0,this.ite_0=null,this.ite_1=null,this.ite_2=null,this.ite_3=null)},ht.prototype.push=function(n){return!1},ht.prototype.pop=function(){return null},ht.prototype.unshift=function(n){return!1},ht.prototype.shift=function(){return null},ht.prototype.remove=function(n){return!1},ht.prototype.clear=function(){},ht.prototype.at=function(n){this.zpp_vm();var t=null,e=0;if(null==t)if(n<this.lengths[0]){var i=n;if(i<this.at_index_0||null==this.ite_0)for(this.at_index_0=0,this.ite_0=this.space.c_arbiters_true.head;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;for(;this.at_index_0!=i;)for(this.at_index_0++,this.ite_0=this.ite_0.next;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;t=this.ite_0.elt.wrapper()}else e=this.lengths[0];if(null==t)if(n<e+this.lengths[1]){var p=n-e;if(p<this.at_index_1||null==this.ite_1)for(this.at_index_1=0,this.ite_1=this.space.c_arbiters_false.head;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;for(;this.at_index_1!=p;)for(this.at_index_1++,this.ite_1=this.ite_1.next;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;t=this.ite_1.elt.wrapper()}else e+=this.lengths[1];if(null==t)if(n<e+this.lengths[2]){var l=n-e;if(l<this.at_index_2||null==this.ite_2)for(this.at_index_2=0,this.ite_2=this.space.f_arbiters.head;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;for(;this.at_index_2!=l;)for(this.at_index_2++,this.ite_2=this.ite_2.next;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;t=this.ite_2.elt.wrapper()}else e+=this.lengths[2];if(null==t)if(n<e+this.lengths[3]){var r=n-e;if(r<this.at_index_3||null==this.ite_3)for(this.at_index_3=0,this.ite_3=this.space.s_arbiters.head;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;for(;this.at_index_3!=r;)for(this.at_index_3++,this.ite_3=this.ite_3.next;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;t=this.ite_3.elt.wrapper()}else e+=this.lengths[3];return t},ht.prototype.__class__=ht;var Lt=zpp_nape.geom.ZPP_AABB=function(){this.wrap_max=null,this.maxy=0,this.maxx=0,this.wrap_min=null,this.miny=0,this.minx=0,this.next=null,this.outer=null,this._immutable=!1,this._validate=null,this._invalidate=null};Lt.__name__=["zpp_nape","geom","ZPP_AABB"],Lt.get=function(n,t,e,i){var p;return null==Lt.zpp_pool?p=new Lt:(p=Lt.zpp_pool,Lt.zpp_pool=p.next,p.next=null),p.minx=n,p.miny=t,p.maxx=e,p.maxy=i,p},Lt.prototype._invalidate=null,Lt.prototype._validate=null,Lt.prototype._immutable=null,Lt.prototype.validate=function(){null!=this._validate&&this._validate()},Lt.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},Lt.prototype.outer=null,Lt.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new R,null!=(n=this.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Lt.zpp_pool,Lt.zpp_pool=n,this.outer.zpp_inner=this),this.outer},Lt.prototype.next=null,Lt.prototype.alloc=function(){},Lt.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this.wrap_min=this.wrap_max=null,this._invalidate=null,this._validate=null},Lt.prototype.copy=function(){var n,t=this.minx,e=this.miny,i=this.maxx,p=this.maxy;return null==Lt.zpp_pool?n=new Lt:(n=Lt.zpp_pool,Lt.zpp_pool=n.next,n.next=null),n.minx=t,n.miny=e,n.maxx=i,n.maxy=p,n},Lt.prototype.width=function(){return this.maxx-this.minx},Lt.prototype.height=function(){return this.maxy-this.miny},Lt.prototype.perimeter=function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},Lt.prototype.minx=null,Lt.prototype.miny=null,Lt.prototype.wrap_min=null,Lt.prototype.getmin=function(){var n,t,e,i;return null==this.wrap_min&&(n=this.minx,i=this.miny,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=n,t.zpp_inner.y=i,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.wrap_min=t,this.wrap_min.zpp_inner._inuse=!0,this._immutable?this.wrap_min.zpp_inner._immutable=!0:this.wrap_min.zpp_inner._invalidate=X(this,this.mod_min),this.wrap_min.zpp_inner._validate=X(this,this.dom_min)),this.wrap_min},Lt.prototype.dom_min=function(){null!=this._validate&&this._validate(),this.wrap_min.zpp_inner.x=this.minx,this.wrap_min.zpp_inner.y=this.miny},Lt.prototype.mod_min=function(n){n.x==this.minx&&n.y==this.miny||(this.minx=n.x,this.miny=n.y,null!=this._invalidate&&this._invalidate(this))},Lt.prototype.maxx=null,Lt.prototype.maxy=null,Lt.prototype.wrap_max=null,Lt.prototype.getmax=function(){var n,t,e,i;return null==this.wrap_max&&(n=this.maxx,i=this.maxy,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=n,t.zpp_inner.y=i,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.wrap_max=t,this.wrap_max.zpp_inner._inuse=!0,this._immutable?this.wrap_max.zpp_inner._immutable=!0:this.wrap_max.zpp_inner._invalidate=X(this,this.mod_max),this.wrap_max.zpp_inner._validate=X(this,this.dom_max)),this.wrap_max},Lt.prototype.dom_max=function(){null!=this._validate&&this._validate(),this.wrap_max.zpp_inner.x=this.maxx,this.wrap_max.zpp_inner.y=this.maxy},Lt.prototype.mod_max=function(n){n.x==this.maxx&&n.y==this.maxy||(this.maxx=n.x,this.maxy=n.y,null!=this._invalidate&&this._invalidate(this))},Lt.prototype.intersectX=function(n){return!(n.minx>this.maxx||this.minx>n.maxx)},Lt.prototype.intersectY=function(n){return!(n.miny>this.maxy||this.miny>n.maxy)},Lt.prototype.intersect=function(n){return n.miny<=this.maxy&&this.miny<=n.maxy&&n.minx<=this.maxx&&this.minx<=n.maxx},Lt.prototype.combine=function(n){n.minx<this.minx&&(this.minx=n.minx),n.maxx>this.maxx&&(this.maxx=n.maxx),n.miny<this.miny&&(this.miny=n.miny),n.maxy>this.maxy&&(this.maxy=n.maxy)},Lt.prototype.contains=function(n){return n.minx>=this.minx&&n.miny>=this.miny&&n.maxx<=this.maxx&&n.maxy<=this.maxy},Lt.prototype.containsPoint=function(n){return n.x>=this.minx&&n.x<=this.maxx&&n.y>=this.miny&&n.y<=this.maxy},Lt.prototype.setCombine=function(n,t){this.minx=(n.minx<t.minx?n:t).minx,this.miny=(n.miny<t.miny?n:t).miny,this.maxx=(n.maxx>t.maxx?n:t).maxx,this.maxy=(n.maxy>t.maxy?n:t).maxy},Lt.prototype.setExpand=function(n,t){this.minx=n.minx-t,this.miny=n.miny-t,this.maxx=n.maxx+t,this.maxy=n.maxy+t},Lt.prototype.setExpandPoint=function(n,t){n<this.minx&&(this.minx=n),n>this.maxx&&(this.maxx=n),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)},Lt.prototype.toString=function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},Lt.prototype.__class__=Lt;var ut=zpp_nape.util.ZNPList_ZPP_Vec2=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ut.__name__=["zpp_nape","util","ZNPList_ZPP_Vec2"],ut.prototype.head=null,ut.prototype.begin=function(){return this.head},ut.prototype.modified=null,ut.prototype.pushmod=null,ut.prototype.length=null,ut.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ut.prototype.add=function(n){null==_i.zpp_pool?t=new _i:(t=_i.zpp_pool,_i.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ut.prototype.inlined_add=function(n){null==_i.zpp_pool?t=new _i:(t=_i.zpp_pool,_i.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ut.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ut.prototype.insert=function(n,t){null==_i.zpp_pool?e=new _i:(e=_i.zpp_pool,_i.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ut.prototype.inlined_insert=function(n,t){null==_i.zpp_pool?e=new _i:(e=_i.zpp_pool,_i.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ut.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=_i.zpp_pool,_i.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ut.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=_i.zpp_pool,_i.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ut.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ut.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ut.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=_i.zpp_pool,_i.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ut.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ut.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=_i.zpp_pool,_i.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ut.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=_i.zpp_pool,_i.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ut.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=_i.zpp_pool,_i.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ut.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=_i.zpp_pool,_i.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ut.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ut.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=_i.zpp_pool,_i.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ut.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=_i.zpp_pool,_i.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ut.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ut.prototype.empty=function(){return null==this.head},ut.prototype.size=function(){return this.length},ut.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ut.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ut.prototype.front=function(){return this.head.elt},ut.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ut.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ut.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},ut.prototype.__class__=ut;var Ep=zpp_nape.geom.ZPP_Collide=function(){};Ep.__name__=["zpp_nape","geom","ZPP_Collide"],Ep.circleContains=function(n,t){var e=0,i=0;return(e=t.x-n.worldCOMx)*e+(i=t.y-n.worldCOMy)*i<n.radius*n.radius},Ep.polyContains=function(n,t){for(var e=!0,i=n.edges.head;null!=i;){var p=i.elt;if(!(p.gnormx*t.x+p.gnormy*t.y<=p.gprojection)){e=!1;break}i=i.next}return e},Ep.shapeContains=function(n,t){return 0==n.type?Ep.circleContains(n.circle,t):Ep.polyContains(n.polygon,t)},Ep.bodyContains=function(n,t){for(var e=!1,i=n.shapes.head;null!=i;){if(Ep.shapeContains(i.elt,t)){e=!0;break}i=i.next}return e},Ep.containTest=function(n,t){var e=n.aabb,i=t.aabb;if(i.minx>=e.minx&&i.miny>=e.miny&&i.maxx<=e.maxx&&i.maxy<=e.maxy){if(0==n.type){if(0==t.type){var p=n.circle.radius+-t.circle.radius,i=0,e=0;return(i=t.circle.worldCOMx-n.circle.worldCOMx)*i+(e=t.circle.worldCOMy-n.circle.worldCOMy)*e<=p*p}for(var l=!0,r=t.polygon.gverts.next;null!=r;){var o=n.circle.radius,a=0,s=0;if(!((a=r.x-n.circle.worldCOMx)*a+(s=r.y-n.circle.worldCOMy)*s<=o*o)){l=!1;break}r=r.next}return l}if(0==t.type){for(var _=!0,h=n.polygon.edges.head;null!=h;){var u=h.elt;if(!(u.gnormx*t.circle.worldCOMx+u.gnormy*t.circle.worldCOMy+t.circle.radius<=u.gprojection)){_=!1;break}h=h.next}return _}for(var x=!0,d=n.polygon.edges.head;null!=d;){for(var y=d.elt,z=-1e100,c=t.polygon.gverts.next;null!=c;){var v=y.gnormx*c.x+y.gnormy*c.y;z<v&&(z=v),c=c.next}if(!(z<=y.gprojection)){x=!1;break}d=d.next}return x}return!1},Ep.contactCollide=function(n,t,e,i){if(1==t.type){if(1==n.type){for(var p=!0,l=-1e100,r=-1,o=null,a=null,s=n.polygon.edges.head;null!=s;){for(var _=s.elt,h=1e100,u=t.polygon.gverts.next;null!=u;){var x=_.gnormx*u.x+_.gnormy*u.y;if(x<h&&(h=x),h-_.gprojection<=l)break;u=u.next}if(0<=(h-=_.gprojection)){p=!1;break}l<h&&(l=h,o=_,r=1),s=s.next}if(p){for(var d=t.polygon.edges.head;null!=d;){for(var y=d.elt,z=1e100,c=n.polygon.gverts.next;null!=c;){var v=y.gnormx*c.x+y.gnormy*c.y;if(v<z&&(z=v),z-y.gprojection<=l)break;c=c.next}if(0<=(z-=y.gprojection)){p=!1;break}l<z&&(l=z,a=y,r=2),d=d.next}if(p){for(var m,f=1==r?($=t.polygon,m=o,1):($=n.polygon,m=a,-1),b=null,g=1e100,w=$.edges.head;null!=w;){var M=w.elt,C=m.gnormx*M.gnormx+m.gnormy*M.gnormy;C<g&&(g=C,b=M),w=w.next}var k=0,O=0,k=b.gp0.x,O=b.gp0.y,P=0,S=0,A=(P=b.gp1.x)-k,j=(S=b.gp1.y)-O,E=m.gnormy*k-m.gnormx*O,I=m.gnormy*P-m.gnormx*S,T=1/(I-E),N=(-m.tp1-E)*T;N>jp.epsilon&&(k+=A*N,O+=j*N);var L=(-m.tp0-I)*T;L<-jp.epsilon&&(P+=A*L,S+=j*L);E=0,N=0,E=m.gnormx*f,N=m.gnormy*f;e.lnormx=m.lnormx,e.lnormy=m.lnormy,e.lproj=m.lprojection,e.radius=0,e.rev=i!=(-1==f),e.ptype=e.rev?1:0;I=k*m.gnormx+O*m.gnormy-m.gprojection,T=P*m.gnormx+S*m.gnormy-m.gprojection;if(0<I&&0<T)return!1;i&&(E=-E,N=-N);for(var A=k-m.gnormx*I*.5,j=O-m.gnormy*I*.5,V=e.rev?1:0,D=null,F=e.contacts.next;null!=F;){if(V==F.hash){D=F;break}F=F.next}null==D?(null==$i.zpp_pool?D=new $i:(D=$i.zpp_pool,$i.zpp_pool=D.next,D.next=null),(R=D.inner).jnAcc=R.jtAcc=0,D.hash=V,D.fresh=!0,(D.arbiter=e).jrAcc=0,L=e.contacts,D._inuse=!0,(f=D).next=L.next,L.next=f,L.modified=!0,L.length++,e.innards.add(R)):D.fresh=!1,D.px=A,D.py=j,e.nx=E,e.ny=N,D.dist=I,D.stamp=e.stamp,D.posOnly=0<I;var R=D;k-=$.body.posx,O-=$.body.posy,R.inner.lr1x=k*$.body.axisy+O*$.body.axisx,R.inner.lr1y=O*$.body.axisy-k*$.body.axisx;for(var A=P-m.gnormx*T*.5,j=S-m.gnormy*T*.5,Z=e.rev?0:1,B=null,G=e.contacts.next;null!=G;){if(Z==G.hash){B=G;break}G=G.next}return null==B?(null==$i.zpp_pool?B=new $i:(B=$i.zpp_pool,$i.zpp_pool=B.next,B.next=null),(I=B.inner).jnAcc=I.jtAcc=0,B.hash=Z,B.fresh=!0,(B.arbiter=e).jrAcc=0,O=e.contacts,B._inuse=!0,(k=B).next=O.next,O.next=k,O.modified=!0,O.length++,e.innards.add(I)):B.fresh=!1,B.px=A,B.py=j,e.nx=E,e.ny=N,B.dist=T,B.stamp=e.stamp,B.posOnly=0<T,R=B,P-=$.body.posx,S-=$.body.posy,R.inner.lr1x=P*$.body.axisy+S*$.body.axisx,R.inner.lr1y=S*$.body.axisy-P*$.body.axisx,1==r?(e.__ref_edge1=m,e.__ref_edge2=b):(e.__ref_edge2=m,e.__ref_edge1=b),!0}return!1}return!1}for(var q=-1e100,U=!0,K=null,W=null,Y=t.polygon.gverts.next,J=t.polygon.edges.head;null!=J;){var X=J.elt,H=X.gnormx*n.circle.worldCOMx+X.gnormy*n.circle.worldCOMy-X.gprojection-n.circle.radius;if(0<H){U=!1;break}q<H&&(q=H,K=X,W=Y),Y=Y.next,J=J.next}if(U){A=W,j=(null==W.next?t.polygon.gverts:W).next,E=n.circle.worldCOMy*K.gnormx-n.circle.worldCOMx*K.gnormy;if(E<=A.y*K.gnormx-A.x*K.gnormy){N=n.circle.radius,T=0,R=0,S=(T=A.x-n.circle.worldCOMx)*T+(R=A.y-n.circle.worldCOMy)*R;if(N*N<S)zn=null;else if(S<jp.epsilon*jp.epsilon){for(var $,Q=n.circle.worldCOMx,nn=n.circle.worldCOMy,tn=null,en=e.contacts.next;null!=en;){if(0==en.hash){tn=en;break}en=en.next}null==tn?(null==$i.zpp_pool?tn=new $i:(tn=$i.zpp_pool,$i.zpp_pool=tn.next,tn.next=null),(pn=tn.inner).jnAcc=pn.jtAcc=0,tn.hash=0,tn.fresh=!0,(tn.arbiter=e).jrAcc=0,P=e.contacts,tn._inuse=!0,($=tn).next=P.next,P.next=$,P.modified=!0,P.length++,e.innards.add(pn)):tn.fresh=!1,tn.px=Q,tn.py=nn,e.nx=1,e.ny=0,tn.dist=-N,tn.stamp=e.stamp,tn.posOnly=!1,zn=tn}else{var pn=1/Math.sqrt(S),Q=pn<jp.epsilon?1e100:1/pn,nn=.5+(n.circle.radius-.5*N)*pn;if(i){for(var ln=n.circle.worldCOMx+T*nn,rn=n.circle.worldCOMy+R*nn,on=null,an=e.contacts.next;null!=an;){if(0==an.hash){on=an;break}an=an.next}null==on?(null==$i.zpp_pool?on=new $i:(on=$i.zpp_pool,$i.zpp_pool=on.next,on.next=null),(_n=on.inner).jnAcc=_n.jtAcc=0,on.hash=0,on.fresh=!0,(on.arbiter=e).jrAcc=0,sn=e.contacts,on._inuse=!0,(S=on).next=sn.next,sn.next=S,sn.modified=!0,sn.length++,e.innards.add(_n)):on.fresh=!1,on.px=ln,on.py=rn,e.nx=-T*pn,e.ny=-R*pn,on.dist=Q-N,on.stamp=e.stamp,on.posOnly=!1,zn=on}else{for(var sn=n.circle.worldCOMx+T*nn,_n=n.circle.worldCOMy+R*nn,hn=null,un=e.contacts.next;null!=un;){if(0==un.hash){hn=un;break}un=un.next}null==hn?(null==$i.zpp_pool?hn=new $i:(hn=$i.zpp_pool,$i.zpp_pool=hn.next,hn.next=null),(ln=hn.inner).jnAcc=ln.jtAcc=0,hn.hash=0,hn.fresh=!0,(hn.arbiter=e).jrAcc=0,rn=e.contacts,hn._inuse=!0,(nn=hn).next=rn.next,rn.next=nn,rn.modified=!0,rn.length++,e.innards.add(ln)):hn.fresh=!1,hn.px=sn,hn.py=_n,e.nx=T*pn,e.ny=R*pn,hn.dist=Q-N,hn.stamp=e.stamp,hn.posOnly=!1,zn=hn}}return null!=zn&&(yn=zn.inner,e.ptype=2,xn=dn=0,dn=A.x-t.polygon.body.posx,xn=A.y-t.polygon.body.posy,e.__ref_edge1=K,e.__ref_vertex=-1,i?(yn.lr1x=dn*t.polygon.body.axisy+xn*t.polygon.body.axisx,yn.lr1y=xn*t.polygon.body.axisy-dn*t.polygon.body.axisx,yn.lr2x=n.circle.localCOMx,yn.lr2y=n.circle.localCOMy):(yn.lr2x=dn*t.polygon.body.axisy+xn*t.polygon.body.axisx,yn.lr2y=xn*t.polygon.body.axisy-dn*t.polygon.body.axisx,yn.lr1x=n.circle.localCOMx,yn.lr1y=n.circle.localCOMy),e.radius=n.circle.radius),null!=zn}if(E>=j.y*K.gnormx-j.x*K.gnormy){var A=n.circle.radius,xn=0,dn=0,yn=(xn=j.x-n.circle.worldCOMx)*xn+(dn=j.y-n.circle.worldCOMy)*dn;if(A*A<yn)In=null;else if(yn<jp.epsilon*jp.epsilon){for(var zn,cn=n.circle.worldCOMx,vn=n.circle.worldCOMy,mn=null,fn=e.contacts.next;null!=fn;){if(0==fn.hash){mn=fn;break}fn=fn.next}null==mn?(null==$i.zpp_pool?mn=new $i:(mn=$i.zpp_pool,$i.zpp_pool=mn.next,mn.next=null),(bn=mn.inner).jnAcc=bn.jtAcc=0,mn.hash=0,mn.fresh=!0,(mn.arbiter=e).jrAcc=0,zn=e.contacts,mn._inuse=!0,(E=mn).next=zn.next,zn.next=E,zn.modified=!0,zn.length++,e.innards.add(bn)):mn.fresh=!1,mn.px=cn,mn.py=vn,e.nx=1,e.ny=0,mn.dist=-A,mn.stamp=e.stamp,mn.posOnly=!1,In=mn}else{var bn=1/Math.sqrt(yn),cn=bn<jp.epsilon?1e100:1/bn,vn=.5+(n.circle.radius-.5*A)*bn;if(i){for(var gn=n.circle.worldCOMx+xn*vn,wn=n.circle.worldCOMy+dn*vn,Mn=null,Cn=e.contacts.next;null!=Cn;){if(0==Cn.hash){Mn=Cn;break}Cn=Cn.next}null==Mn?(null==$i.zpp_pool?Mn=new $i:(Mn=$i.zpp_pool,$i.zpp_pool=Mn.next,Mn.next=null),(On=Mn.inner).jnAcc=On.jtAcc=0,Mn.hash=0,Mn.fresh=!0,(Mn.arbiter=e).jrAcc=0,kn=e.contacts,Mn._inuse=!0,(yn=Mn).next=kn.next,kn.next=yn,kn.modified=!0,kn.length++,e.innards.add(On)):Mn.fresh=!1,Mn.px=gn,Mn.py=wn,e.nx=-xn*bn,e.ny=-dn*bn,Mn.dist=cn-A,Mn.stamp=e.stamp,Mn.posOnly=!1,In=Mn}else{for(var kn=n.circle.worldCOMx+xn*vn,On=n.circle.worldCOMy+dn*vn,Pn=null,Sn=e.contacts.next;null!=Sn;){if(0==Sn.hash){Pn=Sn;break}Sn=Sn.next}null==Pn?(null==$i.zpp_pool?Pn=new $i:(Pn=$i.zpp_pool,$i.zpp_pool=Pn.next,Pn.next=null),(gn=Pn.inner).jnAcc=gn.jtAcc=0,Pn.hash=0,Pn.fresh=!0,(Pn.arbiter=e).jrAcc=0,wn=e.contacts,Pn._inuse=!0,(vn=Pn).next=wn.next,wn.next=vn,wn.modified=!0,wn.length++,e.innards.add(gn)):Pn.fresh=!1,Pn.px=kn,Pn.py=On,e.nx=xn*bn,e.ny=dn*bn,Pn.dist=cn-A,Pn.stamp=e.stamp,Pn.posOnly=!1,In=Pn}}return null!=In&&(En=In.inner,e.ptype=2,An=jn=0,jn=j.x-t.polygon.body.posx,An=j.y-t.polygon.body.posy,e.__ref_edge1=K,e.__ref_vertex=1,i?(En.lr1x=jn*t.polygon.body.axisy+An*t.polygon.body.axisx,En.lr1y=An*t.polygon.body.axisy-jn*t.polygon.body.axisx,En.lr2x=n.circle.localCOMx,En.lr2y=n.circle.localCOMy):(En.lr2x=jn*t.polygon.body.axisy+An*t.polygon.body.axisx,En.lr2y=An*t.polygon.body.axisy-jn*t.polygon.body.axisx,En.lr1x=n.circle.localCOMx,En.lr1y=n.circle.localCOMy),e.radius=n.circle.radius),null!=In}var An=0,jn=0,En=n.circle.radius+.5*q,An=K.gnormx*En,jn=K.gnormy*En,In=0,En=0,In=n.circle.worldCOMx-An,En=n.circle.worldCOMy-jn;if(i){for(var Tn=K.gnormx,Nn=K.gnormy,Ln=null,Vn=e.contacts.next;null!=Vn;){if(0==Vn.hash){Ln=Vn;break}Vn=Vn.next}null==Ln?(null==$i.zpp_pool?Ln=new $i:(Ln=$i.zpp_pool,$i.zpp_pool=Ln.next,Ln.next=null),(Gn=Ln.inner).jnAcc=Gn.jtAcc=0,Ln.hash=0,Ln.fresh=!0,(Ln.arbiter=e).jrAcc=0,An=e.contacts,Ln._inuse=!0,(jn=Ln).next=An.next,An.next=jn,An.modified=!0,An.length++,e.innards.add(Gn)):Ln.fresh=!1,Ln.px=In,Ln.py=En,e.nx=Tn,e.ny=Nn,Ln.dist=q,Ln.stamp=e.stamp,Ln.posOnly=!1,Gn=Ln}else{for(var Dn=-K.gnormx,Fn=-K.gnormy,Rn=null,Zn=e.contacts.next;null!=Zn;){if(0==Zn.hash){Rn=Zn;break}Zn=Zn.next}null==Rn?(null==$i.zpp_pool?Rn=new $i:(Rn=$i.zpp_pool,$i.zpp_pool=Rn.next,Rn.next=null),(Bn=Rn.inner).jnAcc=Bn.jtAcc=0,Rn.hash=0,Rn.fresh=!0,(Rn.arbiter=e).jrAcc=0,Tn=e.contacts,Rn._inuse=!0,(Nn=Rn).next=Tn.next,Tn.next=Nn,Tn.modified=!0,Tn.length++,e.innards.add(Bn)):Rn.fresh=!1,Rn.px=In,Rn.py=En,e.nx=Dn,e.ny=Fn,Rn.dist=q,Rn.stamp=e.stamp,Rn.posOnly=!1,Gn=Rn}return e.ptype=i?0:1,e.lnormx=K.lnormx,e.lnormy=K.lnormy,e.rev=!i,e.lproj=K.lprojection,e.radius=n.circle.radius,Gn.inner.lr1x=n.circle.localCOMx,Gn.inner.lr1y=n.circle.localCOMy,e.__ref_edge1=K,!(e.__ref_vertex=0)}return!1}var Bn=n.circle.radius+t.circle.radius,In=0,En=0,Dn=(In=t.circle.worldCOMx-n.circle.worldCOMx)*In+(En=t.circle.worldCOMy-n.circle.worldCOMy)*En;if(Bn*Bn<Dn)it=null;else if(Dn<jp.epsilon*jp.epsilon){for(var Gn,qn=n.circle.worldCOMx,Un=n.circle.worldCOMy,Kn=null,Wn=e.contacts.next;null!=Wn;){if(0==Wn.hash){Kn=Wn;break}Wn=Wn.next}null==Kn?(null==$i.zpp_pool?Kn=new $i:(Kn=$i.zpp_pool,$i.zpp_pool=Kn.next,Kn.next=null),(Yn=Kn.inner).jnAcc=Yn.jtAcc=0,Kn.hash=0,Kn.fresh=!0,(Kn.arbiter=e).jrAcc=0,Fn=e.contacts,Kn._inuse=!0,(Gn=Kn).next=Fn.next,Fn.next=Gn,Fn.modified=!0,Fn.length++,e.innards.add(Yn)):Kn.fresh=!1,Kn.px=qn,Kn.py=Un,e.nx=1,e.ny=0,Kn.dist=-Bn,Kn.stamp=e.stamp,Kn.posOnly=!1,it=Kn}else{var Yn=1/Math.sqrt(Dn),qn=Yn<jp.epsilon?1e100:1/Yn,Un=.5+(n.circle.radius-.5*Bn)*Yn;if(i){for(var Jn=n.circle.worldCOMx+In*Un,Xn=n.circle.worldCOMy+En*Un,Hn=null,$n=e.contacts.next;null!=$n;){if(0==$n.hash){Hn=$n;break}$n=$n.next}null==Hn?(null==$i.zpp_pool?Hn=new $i:(Hn=$i.zpp_pool,$i.zpp_pool=Hn.next,Hn.next=null),(nt=Hn.inner).jnAcc=nt.jtAcc=0,Hn.hash=0,Hn.fresh=!0,(Hn.arbiter=e).jrAcc=0,Qn=e.contacts,Hn._inuse=!0,(Dn=Hn).next=Qn.next,Qn.next=Dn,Qn.modified=!0,Qn.length++,e.innards.add(nt)):Hn.fresh=!1,Hn.px=Jn,Hn.py=Xn,e.nx=-In*Yn,e.ny=-En*Yn,Hn.dist=qn-Bn,Hn.stamp=e.stamp,Hn.posOnly=!1,it=Hn}else{for(var Qn=n.circle.worldCOMx+In*Un,nt=n.circle.worldCOMy+En*Un,tt=null,et=e.contacts.next;null!=et;){if(0==et.hash){tt=et;break}et=et.next}null==tt?(null==$i.zpp_pool?tt=new $i:(tt=$i.zpp_pool,$i.zpp_pool=tt.next,tt.next=null),(Jn=tt.inner).jnAcc=Jn.jtAcc=0,tt.hash=0,tt.fresh=!0,(tt.arbiter=e).jrAcc=0,Xn=e.contacts,tt._inuse=!0,(Un=tt).next=Xn.next,Xn.next=Un,Xn.modified=!0,Xn.length++,e.innards.add(Jn)):tt.fresh=!1,tt.px=Qn,tt.py=nt,e.nx=In*Yn,e.ny=En*Yn,tt.dist=qn-Bn,tt.stamp=e.stamp,tt.posOnly=!1,it=tt}}if(null==it)return!1;var it=it.inner;return i?(it.lr1x=t.circle.localCOMx,it.lr1y=t.circle.localCOMy,it.lr2x=n.circle.localCOMx,it.lr2y=n.circle.localCOMy):(it.lr1x=n.circle.localCOMx,it.lr1y=n.circle.localCOMy,it.lr2x=t.circle.localCOMx,it.lr2y=t.circle.localCOMy),e.radius=n.circle.radius+t.circle.radius,e.ptype=2,!0},Ep.testCollide_safe=function(n,t){var e;return 0==t.type&&(e=n,n=t,t=e),Ep.testCollide(n,t)},Ep.testCollide=function(n,t){if(1==t.type){if(1==n.type){for(var e=!0,i=n.polygon.edges.head;null!=i;){for(var p=i.elt,l=1e100,r=t.polygon.gverts.next;null!=r;){var o=p.gnormx*r.x+p.gnormy*r.y;o<l&&(l=o),r=r.next}if(0<(l-=p.gprojection)){e=!1;break}i=i.next}if(e){for(var a=t.polygon.edges.head;null!=a;){for(var s=a.elt,_=1e100,h=n.polygon.gverts.next;null!=h;){var u=s.gnormx*h.x+s.gnormy*h.y;u<_&&(_=u),h=h.next}if(0<(_-=s.gprojection)){e=!1;break}a=a.next}return e}return!1}for(var x=null,d=null,y=!0,z=-1e100,c=t.polygon.gverts.next,v=t.polygon.edges.head;null!=v;){var m=v.elt,f=m.gnormx*n.circle.worldCOMx+m.gnormy*n.circle.worldCOMy-m.gprojection-n.circle.radius;if(0<f){y=!1;break}z<f&&(z=f,x=m,d=c),c=c.next,v=v.next}if(y){var b=(null==d.next?t.polygon.gverts:d).next,g=n.circle.worldCOMy*x.gnormx-n.circle.worldCOMx*x.gnormy;if(g<=d.y*x.gnormx-d.x*x.gnormy){var w=n.circle.radius,M=0,C=0;return(M=d.x-n.circle.worldCOMx)*M+(C=d.y-n.circle.worldCOMy)*C<=w*w}if(g>=b.y*x.gnormx-b.x*x.gnormy){var k=n.circle.radius,g=0,O=0;return(g=b.x-n.circle.worldCOMx)*g+(O=b.y-n.circle.worldCOMy)*O<=k*k}return!0}return!1}b=n.circle.radius+t.circle.radius,O=0,k=0;return(O=t.circle.worldCOMx-n.circle.worldCOMx)*O+(k=t.circle.worldCOMy-n.circle.worldCOMy)*k<=b*b},Ep.flowCollide=function(n,t,e){if(1==t.type){if(1==n.type){for(var i=[],p=[],l=!0,r=!0,o=n.polygon.edges.head;null!=o;){for(var a=o.elt,s=1e100,_=0,h=t.polygon.gverts.next;null!=h;){var u=a.gnormx*h.x+a.gnormy*h.y;u<s&&(s=u),u>=a.gprojection+jp.epsilon&&(r=!(p[_]=!0)),++_,h=h.next}if(0<(s-=a.gprojection)){l=!1;break}o=o.next}if(r){var x=t.polygon;if(x.zip_worldCOM&&null!=x.body){if(x.zip_worldCOM=!1,x.zip_localCOM){if(x.zip_localCOM=!1,1==x.type){var d=x.polygon;if(null==d.lverts.next.next)d.localCOMx=d.lverts.next.x,d.localCOMy=d.lverts.next.y;else if(null==d.lverts.next.next.next)d.localCOMx=d.lverts.next.x,d.localCOMy=d.lverts.next.y,d.localCOMx+=d.lverts.next.next.x,d.localCOMy+=d.lverts.next.next.y,d.localCOMx*=.5,d.localCOMy*=.5;else{d.localCOMx=0;var y=d.localCOMy=0,z=d.lverts.next,c=z,v=z=z.next;for(z=z.next;null!=z;){var m=z;y+=v.x*(m.y-c.y);var f=m.y*v.x-m.x*v.y;d.localCOMx+=(v.x+m.x)*f,d.localCOMy+=(v.y+m.y)*f,c=v,v=m,z=z.next}var b=z=d.lverts.next;y+=v.x*(b.y-c.y);var g=b.y*v.x-b.x*v.y;d.localCOMx+=(v.x+b.x)*g,d.localCOMy+=(v.y+b.y)*g,c=v;var w=z=z.next;y+=b.x*(w.y-c.y);g=w.y*b.x-w.x*b.y;d.localCOMx+=(b.x+w.x)*g,d.localCOMy+=(b.y+w.y)*g;w=y=1/(3*y);d.localCOMx*=w,d.localCOMy*=w}}null!=x.wrap_localCOM&&(x.wrap_localCOM.zpp_inner.x=x.localCOMx,x.wrap_localCOM.zpp_inner.y=x.localCOMy)}g=x.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot)),x.worldCOMx=x.body.posx+(x.body.axisy*x.localCOMx-x.body.axisx*x.localCOMy),x.worldCOMy=x.body.posy+(x.localCOMx*x.body.axisx+x.localCOMy*x.body.axisy)}w=t.polygon.area,g=t.polygon.worldCOMx,x=t.polygon.worldCOMy;return e.overlap=w,e.centroidx=g,e.centroidy=x,!0}if(l){r=!0;for(var M=t.polygon.edges.head;null!=M;){for(var C=M.elt,k=1e100,O=0,P=n.polygon.gverts.next;null!=P;){var S=C.gnormx*P.x+C.gnormy*P.y;S<k&&(k=S),S>=C.gprojection+jp.epsilon&&(r=!(i[O]=!0)),++O,P=P.next}if(0<(k-=C.gprojection)){l=!1;break}M=M.next}if(r){var A=n.polygon;if(A.zip_worldCOM&&null!=A.body){if(A.zip_worldCOM=!1,A.zip_localCOM){if(A.zip_localCOM=!1,1==A.type){var j=A.polygon;if(null==j.lverts.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y;else if(null==j.lverts.next.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y,j.localCOMx+=j.lverts.next.next.x,j.localCOMy+=j.lverts.next.next.y,j.localCOMx*=.5,j.localCOMy*=.5;else{j.localCOMx=0;var E=j.localCOMy=0,I=j.lverts.next,T=I,N=I=I.next;for(I=I.next;null!=I;){var L=I;E+=N.x*(L.y-T.y);var V=L.y*N.x-L.x*N.y;j.localCOMx+=(N.x+L.x)*V,j.localCOMy+=(N.y+L.y)*V,T=N,N=L,I=I.next}x=I=j.lverts.next;E+=N.x*(x.y-T.y);var D=x.y*N.x-x.x*N.y;j.localCOMx+=(N.x+x.x)*D,j.localCOMy+=(N.y+x.y)*D,T=N;var F=I=I.next;E+=x.x*(F.y-T.y);D=F.y*x.x-F.x*x.y;j.localCOMx+=(x.x+F.x)*D,j.localCOMy+=(x.y+F.y)*D;F=E=1/(3*E);j.localCOMx*=F,j.localCOMy*=F}}null!=A.wrap_localCOM&&(A.wrap_localCOM.zpp_inner.x=A.localCOMx,A.wrap_localCOM.zpp_inner.y=A.localCOMy)}D=A.body;D.zip_axis&&(D.zip_axis=!1,D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)),A.worldCOMx=A.body.posx+(A.body.axisy*A.localCOMx-A.body.axisx*A.localCOMy),A.worldCOMy=A.body.posy+(A.localCOMx*A.body.axisx+A.localCOMy*A.body.axisy)}F=n.polygon.area,D=n.polygon.worldCOMx,A=n.polygon.worldCOMy;return e.overlap=F,e.centroidx=D,e.centroidy=A,!0}if(l){for(;null!=Ep.flowpoly.head;){var R=Ep.flowpoly.pop_unsafe();R._inuse||(null!=R.outer&&(R.outer.zpp_inner=null,R.outer=null),R._isimmutable=null,R._validate=null,R._invalidate=null,R.next=Ip.zpp_pool,Ip.zpp_pool=R)}for(var Z=null,B=!1,G=n.polygon.gverts.next,q=0,U=t.polygon.gverts.next,K=0,W=0,Y=t.polygon.edgeCnt;W<Y;){var J=W++;if(!p[J]){K=J;break}U=U.next}if(null==U){U=t.polygon.gverts.next,B=!0;for(var X=0,H=n.polygon.edgeCnt;X<H;){var $=X++;if(!i[$]){q=$;break}G=G.next}null==G?G=n.polygon.gverts.next:(Ep.flowpoly.add(G),Z=Ep.flowpoly.head.elt)}else Ep.flowpoly.add(U),Z=Ep.flowpoly.head.elt;var Q=1;if(null==Ep.flowpoly.head){for(var nn=!0,tn=n.polygon.gverts.next,en=tn,pn=tn.next;null!=pn;){for(var ln=pn,rn=2,on=t.polygon.gverts.next,an=on,sn=on.next;null!=sn;){var _n=0,hn=en.x-an.x,un=en.y-an.y,xn=0,dn=ln.x-en.x,yn=0,zn=0,cn=(xn=ln.y-en.y)*(yn=sn.x-an.x)-dn*(zn=sn.y-an.y);cn*cn>jp.epsilon*jp.epsilon&&((yn=(zn*hn-yn*un)*(cn=1/cn))>jp.epsilon&&yn<1-jp.epsilon&&((cn=(xn*hn-dn*un)*cn)>jp.epsilon&&cn<1-jp.epsilon&&(_n=yn,!0)))&&_n<rn&&(rn=_n,U=on),sn=(on=an=sn).next}for(;;){sn=t.polygon.gverts.next;var vn=0,mn=en.x-an.x,fn=en.y-an.y,bn=0,gn=ln.x-en.x,wn=0,Mn=0,Cn=(bn=ln.y-en.y)*(wn=sn.x-an.x)-gn*(Mn=sn.y-an.y);Cn*Cn>jp.epsilon*jp.epsilon&&((wn=(Mn*mn-wn*fn)*(Cn=1/Cn))>jp.epsilon&&wn<1-jp.epsilon&&((Cn=(bn*mn-gn*fn)*Cn)>jp.epsilon&&Cn<1-jp.epsilon&&(vn=wn,!0)))&&vn<rn&&(rn=vn,U=on);break}if(2!=rn){var kn,On=en.x+(ln.x-en.x)*rn,Pn=en.y+(ln.y-en.y)*rn;null==Ip.zpp_pool?kn=new Ip:(kn=Ip.zpp_pool,Ip.zpp_pool=kn.next,kn.next=null),kn.weak=!1,kn._immutable=!1,kn.x=On,kn.y=Pn,Z=kn,Ep.flowpoly.add(Z),G=tn,nn=!(B=!0);break}en=ln,pn=(tn=pn).next}if(nn)for(;;){for(var Sn=pn=n.polygon.gverts.next,An=2,jn=t.polygon.gverts.next,En=jn,In=jn.next;null!=In;){var Tn=0,Nn=en.x-En.x,Ln=en.y-En.y,Vn=0,Dn=Sn.x-en.x,Fn=0,Rn=0,Zn=(Vn=Sn.y-en.y)*(Fn=In.x-En.x)-Dn*(Rn=In.y-En.y);Zn*Zn>jp.epsilon*jp.epsilon&&((Fn=(Rn*Nn-Fn*Ln)*(Zn=1/Zn))>jp.epsilon&&Fn<1-jp.epsilon&&((Zn=(Vn*Nn-Dn*Ln)*Zn)>jp.epsilon&&Zn<1-jp.epsilon&&(Tn=Fn,!0)))&&Tn<An&&(An=Tn,U=jn),In=(jn=En=In).next}for(;;){In=t.polygon.gverts.next;var Bn=0,Gn=en.x-En.x,qn=en.y-En.y,Un=0,Kn=Sn.x-en.x,Wn=0,Yn=0,Jn=(Un=Sn.y-en.y)*(Wn=In.x-En.x)-Kn*(Yn=In.y-En.y);Jn*Jn>jp.epsilon*jp.epsilon&&((Wn=(Yn*Gn-Wn*qn)*(Jn=1/Jn))>jp.epsilon&&Wn<1-jp.epsilon&&((Jn=(Un*Gn-Kn*qn)*Jn)>jp.epsilon&&Jn<1-jp.epsilon&&(Bn=Wn,!0)))&&Bn<An&&(An=Bn,U=jn);break}if(2==An)break;var Xn,Hn=en.x+(Sn.x-en.x)*An,$n=en.y+(Sn.y-en.y)*An;null==Ip.zpp_pool?Xn=new Ip:(Xn=Ip.zpp_pool,Ip.zpp_pool=Xn.next,Xn.next=null),Xn.weak=!1,Xn._immutable=!1,Xn.x=Hn,Xn.y=$n,Z=Xn,Ep.flowpoly.add(Z),B=!0,G=tn;break}Q=2}for(;;)if(B)if(++q,null==(G=G.next)&&(G=n.polygon.gverts.next,q=0),i[q]){var Qn=Ep.flowpoly.head.elt,nt=G,tt=U,et=U.next;null==et&&(et=t.polygon.gverts.next);for(var it=-1,pt=null,lt=0,rt=0,ot=et,at=et;;){var st,_t=at,ht=0,ut=tt.x-Qn.x,xt=tt.y-Qn.y,dt=0,yt=_t.x-tt.x,zt=0,ct=0,vt=(dt=_t.y-tt.y)*(zt=nt.x-Qn.x)-yt*(ct=nt.y-Qn.y);if(st=vt*vt>jp.epsilon*jp.epsilon&&((st=(ct*ut-zt*xt)*(vt=1/vt))>jp.epsilon&&st<1-jp.epsilon&&((vt=(dt*ut-yt*xt)*vt)>jp.epsilon&&vt<1-jp.epsilon&&(ht=st,!0))),st&&-1<=ht){if(pt=U,lt=K,(rt=1)==Q){it=ht,at=ot;break}it=ht}tt=_t,U=at,++K>=t.polygon.edgeCnt&&(K=0),null==(at=at.next)&&(at=t.polygon.gverts.next);break}for(;at!=ot;){var mt,ft=at,bt=0,gt=tt.x-Qn.x,wt=tt.y-Qn.y,Mt=0,Ct=ft.x-tt.x,kt=0,Ot=0,Pt=(Mt=ft.y-tt.y)*(kt=nt.x-Qn.x)-Ct*(Ot=nt.y-Qn.y);if(mt=Pt*Pt>jp.epsilon*jp.epsilon&&((mt=(Ot*gt-kt*wt)*(Pt=1/Pt))>jp.epsilon&&mt<1-jp.epsilon&&((Pt=(Mt*gt-Ct*wt)*Pt)>jp.epsilon&&Pt<1-jp.epsilon&&(bt=mt,!0))),mt&&it<=bt){if(pt=U,lt=K,++rt==Q){it=bt;break}it=bt}tt=ft,U=at,++K>=t.polygon.edgeCnt&&(K=0),null==(at=at.next)&&(at=t.polygon.gverts.next)}if(null==pt)break;var St=pt.next;null==St&&(St=t.polygon.gverts.next);var At,jt=0,et=0,jt=pt.x+(St.x-pt.x)*it,et=pt.y+(St.y-pt.y)*it;if(null!=Z&&(It=Et=0,(Et=jt-Z.x)*Et+(It=et-Z.y)*It<jp.epsilon))break;null==Ip.zpp_pool?At=new Ip:(At=Ip.zpp_pool,Ip.zpp_pool=At.next,At.next=null),At.weak=!1,At._immutable=!1,At.x=jt,At.y=et,Ep.flowpoly.add(At),null==Z&&(Z=Ep.flowpoly.head.elt),U=pt,K=lt,B=!B,Q=2}else{var Et,It,St=G;if(null!=Z&&(Et=St.x,It=St.y,et=jt=0,(jt=Et-Z.x)*jt+(et=It-Z.y)*et<jp.epsilon))break;Ep.flowpoly.add(St),null==Z&&(Z=Ep.flowpoly.head.elt),Q=1}else if(++K,null==(U=U.next)&&(U=t.polygon.gverts.next,K=0),p[K]){var Tt=Ep.flowpoly.head.elt,Nt=U,Lt=G,Vt=G.next;null==Vt&&(Vt=n.polygon.gverts.next);for(var Dt=-1,Ft=null,Rt=0,Zt=0,Bt=Vt,Gt=Vt;;){var qt,Ut=Gt,Kt=0,Wt=Lt.x-Tt.x,Yt=Lt.y-Tt.y,Jt=0,Xt=Ut.x-Lt.x,Ht=0,$t=0,Qt=(Jt=Ut.y-Lt.y)*(Ht=Nt.x-Tt.x)-Xt*($t=Nt.y-Tt.y);if(qt=Qt*Qt>jp.epsilon*jp.epsilon&&((qt=($t*Wt-Ht*Yt)*(Qt=1/Qt))>jp.epsilon&&qt<1-jp.epsilon&&((Qt=(Jt*Wt-Xt*Yt)*Qt)>jp.epsilon&&Qt<1-jp.epsilon&&(Kt=qt,!0))),qt&&-1<=Kt){if(Ft=G,Rt=q,(Zt=1)==Q){Dt=Kt,Gt=Bt;break}Dt=Kt}Lt=Ut,G=Gt,++q>=n.polygon.edgeCnt&&(q=0),null==(Gt=Gt.next)&&(Gt=n.polygon.gverts.next);break}for(;Gt!=Bt;){var ne,te=Gt,ee=0,ie=Lt.x-Tt.x,pe=Lt.y-Tt.y,le=0,re=te.x-Lt.x,oe=0,ae=0,se=(le=te.y-Lt.y)*(oe=Nt.x-Tt.x)-re*(ae=Nt.y-Tt.y);if(ne=se*se>jp.epsilon*jp.epsilon&&((ne=(ae*ie-oe*pe)*(se=1/se))>jp.epsilon&&ne<1-jp.epsilon&&((se=(le*ie-re*pe)*se)>jp.epsilon&&se<1-jp.epsilon&&(ee=ne,!0))),ne&&Dt<=ee){if(Ft=G,Rt=q,++Zt==Q){Dt=ee;break}Dt=ee}Lt=te,G=Gt,++q>=n.polygon.edgeCnt&&(q=0),null==(Gt=Gt.next)&&(Gt=n.polygon.gverts.next)}if(null==Ft)break;var _e=Ft.next;null==_e&&(_e=n.polygon.gverts.next);var he,ue=0,Vt=0,ue=Ft.x+(_e.x-Ft.x)*Dt,Vt=Ft.y+(_e.y-Ft.y)*Dt;if(null!=Z&&(de=xe=0,(xe=ue-Z.x)*xe+(de=Vt-Z.y)*de<jp.epsilon))break;null==Ip.zpp_pool?he=new Ip:(he=Ip.zpp_pool,Ip.zpp_pool=he.next,he.next=null),he.weak=!1,he._immutable=!1,he.x=ue,he.y=Vt,Ep.flowpoly.add(he),null==Z&&(Z=Ep.flowpoly.head.elt),G=Ft,q=Rt,B=!B,Q=2}else{var xe,de,_e=U;if(null!=Z&&(xe=_e.x,de=_e.y,Vt=ue=0,(ue=xe-Z.x)*ue+(Vt=de-Z.y)*Vt<jp.epsilon))break;Ep.flowpoly.add(_e),null==Z&&(Z=Ep.flowpoly.head.elt),Q=1}if(null==Ep.flowpoly.head||null==Ep.flowpoly.head.next||null==Ep.flowpoly.head.next.next)return!1;var ye=0,ze=0,ce=0,ze=0,ce=0,ye=0,ve=Ep.flowpoly.head,me=ve.elt,fe=(ve=ve.next).elt;for(ve=ve.next;null!=ve;){var be=ve.elt;ye+=fe.x*(be.y-me.y);var ge=be.y*fe.x-be.x*fe.y;ze+=(fe.x+be.x)*ge,ce+=(fe.y+be.y)*ge,me=fe,fe=be,ve=ve.next}D=(ve=Ep.flowpoly.head).elt;ye+=fe.x*(D.y-me.y);var we=D.y*fe.x-D.x*fe.y;ze+=(fe.x+D.x)*we,ce+=(fe.y+D.y)*we,me=fe;A=(ve=ve.next).elt;ye+=D.x*(A.y-me.y);we=A.y*D.x-A.x*D.y;ze+=(D.x+A.x)*we,ce+=(D.y+A.y)*we;we=1/(6*(ye*=.5));return ze*=we,ce*=we,e.overlap=-ye,e.centroidx=ze,e.centroidy=ce,!0}return!1}return!1}for(var Me=[],Ce=!0,ke=null,Oe=null,Pe=-1e100,Se=!0,Ae=t.polygon.gverts.next,je=0,Ee=t.polygon.edges.head;null!=Ee;){var Ie=Ee.elt,Te=Ie.gnormx*n.circle.worldCOMx+Ie.gnormy*n.circle.worldCOMy;if(Te>Ie.gprojection+n.circle.radius){Se=!1;break}Te+n.circle.radius>Ie.gprojection+jp.epsilon&&(Ce=!1,Me[je]=!0),Pe<(Te-=Ie.gprojection+n.circle.radius)&&(Pe=Te,ke=Ie,Oe=Ae),Ae=Ae.next,++je,Ee=Ee.next}if(Se){if(Ce){var Ne=n.circle.area,Le=n.circle.worldCOMx,Ve=n.circle.worldCOMy;return e.overlap=Ne,e.centroidx=Le,e.centroidy=Ve,!0}var De,we=(null==Oe.next?t.polygon.gverts:Oe).next,Ne=n.circle.worldCOMy*ke.gnormx-n.circle.worldCOMx*ke.gnormy;if(Ne<=Oe.y*ke.gnormx-Oe.x*ke.gnormy?(De=n.circle.radius,Ve=Le=0,(Le=Oe.x-n.circle.worldCOMx)*Le+(Ve=Oe.y-n.circle.worldCOMy)*Ve<=De*De):!(Ne>=we.y*ke.gnormx-we.x*ke.gnormy)||(ii=n.circle.radius,Ne=De=0,(De=we.x-n.circle.worldCOMx)*De+(Ne=we.y-n.circle.worldCOMy)*Ne<=ii*ii)){for(var Fe=[],Re=0,Ze=!0,Be=null,Ge=0,qe=t.polygon.gverts.next;null!=qe;){var Ue=qe.x,Ke=qe.y,We=Ue-n.circle.worldCOMx,Ye=Ke-n.circle.worldCOMy;(Fe[Re]=We*We+Ye*Ye<=n.circle.radius*n.circle.radius)?(Ge=Re,Be=qe):Ze=!1,++Re,qe=qe.next}if(Ze){var Je=t.polygon;if(Je.zip_worldCOM&&null!=Je.body){if(Je.zip_worldCOM=!1,Je.zip_localCOM){if(Je.zip_localCOM=!1,1==Je.type){var Xe=Je.polygon;if(null==Xe.lverts.next.next)Xe.localCOMx=Xe.lverts.next.x,Xe.localCOMy=Xe.lverts.next.y;else if(null==Xe.lverts.next.next.next)Xe.localCOMx=Xe.lverts.next.x,Xe.localCOMy=Xe.lverts.next.y,Xe.localCOMx+=Xe.lverts.next.next.x,Xe.localCOMy+=Xe.lverts.next.next.y,Xe.localCOMx*=.5,Xe.localCOMy*=.5;else{Xe.localCOMx=0;var He=Xe.localCOMy=0,$e=Xe.lverts.next,Qe=$e,ni=$e=$e.next;for($e=$e.next;null!=$e;){var ti=$e;He+=ni.x*(ti.y-Qe.y);var ei=ti.y*ni.x-ti.x*ni.y;Xe.localCOMx+=(ni.x+ti.x)*ei,Xe.localCOMy+=(ni.y+ti.y)*ei,Qe=ni,ni=ti,$e=$e.next}var ii=$e=Xe.lverts.next;He+=ni.x*(ii.y-Qe.y);var pi=ii.y*ni.x-ii.x*ni.y;Xe.localCOMx+=(ni.x+ii.x)*pi,Xe.localCOMy+=(ni.y+ii.y)*pi,Qe=ni;var li=$e=$e.next;He+=ii.x*(li.y-Qe.y);pi=li.y*ii.x-li.x*ii.y;Xe.localCOMx+=(ii.x+li.x)*pi,Xe.localCOMy+=(ii.y+li.y)*pi;li=He=1/(3*He);Xe.localCOMx*=li,Xe.localCOMy*=li}}null!=Je.wrap_localCOM&&(Je.wrap_localCOM.zpp_inner.x=Je.localCOMx,Je.wrap_localCOM.zpp_inner.y=Je.localCOMy)}pi=Je.body;pi.zip_axis&&(pi.zip_axis=!1,pi.axisx=Math.sin(pi.rot),pi.axisy=Math.cos(pi.rot)),Je.worldCOMx=Je.body.posx+(Je.body.axisy*Je.localCOMx-Je.body.axisx*Je.localCOMy),Je.worldCOMy=Je.body.posy+(Je.localCOMx*Je.body.axisx+Je.localCOMy*Je.body.axisy)}li=t.polygon.area,pi=t.polygon.worldCOMx,Je=t.polygon.worldCOMy;return e.overlap=li,e.centroidx=pi,e.centroidy=Je,!0}for(;null!=Ep.flowpoly.head;){var ri=Ep.flowpoly.pop_unsafe();ri._inuse||(null!=ri.outer&&(ri.outer.zpp_inner=null,ri.outer=null),ri._isimmutable=null,ri._validate=null,ri._invalidate=null,ri.next=Ip.zpp_pool,Ip.zpp_pool=ri)}Ep.flowsegs.clear();var oi=null,ai=1;for(null==Be?(Be=t.polygon.gverts.next,ai=2):(oi=Be,Ep.flowpoly.add(oi));0!=ai;)if(1==ai)if(null==(Be=Be.next)&&(Be=t.polygon.gverts.next),++Ge>=t.polygon.edgeCnt&&(Ge=0),Fe[Ge]){var si=oi.x,_i=oi.y,hi=0,ui=0;if((hi=si-Be.x)*hi+(ui=_i-Be.y)*ui<jp.epsilon)break;Ep.flowpoly.add(Be)}else{var xi,di=Ep.flowpoly.head.elt,yi=Be,si=0,hi=0,_i=0,zi=0,ui=(si=yi.x-di.x)*si+(hi=yi.y-di.y)*hi,hi=2*((_i=di.x-n.circle.worldCOMx)*si+(zi=di.y-n.circle.worldCOMy)*hi),_i=Math.sqrt(hi*hi-4*ui*(_i*_i+zi*zi-n.circle.radius*n.circle.radius)),zi=(-hi-_i)*(ui=1/(2*ui)),_i=zi<jp.epsilon?(-hi+_i)*ui:zi,ui=0,zi=0,ui=di.x+(yi.x-di.x)*_i,zi=di.y+(yi.y-di.y)*_i,di=0,_i=0;if((di=oi.x-ui)*di+(_i=oi.y-zi)*_i<jp.epsilon)break;null==Ip.zpp_pool?xi=new Ip:(xi=Ip.zpp_pool,Ip.zpp_pool=xi.next,xi.next=null),xi.weak=!1,xi._immutable=!1,xi.x=ui,xi.y=zi,Ep.flowpoly.add(xi),ai=2}else if(2==ai){zi=Be.next;null==zi&&(zi=t.polygon.gverts.next);for(var ci=Be,ai=0,vi=zi,mi=zi;;){var fi=mi,bi=Ge+1;if(bi==t.polygon.edgeCnt&&(bi=0),Me[Ge]){if(Fe[bi]){var gi,wi=0,Mi=0,Ci=0,ki=0,Oi=(wi=fi.x-ci.x)*wi+(Mi=fi.y-ci.y)*Mi,Pi=2*((Ci=ci.x-n.circle.worldCOMx)*wi+(ki=ci.y-n.circle.worldCOMy)*Mi),Si=Math.sqrt(Pi*Pi-4*Oi*(Ci*Ci+ki*ki-n.circle.radius*n.circle.radius)),wi=(-Pi-Si)*(Oi=1/(2*Oi)),Mi=wi<jp.epsilon?(-Pi+Si)*Oi:wi,Ci=0,ki=0,Ci=ci.x+(fi.x-ci.x)*Mi,ki=ci.y+(fi.y-ci.y)*Mi,Pi=0,Si=0;if((Pi=oi.x-Ci)*Pi+(Si=oi.y-ki)*Si<jp.epsilon){ai=0,mi=vi;break}null==Ip.zpp_pool?gi=new Ip:(gi=Ip.zpp_pool,Ip.zpp_pool=gi.next,gi.next=null),gi.weak=!1,gi._immutable=!1,gi.x=Ci,gi.y=ki;Oi=gi;Ep.flowsegs.add(Ep.flowpoly.head.elt),Ep.flowsegs.add(Oi),Ep.flowpoly.add(Oi),ai=1,mi=vi;break}wi=0,Mi=0,Pi=0,Si=0,Ci=0,ki=0,Oi=(Pi=fi.x-ci.x)*Pi+(Si=fi.y-ci.y)*Si,Si=2*((Ci=ci.x-n.circle.worldCOMx)*Pi+(ki=ci.y-n.circle.worldCOMy)*Si),Ci=Si*Si-4*Oi*(Ci*Ci+ki*ki-n.circle.radius*n.circle.radius),ki=Ci*Ci<jp.epsilon?(wi=Ci<0?10:Mi=-Si/(2*Oi),!1):(wi=(-Si-(Ci=Math.sqrt(Ci)))*(Oi=1/(2*Oi)),Mi=(-Si+Ci)*Oi,!0);if(wi<1-jp.epsilon&&Mi>jp.epsilon){var Ai,Si=0,Ci=0,Si=ci.x+(fi.x-ci.x)*wi,Ci=ci.y+(fi.y-ci.y)*wi;if(null!=oi&&(wi=Oi=0,(Oi=oi.x-Si)*Oi+(wi=oi.y-Ci)*wi<jp.epsilon)){ai=0,mi=vi;break}null==Ip.zpp_pool?Ai=new Ip:(Ai=Ip.zpp_pool,Ip.zpp_pool=Ai.next,Ai.next=null),Ai.weak=!1,Ai._immutable=!1,Ai.x=Si,Ai.y=Ci;var ji,Ci=Ai;null!=Ep.flowpoly.head&&(Ep.flowsegs.add(Ep.flowpoly.head.elt),Ep.flowsegs.add(Ci)),Ep.flowpoly.add(Ci),null==oi&&(oi=Ep.flowpoly.head.elt),ki&&(ki=Ci=0,Ci=ci.x+(fi.x-ci.x)*Mi,ki=ci.y+(fi.y-ci.y)*Mi,null==Ip.zpp_pool?ji=new Ip:(ji=Ip.zpp_pool,Ip.zpp_pool=ji.next,ji.next=null),ji.weak=!1,ji._immutable=!1,ji.x=Ci,ji.y=ki,Ep.flowpoly.add(ji))}}ci=fi,Ge=bi,null==(mi=(Be=mi).next)&&(mi=t.polygon.gverts.next);break}for(;mi!=vi;){var Ei=mi,Ii=Ge+1;if(Ii==t.polygon.edgeCnt&&(Ii=0),Me[Ge]){if(Fe[Ii]){var Ti,Ni=0,Li=0,Vi=0,Di=0,Fi=(Ni=Ei.x-ci.x)*Ni+(Li=Ei.y-ci.y)*Li,Ri=2*((Vi=ci.x-n.circle.worldCOMx)*Ni+(Di=ci.y-n.circle.worldCOMy)*Li),Zi=Math.sqrt(Ri*Ri-4*Fi*(Vi*Vi+Di*Di-n.circle.radius*n.circle.radius)),Ni=(-Ri-Zi)*(Fi=1/(2*Fi)),Li=Ni<jp.epsilon?(-Ri+Zi)*Fi:Ni,Vi=0,Di=0,Vi=ci.x+(Ei.x-ci.x)*Li,Di=ci.y+(Ei.y-ci.y)*Li,Ri=0,Zi=0;if((Ri=oi.x-Vi)*Ri+(Zi=oi.y-Di)*Zi<jp.epsilon){ai=0;break}null==Ip.zpp_pool?Ti=new Ip:(Ti=Ip.zpp_pool,Ip.zpp_pool=Ti.next,Ti.next=null),Ti.weak=!1,Ti._immutable=!1,Ti.x=Vi,Ti.y=Di;Fi=Ti;Ep.flowsegs.add(Ep.flowpoly.head.elt),Ep.flowsegs.add(Fi),Ep.flowpoly.add(Fi),ai=1;break}Ni=0,Li=0,Ri=0,Zi=0,Vi=0,Di=0,Fi=(Ri=Ei.x-ci.x)*Ri+(Zi=Ei.y-ci.y)*Zi,Zi=2*((Vi=ci.x-n.circle.worldCOMx)*Ri+(Di=ci.y-n.circle.worldCOMy)*Zi),Vi=Zi*Zi-4*Fi*(Vi*Vi+Di*Di-n.circle.radius*n.circle.radius),Di=Vi*Vi<jp.epsilon?(Ni=Vi<0?10:Li=-Zi/(2*Fi),!1):(Ni=(-Zi-(Vi=Math.sqrt(Vi)))*(Fi=1/(2*Fi)),Li=(-Zi+Vi)*Fi,!0);if(Ni<1-jp.epsilon&&Li>jp.epsilon){var Bi,Zi=0,Vi=0,Zi=ci.x+(Ei.x-ci.x)*Ni,Vi=ci.y+(Ei.y-ci.y)*Ni;if(null!=oi&&(Ni=Fi=0,(Fi=oi.x-Zi)*Fi+(Ni=oi.y-Vi)*Ni<jp.epsilon)){ai=0;break}null==Ip.zpp_pool?Bi=new Ip:(Bi=Ip.zpp_pool,Ip.zpp_pool=Bi.next,Bi.next=null),Bi.weak=!1,Bi._immutable=!1,Bi.x=Zi,Bi.y=Vi;var Gi,Vi=Bi;null!=Ep.flowpoly.head&&(Ep.flowsegs.add(Ep.flowpoly.head.elt),Ep.flowsegs.add(Vi)),Ep.flowpoly.add(Vi),null==oi&&(oi=Ep.flowpoly.head.elt),Di&&(Di=Vi=0,Vi=ci.x+(Ei.x-ci.x)*Li,Di=ci.y+(Ei.y-ci.y)*Li,null==Ip.zpp_pool?Gi=new Ip:(Gi=Ip.zpp_pool,Ip.zpp_pool=Gi.next,Gi.next=null),Gi.weak=!1,Gi._immutable=!1,Gi.x=Vi,Gi.y=Di,Ep.flowpoly.add(Gi))}}ci=Ei,Ge=Ii,null==(mi=(Be=mi).next)&&(mi=t.polygon.gverts.next)}}if(null==Ep.flowpoly.head)return!1;if(null==Ep.flowpoly.head.next){for(var qi=!0,Ui=t.polygon.edges.head;null!=Ui;){var Ki=Ui.elt;if(Ki.gnormx*n.circle.worldCOMx+Ki.gnormy*n.circle.worldCOMy>Ki.gprojection){qi=!1;break}Ui=Ui.next}if(qi){var Je=n.circle.area,Wi=n.circle.worldCOMx,Yi=n.circle.worldCOMy;return e.overlap=Je,e.centroidx=Wi,e.centroidy=Yi,!0}return!1}var Ji=0,Xi=0,Hi=0;if(null!=Ep.flowpoly.head.next.next){var $i=0,Qi=0,np=0,Qi=0,np=0,$i=0,tp=Ep.flowpoly.head,ep=tp.elt,ip=(tp=tp.next).elt;for(tp=tp.next;null!=tp;){var pp=tp.elt;$i+=ip.x*(pp.y-ep.y);var lp=pp.y*ip.x-pp.x*ip.y;Qi+=(ip.x+pp.x)*lp,np+=(ip.y+pp.y)*lp,ep=ip,ip=pp,tp=tp.next}var rp=(tp=Ep.flowpoly.head).elt;$i+=ip.x*(rp.y-ep.y);var op=rp.y*ip.x-rp.x*ip.y;Qi+=(ip.x+rp.x)*op,np+=(ip.y+rp.y)*op,ep=ip;var ap=(tp=tp.next).elt;$i+=rp.x*(ap.y-ep.y);var sp=ap.y*rp.x-ap.x*rp.y;Qi+=(rp.x+ap.x)*sp,np+=(rp.y+ap.y)*sp;var _p=1/(6*($i*=.5)),hp=-$i;Ji+=(Qi*=_p)*hp,Xi+=(np*=_p)*hp,Hi=0-$i}else Ep.flowsegs.add(Ep.flowpoly.head.elt),Ep.flowsegs.add(Ep.flowpoly.head.next.elt);for(;null!=Ep.flowsegs.head;){var up=Ep.flowsegs.pop_unsafe(),xp=Ep.flowsegs.pop_unsafe(),dp=0,yp=0,dp=xp.x-up.x,yp=xp.y-up.y,zp=1/Math.sqrt(dp*dp+yp*yp),cp=dp*=zp;dp=-(yp*=zp),yp=cp;var vp=up.x+xp.x,mp=up.y+xp.y;vp*=.5,mp*=.5;var fp=dp*(vp-=n.circle.worldCOMx)+yp*(mp-=n.circle.worldCOMy),cp=fp/n.circle.radius,up=Math.sqrt(1-cp*cp),xp=Math.acos(cp),bp=n.circle.radius*(n.circle.radius*xp-fp*up),zp=.6666666666666666*n.circle.radius*up*up*up/(xp-cp*up);vp=n.circle.worldCOMx,mp=n.circle.worldCOMy,Ji+=(vp+=dp*zp)*bp,Xi+=(mp+=yp*zp)*bp,Hi+=bp}Wi=1/Hi;return Ji*=Wi,Xi*=Wi,e.overlap=Hi,e.centroidx=Ji,e.centroidy=Xi,!0}return!1}return!1}Yi=n.circle,op=t.circle,rp=0,rp=op.worldCOMx-Yi.worldCOMx,ap=op.worldCOMy-Yi.worldCOMy,sp=Yi.radius+op.radius,_p=rp*rp+ap*ap;if(sp*sp<_p)return!1;if(_p<jp.epsilon*jp.epsilon)return Yi.radius<op.radius?(hp=Yi.area,Wi=Yi.worldCOMx,sp=Yi.worldCOMy,e.overlap=hp,e.centroidx=Wi,e.centroidy=sp):(Pp=op.area,Sp=op.worldCOMx,Ap=op.worldCOMy,e.overlap=Pp,e.centroidx=Sp,e.centroidy=Ap),!0;var gp,wp,Mp,Cp,kp,Op,Pp=Math.sqrt(_p),Sp=1/Pp,Ap=.5*(Pp-(op.radius*op.radius-Yi.radius*Yi.radius)*Sp);return Ap<=-Yi.radius?(gp=Yi.area,wp=Yi.worldCOMx,Op=Yi.worldCOMy,e.overlap=gp,e.centroidx=wp,e.centroidy=Op):(_p=Pp-Ap)<=-op.radius?(Cp=op.area,kp=op.worldCOMx,Mp=op.worldCOMy,e.overlap=Cp,e.centroidx=kp,e.centroidy=Mp):(Op=wp=gp=0,Cp=Ap/Yi.radius,kp=Math.sqrt(1-Cp*Cp),Mp=Math.acos(Cp),gp=Yi.radius*(Yi.radius*Mp-Ap*kp),wp=.6666666666666666*Yi.radius*kp*kp*kp/(Mp-Cp*kp),Mp=_p/op.radius,Cp=Math.sqrt(1-Mp*Mp),kp=Math.acos(Mp),_p=gp+(Op=op.radius*(op.radius*kp-_p*Cp)),Sp=(wp*gp+(Pp-.6666666666666666*op.radius*Cp*Cp*Cp/(kp-Mp*Cp))*Op)/_p*Sp,rp=Yi.worldCOMx+rp*Sp,Sp=Yi.worldCOMy+ap*Sp,e.overlap=_p,e.centroidx=rp,e.centroidy=Sp),!0},Ep.prototype.__class__=Ep;var xt=zpp_nape.geom.ZPP_Convex=function(){};xt.__name__=["zpp_nape","geom","ZPP_Convex"],xt.isinner=function(n,t,e){var i=n.x-t.x,p=n.y-t.y,n=0,n=e.x-t.x;return 0<=(e.y-t.y)*i-n*p},xt.optimise=function(n){var t=n.vertices,e=n.vertices;if(null!=t)for(var i=t;i.sort(),(i=i.next)!=e;);var t=n.vertices,p=n.vertices;if(null!=t)for(var l=t;;){for(var r=l,o=r.prev,a=null,s=r.diagonals.head;null!=s;){var _=s.elt;if(xt.isinner(null==s.next?r.next:s.next.elt,r,o)){for(var h=!0,u=_.prev,x=null,d=_.diagonals.head;null!=d;){var y=d.elt;if(y==r){h=xt.isinner(null==d.next?_.next:d.next.elt,_,u);break}u=y,d=(x=d).next}h?(s=r.diagonals.erase(a),_.diagonals.erase(x)):(o=_,s=(a=s).next)}else o=_,s=(a=s).next}if((l=l.next)==p)break}},xt.prototype.__class__=xt;var dt=zpp_nape.geom.ZPP_ConvexRayResult=function(){this.toiDistance=0,this.next=null,this.inner=!1,this.ray=null,this.position=null,this.convex=null,this.shape=null,this.normal=null};dt.__name__=["zpp_nape","geom","ZPP_ConvexRayResult"],dt.getRay=function(n,t,e,i){var p;null==dt.rayPool?(dt.internal=!0,(p=new K).zpp_inner=new dt,p.zpp_inner.ray=p,dt.internal=!1):(p=dt.rayPool.ray,dt.rayPool=dt.rayPool.next,p.zpp_inner.next=null);var l=p.zpp_inner;return(l.normal=n).zpp_inner._immutable=!0,l.toiDistance=t,l.inner=e,l.shape=i,p},dt.getConvex=function(n,t,e,i){var p;null==dt.convexPool?(dt.internal=!0,(p=new Z).zpp_inner=new dt,p.zpp_inner.convex=p,dt.internal=!1):(p=dt.convexPool.convex,dt.convexPool=dt.convexPool.next,p.zpp_inner.next=null);var l=p.zpp_inner;return l.normal=n,l.position=t,n.zpp_inner._immutable=!0,t.zpp_inner._immutable=!0,l.toiDistance=e,l.shape=i,p},dt.prototype.normal=null,dt.prototype.shape=null,dt.prototype.convex=null,dt.prototype.position=null,dt.prototype.ray=null,dt.prototype.inner=null,dt.prototype.next=null,dt.prototype.toiDistance=null,dt.prototype.disposed=function(){},dt.prototype.free=function(){this.normal.zpp_inner._immutable=!1;var n=this.normal,t=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,null!=this.position&&(this.position.zpp_inner._immutable=!1,t=(n=this.position).zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t),this.shape=null,this.toiDistance=0,null!=this.convex?(this.next=dt.convexPool,dt.convexPool=this):(this.next=dt.rayPool,dt.rayPool=this)},dt.prototype.__class__=dt;var ye=zpp_nape.geom.ZPP_CutVert=function(){this.used=!1,this.rank=0,this.parent=null,this.positive=!1,this.value=0,this.vert=null,this.posy=0,this.posx=0,this.next=null,this.prev=null};ye.__name__=["zpp_nape","geom","ZPP_CutVert"],ye.path=function(n){var t;return null==ye.zpp_pool?t=new ye:(t=ye.zpp_pool,ye.zpp_pool=t.next,t.next=null),t.vert=n,(t.parent=t).rank=0,t.used=!1,t},ye.prototype.prev=null,ye.prototype.next=null,ye.prototype.posx=null,ye.prototype.posy=null,ye.prototype.vert=null,ye.prototype.value=null,ye.prototype.positive=null,ye.prototype.parent=null,ye.prototype.rank=null,ye.prototype.used=null,ye.prototype.alloc=function(){},ye.prototype.free=function(){this.vert=null,this.parent=null},ye.prototype.__class__=ye;var ze=zpp_nape.geom.ZPP_CutInt=function(){this.path1=null,this.start=null,this.end=null,this.path0=null,this.vertex=!1,this.virtualint=!1,this.time=0,this.next=null};ze.__name__=["zpp_nape","geom","ZPP_CutInt"],ze.get=function(n,t,e,i,p,l,r){var o;return null==r&&(r=!1),null==l&&(l=!1),null==ze.zpp_pool?o=new ze:(o=ze.zpp_pool,ze.zpp_pool=o.next,o.next=null),o.virtualint=l,o.end=t,o.start=e,o.path0=i,o.path1=p,o.time=n,o.vertex=r,o},ze.prototype.next=null,ze.prototype.time=null,ze.prototype.virtualint=null,ze.prototype.vertex=null,ze.prototype.path0=null,ze.prototype.end=null,ze.prototype.start=null,ze.prototype.path1=null,ze.prototype.alloc=function(){},ze.prototype.free=function(){this.end=this.start=null,this.path0=this.path1=null},ze.prototype.__class__=ze;var ce=zpp_nape.geom.ZPP_Cutter=function(){};ce.__name__=["zpp_nape","geom","ZPP_Cutter"],ce.run=function(n,t,e,i,p,l){var r,o,a=t.zpp_inner;null!=a._validate&&a._validate(),r=t.zpp_inner.x;a=t.zpp_inner;null!=a._validate&&a._validate(),o=t.zpp_inner.y;var s,_,t=e.zpp_inner;null!=t._validate&&t._validate(),s=e.zpp_inner.x-r;t=e.zpp_inner;null!=t._validate&&t._validate();for(var h,u=i?0:-1/0,x=p?1:1/0,d=-(o*s-r*(_=e.zpp_inner.y-o)),y=null,z=!1,c=n;;){null==ye.zpp_pool?h=new ye:(h=ye.zpp_pool,ye.zpp_pool=h.next,h.next=null),h.vert=c,h.posx=h.vert.x,h.posy=h.vert.y,h.value=h.posy*s-h.posx*_+d,h.positive=0<h.value,0==h.value&&(z=!0);var v=h;if(null==y?y=v.prev=v.next=v:(v.prev=y,v.next=y.next,y.next.prev=v,y.next=v),y=v,(c=c.next)==n)break}if(z){var m=null,f=y;if(null!=y)for(var b=y;;){if(0!=b.value){m=b;break}if((b=b.next)==f)break}var g=s,w=_,M=1/Math.sqrt(g*g+w*w),C=g*=M;g=-(w*=M),w=C;for(var k=null,O=m;;)if(0==O.value||null!=k&&O!=k.next){var P=k.value*O.value;if(0!=P){var S,A=k.next;if(0<P)S=k.positive;else{var j=A.next,E=A.posx+j.posx,P=A.posy+j.posy,I=(E*=.5)+1e-8*g,T=(P*=.5)+1e-8*w,N=!1;if(null!=n)for(var L=n;;){var V=L.prev;if((L.y<T&&V.y>=T||V.y<T&&L.y>=T)&&(L.x<=I||V.x<=I)&&L.x+(T-L.y)/(V.y-L.y)*(V.x-L.x)<I&&(N=!N),(L=L.next)==n)break}S=N}var D=O;if(null!=A)for(var F=A;F.positive=S,(F=F.next)!=D;);if((O=(k=O).next)==m)break}else if((O=O.next)==m)break}else if((O=(k=O).next)==m)break;for(;;){if(0!=O.value&&(null==k||O==k.next)){O=(k=O).next;break}var R=k.value*O.value;if(0==R){O=O.next;break}var Z,B=k.next;if(0<R)Z=k.positive;else{var G=B.next,q=B.posx+G.posx,R=B.posy+G.posy,U=(q*=.5)+1e-8*g,K=(R*=.5)+1e-8*w,W=!1;if(null!=n)for(var Y=n;;){var J=Y.prev;if((Y.y<K&&J.y>=K||J.y<K&&Y.y>=K)&&(Y.x<=U||J.x<=U)&&Y.x+(K-Y.y)/(J.y-Y.y)*(J.x-Y.x)<U&&(W=!W),(Y=Y.next)==n)break}Z=W}var X=O;if(null!=B)for(var H=B;H.positive=Z,(H=H.next)!=X;);O=(k=O).next;break}}null==ce.ints&&(ce.ints=new ge),null==ce.paths&&(ce.paths=new we);var $=null,M=y.posx,C=y.posy;null==ii.zpp_pool?Q=new ii:(Q=ii.zpp_pool,ii.zpp_pool=Q.next,Q.next=null),Q.forced=!1,Q.x=M,Q.y=C;C=Q;null==$?$=C.prev=C.next=C:(C.next=$,C.prev=$.prev,$.prev.next=C,$.prev=C);var Q=$;null==ye.zpp_pool?Cn=new ye:(Cn=ye.zpp_pool,ye.zpp_pool=Cn.next,Cn.next=null),Cn.vert=$,(Cn.parent=Cn).rank=0,Cn.used=!1;C=Cn;ce.paths.add(C);for(var nn=y;;){var tn,en=nn.next,pn=en.posx,ln=en.posy;null==ii.zpp_pool?tn=new ii:(tn=ii.zpp_pool,ii.zpp_pool=tn.next,tn.next=null),tn.forced=!1,tn.x=pn,tn.y=ln;var rn,on,an,sn,_n,hn,un,xn,dn,yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn=tn;if(nn.positive==en.positive?null==$?$=Mn.prev=Mn.next=Mn:(Mn.next=$,Mn.prev=$.prev,$.prev.next=Mn,$.prev=Mn):(on=rn=0,bn=1/(bn=_*(rn=en.posx-nn.posx)-s*(on=en.posy-nn.posy)),vn=mn=0,(pn=(on*(mn=r-nn.posx)-rn*(vn=o-nn.posy))*bn)<u||x<pn?(null==ze.zpp_pool?an=new ze:(an=ze.zpp_pool,ze.zpp_pool=an.next,an.next=null),an.virtualint=!0,an.end=null,an.start=null,an.path0=null,an.path1=null,an.time=pn,an.vertex=!1,ce.ints.add(an),null==$?$=Mn.prev=Mn.next=Mn:(Mn.next=$,Mn.prev=$.prev,$.prev.next=Mn,$.prev=Mn)):0==nn.value?(ln=$.prev,$=null,yn=ln.x,un=ln.y,null==ii.zpp_pool?sn=new ii:(sn=ii.zpp_pool,ii.zpp_pool=sn.next,sn.next=null),sn.forced=!1,sn.x=yn,sn.y=un,yn=sn,null==$?$=yn.prev=yn.next=yn:(yn.next=$,yn.prev=$.prev,$.prev.next=yn,$.prev=yn),null==$?$=Mn.prev=Mn.next=Mn:(Mn.next=$,Mn.prev=$.prev,$.prev.next=Mn,$.prev=Mn),un=ce.paths.head.elt,null==ye.zpp_pool?_n=new ye:(_n=ye.zpp_pool,ye.zpp_pool=_n.next,_n.next=null),_n.vert=$,(_n.parent=_n).rank=0,_n.used=!1,ce.paths.add(_n),yn=ce.paths.head.elt,null==ze.zpp_pool?hn=new ze:(hn=ze.zpp_pool,ze.zpp_pool=hn.next,hn.next=null),hn.virtualint=!0,hn.end=ln,hn.start=$,hn.path0=un,hn.path1=yn,hn.time=pn,hn.vertex=!1,ce.ints.add(hn)):0==en.value?(null==$?$=Mn.prev=Mn.next=Mn:(Mn.next=$,Mn.prev=$.prev,$.prev.next=Mn,$.prev=Mn),un=$.prev,$=null,yn=en.posx,en=en.posy,null==ii.zpp_pool?xn=new ii:(xn=ii.zpp_pool,ii.zpp_pool=xn.next,xn.next=null),xn.forced=!1,xn.x=yn,xn.y=en,yn=xn,null==$?$=yn.prev=yn.next=yn:(yn.next=$,yn.prev=$.prev,$.prev.next=yn,$.prev=yn),en=ce.paths.head.elt,null==ye.zpp_pool?dn=new ye:(dn=ye.zpp_pool,ye.zpp_pool=dn.next,dn.next=null),dn.vert=$,(dn.parent=dn).rank=0,dn.used=!1,ce.paths.add(dn),yn=ce.paths.head.elt,null==ze.zpp_pool?zn=new ze:(zn=ze.zpp_pool,ze.zpp_pool=zn.next,zn.next=null),zn.virtualint=!0,zn.end=un,zn.start=$,zn.path0=en,zn.path1=yn,zn.time=pn,zn.vertex=!1,ce.ints.add(zn)):(mn=(_*mn-s*vn)*bn,bn=vn=0,vn=nn.posx,bn=nn.posy,vn+=rn*mn,bn+=on*mn,null==ii.zpp_pool?cn=new ii:(cn=ii.zpp_pool,ii.zpp_pool=cn.next,cn.next=null),cn.forced=!1,cn.x=vn,cn.y=bn,mn=cn,null==$?$=mn.prev=mn.next=mn:(mn.next=$,mn.prev=$.prev,$.prev.next=mn,$.prev=mn),mn=$.prev,($=null)==ii.zpp_pool?fn=new ii:(fn=ii.zpp_pool,ii.zpp_pool=fn.next,fn.next=null),fn.forced=!1,fn.x=vn,fn.y=bn,bn=fn,null==$?$=bn.prev=bn.next=bn:(bn.next=$,bn.prev=$.prev,$.prev.next=bn,$.prev=bn),null==$?$=Mn.prev=Mn.next=Mn:(Mn.next=$,Mn.prev=$.prev,$.prev.next=Mn,$.prev=Mn),bn=ce.paths.head.elt,null==ye.zpp_pool?gn=new ye:(gn=ye.zpp_pool,ye.zpp_pool=gn.next,gn.next=null),gn.vert=$,(gn.parent=gn).rank=0,gn.used=!1,ce.paths.add(gn),Mn=ce.paths.head.elt,null==ze.zpp_pool?wn=new ze:(wn=ze.zpp_pool,ze.zpp_pool=wn.next,wn.next=null),wn.virtualint=!1,wn.end=mn,wn.start=$,wn.path0=bn,wn.path1=Mn,wn.time=pn,wn.vertex=!1,ce.ints.add(wn))),(nn=nn.next)==y)break}var Cn=$.prev;Cn.next.prev=Q.prev,Q.prev.next=Cn.next,(Cn.next=Q).prev=Cn;var kn,Cn=ce.paths.head.elt;if(C==C.parent)Nn=C;else{for(var On=C,Pn=null;On!=On.parent;){var Sn=On.parent;On.parent=Pn,Pn=On,On=Sn}for(;null!=Pn;){var An=Pn.parent;Pn.parent=On,Pn=An}Nn=On}if(Cn==Cn.parent)kn=Cn;else{for(var jn=Cn,En=null;jn!=jn.parent;){var In=jn.parent;jn.parent=En,En=jn,jn=In}for(;null!=En;){var Tn=En.parent;En.parent=jn,En=Tn}kn=jn}Nn!=kn&&(Nn.rank<kn.rank?Nn.parent=kn:Nn.rank>kn.rank?kn.parent=Nn:(kn.parent=Nn).rank++);var Nn=ce.ints;if(null!=Nn.head&&null!=Nn.head.next){for(var Ln,Vn,Dn,Fn=Nn.head,Rn=null,Zn=null,Bn=null,Gn=null,qn=1;;){for(Ln=0,Zn=Fn,Rn=Fn=null;null!=Zn;){for(++Ln,Bn=Zn,Vn=0,Dn=qn;null!=Bn&&Vn<qn;)++Vn,Bn=Bn.next;for(;0<Vn||0<Dn&&null!=Bn;)0!=Vn&&(0==Dn||null==Bn||Zn.elt.time<Bn.elt.time)?(Zn=(Gn=Zn).next,--Vn):(Bn=(Gn=Bn).next,--Dn),null!=Rn?Rn.next=Gn:Fn=Gn,Rn=Gn;Zn=Bn}if(Rn.next=null,qn<<=1,!(1<Ln))break}Nn.head=Fn,Nn.modified=!0,Nn.pushmod=!0}for(;null!=ce.ints.head;){var Un,Kn,Wn,Yn,Jn=ce.ints.pop_unsafe(),Xn=ce.ints.pop_unsafe();if(Jn.virtualint||Xn.virtualint){if(Jn.virtualint&&!Xn.virtualint){var Hn,$n,Qn,nt,tt,et,it,pt,lt,rt,ot,at=null!=Xn.end&&Xn.end.prev==Xn.end?((Xn.end.next=Xn.end.prev=null)!=(Qn=Xn.end).wrap&&(Qn.wrap.zpp_inner._inuse=!1,$n=(Hn=Qn.wrap).zpp_inner,Hn.zpp_inner.outer=null,Hn.zpp_inner=null,Hn.zpp_pool=Vi.poolVec2,Vi.poolVec2=Hn,null!=$n.outer&&($n.outer.zpp_inner=null,$n.outer=null),$n._isimmutable=null,$n._validate=null,$n._invalidate=null,$n.next=Ip.zpp_pool,Ip.zpp_pool=$n,Qn.wrap=null),Qn.prev=Qn.next=null,Qn.next=ii.zpp_pool,ii.zpp_pool=Qn,null):(at=Xn.end.prev,Xn.end.prev.next=Xn.end.next,Xn.end.next.prev=Xn.end.prev,(Xn.end.next=Xn.end.prev=null)!=(Hn=Xn.end).wrap&&(Hn.wrap.zpp_inner._inuse=!1,Qn=($n=Hn.wrap).zpp_inner,$n.zpp_inner.outer=null,$n.zpp_inner=null,$n.zpp_pool=Vi.poolVec2,Vi.poolVec2=$n,null!=Qn.outer&&(Qn.outer.zpp_inner=null,Qn.outer=null),Qn._isimmutable=null,Qn._validate=null,Qn._invalidate=null,Qn.next=Ip.zpp_pool,Ip.zpp_pool=Qn,Hn.wrap=null),Hn.prev=Hn.next=null,Hn.next=ii.zpp_pool,ii.zpp_pool=Hn,Xn.end=null,at);if(Xn.end=at,Xn.vertex||(Xn.end!=Xn.path0.vert?(Xn.start.x=Xn.end.x,Xn.start.y=Xn.end.y,et=null!=Xn.end&&Xn.end.prev==Xn.end?((Xn.end.next=Xn.end.prev=null)!=(tt=Xn.end).wrap&&(tt.wrap.zpp_inner._inuse=!1,nt=(at=tt.wrap).zpp_inner,at.zpp_inner.outer=null,at.zpp_inner=null,at.zpp_pool=Vi.poolVec2,Vi.poolVec2=at,null!=nt.outer&&(nt.outer.zpp_inner=null,nt.outer=null),nt._isimmutable=null,nt._validate=null,nt._invalidate=null,nt.next=Ip.zpp_pool,Ip.zpp_pool=nt,tt.wrap=null),tt.prev=tt.next=null,tt.next=ii.zpp_pool,ii.zpp_pool=tt,null):(lt=Xn.end.prev,Xn.end.prev.next=Xn.end.next,Xn.end.next.prev=Xn.end.prev,(Xn.end.next=Xn.end.prev=null)!=(et=Xn.end).wrap&&(et.wrap.zpp_inner._inuse=!1,tt=(nt=et.wrap).zpp_inner,nt.zpp_inner.outer=null,nt.zpp_inner=null,nt.zpp_pool=Vi.poolVec2,Vi.poolVec2=nt,null!=tt.outer&&(tt.outer.zpp_inner=null,tt.outer=null),tt._isimmutable=null,tt._validate=null,tt._invalidate=null,tt.next=Ip.zpp_pool,Ip.zpp_pool=tt,et.wrap=null),et.prev=et.next=null,et.next=ii.zpp_pool,ii.zpp_pool=et,Xn.end=null,lt),Xn.end=et):(lt=Xn.start.next,Xn.start.x=lt.x,Xn.start.y=lt.y,null!=lt&&lt.prev==lt?((lt.next=lt.prev=null)!=(pt=lt).wrap&&(pt.wrap.zpp_inner._inuse=!1,it=(et=pt.wrap).zpp_inner,et.zpp_inner.outer=null,et.zpp_inner=null,et.zpp_pool=Vi.poolVec2,Vi.poolVec2=et,null!=it.outer&&(it.outer.zpp_inner=null,it.outer=null),it._isimmutable=null,it._validate=null,it._invalidate=null,it.next=Ip.zpp_pool,Ip.zpp_pool=it,pt.wrap=null),pt.prev=pt.next=null,pt.next=ii.zpp_pool,ii.zpp_pool=pt,lt=null):(lt.prev.next=lt.next,lt.next.prev=lt.prev,(lt.next=lt.prev=null)!=(it=lt).wrap&&(it.wrap.zpp_inner._inuse=!1,lt=(pt=it.wrap).zpp_inner,pt.zpp_inner.outer=null,pt.zpp_inner=null,pt.zpp_pool=Vi.poolVec2,Vi.poolVec2=pt,null!=lt.outer&&(lt.outer.zpp_inner=null,lt.outer=null),lt._isimmutable=null,lt._validate=null,lt._invalidate=null,lt.next=Ip.zpp_pool,Ip.zpp_pool=lt,it.wrap=null),it.prev=it.next=null,it.next=ii.zpp_pool,ii.zpp_pool=it))),Xn.end.next.prev=Xn.start.prev,Xn.start.prev.next=Xn.end.next,Xn.end.next=Xn.start,Xn.start.prev=Xn.end,Xn.path0==Xn.path0.parent)rt=Xn.path0;else{for(var st=Xn.path0,_t=null;st!=st.parent;){var ht=st.parent;st.parent=_t,_t=st,st=ht}for(;null!=_t;){var ut=_t.parent;_t.parent=st,_t=ut}rt=st}if(Xn.path1==Xn.path1.parent)ot=Xn.path1;else{for(var xt=Xn.path1,dt=null;xt!=xt.parent;){var yt=xt.parent;xt.parent=dt,dt=xt,xt=yt}for(;null!=dt;){var zt=dt.parent;dt.parent=xt,dt=zt}ot=xt}rt!=ot&&(rt.rank<ot.rank?rt.parent=ot:rt.rank>ot.rank?ot.parent=rt:(ot.parent=rt).rank++)}else if(Xn.virtualint&&!Jn.virtualint){var ct,vt,mt,ft,bt,gt,wt,Mt,Ct,kt,Ot,Pt=null!=Jn.end&&Jn.end.prev==Jn.end?((Jn.end.next=Jn.end.prev=null)!=(mt=Jn.end).wrap&&(mt.wrap.zpp_inner._inuse=!1,vt=(ct=mt.wrap).zpp_inner,ct.zpp_inner.outer=null,ct.zpp_inner=null,ct.zpp_pool=Vi.poolVec2,Vi.poolVec2=ct,null!=vt.outer&&(vt.outer.zpp_inner=null,vt.outer=null),vt._isimmutable=null,vt._validate=null,vt._invalidate=null,vt.next=Ip.zpp_pool,Ip.zpp_pool=vt,mt.wrap=null),mt.prev=mt.next=null,mt.next=ii.zpp_pool,ii.zpp_pool=mt,null):(Pt=Jn.end.prev,Jn.end.prev.next=Jn.end.next,Jn.end.next.prev=Jn.end.prev,(Jn.end.next=Jn.end.prev=null)!=(ct=Jn.end).wrap&&(ct.wrap.zpp_inner._inuse=!1,mt=(vt=ct.wrap).zpp_inner,vt.zpp_inner.outer=null,vt.zpp_inner=null,vt.zpp_pool=Vi.poolVec2,Vi.poolVec2=vt,null!=mt.outer&&(mt.outer.zpp_inner=null,mt.outer=null),mt._isimmutable=null,mt._validate=null,mt._invalidate=null,mt.next=Ip.zpp_pool,Ip.zpp_pool=mt,ct.wrap=null),ct.prev=ct.next=null,ct.next=ii.zpp_pool,ii.zpp_pool=ct,Jn.end=null,Pt);if(Jn.end=Pt,Jn.vertex||(Jn.end!=Jn.path0.vert?(Jn.start.x=Jn.end.x,Jn.start.y=Jn.end.y,gt=null!=Jn.end&&Jn.end.prev==Jn.end?((Jn.end.next=Jn.end.prev=null)!=(bt=Jn.end).wrap&&(bt.wrap.zpp_inner._inuse=!1,ft=(Pt=bt.wrap).zpp_inner,Pt.zpp_inner.outer=null,Pt.zpp_inner=null,Pt.zpp_pool=Vi.poolVec2,Vi.poolVec2=Pt,null!=ft.outer&&(ft.outer.zpp_inner=null,ft.outer=null),ft._isimmutable=null,ft._validate=null,ft._invalidate=null,ft.next=Ip.zpp_pool,Ip.zpp_pool=ft,bt.wrap=null),bt.prev=bt.next=null,bt.next=ii.zpp_pool,ii.zpp_pool=bt,null):(Ct=Jn.end.prev,Jn.end.prev.next=Jn.end.next,Jn.end.next.prev=Jn.end.prev,(Jn.end.next=Jn.end.prev=null)!=(gt=Jn.end).wrap&&(gt.wrap.zpp_inner._inuse=!1,bt=(ft=gt.wrap).zpp_inner,ft.zpp_inner.outer=null,ft.zpp_inner=null,ft.zpp_pool=Vi.poolVec2,Vi.poolVec2=ft,null!=bt.outer&&(bt.outer.zpp_inner=null,bt.outer=null),bt._isimmutable=null,bt._validate=null,bt._invalidate=null,bt.next=Ip.zpp_pool,Ip.zpp_pool=bt,gt.wrap=null),gt.prev=gt.next=null,gt.next=ii.zpp_pool,ii.zpp_pool=gt,Jn.end=null,Ct),Jn.end=gt):(Ct=Jn.start.next,Jn.start.x=Ct.x,Jn.start.y=Ct.y,null!=Ct&&Ct.prev==Ct?((Ct.next=Ct.prev=null)!=(Mt=Ct).wrap&&(Mt.wrap.zpp_inner._inuse=!1,wt=(gt=Mt.wrap).zpp_inner,gt.zpp_inner.outer=null,gt.zpp_inner=null,gt.zpp_pool=Vi.poolVec2,Vi.poolVec2=gt,null!=wt.outer&&(wt.outer.zpp_inner=null,wt.outer=null),wt._isimmutable=null,wt._validate=null,wt._invalidate=null,wt.next=Ip.zpp_pool,Ip.zpp_pool=wt,Mt.wrap=null),Mt.prev=Mt.next=null,Mt.next=ii.zpp_pool,ii.zpp_pool=Mt,Ct=null):(Ct.prev.next=Ct.next,Ct.next.prev=Ct.prev,(Ct.next=Ct.prev=null)!=(wt=Ct).wrap&&(wt.wrap.zpp_inner._inuse=!1,Ct=(Mt=wt.wrap).zpp_inner,Mt.zpp_inner.outer=null,Mt.zpp_inner=null,Mt.zpp_pool=Vi.poolVec2,Vi.poolVec2=Mt,null!=Ct.outer&&(Ct.outer.zpp_inner=null,Ct.outer=null),Ct._isimmutable=null,Ct._validate=null,Ct._invalidate=null,Ct.next=Ip.zpp_pool,Ip.zpp_pool=Ct,wt.wrap=null),wt.prev=wt.next=null,wt.next=ii.zpp_pool,ii.zpp_pool=wt))),Jn.end.next.prev=Jn.start.prev,Jn.start.prev.next=Jn.end.next,Jn.end.next=Jn.start,Jn.start.prev=Jn.end,Jn.path0==Jn.path0.parent)kt=Jn.path0;else{for(var St=Jn.path0,At=null;St!=St.parent;){var jt=St.parent;St.parent=At,At=St,St=jt}for(;null!=At;){var Et=At.parent;At.parent=St,At=Et}kt=St}if(Jn.path1==Jn.path1.parent)Ot=Jn.path1;else{for(var It=Jn.path1,Tt=null;It!=It.parent;){var Nt=It.parent;It.parent=Tt,Tt=It,It=Nt}for(;null!=Tt;){var Lt=Tt.parent;Tt.parent=It,Tt=Lt}Ot=It}kt!=Ot&&(kt.rank<Ot.rank?kt.parent=Ot:kt.rank>Ot.rank?Ot.parent=kt:(Ot.parent=kt).rank++)}}else{if(Jn.end.next.prev=Xn.start.prev,Xn.start.prev.next=Jn.end.next,Jn.end.next=Xn.start,Xn.start.prev=Jn.end,Xn.end.next.prev=Jn.start.prev,Jn.start.prev.next=Xn.end.next,Xn.end.next=Jn.start,Jn.start.prev=Xn.end,Jn.path0==Jn.path0.parent)Un=Jn.path0;else{for(var Vt=Jn.path0,Dt=null;Vt!=Vt.parent;){var Ft=Vt.parent;Vt.parent=Dt,Dt=Vt,Vt=Ft}for(;null!=Dt;){var Rt=Dt.parent;Dt.parent=Vt,Dt=Rt}Un=Vt}if(Xn.path1==Xn.path1.parent)Kn=Xn.path1;else{for(var Zt=Xn.path1,Bt=null;Zt!=Zt.parent;){var Gt=Zt.parent;Zt.parent=Bt,Bt=Zt,Zt=Gt}for(;null!=Bt;){var qt=Bt.parent;Bt.parent=Zt,Bt=qt}Kn=Zt}if(Un!=Kn&&(Un.rank<Kn.rank?Un.parent=Kn:Un.rank>Kn.rank?Kn.parent=Un:(Kn.parent=Un).rank++),Jn.path1==Jn.path1.parent)Wn=Jn.path1;else{for(var Ut=Jn.path1,Kt=null;Ut!=Ut.parent;){var Wt=Ut.parent;Ut.parent=Kt,Kt=Ut,Ut=Wt}for(;null!=Kt;){var Yt=Kt.parent;Kt.parent=Ut,Kt=Yt}Wn=Ut}if(Xn.path0==Xn.path0.parent)Yn=Xn.path0;else{for(var Jt=Xn.path0,Xt=null;Jt!=Jt.parent;){var Ht=Jt.parent;Jt.parent=Xt,Xt=Jt,Jt=Ht}for(;null!=Xt;){var $t=Xt.parent;Xt.parent=Jt,Xt=$t}Yn=Jt}Wn!=Yn&&(Wn.rank<Yn.rank?Wn.parent=Yn:Wn.rank>Yn.rank?Yn.parent=Wn:(Yn.parent=Wn).rank++)}Jn.end=Jn.start=null,Jn.path0=Jn.path1=null,Jn.next=ze.zpp_pool,ze.zpp_pool=Jn,Xn.end=Xn.start=null,Xn.path0=Xn.path1=null,Xn.next=ze.zpp_pool,ze.zpp_pool=Xn}for(var Qt=null==l?new de:l,ne=ce.paths.head;null!=ne;){var te,ee=ne.elt;if(ee==ee.parent)te=ee;else{for(var ie=ee,pe=null;ie!=ie.parent;){var le=ie.parent;ie.parent=pe,pe=ie,ie=le}for(;null!=pe;){var re=pe.parent;pe.parent=ie,pe=re}te=ie}if(te.used)ne=ne.next;else{te.used=!0;for(var oe=te.vert,ae=!0;null!=te.vert&&(ae||oe!=te.vert);)var se,ae=!1,oe=oe.x==oe.next.x&&oe.y==oe.next.y?(oe==te.vert&&(te.vert=oe.next==oe?null:oe.next,ae=!0),null!=oe&&oe.prev==oe?oe.next=oe.prev=null:(se=oe.next,oe.prev.next=oe.next,oe.next.prev=oe.prev,oe.next=oe.prev=null,oe=null,se)):oe.next;null!=te.vert&&((ee=xe.get()).zpp_inner.vertices=te.vert,Qt.zpp_inner.reverse_flag?Qt.push(ee):Qt.unshift(ee)),ne=ne.next}}for(;null!=ce.paths.head;){var _e=ce.paths.pop_unsafe();_e.vert=null,_e.parent=null,_e.next=ye.zpp_pool,ye.zpp_pool=_e}for(;null!=y;)var he,ue,y=null!=y&&y.prev==y?(y.next=y.prev=null,(ue=y).vert=null,ue.parent=null,ue.next=ye.zpp_pool,ye.zpp_pool=ue,null):(he=y.next,y.prev.next=y.next,y.next.prev=y.prev,y.next=y.prev=null,(ue=y).vert=null,ue.parent=null,ue.next=ye.zpp_pool,ye.zpp_pool=ue,y=null,he);return Qt},ce.prototype.__class__=ce;var yt=zpp_nape.geom.ZPP_Geom=function(){};yt.__name__=["zpp_nape","geom","ZPP_Geom"],yt.validateShape=function(n){if(1==n.type){var t=n.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var p=t.lverts.next,l=t.gverts.next;null!=l;){var r=l,o=p,p=p.next;r.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),r.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),l=l.next}}for(var a=t.edges.head,s=_=t.gverts.next,_=_.next;null!=_;){var h=_,u=a.elt,a=a.next;u.gp0=s,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,s=h,_=_.next}e=a.elt;e.gp0=s,e.gp1=t.gverts.next,e.gnormx=t.body.axisy*e.lnormx-t.body.axisx*e.lnormy,e.gnormy=e.lnormx*t.body.axisx+e.lnormy*t.body.axisy,e.gprojection=t.body.posx*e.gnormx+t.body.posy*e.gnormy+e.lprojection,null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy),e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy,e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){i=n.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var x=i.polygon;if(null==x.lverts.next.next)x.localCOMx=x.lverts.next.x,x.localCOMy=x.lverts.next.y;else if(null==x.lverts.next.next.next)x.localCOMx=x.lverts.next.x,x.localCOMy=x.lverts.next.y,x.localCOMx+=x.lverts.next.next.x,x.localCOMy+=x.lverts.next.next.y,x.localCOMx*=.5,x.localCOMy*=.5;else{x.localCOMx=0;var d=x.localCOMy=0,y=x.lverts.next,z=y,c=y=y.next;for(y=y.next;null!=y;){var v=y;d+=c.x*(v.y-z.y);var m=v.y*c.x-v.x*c.y;x.localCOMx+=(c.x+v.x)*m,x.localCOMy+=(c.y+v.y)*m,z=c,c=v,y=y.next}e=y=x.lverts.next;d+=c.x*(e.y-z.y);var f=e.y*c.x-e.x*c.y;x.localCOMx+=(c.x+e.x)*f,x.localCOMy+=(c.y+e.y)*f,z=c;var b=y=y.next;d+=e.x*(b.y-z.y);f=b.y*e.x-b.x*e.y;x.localCOMx+=(e.x+b.x)*f,x.localCOMy+=(e.y+b.y)*f;b=d=1/(3*d);x.localCOMx*=b,x.localCOMy*=b}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}f=i.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}b=i.radius,f=i.radius;i.aabb.minx=i.worldCOMx-b,i.aabb.miny=i.worldCOMy-f,i.aabb.maxx=i.worldCOMx+b,i.aabb.maxy=i.worldCOMy+f}else{var g=n.polygon;if(g.zip_gverts&&null!=g.body){g.zip_gverts=!1,g.validate_lverts();var w=g.body;w.zip_axis&&(w.zip_axis=!1,w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot));for(var M=g.lverts.next,C=g.gverts.next;null!=C;){var k=C,O=M,M=M.next;k.x=g.body.posx+(g.body.axisy*O.x-g.body.axisx*O.y),k.y=g.body.posy+(O.x*g.body.axisx+O.y*g.body.axisy),C=C.next}}var P=g.gverts.next;g.aabb.minx=P.x,g.aabb.miny=P.y,g.aabb.maxx=P.x,g.aabb.maxy=P.y;for(var S=g.gverts.next.next;null!=S;){var A=S;A.x<g.aabb.minx&&(g.aabb.minx=A.x),A.x>g.aabb.maxx&&(g.aabb.maxx=A.x),A.y<g.aabb.miny&&(g.aabb.miny=A.y),A.y>g.aabb.maxy&&(g.aabb.maxy=A.y),S=S.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var j=n.polygon;if(null==j.lverts.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y;else if(null==j.lverts.next.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y,j.localCOMx+=j.lverts.next.next.x,j.localCOMy+=j.lverts.next.next.y,j.localCOMx*=.5,j.localCOMy*=.5;else{j.localCOMx=0;var E=j.localCOMy=0,I=j.lverts.next,T=I,N=I=I.next;for(I=I.next;null!=I;){var L=I;E+=N.x*(L.y-T.y);var V=L.y*N.x-L.x*N.y;j.localCOMx+=(N.x+L.x)*V,j.localCOMy+=(N.y+L.y)*V,T=N,N=L,I=I.next}w=I=j.lverts.next;E+=N.x*(w.y-T.y);var D=w.y*N.x-w.x*N.y;j.localCOMx+=(N.x+w.x)*D,j.localCOMy+=(N.y+w.y)*D,T=N;P=I=I.next;E+=w.x*(P.y-T.y);D=P.y*w.x-P.x*w.y;j.localCOMx+=(w.x+P.x)*D,j.localCOMy+=(w.y+P.y)*D;D=E=1/(3*E);j.localCOMx*=D,j.localCOMy*=D}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}D=n.body;D.zip_axis&&(D.zip_axis=!1,D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}},yt.prototype.__class__=yt;var ii=zpp_nape.geom.ZPP_GeomVert=function(){this.forced=!1,this.wrap=null,this.next=null,this.prev=null,this.y=0,this.x=0};ii.__name__=["zpp_nape","geom","ZPP_GeomVert"],ii.get=function(n,t){var e;return null==ii.zpp_pool?e=new ii:(e=ii.zpp_pool,ii.zpp_pool=e.next,e.next=null),e.forced=!1,e.x=n,e.y=t,e},ii.prototype.x=null,ii.prototype.y=null,ii.prototype.prev=null,ii.prototype.next=null,ii.prototype.wrap=null,ii.prototype.forced=null,ii.prototype.free=function(){var n,t;null!=this.wrap&&(this.wrap.zpp_inner._inuse=!1,t=(n=this.wrap).zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,this.wrap=null),this.prev=this.next=null},ii.prototype.alloc=function(){this.forced=!1},ii.prototype.wrapper=function(){var n,t,e,i;return null==this.wrap&&(n=this.x,i=this.y,null==Vi.poolVec2?t=new Cn:(t=Vi.poolVec2,Vi.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner?(null==Ip.zpp_pool?e=new Ip:(e=Ip.zpp_pool,Ip.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=n,e.y=i,t.zpp_inner=e,t.zpp_inner.outer=t):(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.x==n&&(null!=(e=t.zpp_inner)._validate&&e._validate(),t.zpp_inner.y==i)||(t.zpp_inner.x=n,t.zpp_inner.y=i,null!=(i=t.zpp_inner)._invalidate&&i._invalidate(i))),t.zpp_inner.weak=!1,this.wrap=t,this.wrap.zpp_inner._inuse=!0,this.wrap.zpp_inner._invalidate=X(this,this.modwrap),this.wrap.zpp_inner._validate=X(this,this.getwrap)),this.wrap},ii.prototype.modwrap=function(n){this.x=n.x,this.y=n.y},ii.prototype.getwrap=function(){this.wrap.zpp_inner.x=this.x,this.wrap.zpp_inner.y=this.y},ii.prototype.__class__=ii;var zt=zpp_nape.geom.ZPP_GeomPoly=function(n){this.vertices=null,this.outer=null,this.outer=n};zt.__name__=["zpp_nape","geom","ZPP_GeomPoly"],zt.prototype.outer=null,zt.prototype.vertices=null,zt.prototype.__class__=zt;var ct=zpp_nape.geom.ZPP_GeomVertexIterator=function(){this.next=null,this.outer=null,this.forward=!1,this.first=!1,this.start=null,this.ptr=null,this.outer=new B};ct.__name__=["zpp_nape","geom","ZPP_GeomVertexIterator"],ct.get=function(n,t){var e;return null==ct.zpp_pool?e=new ct:(e=ct.zpp_pool,ct.zpp_pool=e.next,e.next=null),(e.outer.zpp_inner=e).ptr=n,e.forward=t,e.start=n,e.first=null!=n,e.outer},ct.prototype.ptr=null,ct.prototype.start=null,ct.prototype.first=null,ct.prototype.forward=null,ct.prototype.outer=null,ct.prototype.next=null,ct.prototype.free=function(){this.outer.zpp_inner=null,this.ptr=this.start=null},ct.prototype.alloc=function(){},ct.prototype.__class__=ct;var vt=zpp_nape.geom.ZPP_MarchSpan=function(){this.next=null,this.out=!1,this.rank=0,this.parent=null,this.parent=this};vt.__name__=["zpp_nape","geom","ZPP_MarchSpan"],vt.prototype.parent=null,vt.prototype.rank=null,vt.prototype.out=null,vt.prototype.next=null,vt.prototype.free=function(){this.parent=this},vt.prototype.alloc=function(){this.out=!1,this.rank=0},vt.prototype.__class__=vt;var pi=zpp_nape.geom.ZPP_MarchPair=function(){this.next=null,this.spanr=null,this.span2=null,this.span1=null,this.pd=null,this.okeyr=0,this.keyr=0,this.pr=null,this.okey2=0,this.key2=0,this.p2=null,this.okey1=0,this.key1=0,this.p1=null};pi.__name__=["zpp_nape","geom","ZPP_MarchPair"],pi.prototype.p1=null,pi.prototype.key1=null,pi.prototype.okey1=null,pi.prototype.p2=null,pi.prototype.key2=null,pi.prototype.okey2=null,pi.prototype.pr=null,pi.prototype.keyr=null,pi.prototype.okeyr=null,pi.prototype.pd=null,pi.prototype.span1=null,pi.prototype.span2=null,pi.prototype.spanr=null,pi.prototype.next=null,pi.prototype.free=function(){this.p1=this.p2=this.pr=this.pd=null,this.span1=this.span2=this.spanr=null},pi.prototype.alloc=function(){},pi.prototype.__class__=pi;var li=zpp_nape.geom.ZPP_MarchingSquares=function(){};li.__name__=["zpp_nape","geom","ZPP_MarchingSquares"],li.isos=null,li.ints=null,li.map=null,li.run=function(n,t,e,i,p,l,r,o,a){var s=i-t,_=l.zpp_inner;null!=_._validate&&_._validate();var h=s/l.zpp_inner.x,u=0|h,_=p-e,s=l.zpp_inner;null!=s._validate&&s._validate();var _=_/l.zpp_inner.y,x=0|_;h!=u&&++u,_!=x&&++x,o&&(null==li.map?li.map=new ae(u,x):li.map.resize(u,x,null)),null==li.isos?li.isos=new re(u+1,x+1):li.isos.resize(u+1,x+1,0);for(var d=0,y=x+1;d<y;){var z,c,v=d++;c=0==v?e:v<=x?(null!=(z=l.zpp_inner)._validate&&z._validate(),e+l.zpp_inner.y*v):p;for(var m=0,f=u+1;m<f;){var b=m++;w=0==b?t:b<=u?(null!=(g=l.zpp_inner)._validate&&g._validate(),t+l.zpp_inner.x*b):i;var g=li.isos,w=n(w,c);g.list[v*g.width+b]=w}}null==li.ints?li.ints=new oe(u+1,1+(x<<1)):li.ints.resize(u+1,1+(x<<1),null);var M=null;o&&(null==vt.zpp_pool?M=new vt:(M=vt.zpp_pool,vt.zpp_pool=M.next,M.next=null),M.out=!1,M.rank=0);for(var C=e,k=0,O=x;k<O;)for(var P,S=k++,A=C,j=S==x-1?p:(null!=(P=l.zpp_inner)._validate&&P._validate(),e+l.zpp_inner.y*(1+S)),C=j,E=t,I=null,T=0,N=u;T<N;){var L,V,D=T++,F=E,R=D==u-1?i:(null!=(R=l.zpp_inner)._validate&&R._validate(),t+l.zpp_inner.x*(1+D)),E=R,F=li.me.marchSquare(n,li.isos,li.ints,F,A,R,j,D,S,0==D||!o,0==S||!o,D==u-1||!o,S==x-1||!o,r);null!=F?o?(R=null!=F.p2&&14!=F.okey2?F.p2:F.p1,F.pd=(0==(128&(R==F.p2?F.okey2:F.okey1))?R:R.prev).prev,(R=li.map).list[S*R.width+D]=F,null!=I&&(R=0!=(1&(D=1&(R=F.key1)|(192&R)>>5))?1:0,0!=(2&D)&&++R,0!=(4&D)&&++R,2<=R)?(li.me.combLR(I,F),F.span1=I.spanr):(null==vt.zpp_pool?F.span1=new vt:(F.span1=vt.zpp_pool,vt.zpp_pool=F.span1.next,F.span1.next=null),(L=F.span1).out=!1,L.rank=0,F.span1.next=M,M=F.span1),null!=F.p2?(null==vt.zpp_pool?F.span2=new vt:(F.span2=vt.zpp_pool,vt.zpp_pool=F.span2.next,F.span2.next=null),(V=F.span2).out=!1,V.rank=0,F.span2.next=M,M=F.span2,F.spanr=F.span2):F.spanr=F.span1,V=0!=(1&(L=(28&F.keyr)>>2))?1:0,0!=(2&L)&&++V,0!=(4&L)&&++V,I=2<=V?F:null):(li.me.output(a,F.p1),null!=F.p2&&li.me.output(a,F.p2),F.p1=F.p2=F.pr=F.pd=null,F.span1=F.span2=F.spanr=null,F.next=pi.zpp_pool,pi.zpp_pool=F):I=null}if(o){for(var Z=1,B=x;Z<B;)for(var G=Z++,q=null,U=0,K=u;U<K;){var W=U++,Y=li.map,J=Y.list[G*Y.width+W];if(null!=J){var X=7&(null!=J.p2&&14==J.okey2?J.okey2:J.okey1),Y=0!=(1&X)?1:0;if(0!=(2&X)&&++Y,0!=(4&X)&&++Y,Y<2)q=null;else{X=li.map,Y=X.list[(G-1)*X.width+W];if(null!=Y){X=(112&(null!=Y.p2&&56==Y.okey2?Y.okey2:Y.okey1))>>4,W=0!=(1&X)?1:0;if(0!=(2&X)&&++W,0!=(4&X)&&++W,W<2)q=null;else{var H,$,Q,nn,X=null!=Y.p2&&56==Y.okey2?Y.span2:Y.span1,W=null!=J.p2&&14==J.okey2?J.span2:J.span1;if(X==X.parent)H=X;else{for(var tn=X,en=null;tn!=tn.parent;){var pn=tn.parent;tn.parent=en,en=tn,tn=pn}for(;null!=en;){var ln=en.parent;en.parent=tn,en=ln}H=tn}if(W==W.parent)$=W;else{for(var rn=W,on=null;rn!=rn.parent;){var an=rn.parent;rn.parent=on,on=rn,rn=an}for(;null!=on;){var sn=on.parent;on.parent=rn,on=sn}$=rn}if(H==$)q!=W&&li.me.combUD_virtual(Y,J);else{if(X==X.parent)Q=X;else{for(var _n=X,hn=null;_n!=_n.parent;){var un=_n.parent;_n.parent=hn,hn=_n,_n=un}for(;null!=hn;){var xn=hn.parent;hn.parent=_n,hn=xn}Q=_n}if(W==W.parent)nn=W;else{for(var dn=W,yn=null;dn!=dn.parent;){var zn=dn.parent;dn.parent=yn,yn=dn,dn=zn}for(;null!=yn;){var cn=yn.parent;yn.parent=dn,yn=cn}nn=dn}Q!=nn&&(Q.rank<nn.rank?Q.parent=nn:Q.rank>nn.rank?nn.parent=Q:(nn.parent=Q).rank++),li.me.combUD(Y,J)}q=0!=(4&(W==J.span2?J.okey2:J.okey1))?W:null}}else q=null}}else q=null}for(var vn=0,mn=x;vn<mn;)for(var fn=vn++,bn=0,gn=u;bn<gn;){var wn,Mn=bn++,Cn=li.map,Cn=Cn.list[fn*Cn.width+Mn];if(null!=Cn){if(Cn.span1==Cn.span1.parent)wn=Cn.span1;else{for(var kn=Cn.span1,On=null;kn!=kn.parent;){var Pn=kn.parent;kn.parent=On,On=kn,kn=Pn}for(;null!=On;){var Sn=On.parent;On.parent=kn,On=Sn}wn=kn}if(wn.out||(wn.out=!0,li.me.output(a,Cn.p1)),null!=Cn.p2){if(Cn.span2==Cn.span2.parent)wn=Cn.span2;else{for(var An=Cn.span2,jn=null;An!=An.parent;){var En=An.parent;An.parent=jn,jn=An,An=En}for(;null!=jn;){var In=jn.parent;jn.parent=An,jn=In}wn=An}wn.out||(wn.out=!0,li.me.output(a,Cn.p2))}Cn.p1=Cn.p2=Cn.pr=Cn.pd=null,Cn.span1=Cn.span2=Cn.spanr=null,Cn.next=pi.zpp_pool,pi.zpp_pool=Cn;Cn=li.map;Cn.list[fn*Cn.width+Mn]=null}}for(;null!=M;){var Tn=M,M=Tn.next;(Tn.parent=Tn).next=vt.zpp_pool,vt.zpp_pool=Tn}}},li.ISO=function(n,t,e){return n(t,e)},li.prototype.output=function(n,t){var e;if(null==t||t.next==t||t.next==t.prev)o=!0;else{var i=0,p=t;if(null!=t)for(var l=t;;)if(i+=l.x*(l.next.y-l.prev.y),(l=l.next)==p)break;var r=.5*i,o=r*r<jp.epsilon*jp.epsilon}if(o)for(;null!=t;)t=null!=t&&t.prev==t?t.next=t.prev=null:(e=t.next,t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null,t=null,e);else{o=xe.get();o.zpp_inner.vertices=t,n.zpp_inner.reverse_flag?n.push(o):n.unshift(o)}},li.prototype.linkright=function(n,t){t&=7;return 0==t?n:(3==t?n.next:n).next},li.prototype.linkleft=function(n,t){return 0==(1&t)?n.prev:n},li.prototype.linkdown=function(n,t){return(0==(128&t)?n:n.prev).prev},li.prototype.linkup=function(n,t){return n},li.prototype.combLR=function(n,t){var e=n.pr,i=7&n.okeyr,p=0==i?e:(3==i?e.next:e).next,l=t.p1,r=0==(1&t.okey1)?l.prev:l,o=p.next,i=r.prev;0!=(4&n.keyr)?(t.pr==t.p1&&(t.pr=p.prev),t.p1=p.prev,p.prev.next=r.next,r.next.prev=p.prev,null!=(s=p).wrap&&(s.wrap.zpp_inner._inuse=!1,l=(e=s.wrap).zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l,s.wrap=null),s.prev=s.next=null,s.next=ii.zpp_pool,ii.zpp_pool=s):(p.next=r.next,r.next.prev=p);var a,s=r;null!=s.wrap&&(s.wrap.zpp_inner._inuse=!1,r=(p=s.wrap).zpp_inner,p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=Vi.poolVec2,Vi.poolVec2=p,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ip.zpp_pool,Ip.zpp_pool=r,s.wrap=null),s.prev=s.next=null,s.next=ii.zpp_pool,ii.zpp_pool=s,0!=(16&n.keyr)?(t.pd=o.next,o.next.prev=i.prev,i.prev.next=o.next,null!=o.wrap&&(o.wrap.zpp_inner._inuse=!1,a=(t=o.wrap).zpp_inner,t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=Vi.poolVec2,Vi.poolVec2=t,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a,o.wrap=null),o.prev=o.next=null,o.next=ii.zpp_pool,ii.zpp_pool=o):(o.prev=i.prev,i.prev.next=o),null!=i.wrap&&(i.wrap.zpp_inner._inuse=!1,o=(a=i.wrap).zpp_inner,a.zpp_inner.outer=null,a.zpp_inner=null,a.zpp_pool=Vi.poolVec2,Vi.poolVec2=a,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o,i.wrap=null),i.prev=i.next=null,i.next=ii.zpp_pool,ii.zpp_pool=i},li.prototype.combUD=function(n,t){null!=n.p2&&n.key2;var e=null!=t.p2&&14==t.key2?t.p2:t.p1,i=n.pd,p=e,l=i.prev,t=p.next;p.next=i.next,i.next.prev=p,null!=i.wrap&&(i.wrap.zpp_inner._inuse=!1,p=(e=i.wrap).zpp_inner,e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=Vi.poolVec2,Vi.poolVec2=e,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p,i.wrap=null),i.prev=i.next=null,i.next=ii.zpp_pool,ii.zpp_pool=i,t.prev=l.prev,l.prev.next=t,l==n.p1&&(n.p1=t),null!=l.wrap&&(l.wrap.zpp_inner._inuse=!1,t=(n=l.wrap).zpp_inner,n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=Vi.poolVec2,Vi.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,l.wrap=null),l.prev=l.next=null,l.next=ii.zpp_pool,ii.zpp_pool=l},li.prototype.combUD_virtual=function(n,t){null!=n.p2&&n.key2;t=null!=t.p2&&14==t.key2?t.p2:t.p1,n=n.pd;n.forced=t.forced=n.prev.forced=t.next.forced=!0},li.prototype.combLeft=function(n){var t=1&n|(192&n)>>5,n=0!=(1&t)?1:0;return 0!=(2&t)&&++n,0!=(4&t)&&++n,2<=n},li.prototype.combRight=function(n){var t=(28&n)>>2,n=0!=(1&t)?1:0;return 0!=(2&t)&&++n,0!=(4&t)&&++n,2<=n},li.prototype.combUp=function(n){var t=7&n,n=0!=(1&t)?1:0;return 0!=(2&t)&&++n,0!=(4&t)&&++n,2<=n},li.prototype.combDown=function(n){var t=(112&n)>>4,n=0!=(1&t)?1:0;return 0!=(2&t)&&++n,0!=(4&t)&&++n,2<=n},li.prototype.comb=function(n){var t=0!=(1&n)?1:0;return 0!=(2&n)&&++t,0!=(4&n)&&++t,2<=t},li.prototype.marchSquare=function(n,t,e,i,p,l,r,o,a,s,_,h,u,x){var d=0,y=t.list[a*t.width+o];y<0&&(d=8);var z=t.list[a*t.width+(o+1)];z<0&&(d|=4);var c=t.list[(a+1)*t.width+(o+1)];c<0&&(d|=2);var v,m=t.list[(a+1)*t.width+o];if(m<0&&(d|=1),0==d)return null;if(null==pi.zpp_pool?v=new pi:(v=pi.zpp_pool,pi.zpp_pool=v.next,v.next=null),10!=d&&5!=d){var f=li.look_march[d];v.okey1=f;for(var b=0;b<8;){var g,w,M,C,k,O,P,S,A,j,E,I,T,N,L,V,D,F,R,Z=b++;0!=(f&1<<Z)&&(R=null,0==Z?(null==ii.zpp_pool?g=new ii:(g=ii.zpp_pool,ii.zpp_pool=g.next,g.next=null),g.forced=!1,g.x=i,g.y=p,R=g,(s||_)&&(R.forced=!0)):2==Z?(null==ii.zpp_pool?w=new ii:(w=ii.zpp_pool,ii.zpp_pool=w.next,w.next=null),w.forced=!1,w.x=l,w.y=p,R=w,(h||_)&&(R.forced=!0)):4==Z?(null==ii.zpp_pool?M=new ii:(M=ii.zpp_pool,ii.zpp_pool=M.next,M.next=null),M.forced=!1,M.x=l,M.y=r,R=M,(h||u)&&(R.forced=!0)):6==Z?(null==ii.zpp_pool?C=new ii:(C=ii.zpp_pool,ii.zpp_pool=C.next,C.next=null),C.forced=!1,C.x=i,C.y=r,R=C,(s||u)&&(R.forced=!0)):1==Z?(null==(R=e.list[(a<<1)*e.width+o])?(O=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?k=new ii:(k=ii.zpp_pool,ii.zpp_pool=k.next,k.next=null),k.forced=!1,k.x=O,k.y=p,R=k,e.list[(a<<1)*e.width+o]=R):(O=R.x,A=R.y,null==ii.zpp_pool?P=new ii:(P=ii.zpp_pool,ii.zpp_pool=P.next,P.next=null),P.forced=!1,P.x=O,P.y=A,R=P),_&&(R.forced=!0),R.x!=i&&R.x!=l||(R.x==i&&0!=(1&f)||R.x==l&&0!=(4&f))&&(f^=2)):5==Z?(null==(R=e.list[(2+(a<<1))*e.width+o])?(j=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?S=new ii:(S=ii.zpp_pool,ii.zpp_pool=S.next,S.next=null),S.forced=!1,S.x=j,S.y=r,R=S,e.list[(2+(a<<1))*e.width+o]=R):(A=R.x,j=R.y,null==ii.zpp_pool?E=new ii:(E=ii.zpp_pool,ii.zpp_pool=E.next,E.next=null),E.forced=!1,E.x=A,E.y=j,R=E),u&&(R.forced=!0),R.x!=i&&R.x!=l||(R.x==i&&0!=(64&f)||R.x==l&&0!=(16&f))&&(f^=32)):3==Z?(null==(R=e.list[(1+(a<<1))*e.width+(o+1)])?(T=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?I=new ii:(I=ii.zpp_pool,ii.zpp_pool=I.next,I.next=null),I.forced=!1,I.x=l,I.y=T,R=I,e.list[(1+(a<<1))*e.width+(o+1)]=R):(T=R.x,V=R.y,null==ii.zpp_pool?N=new ii:(N=ii.zpp_pool,ii.zpp_pool=N.next,N.next=null),N.forced=!1,N.x=T,N.y=V,R=N),h&&(R.forced=!0),R.y!=p&&R.y!=r||(R.y==p&&0!=(4&f)||R.y==r&&0!=(16&f))&&(f^=8)):(null==(R=e.list[(1+(a<<1))*e.width+o])?(D=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?L=new ii:(L=ii.zpp_pool,ii.zpp_pool=L.next,L.next=null),L.forced=!1,L.x=i,L.y=D,R=L,e.list[(1+(a<<1))*e.width+o]=R):(V=R.x,D=R.y,null==ii.zpp_pool?F=new ii:(F=ii.zpp_pool,ii.zpp_pool=F.next,F.next=null),F.forced=!1,F.x=V,F.y=D,R=F),s&&(R.forced=!0),R.y!=p&&R.y!=r||(R.y==p&&0!=(1&f)||R.y==r&&0!=(64&f))&&(f^=128)),R=R,null==v.p1?v.p1=R.prev=R.next=R:(R.prev=v.p1,R.next=v.p1.next,v.p1.next.prev=R,v.p1.next=R),v.p1=R)}v.p1=v.p1.next,1!=(v.key1=f)&&4!=f&&16!=f&&64!=f&&3!=f&&12!=f&&48!=f&&192!=f&&129!=f&&6!=f&&24!=f&&96!=f&&5!=f&&20!=f&&80!=f&&65!=f&&17!=f&&68!=f||(f=0,v.key1=0,v.p1=null),0==f?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}else{t=n(.5*(i+l),.5*(p+r))<0;if(10==d)if(t){var B=187;v.okey1=187;for(var G=0;G<8;){var q,U,K,W,Y,J,X,H,$,Q,nn,tn,en,pn,ln,rn,on,an,sn,_n=G++;0!=(B&1<<_n)&&(sn=null,0==_n?(null==ii.zpp_pool?q=new ii:(q=ii.zpp_pool,ii.zpp_pool=q.next,q.next=null),q.forced=!1,q.x=i,q.y=p,sn=q,(s||_)&&(sn.forced=!0)):2==_n?(null==ii.zpp_pool?U=new ii:(U=ii.zpp_pool,ii.zpp_pool=U.next,U.next=null),U.forced=!1,U.x=l,U.y=p,sn=U,(h||_)&&(sn.forced=!0)):4==_n?(null==ii.zpp_pool?K=new ii:(K=ii.zpp_pool,ii.zpp_pool=K.next,K.next=null),K.forced=!1,K.x=l,K.y=r,sn=K,(h||u)&&(sn.forced=!0)):6==_n?(null==ii.zpp_pool?W=new ii:(W=ii.zpp_pool,ii.zpp_pool=W.next,W.next=null),W.forced=!1,W.x=i,W.y=r,sn=W,(s||u)&&(sn.forced=!0)):1==_n?(null==(sn=e.list[(a<<1)*e.width+o])?(J=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?Y=new ii:(Y=ii.zpp_pool,ii.zpp_pool=Y.next,Y.next=null),Y.forced=!1,Y.x=J,Y.y=p,sn=Y,e.list[(a<<1)*e.width+o]=sn):(J=sn.x,$=sn.y,null==ii.zpp_pool?X=new ii:(X=ii.zpp_pool,ii.zpp_pool=X.next,X.next=null),X.forced=!1,X.x=J,X.y=$,sn=X),_&&(sn.forced=!0),sn.x!=i&&sn.x!=l||(sn.x==i&&0!=(1&B)||sn.x==l&&0!=(4&B))&&(B^=2)):5==_n?(null==(sn=e.list[(2+(a<<1))*e.width+o])?(Q=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?H=new ii:(H=ii.zpp_pool,ii.zpp_pool=H.next,H.next=null),H.forced=!1,H.x=Q,H.y=r,sn=H,e.list[(2+(a<<1))*e.width+o]=sn):($=sn.x,Q=sn.y,null==ii.zpp_pool?nn=new ii:(nn=ii.zpp_pool,ii.zpp_pool=nn.next,nn.next=null),nn.forced=!1,nn.x=$,nn.y=Q,sn=nn),u&&(sn.forced=!0),sn.x!=i&&sn.x!=l||(sn.x==i&&0!=(64&B)||sn.x==l&&0!=(16&B))&&(B^=32)):3==_n?(null==(sn=e.list[(1+(a<<1))*e.width+(o+1)])?(en=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?tn=new ii:(tn=ii.zpp_pool,ii.zpp_pool=tn.next,tn.next=null),tn.forced=!1,tn.x=l,tn.y=en,sn=tn,e.list[(1+(a<<1))*e.width+(o+1)]=sn):(en=sn.x,rn=sn.y,null==ii.zpp_pool?pn=new ii:(pn=ii.zpp_pool,ii.zpp_pool=pn.next,pn.next=null),pn.forced=!1,pn.x=en,pn.y=rn,sn=pn),h&&(sn.forced=!0),sn.y!=p&&sn.y!=r||(sn.y==p&&0!=(4&B)||sn.y==r&&0!=(16&B))&&(B^=8)):(null==(sn=e.list[(1+(a<<1))*e.width+o])?(on=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?ln=new ii:(ln=ii.zpp_pool,ii.zpp_pool=ln.next,ln.next=null),ln.forced=!1,ln.x=i,ln.y=on,sn=ln,e.list[(1+(a<<1))*e.width+o]=sn):(rn=sn.x,on=sn.y,null==ii.zpp_pool?an=new ii:(an=ii.zpp_pool,ii.zpp_pool=an.next,an.next=null),an.forced=!1,an.x=rn,an.y=on,sn=an),s&&(sn.forced=!0),sn.y!=p&&sn.y!=r||(sn.y==p&&0!=(1&B)||sn.y==r&&0!=(64&B))&&(B^=128)),sn=sn,null==v.p1?v.p1=sn.prev=sn.next=sn:(sn.prev=v.p1,sn.next=v.p1.next,v.p1.next.prev=sn,v.p1.next=sn),v.p1=sn)}v.p1=v.p1.next,1!=(v.key1=B)&&4!=B&&16!=B&&64!=B&&3!=B&&12!=B&&48!=B&&192!=B&&129!=B&&6!=B&&24!=B&&96!=B&&5!=B&&20!=B&&80!=B&&65!=B&&17!=B&&68!=B||(B=0,v.key1=0,v.p1=null),0==B?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}else{var hn=131;v.okey1=131;for(var un=0;un<8;){var xn,dn,yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn,Cn,kn,On,Pn,Sn,An,jn,En=un++;0!=(hn&1<<En)&&(jn=null,0==En?(null==ii.zpp_pool?xn=new ii:(xn=ii.zpp_pool,ii.zpp_pool=xn.next,xn.next=null),xn.forced=!1,xn.x=i,xn.y=p,jn=xn,(s||_)&&(jn.forced=!0)):2==En?(null==ii.zpp_pool?dn=new ii:(dn=ii.zpp_pool,ii.zpp_pool=dn.next,dn.next=null),dn.forced=!1,dn.x=l,dn.y=p,jn=dn,(h||_)&&(jn.forced=!0)):4==En?(null==ii.zpp_pool?yn=new ii:(yn=ii.zpp_pool,ii.zpp_pool=yn.next,yn.next=null),yn.forced=!1,yn.x=l,yn.y=r,jn=yn,(h||u)&&(jn.forced=!0)):6==En?(null==ii.zpp_pool?zn=new ii:(zn=ii.zpp_pool,ii.zpp_pool=zn.next,zn.next=null),zn.forced=!1,zn.x=i,zn.y=r,jn=zn,(s||u)&&(jn.forced=!0)):1==En?(null==(jn=e.list[(a<<1)*e.width+o])?(vn=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?cn=new ii:(cn=ii.zpp_pool,ii.zpp_pool=cn.next,cn.next=null),cn.forced=!1,cn.x=vn,cn.y=p,jn=cn,e.list[(a<<1)*e.width+o]=jn):(vn=jn.x,bn=jn.y,null==ii.zpp_pool?mn=new ii:(mn=ii.zpp_pool,ii.zpp_pool=mn.next,mn.next=null),mn.forced=!1,mn.x=vn,mn.y=bn,jn=mn),_&&(jn.forced=!0),jn.x!=i&&jn.x!=l||(jn.x==i&&0!=(1&hn)||jn.x==l&&0!=(4&hn))&&(hn^=2)):5==En?(null==(jn=e.list[(2+(a<<1))*e.width+o])?(gn=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?fn=new ii:(fn=ii.zpp_pool,ii.zpp_pool=fn.next,fn.next=null),fn.forced=!1,fn.x=gn,fn.y=r,jn=fn,e.list[(2+(a<<1))*e.width+o]=jn):(bn=jn.x,gn=jn.y,null==ii.zpp_pool?wn=new ii:(wn=ii.zpp_pool,ii.zpp_pool=wn.next,wn.next=null),wn.forced=!1,wn.x=bn,wn.y=gn,jn=wn),u&&(jn.forced=!0),jn.x!=i&&jn.x!=l||(jn.x==i&&0!=(64&hn)||jn.x==l&&0!=(16&hn))&&(hn^=32)):3==En?(null==(jn=e.list[(1+(a<<1))*e.width+(o+1)])?(Cn=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?Mn=new ii:(Mn=ii.zpp_pool,ii.zpp_pool=Mn.next,Mn.next=null),Mn.forced=!1,Mn.x=l,Mn.y=Cn,jn=Mn,e.list[(1+(a<<1))*e.width+(o+1)]=jn):(Cn=jn.x,Pn=jn.y,null==ii.zpp_pool?kn=new ii:(kn=ii.zpp_pool,ii.zpp_pool=kn.next,kn.next=null),kn.forced=!1,kn.x=Cn,kn.y=Pn,jn=kn),h&&(jn.forced=!0),jn.y!=p&&jn.y!=r||(jn.y==p&&0!=(4&hn)||jn.y==r&&0!=(16&hn))&&(hn^=8)):(null==(jn=e.list[(1+(a<<1))*e.width+o])?(Sn=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?On=new ii:(On=ii.zpp_pool,ii.zpp_pool=On.next,On.next=null),On.forced=!1,On.x=i,On.y=Sn,jn=On,e.list[(1+(a<<1))*e.width+o]=jn):(Pn=jn.x,Sn=jn.y,null==ii.zpp_pool?An=new ii:(An=ii.zpp_pool,ii.zpp_pool=An.next,An.next=null),An.forced=!1,An.x=Pn,An.y=Sn,jn=An),s&&(jn.forced=!0),jn.y!=p&&jn.y!=r||(jn.y==p&&0!=(1&hn)||jn.y==r&&0!=(64&hn))&&(hn^=128)),jn=jn,null==v.p1?v.p1=jn.prev=jn.next=jn:(jn.prev=v.p1,jn.next=v.p1.next,v.p1.next.prev=jn,v.p1.next=jn),v.p1=jn)}if(v.p1=v.p1.next,1!=(v.key1=hn)&&4!=hn&&16!=hn&&64!=hn&&3!=hn&&12!=hn&&48!=hn&&192!=hn&&129!=hn&&6!=hn&&24!=hn&&96!=hn&&5!=hn&&20!=hn&&80!=hn&&65!=hn&&17!=hn&&68!=hn||(hn=0,v.key1=0,v.p1=null),0!=hn){var In=56;v.okey2=56;for(var Tn=0;Tn<8;){var Nn,Ln,Vn,Dn,Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn,Jn,Xn,Hn,$n,Qn,nt=Tn++;0!=(In&1<<nt)&&(Qn=null,0==nt?(null==ii.zpp_pool?Nn=new ii:(Nn=ii.zpp_pool,ii.zpp_pool=Nn.next,Nn.next=null),Nn.forced=!1,Nn.x=i,Nn.y=p,Qn=Nn,(s||_)&&(Qn.forced=!0)):2==nt?(null==ii.zpp_pool?Ln=new ii:(Ln=ii.zpp_pool,ii.zpp_pool=Ln.next,Ln.next=null),Ln.forced=!1,Ln.x=l,Ln.y=p,Qn=Ln,(h||_)&&(Qn.forced=!0)):4==nt?(null==ii.zpp_pool?Vn=new ii:(Vn=ii.zpp_pool,ii.zpp_pool=Vn.next,Vn.next=null),Vn.forced=!1,Vn.x=l,Vn.y=r,Qn=Vn,(h||u)&&(Qn.forced=!0)):6==nt?(null==ii.zpp_pool?Dn=new ii:(Dn=ii.zpp_pool,ii.zpp_pool=Dn.next,Dn.next=null),Dn.forced=!1,Dn.x=i,Dn.y=r,Qn=Dn,(s||u)&&(Qn.forced=!0)):1==nt?(null==(Qn=e.list[(a<<1)*e.width+o])?(Rn=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?Fn=new ii:(Fn=ii.zpp_pool,ii.zpp_pool=Fn.next,Fn.next=null),Fn.forced=!1,Fn.x=Rn,Fn.y=p,Qn=Fn,e.list[(a<<1)*e.width+o]=Qn):(Rn=Qn.x,Gn=Qn.y,null==ii.zpp_pool?Zn=new ii:(Zn=ii.zpp_pool,ii.zpp_pool=Zn.next,Zn.next=null),Zn.forced=!1,Zn.x=Rn,Zn.y=Gn,Qn=Zn),_&&(Qn.forced=!0),Qn.x!=i&&Qn.x!=l||(Qn.x==i&&0!=(1&In)||Qn.x==l&&0!=(4&In))&&(In^=2)):5==nt?(null==(Qn=e.list[(2+(a<<1))*e.width+o])?(qn=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?Bn=new ii:(Bn=ii.zpp_pool,ii.zpp_pool=Bn.next,Bn.next=null),Bn.forced=!1,Bn.x=qn,Bn.y=r,Qn=Bn,e.list[(2+(a<<1))*e.width+o]=Qn):(Gn=Qn.x,qn=Qn.y,null==ii.zpp_pool?Un=new ii:(Un=ii.zpp_pool,ii.zpp_pool=Un.next,Un.next=null),Un.forced=!1,Un.x=Gn,Un.y=qn,Qn=Un),u&&(Qn.forced=!0),Qn.x!=i&&Qn.x!=l||(Qn.x==i&&0!=(64&In)||Qn.x==l&&0!=(16&In))&&(In^=32)):3==nt?(null==(Qn=e.list[(1+(a<<1))*e.width+(o+1)])?(Wn=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?Kn=new ii:(Kn=ii.zpp_pool,ii.zpp_pool=Kn.next,Kn.next=null),Kn.forced=!1,Kn.x=l,Kn.y=Wn,Qn=Kn,e.list[(1+(a<<1))*e.width+(o+1)]=Qn):(Wn=Qn.x,Xn=Qn.y,null==ii.zpp_pool?Yn=new ii:(Yn=ii.zpp_pool,ii.zpp_pool=Yn.next,Yn.next=null),Yn.forced=!1,Yn.x=Wn,Yn.y=Xn,Qn=Yn),h&&(Qn.forced=!0),Qn.y!=p&&Qn.y!=r||(Qn.y==p&&0!=(4&In)||Qn.y==r&&0!=(16&In))&&(In^=8)):(null==(Qn=e.list[(1+(a<<1))*e.width+o])?(Hn=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?Jn=new ii:(Jn=ii.zpp_pool,ii.zpp_pool=Jn.next,Jn.next=null),Jn.forced=!1,Jn.x=i,Jn.y=Hn,Qn=Jn,e.list[(1+(a<<1))*e.width+o]=Qn):(Xn=Qn.x,Hn=Qn.y,null==ii.zpp_pool?$n=new ii:($n=ii.zpp_pool,ii.zpp_pool=$n.next,$n.next=null),$n.forced=!1,$n.x=Xn,$n.y=Hn,Qn=$n),s&&(Qn.forced=!0),Qn.y!=p&&Qn.y!=r||(Qn.y==p&&0!=(1&In)||Qn.y==r&&0!=(64&In))&&(In^=128)),Qn=Qn,null==v.p2?v.p2=Qn.prev=Qn.next=Qn:(Qn.prev=v.p2,Qn.next=v.p2.next,v.p2.next.prev=Qn,v.p2.next=Qn),v.p2=Qn)}v.p2=v.p2.next,1!=(v.key2=In)&&4!=In&&16!=In&&64!=In&&3!=In&&12!=In&&48!=In&&192!=In&&129!=In&&6!=In&&24!=In&&96!=In&&5!=In&&20!=In&&80!=In&&65!=In&&17!=In&&68!=In||(In=0,v.key2=0,v.p2=null),0==In?(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1):(v.pr=v.p2,v.okeyr=v.okey2,v.keyr=v.key2)}else{var tt=56;v.okey1=56;for(var et=0;et<8;){var it,pt,lt,rt,ot,at,st,_t,ht,ut,xt,dt,yt,zt,ct,vt,mt,ft,bt,gt=et++;0!=(tt&1<<gt)&&(bt=null,0==gt?(null==ii.zpp_pool?it=new ii:(it=ii.zpp_pool,ii.zpp_pool=it.next,it.next=null),it.forced=!1,it.x=i,it.y=p,bt=it,(s||_)&&(bt.forced=!0)):2==gt?(null==ii.zpp_pool?pt=new ii:(pt=ii.zpp_pool,ii.zpp_pool=pt.next,pt.next=null),pt.forced=!1,pt.x=l,pt.y=p,bt=pt,(h||_)&&(bt.forced=!0)):4==gt?(null==ii.zpp_pool?lt=new ii:(lt=ii.zpp_pool,ii.zpp_pool=lt.next,lt.next=null),lt.forced=!1,lt.x=l,lt.y=r,bt=lt,(h||u)&&(bt.forced=!0)):6==gt?(null==ii.zpp_pool?rt=new ii:(rt=ii.zpp_pool,ii.zpp_pool=rt.next,rt.next=null),rt.forced=!1,rt.x=i,rt.y=r,bt=rt,(s||u)&&(bt.forced=!0)):1==gt?(null==(bt=e.list[(a<<1)*e.width+o])?(at=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?ot=new ii:(ot=ii.zpp_pool,ii.zpp_pool=ot.next,ot.next=null),ot.forced=!1,ot.x=at,ot.y=p,bt=ot,e.list[(a<<1)*e.width+o]=bt):(at=bt.x,ht=bt.y,null==ii.zpp_pool?st=new ii:(st=ii.zpp_pool,ii.zpp_pool=st.next,st.next=null),st.forced=!1,st.x=at,st.y=ht,bt=st),_&&(bt.forced=!0),bt.x!=i&&bt.x!=l||(bt.x==i&&0!=(1&tt)||bt.x==l&&0!=(4&tt))&&(tt^=2)):5==gt?(null==(bt=e.list[(2+(a<<1))*e.width+o])?(ut=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?_t=new ii:(_t=ii.zpp_pool,ii.zpp_pool=_t.next,_t.next=null),_t.forced=!1,_t.x=ut,_t.y=r,bt=_t,e.list[(2+(a<<1))*e.width+o]=bt):(ht=bt.x,ut=bt.y,null==ii.zpp_pool?xt=new ii:(xt=ii.zpp_pool,ii.zpp_pool=xt.next,xt.next=null),xt.forced=!1,xt.x=ht,xt.y=ut,bt=xt),u&&(bt.forced=!0),bt.x!=i&&bt.x!=l||(bt.x==i&&0!=(64&tt)||bt.x==l&&0!=(16&tt))&&(tt^=32)):3==gt?(null==(bt=e.list[(1+(a<<1))*e.width+(o+1)])?(yt=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?dt=new ii:(dt=ii.zpp_pool,ii.zpp_pool=dt.next,dt.next=null),dt.forced=!1,dt.x=l,dt.y=yt,bt=dt,e.list[(1+(a<<1))*e.width+(o+1)]=bt):(yt=bt.x,vt=bt.y,null==ii.zpp_pool?zt=new ii:(zt=ii.zpp_pool,ii.zpp_pool=zt.next,zt.next=null),zt.forced=!1,zt.x=yt,zt.y=vt,bt=zt),h&&(bt.forced=!0),bt.y!=p&&bt.y!=r||(bt.y==p&&0!=(4&tt)||bt.y==r&&0!=(16&tt))&&(tt^=8)):(null==(bt=e.list[(1+(a<<1))*e.width+o])?(mt=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?ct=new ii:(ct=ii.zpp_pool,ii.zpp_pool=ct.next,ct.next=null),ct.forced=!1,ct.x=i,ct.y=mt,bt=ct,e.list[(1+(a<<1))*e.width+o]=bt):(vt=bt.x,mt=bt.y,null==ii.zpp_pool?ft=new ii:(ft=ii.zpp_pool,ii.zpp_pool=ft.next,ft.next=null),ft.forced=!1,ft.x=vt,ft.y=mt,bt=ft),s&&(bt.forced=!0),bt.y!=p&&bt.y!=r||(bt.y==p&&0!=(1&tt)||bt.y==r&&0!=(64&tt))&&(tt^=128)),bt=bt,null==v.p1?v.p1=bt.prev=bt.next=bt:(bt.prev=v.p1,bt.next=v.p1.next,v.p1.next.prev=bt,v.p1.next=bt),v.p1=bt)}v.p1=v.p1.next,1!=(v.key1=tt)&&4!=tt&&16!=tt&&64!=tt&&3!=tt&&12!=tt&&48!=tt&&192!=tt&&129!=tt&&6!=tt&&24!=tt&&96!=tt&&5!=tt&&20!=tt&&80!=tt&&65!=tt&&17!=tt&&68!=tt||(tt=0,v.key1=0,v.p1=null),0==tt?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}}else if(t){var wt=238;v.okey1=238;for(var Mt=0;Mt<8;){var Ct,kt,Ot,Pt,St,At,jt,Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt=Mt++;0!=(wt&1<<qt)&&(Gt=null,0==qt?(null==ii.zpp_pool?Ct=new ii:(Ct=ii.zpp_pool,ii.zpp_pool=Ct.next,Ct.next=null),Ct.forced=!1,Ct.x=i,Ct.y=p,Gt=Ct,(s||_)&&(Gt.forced=!0)):2==qt?(null==ii.zpp_pool?kt=new ii:(kt=ii.zpp_pool,ii.zpp_pool=kt.next,kt.next=null),kt.forced=!1,kt.x=l,kt.y=p,Gt=kt,(h||_)&&(Gt.forced=!0)):4==qt?(null==ii.zpp_pool?Ot=new ii:(Ot=ii.zpp_pool,ii.zpp_pool=Ot.next,Ot.next=null),Ot.forced=!1,Ot.x=l,Ot.y=r,Gt=Ot,(h||u)&&(Gt.forced=!0)):6==qt?(null==ii.zpp_pool?Pt=new ii:(Pt=ii.zpp_pool,ii.zpp_pool=Pt.next,Pt.next=null),Pt.forced=!1,Pt.x=i,Pt.y=r,Gt=Pt,(s||u)&&(Gt.forced=!0)):1==qt?(null==(Gt=e.list[(a<<1)*e.width+o])?(At=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?St=new ii:(St=ii.zpp_pool,ii.zpp_pool=St.next,St.next=null),St.forced=!1,St.x=At,St.y=p,Gt=St,e.list[(a<<1)*e.width+o]=Gt):(At=Gt.x,It=Gt.y,null==ii.zpp_pool?jt=new ii:(jt=ii.zpp_pool,ii.zpp_pool=jt.next,jt.next=null),jt.forced=!1,jt.x=At,jt.y=It,Gt=jt),_&&(Gt.forced=!0),Gt.x!=i&&Gt.x!=l||(Gt.x==i&&0!=(1&wt)||Gt.x==l&&0!=(4&wt))&&(wt^=2)):5==qt?(null==(Gt=e.list[(2+(a<<1))*e.width+o])?(Tt=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?Et=new ii:(Et=ii.zpp_pool,ii.zpp_pool=Et.next,Et.next=null),Et.forced=!1,Et.x=Tt,Et.y=r,Gt=Et,e.list[(2+(a<<1))*e.width+o]=Gt):(It=Gt.x,Tt=Gt.y,null==ii.zpp_pool?Nt=new ii:(Nt=ii.zpp_pool,ii.zpp_pool=Nt.next,Nt.next=null),Nt.forced=!1,Nt.x=It,Nt.y=Tt,Gt=Nt),u&&(Gt.forced=!0),Gt.x!=i&&Gt.x!=l||(Gt.x==i&&0!=(64&wt)||Gt.x==l&&0!=(16&wt))&&(wt^=32)):3==qt?(null==(Gt=e.list[(1+(a<<1))*e.width+(o+1)])?(Vt=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?Lt=new ii:(Lt=ii.zpp_pool,ii.zpp_pool=Lt.next,Lt.next=null),Lt.forced=!1,Lt.x=l,Lt.y=Vt,Gt=Lt,e.list[(1+(a<<1))*e.width+(o+1)]=Gt):(Vt=Gt.x,Rt=Gt.y,null==ii.zpp_pool?Dt=new ii:(Dt=ii.zpp_pool,ii.zpp_pool=Dt.next,Dt.next=null),Dt.forced=!1,Dt.x=Vt,Dt.y=Rt,Gt=Dt),h&&(Gt.forced=!0),Gt.y!=p&&Gt.y!=r||(Gt.y==p&&0!=(4&wt)||Gt.y==r&&0!=(16&wt))&&(wt^=8)):(null==(Gt=e.list[(1+(a<<1))*e.width+o])?(Zt=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?Ft=new ii:(Ft=ii.zpp_pool,ii.zpp_pool=Ft.next,Ft.next=null),Ft.forced=!1,Ft.x=i,Ft.y=Zt,Gt=Ft,e.list[(1+(a<<1))*e.width+o]=Gt):(Rt=Gt.x,Zt=Gt.y,null==ii.zpp_pool?Bt=new ii:(Bt=ii.zpp_pool,ii.zpp_pool=Bt.next,Bt.next=null),Bt.forced=!1,Bt.x=Rt,Bt.y=Zt,Gt=Bt),s&&(Gt.forced=!0),Gt.y!=p&&Gt.y!=r||(Gt.y==p&&0!=(1&wt)||Gt.y==r&&0!=(64&wt))&&(wt^=128)),Gt=Gt,null==v.p1?v.p1=Gt.prev=Gt.next=Gt:(Gt.prev=v.p1,Gt.next=v.p1.next,v.p1.next.prev=Gt,v.p1.next=Gt),v.p1=Gt)}v.p1=v.p1.next,1!=(v.key1=wt)&&4!=wt&&16!=wt&&64!=wt&&3!=wt&&12!=wt&&48!=wt&&192!=wt&&129!=wt&&6!=wt&&24!=wt&&96!=wt&&5!=wt&&20!=wt&&80!=wt&&65!=wt&&17!=wt&&68!=wt||(wt=0,v.key1=0,v.p1=null),0==wt?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}else{var Ut=224;v.okey1=224;for(var Kt=0;Kt<8;){var Wt,Yt,Jt,Xt,Ht,$t,Qt,ne,te,ee,ie,pe,le,re,oe,ae,se,_e,he,ue=Kt++;0!=(Ut&1<<ue)&&(he=null,0==ue?(null==ii.zpp_pool?Wt=new ii:(Wt=ii.zpp_pool,ii.zpp_pool=Wt.next,Wt.next=null),Wt.forced=!1,Wt.x=i,Wt.y=p,he=Wt,(s||_)&&(he.forced=!0)):2==ue?(null==ii.zpp_pool?Yt=new ii:(Yt=ii.zpp_pool,ii.zpp_pool=Yt.next,Yt.next=null),Yt.forced=!1,Yt.x=l,Yt.y=p,he=Yt,(h||_)&&(he.forced=!0)):4==ue?(null==ii.zpp_pool?Jt=new ii:(Jt=ii.zpp_pool,ii.zpp_pool=Jt.next,Jt.next=null),Jt.forced=!1,Jt.x=l,Jt.y=r,he=Jt,(h||u)&&(he.forced=!0)):6==ue?(null==ii.zpp_pool?Xt=new ii:(Xt=ii.zpp_pool,ii.zpp_pool=Xt.next,Xt.next=null),Xt.forced=!1,Xt.x=i,Xt.y=r,he=Xt,(s||u)&&(he.forced=!0)):1==ue?(null==(he=e.list[(a<<1)*e.width+o])?($t=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?Ht=new ii:(Ht=ii.zpp_pool,ii.zpp_pool=Ht.next,Ht.next=null),Ht.forced=!1,Ht.x=$t,Ht.y=p,he=Ht,e.list[(a<<1)*e.width+o]=he):($t=he.x,te=he.y,null==ii.zpp_pool?Qt=new ii:(Qt=ii.zpp_pool,ii.zpp_pool=Qt.next,Qt.next=null),Qt.forced=!1,Qt.x=$t,Qt.y=te,he=Qt),_&&(he.forced=!0),he.x!=i&&he.x!=l||(he.x==i&&0!=(1&Ut)||he.x==l&&0!=(4&Ut))&&(Ut^=2)):5==ue?(null==(he=e.list[(2+(a<<1))*e.width+o])?(ee=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?ne=new ii:(ne=ii.zpp_pool,ii.zpp_pool=ne.next,ne.next=null),ne.forced=!1,ne.x=ee,ne.y=r,he=ne,e.list[(2+(a<<1))*e.width+o]=he):(te=he.x,ee=he.y,null==ii.zpp_pool?ie=new ii:(ie=ii.zpp_pool,ii.zpp_pool=ie.next,ie.next=null),ie.forced=!1,ie.x=te,ie.y=ee,he=ie),u&&(he.forced=!0),he.x!=i&&he.x!=l||(he.x==i&&0!=(64&Ut)||he.x==l&&0!=(16&Ut))&&(Ut^=32)):3==ue?(null==(he=e.list[(1+(a<<1))*e.width+(o+1)])?(le=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?pe=new ii:(pe=ii.zpp_pool,ii.zpp_pool=pe.next,pe.next=null),pe.forced=!1,pe.x=l,pe.y=le,he=pe,e.list[(1+(a<<1))*e.width+(o+1)]=he):(le=he.x,ae=he.y,null==ii.zpp_pool?re=new ii:(re=ii.zpp_pool,ii.zpp_pool=re.next,re.next=null),re.forced=!1,re.x=le,re.y=ae,he=re),h&&(he.forced=!0),he.y!=p&&he.y!=r||(he.y==p&&0!=(4&Ut)||he.y==r&&0!=(16&Ut))&&(Ut^=8)):(null==(he=e.list[(1+(a<<1))*e.width+o])?(se=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?oe=new ii:(oe=ii.zpp_pool,ii.zpp_pool=oe.next,oe.next=null),oe.forced=!1,oe.x=i,oe.y=se,he=oe,e.list[(1+(a<<1))*e.width+o]=he):(ae=he.x,se=he.y,null==ii.zpp_pool?_e=new ii:(_e=ii.zpp_pool,ii.zpp_pool=_e.next,_e.next=null),_e.forced=!1,_e.x=ae,_e.y=se,he=_e),s&&(he.forced=!0),he.y!=p&&he.y!=r||(he.y==p&&0!=(1&Ut)||he.y==r&&0!=(64&Ut))&&(Ut^=128)),he=he,null==v.p1?v.p1=he.prev=he.next=he:(he.prev=v.p1,he.next=v.p1.next,v.p1.next.prev=he,v.p1.next=he),v.p1=he)}if(v.p1=v.p1.next,1!=(v.key1=Ut)&&4!=Ut&&16!=Ut&&64!=Ut&&3!=Ut&&12!=Ut&&48!=Ut&&192!=Ut&&129!=Ut&&6!=Ut&&24!=Ut&&96!=Ut&&5!=Ut&&20!=Ut&&80!=Ut&&65!=Ut&&17!=Ut&&68!=Ut||(Ut=0,v.key1=0,v.p1=null),0!=Ut){var xe=14;v.okey2=14;for(var de=0;de<8;){var ye,ze,ce,ve,me,fe,be,ge,we,Me,Ce,ke,Oe,Pe,Se,Ae,je,Ee,Ie,Te=de++;0!=(xe&1<<Te)&&(Ie=null,0==Te?(null==ii.zpp_pool?ye=new ii:(ye=ii.zpp_pool,ii.zpp_pool=ye.next,ye.next=null),ye.forced=!1,ye.x=i,ye.y=p,Ie=ye,(s||_)&&(Ie.forced=!0)):2==Te?(null==ii.zpp_pool?ze=new ii:(ze=ii.zpp_pool,ii.zpp_pool=ze.next,ze.next=null),ze.forced=!1,ze.x=l,ze.y=p,Ie=ze,(h||_)&&(Ie.forced=!0)):4==Te?(null==ii.zpp_pool?ce=new ii:(ce=ii.zpp_pool,ii.zpp_pool=ce.next,ce.next=null),ce.forced=!1,ce.x=l,ce.y=r,Ie=ce,(h||u)&&(Ie.forced=!0)):6==Te?(null==ii.zpp_pool?ve=new ii:(ve=ii.zpp_pool,ii.zpp_pool=ve.next,ve.next=null),ve.forced=!1,ve.x=i,ve.y=r,Ie=ve,(s||u)&&(Ie.forced=!0)):1==Te?(null==(Ie=e.list[(a<<1)*e.width+o])?(fe=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?me=new ii:(me=ii.zpp_pool,ii.zpp_pool=me.next,me.next=null),me.forced=!1,me.x=fe,me.y=p,Ie=me,e.list[(a<<1)*e.width+o]=Ie):(fe=Ie.x,we=Ie.y,null==ii.zpp_pool?be=new ii:(be=ii.zpp_pool,ii.zpp_pool=be.next,be.next=null),be.forced=!1,be.x=fe,be.y=we,Ie=be),_&&(Ie.forced=!0),Ie.x!=i&&Ie.x!=l||(Ie.x==i&&0!=(1&xe)||Ie.x==l&&0!=(4&xe))&&(xe^=2)):5==Te?(null==(Ie=e.list[(2+(a<<1))*e.width+o])?(Me=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?ge=new ii:(ge=ii.zpp_pool,ii.zpp_pool=ge.next,ge.next=null),ge.forced=!1,ge.x=Me,ge.y=r,Ie=ge,e.list[(2+(a<<1))*e.width+o]=Ie):(we=Ie.x,Me=Ie.y,null==ii.zpp_pool?Ce=new ii:(Ce=ii.zpp_pool,ii.zpp_pool=Ce.next,Ce.next=null),Ce.forced=!1,Ce.x=we,Ce.y=Me,Ie=Ce),u&&(Ie.forced=!0),Ie.x!=i&&Ie.x!=l||(Ie.x==i&&0!=(64&xe)||Ie.x==l&&0!=(16&xe))&&(xe^=32)):3==Te?(null==(Ie=e.list[(1+(a<<1))*e.width+(o+1)])?(Oe=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?ke=new ii:(ke=ii.zpp_pool,ii.zpp_pool=ke.next,ke.next=null),ke.forced=!1,ke.x=l,ke.y=Oe,Ie=ke,e.list[(1+(a<<1))*e.width+(o+1)]=Ie):(Oe=Ie.x,Ae=Ie.y,null==ii.zpp_pool?Pe=new ii:(Pe=ii.zpp_pool,ii.zpp_pool=Pe.next,Pe.next=null),Pe.forced=!1,Pe.x=Oe,Pe.y=Ae,Ie=Pe),h&&(Ie.forced=!0),Ie.y!=p&&Ie.y!=r||(Ie.y==p&&0!=(4&xe)||Ie.y==r&&0!=(16&xe))&&(xe^=8)):(null==(Ie=e.list[(1+(a<<1))*e.width+o])?(je=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?Se=new ii:(Se=ii.zpp_pool,ii.zpp_pool=Se.next,Se.next=null),Se.forced=!1,Se.x=i,Se.y=je,Ie=Se,e.list[(1+(a<<1))*e.width+o]=Ie):(Ae=Ie.x,je=Ie.y,null==ii.zpp_pool?Ee=new ii:(Ee=ii.zpp_pool,ii.zpp_pool=Ee.next,Ee.next=null),Ee.forced=!1,Ee.x=Ae,Ee.y=je,Ie=Ee),s&&(Ie.forced=!0),Ie.y!=p&&Ie.y!=r||(Ie.y==p&&0!=(1&xe)||Ie.y==r&&0!=(64&xe))&&(xe^=128)),Ie=Ie,null==v.p2?v.p2=Ie.prev=Ie.next=Ie:(Ie.prev=v.p2,Ie.next=v.p2.next,v.p2.next.prev=Ie,v.p2.next=Ie),v.p2=Ie)}v.p2=v.p2.next,1!=(v.key2=xe)&&4!=xe&&16!=xe&&64!=xe&&3!=xe&&12!=xe&&48!=xe&&192!=xe&&129!=xe&&6!=xe&&24!=xe&&96!=xe&&5!=xe&&20!=xe&&80!=xe&&65!=xe&&17!=xe&&68!=xe||(xe=0,v.key2=0,v.p2=null),0==xe?(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1):(v.pr=v.p2,v.okeyr=v.okey2,v.keyr=v.key2)}else{var Ne=14;v.okey1=14;for(var Le=0;Le<8;){var Ve,De,Fe,Re,Ze,Be,Ge,qe,Ue,Ke,We,Ye,Je,Xe,He,$e,Qe,ni,ti,ei=Le++;0!=(Ne&1<<ei)&&(ti=null,0==ei?(null==ii.zpp_pool?Ve=new ii:(Ve=ii.zpp_pool,ii.zpp_pool=Ve.next,Ve.next=null),Ve.forced=!1,Ve.x=i,Ve.y=p,ti=Ve,(s||_)&&(ti.forced=!0)):2==ei?(null==ii.zpp_pool?De=new ii:(De=ii.zpp_pool,ii.zpp_pool=De.next,De.next=null),De.forced=!1,De.x=l,De.y=p,ti=De,(h||_)&&(ti.forced=!0)):4==ei?(null==ii.zpp_pool?Fe=new ii:(Fe=ii.zpp_pool,ii.zpp_pool=Fe.next,Fe.next=null),Fe.forced=!1,Fe.x=l,Fe.y=r,ti=Fe,(h||u)&&(ti.forced=!0)):6==ei?(null==ii.zpp_pool?Re=new ii:(Re=ii.zpp_pool,ii.zpp_pool=Re.next,Re.next=null),Re.forced=!1,Re.x=i,Re.y=r,ti=Re,(s||u)&&(ti.forced=!0)):1==ei?(null==(ti=e.list[(a<<1)*e.width+o])?(Be=this.xlerp(i,l,p,y,z,n,x),null==ii.zpp_pool?Ze=new ii:(Ze=ii.zpp_pool,ii.zpp_pool=Ze.next,Ze.next=null),Ze.forced=!1,Ze.x=Be,Ze.y=p,ti=Ze,e.list[(a<<1)*e.width+o]=ti):(Be=ti.x,Ue=ti.y,null==ii.zpp_pool?Ge=new ii:(Ge=ii.zpp_pool,ii.zpp_pool=Ge.next,Ge.next=null),Ge.forced=!1,Ge.x=Be,Ge.y=Ue,ti=Ge),_&&(ti.forced=!0),ti.x!=i&&ti.x!=l||(ti.x==i&&0!=(1&Ne)||ti.x==l&&0!=(4&Ne))&&(Ne^=2)):5==ei?(null==(ti=e.list[(2+(a<<1))*e.width+o])?(Ke=this.xlerp(i,l,r,m,c,n,x),null==ii.zpp_pool?qe=new ii:(qe=ii.zpp_pool,ii.zpp_pool=qe.next,qe.next=null),qe.forced=!1,qe.x=Ke,qe.y=r,ti=qe,e.list[(2+(a<<1))*e.width+o]=ti):(Ue=ti.x,Ke=ti.y,null==ii.zpp_pool?We=new ii:(We=ii.zpp_pool,ii.zpp_pool=We.next,We.next=null),We.forced=!1,We.x=Ue,We.y=Ke,ti=We),u&&(ti.forced=!0),ti.x!=i&&ti.x!=l||(ti.x==i&&0!=(64&Ne)||ti.x==l&&0!=(16&Ne))&&(Ne^=32)):3==ei?(null==(ti=e.list[(1+(a<<1))*e.width+(o+1)])?(Je=this.ylerp(p,r,l,z,c,n,x),null==ii.zpp_pool?Ye=new ii:(Ye=ii.zpp_pool,ii.zpp_pool=Ye.next,Ye.next=null),Ye.forced=!1,Ye.x=l,Ye.y=Je,ti=Ye,e.list[(1+(a<<1))*e.width+(o+1)]=ti):(Je=ti.x,$e=ti.y,null==ii.zpp_pool?Xe=new ii:(Xe=ii.zpp_pool,ii.zpp_pool=Xe.next,Xe.next=null),Xe.forced=!1,Xe.x=Je,Xe.y=$e,ti=Xe),h&&(ti.forced=!0),ti.y!=p&&ti.y!=r||(ti.y==p&&0!=(4&Ne)||ti.y==r&&0!=(16&Ne))&&(Ne^=8)):(null==(ti=e.list[(1+(a<<1))*e.width+o])?(Qe=this.ylerp(p,r,i,y,m,n,x),null==ii.zpp_pool?He=new ii:(He=ii.zpp_pool,ii.zpp_pool=He.next,He.next=null),He.forced=!1,He.x=i,He.y=Qe,ti=He,e.list[(1+(a<<1))*e.width+o]=ti):($e=ti.x,Qe=ti.y,null==ii.zpp_pool?ni=new ii:(ni=ii.zpp_pool,ii.zpp_pool=ni.next,ni.next=null),ni.forced=!1,ni.x=$e,ni.y=Qe,ti=ni),s&&(ti.forced=!0),ti.y!=p&&ti.y!=r||(ti.y==p&&0!=(1&Ne)||ti.y==r&&0!=(64&Ne))&&(Ne^=128)),ti=ti,null==v.p1?v.p1=ti.prev=ti.next=ti:(ti.prev=v.p1,ti.next=v.p1.next,v.p1.next.prev=ti,v.p1.next=ti),v.p1=ti)}v.p1=v.p1.next,1!=(v.key1=Ne)&&4!=Ne&&16!=Ne&&64!=Ne&&3!=Ne&&12!=Ne&&48!=Ne&&192!=Ne&&129!=Ne&&6!=Ne&&24!=Ne&&96!=Ne&&5!=Ne&&20!=Ne&&80!=Ne&&65!=Ne&&17!=Ne&&68!=Ne||(Ne=0,v.key1=0,v.p1=null),0==Ne?v=null:(v.pr=v.p1,v.okeyr=v.okey1,v.keyr=v.key1)}}}return v},li.prototype.lerp=function(n,t,e,i){if(0==e)return n;if(0==i)return t;i=e-i,i=i*i<jp.epsilon*jp.epsilon?.5:e/i;return i<0?i=0:1<i&&(i=1),n+i*(t-n)},li.prototype.xlerp=function(n,t,e,i,p,l,r){var o,a;for(a=0==i?n:0==p?t:((o=(o=i-p)*o<jp.epsilon*jp.epsilon?.5:i/o)<0?o=0:1<o&&(o=1),n+o*(t-n));0!=r--&&n<a&&a<t;){var s=l(a,e);if(0==s)break;i*s<0?(t=a,p=s):(n=a,i=s),a=0==i?n:0==p?t:((s=(s=i-p)*s<jp.epsilon*jp.epsilon?.5:i/s)<0?s=0:1<s&&(s=1),n+s*(t-n))}return a},li.prototype.ylerp=function(n,t,e,i,p,l,r){var o,a;for(a=0==i?n:0==p?t:((o=(o=i-p)*o<jp.epsilon*jp.epsilon?.5:i/o)<0?o=0:1<o&&(o=1),n+o*(t-n));0!=r--&&n<a&&a<t;){var s=l(e,a);if(0==s)break;i*s<0?(t=a,p=s):(n=a,i=s),a=0==i?n:0==p?t:((s=(s=i-p)*s<jp.epsilon*jp.epsilon?.5:i/s)<0?s=0:1<s&&(s=1),n+s*(t-n))}return a},li.prototype.__class__=li;var mt=zpp_nape.geom.ZPP_Mat23=function(){this.next=null,this._invalidate=null,this.ty=0,this.tx=0,this.d=0,this.c=0,this.b=0,this.a=0,this.outer=null};mt.__name__=["zpp_nape","geom","ZPP_Mat23"],mt.get=function(){var n;return null==mt.zpp_pool?n=new mt:(n=mt.zpp_pool,mt.zpp_pool=n.next,n.next=null),n},mt.identity=function(){var n=mt.get();return n.setas(1,0,0,1,0,0),n},mt.prototype.outer=null,mt.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new G,(n=this.outer.zpp_inner).next=mt.zpp_pool,mt.zpp_pool=n,this.outer.zpp_inner=this),this.outer},mt.prototype.a=null,mt.prototype.b=null,mt.prototype.c=null,mt.prototype.d=null,mt.prototype.tx=null,mt.prototype.ty=null,mt.prototype._invalidate=null,mt.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate()},mt.prototype.set=function(n){this.setas(n.a,n.b,n.c,n.d,n.tx,n.ty)},mt.prototype.setas=function(n,t,e,i,p,l){this.tx=p,this.ty=l,this.a=n,this.b=t,this.c=e,this.d=i},mt.prototype.next=null,mt.prototype.free=function(){},mt.prototype.alloc=function(){},mt.prototype.__class__=mt;var ft=zpp_nape.geom.ZPP_MatMN=function(n,t){this.x=null,this.n=0,this.m=0,this.outer=null,this.m=n,this.n=t,this.x=[];for(var e=0,i=n*t;e<i;)++e,this.x.push(0)};ft.__name__=["zpp_nape","geom","ZPP_MatMN"],ft.prototype.outer=null,ft.prototype.m=null,ft.prototype.n=null,ft.prototype.x=null,ft.prototype.__class__=ft;var bt=zpp_nape.geom.ZPP_Monotone=function(){};bt.__name__=["zpp_nape","geom","ZPP_Monotone"],bt.bisector=function(n){var t=n.prev,e=n.next,i=n.x-t.x,p=n.y-t.y,l=e.x-n.x,t=e.y-n.y;null==Ip.zpp_pool?r=new Ip:(r=Ip.zpp_pool,Ip.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=-p-t,r.y=i+l;var n=r,r=1/Math.sqrt(n.x*n.x+n.y*n.y);return n.x*=r,n.y*=r,t*i-l*p<0&&(n.x=-n.x,n.y=-n.y),n},bt.below=function(n,t){if(n.y<t.y)return!0;if(n.y>t.y)return!1;if(n.x<t.x)return!0;if(n.x>t.x)return!1;var e=bt.bisector(n),i=bt.bisector(t);e.x+=n.x,e.y+=n.y,i.x+=t.x,i.y+=t.y;t=e.x<i.x||e.x==i.x&&e.y<i.y;return null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ip.zpp_pool,Ip.zpp_pool=i,t},bt.above=function(n,t){return bt.below(t,n)},bt.left_vertex=function(n){var t=n.prev;return t.y>n.y||t.y==n.y&&n.next.y<n.y},bt.isMonotone=function(n){var t=n,e=n,i=n.next;if(null!=i)for(var p=i;;)if(p.y<t.y&&(t=p),p.y>e.y&&(e=p),(p=p.next)==n)break;var l=!0,r=t;if(e!=t.next){var o=t.next,a=e;if(null!=o)for(var s=o;;){var _=s;if(_.y<r.y){l=!1;break}if(r=_,(s=s.next)==a)break}}if(!l)return!1;if(e!=(r=t).prev){var o=t.prev,h=e;if(null!=o)for(var u=o;;){var x=u;if(x.y<r.y){l=!1;break}if(r=x,(u=u.prev)==h)break}}return l},bt.sharedPPoly=null,bt.getShared=function(){return null==bt.sharedPPoly&&(bt.sharedPPoly=new wt),bt.sharedPPoly},bt.decompose=function(n,t){if(null==t?t=new wt(n):t.init(n),null==t.vertices)return t;null==bt.queue&&(bt.queue=new Me);var n=t.vertices,e=t.vertices;if(null!=n)for(var i=n;;){var p=i;bt.queue.add(p);var l=p.next.x-p.x,r=p.next.y-p.y,o=p.prev.x-p.x,r=0<(p.prev.y-p.y)*l-o*r;if(p.type=bt.below(p.prev,p)?bt.below(p.next,p)?r?0:3:4:bt.below(p,p.next)?r?1:2:4,(i=i.next)==e)break}n=bt.queue;if(null!=n.head&&null!=n.head.next){for(var a,s,_,h=n.head,u=null,x=null,d=null,y=null,z=1;;){for(a=0,x=h,u=h=null;null!=x;){for(++a,d=x,s=0,_=z;null!=d&&s<z;)++s,d=d.next;for(;0<s||0<_&&null!=d;)0!=s&&(0==_||null==d||bt.above(x.elt,d.elt))?(x=(y=x).next,--s):(d=(y=d).next,--_),null!=u?u.next=y:h=y,u=y;x=d}if(u.next=null,z<<=1,!(1<a))break}n.head=h,n.modified=!0,n.pushmod=!0}for(null==bt.edges&&(null==Ri.zpp_pool?bt.edges=new Ri:(bt.edges=Ri.zpp_pool,Ri.zpp_pool=bt.edges.next,bt.edges.next=null),bt.edges.lt=gt.edge_lt,bt.edges.swapped=gt.edge_swap);null!=bt.queue.head;){var c=bt.queue.pop_unsafe();switch(c.type){case 0:(c.helper=c).node=bt.edges.insert(c);break;case 1:var v=c.prev;2==v.helper.type&&t.add_diagonal(c,v.helper),bt.edges.remove_node(v.node);break;case 2:v=c.prev;2==v.helper.type&&t.add_diagonal(c,v.helper),bt.edges.remove_node(v.node);var m=null;if(!bt.edges.empty()){for(var f=bt.edges.parent;null!=f.prev;)f=f.prev;for(;null!=f;){var b=f.data;if(!gt.vert_lt(b,c)){m=b;break}if(null!=f.next)for(f=f.next;null!=f.prev;)f=f.prev;else{for(;null!=f.parent&&f==f.parent.next;)f=f.parent;f=f.parent}}}v=m;null!=v&&(2==v.helper.type&&t.add_diagonal(c,v.helper),v.helper=c);break;case 3:var g=null;if(!bt.edges.empty()){for(var w=bt.edges.parent;null!=w.prev;)w=w.prev;for(;null!=w;){var M=w.data;if(!gt.vert_lt(M,c)){g=M;break}if(null!=w.next)for(w=w.next;null!=w.prev;)w=w.prev;else{for(;null!=w.parent&&w==w.parent.next;)w=w.parent;w=w.parent}}}var C=g;null!=C&&(t.add_diagonal(c,C.helper),C.helper=c),c.node=bt.edges.insert(c),c.helper=c;break;case 4:C=c.prev;if(bt.left_vertex(c))2==C.helper.type&&t.add_diagonal(c,C.helper),bt.edges.remove_node(C.node),c.node=bt.edges.insert(c),c.helper=c;else{var k=null;if(!bt.edges.empty()){for(var O=bt.edges.parent;null!=O.prev;)O=O.prev;for(;null!=O;){var P=O.data;if(!gt.vert_lt(P,c)){k=P;break}if(null!=O.next)for(O=O.next;null!=O.prev;)O=O.prev;else{for(;null!=O.parent&&O==O.parent.next;)O=O.parent;O=O.parent}}}C=k;2==C.helper.type&&t.add_diagonal(c,C.helper),C.helper=c}}}return t},bt.prototype.__class__=bt;var gt=zpp_nape.geom.ZPP_PartitionVertex=function(){this.node=null,this.prev=null,this.next=null,this.rightchain=!1,this.helper=null,this.type=0,this.diagonals=null,this.forced=!1,this.y=0,this.x=0,this.mag=0,this.id=0,this.id=gt.nextId++,this.diagonals=new Me};gt.__name__=["zpp_nape","geom","ZPP_PartitionVertex"],gt.get=function(n){var t;return null==gt.zpp_pool?t=new gt:(t=gt.zpp_pool,gt.zpp_pool=t.next,t.next=null),t.x=n.x,t.y=n.y,t},gt.rightdistance=function(n,t){var e=n.next.y>n.y,i=n.next.x-n.x,p=n.next.y-n.y,l=t.x-n.x;return(e?-1:1)*((t.y-n.y)*i-l*p)},gt.vert_lt=function(n,t){if(t==n||t==n.next)return!0;if(n.y!=n.next.y)return gt.rightdistance(n,t)<=0;var e=n.x,n=n.next.x;return(e<n?e:n)<=t.x},gt.edge_swap=function(n,t){var e=n.node;n.node=t.node,t.node=e},gt.edge_lt=function(n,t){if(n==t&&n.next==t.next)return!1;if(n==t.next)return!gt.vert_lt(n,t);if(t==n.next)return gt.vert_lt(t,n);if(n.y==n.next.y){if(t.y!=t.next.y)return 0<gt.rightdistance(t,n)||0<gt.rightdistance(t,n.next);var e=n.x,i=n.next.x,p=i<e?e:i,l=t.x,r=t.next.x;return(r<l?l:r)<p}e=gt.rightdistance(n,t),i=gt.rightdistance(n,t.next);if(0==e&&0==i){l=n.x,r=n.next.x,p=r<l?l:r,l=t.x,r=t.next.x;return(r<l?l:r)<p}if(0<=e*i)return e<0||i<0;i=gt.rightdistance(t,n),n=gt.rightdistance(t,n.next);return 0<=i*n&&(0<i||0<n)},gt.prototype.id=null,gt.prototype.mag=null,gt.prototype.x=null,gt.prototype.y=null,gt.prototype.forced=null,gt.prototype.diagonals=null,gt.prototype.type=null,gt.prototype.helper=null,gt.prototype.rightchain=null,gt.prototype.next=null,gt.prototype.prev=null,gt.prototype.alloc=function(){},gt.prototype.free=function(){this.helper=null},gt.prototype.copy=function(){var n;return null==gt.zpp_pool?n=new gt:(n=gt.zpp_pool,gt.zpp_pool=n.next,n.next=null),n.x=this.x,n.y=this.y,n.forced=this.forced,n},gt.prototype.sort=function(){var n=0,t=0,e=0;n=this.prev.x-this.x,t=this.prev.y-this.y,e=this.next.x-this.x;var i=(this.next.y-this.y)*n-e*t,p=0<i?-1:0==i?0:1,i=this.diagonals;if(null!=i.head&&null!=i.head.next){for(var l,r,o,a,s,_,h=i.head,u=null,x=null,d=null,y=null,z=1;;){for(l=0,x=h,u=h=null;null!=x;){for(++l,d=x,r=0,o=z;null!=d&&r<z;)++r,d=d.next;for(;0<r||0<o&&null!=d;)0!=r&&(0==o||null==d||(1==p?(n=x.elt.x-this.x,t=x.elt.y-this.y,e=d.elt.x-this.x,1==(0<(a=(d.elt.y-this.y)*n-e*t)?-1:0==a?0:1)):(n=this.prev.x-this.x,t=this.prev.y-this.y,e=x.elt.x-this.x,s=0<(_=(x.elt.y-this.y)*n-e*t)?-1:0==_?0:1,n=this.prev.x-this.x,t=this.prev.y-this.y,e=d.elt.x-this.x,s*(_=0<(a=(d.elt.y-this.y)*n-e*t)?-1:0==a?0:1)==1||s*_==0&&(1==s||1==_)?(n=x.elt.x-this.x,t=x.elt.y-this.y,e=d.elt.x-this.x,1==(0<(a=(d.elt.y-this.y)*n-e*t)?-1:0==a?0:1)):-1==s||-1==_?-1==_:0!=s||0!=_||(n=this.x-this.prev.x,t=this.y-this.prev.y,s=n*(e=x.elt.x-this.x)+t*(x.elt.y-this.y),_=n*(e=d.elt.x-this.x)+t*(d.elt.y-this.y),s<0&&0<_||!(_<0&&0<s)))))?(x=(y=x).next,--r):(d=(y=d).next,--o),null!=u?u.next=y:h=y,u=y;x=d}if(u.next=null,z<<=1,!(1<l))break}i.head=h,i.modified=!0,i.pushmod=!0}},gt.prototype.node=null,gt.prototype.__class__=gt;var wt=zpp_nape.geom.ZPP_PartitionedPoly=function(n){this.next=null,this.vertices=null,this.init(n)};wt.__name__=["zpp_nape","geom","ZPP_PartitionedPoly"],wt.sharedPPList=null,wt.getSharedPP=function(){return null==wt.sharedPPList&&(wt.sharedPPList=new ke),wt.sharedPPList},wt.sharedGVList=null,wt.getShared=function(){return null==wt.sharedGVList&&(wt.sharedGVList=new Oe),wt.sharedGVList},wt.prototype.vertices=null,wt.prototype.eq=function(n,t){var e=n.x,i=n.y,p=0,n=0;return(p=e-t.x)*p+(n=i-t.y)*n<jp.epsilon*jp.epsilon},wt.prototype.next=null,wt.prototype.alloc=function(){},wt.prototype.free=function(){},wt.prototype.init=function(n){if(null!=n){var t=0;if(null!=n)for(var e=n;;)if(t+=e.x*(e.next.y-e.prev.y),(e=e.next)==n)break;for(var i=0<.5*t,p=n;;){var l,r,o,a=i?(null==gt.zpp_pool?l=new gt:(l=gt.zpp_pool,gt.zpp_pool=l.next,l.next=null),l.x=p.x,l.y=p.y,r=l,null==this.vertices?this.vertices=r.prev=r.next=r:(r.prev=this.vertices,r.next=this.vertices.next,this.vertices.next.prev=r,this.vertices.next=r),r):(null==gt.zpp_pool?o=new gt:(o=gt.zpp_pool,gt.zpp_pool=o.next,o.next=null),o.x=p.x,o.y=p.y,a=o,null==this.vertices?this.vertices=a.prev=a.next=a:(a.next=this.vertices,a.prev=this.vertices.prev,this.vertices.prev.next=a,this.vertices.prev=a),a);if(this.vertices=a,this.vertices.forced=p.forced,(p=p.next)==n)break}this.remove_collinear_vertices()}},wt.prototype.remove_collinear_vertices=function(){for(var n,t=this.vertices,e=!0;e||t!=this.vertices;){var i,p,e=!1;if(this.eq(t,t.next)){if(t==this.vertices&&(this.vertices=t.next,e=!0),t.forced&&(t.next.forced=!0),null==(t=null!=t&&t.prev==t?(t.next=t.prev=null,(p=t).helper=null,p.next=gt.zpp_pool,gt.zpp_pool=p,null):(i=t.next,t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null,(p=t).helper=null,p.next=gt.zpp_pool,gt.zpp_pool=p,t=null,i))){this.vertices=null;break}}else t=t.next}if(null==this.vertices)return!0;for(;;){for(n=!1,t=this.vertices,e=!0;e||t!=this.vertices;){e=!1;var l,r=t.prev,o=0,a=t.x-r.x,o=t.y-r.y,r=t.next.x-t.x,o=(t.next.y-t.y)*a-r*o;if(o*o>=jp.epsilon*jp.epsilon)t=t.next;else if(t==this.vertices&&(this.vertices=t.next,e=!0),n=!0,null==(t=null!=t&&t.prev==t?(t.next=t.prev=null,(l=t).helper=null,l.next=gt.zpp_pool,gt.zpp_pool=l,null):(o=t.next,t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null,(l=t).helper=null,l.next=gt.zpp_pool,gt.zpp_pool=l,t=null,o))){n=!1,this.vertices=null;break}}if(!n)break}return null==this.vertices},wt.prototype.add_diagonal=function(n,t){n.diagonals.add(t),t.diagonals.add(n),n.forced=t.forced=!0},wt.prototype.extract_partitions=function(n){if(null==n&&(n=new ke),null!=this.vertices){var t=this.vertices,e=this.vertices;if(null!=t)for(var i=t;i.sort(),(i=i.next)!=e;);for(this.pull_partitions(this.vertices,n);null!=this.vertices;){var p,l=null!=this.vertices&&this.vertices.prev==this.vertices?(this.vertices.next=this.vertices.prev=null,(p=this.vertices).helper=null,p.next=gt.zpp_pool,gt.zpp_pool=p,this.vertices=null):(l=this.vertices.next,this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null,(p=this.vertices).helper=null,p.next=gt.zpp_pool,gt.zpp_pool=p,this.vertices=null,l);this.vertices=l}for(var r=null,o=n.head;null!=o;)o.elt.remove_collinear_vertices()?n.erase(r):o=(r=o).next}return n},wt.prototype.pull_partitions=function(n,t){var e;null==wt.zpp_pool?e=new wt:(e=wt.zpp_pool,wt.zpp_pool=e.next,e.next=null);for(var i,p=n;;){null==gt.zpp_pool?i=new gt:(i=gt.zpp_pool,gt.zpp_pool=i.next,i.next=null),i.x=p.x,i.y=p.y,i.forced=p.forced;var l=i;if(null==e.vertices?e.vertices=l.prev=l.next=l:(l.prev=e.vertices,l.next=e.vertices.next,e.vertices.next.prev=l,e.vertices.next=l),e.vertices=l,e.vertices.forced=p.forced,null!=p.diagonals.head){var r=p.diagonals,l=r.head.elt;if(r.pop(),l==n)break;p=this.pull_partitions(p,t)}else p=p.next;if(p==n)break}var o=0,a=e.vertices,s=e.vertices;if(null!=a)for(var _=a;;)if(o+=_.x*(_.next.y-_.prev.y),(_=_.next)==s)break;return.5*o!=0&&t.add(e),p},wt.prototype.extract=function(n){if(null==n&&(n=new Oe),null!=this.vertices){var t=this.vertices,e=this.vertices;if(null!=t)for(var i=t;i.sort(),(i=i.next)!=e;);for(this.pull(this.vertices,n);null!=this.vertices;){var p,l=null!=this.vertices&&this.vertices.prev==this.vertices?(this.vertices.next=this.vertices.prev=null,(p=this.vertices).helper=null,p.next=gt.zpp_pool,gt.zpp_pool=p,this.vertices=null):(l=this.vertices.next,this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null,(p=this.vertices).helper=null,p.next=gt.zpp_pool,gt.zpp_pool=p,this.vertices=null,l);this.vertices=l}}return n},wt.prototype.pull=function(n,t){for(var e=null,i=n;;){var p,l=i.x,r=i.y;null==ii.zpp_pool?p=new ii:(p=ii.zpp_pool,ii.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=l,p.y=r;l=p;if(null==e?e=l.prev=l.next=l:(l.prev=e,l.next=e.next,e.next.prev=l,e.next=l),(e=l).forced=i.forced,null!=i.diagonals.head){r=i.diagonals,l=r.head.elt;if(r.pop(),l==n)break;i=this.pull(i,t)}else i=i.next;if(i==n)break}var o=0,a=e;if(null!=e)for(var s=e;;)if(o+=s.x*(s.next.y-s.prev.y),(s=s.next)==a)break;var _=.5*o;if(_*_>=jp.epsilon*jp.epsilon){for(var h,u=e,x=!0;x||u!=e;){x=!1;var d=u.x,y=u.y,z=0,c=d-u.next.x,z=y-u.next.y;if(c*c+z*z<jp.epsilon*jp.epsilon){if(u==e&&(e=u.next,x=!0),u.forced&&(u.next.forced=!0),null==(u=null!=u&&u.prev==u?u.next=u.prev=null:(z=u.next,u.prev.next=u.next,u.next.prev=u.prev,u.next=u.prev=null,u=null,z))){e=null;break}}else u=u.next}if(null!=e)for(;;){for(u=e,x=!(h=!1);x||u!=e;){x=!1;var v=u.prev,m=0,f=u.x-v.x,m=u.y-v.y,v=u.next.x-u.x,m=(u.next.y-u.y)*f-v*m;if(m*m>=jp.epsilon*jp.epsilon)u=u.next;else if(u==e&&(e=u.next,x=!0),h=!0,null==(u=null!=u&&u.prev==u?u.next=u.prev=null:(m=u.next,u.prev.next=u.next,u.next.prev=u.prev,u.next=u.prev=null,u=null,m))){h=!1,e=null;break}}if(!h)break}null!=e&&t.add(e)}return i},wt.prototype.__class__=wt;var Mt=zpp_nape.geom.ZPP_Ray=function(){var n,t,e,i,p,l;this.zip_dir=!1,this.absnormaly=0,this.absnormalx=0,this.normaly=0,this.normalx=0,this.idiry=0,this.idirx=0,this.diry=0,this.dirx=0,this.originy=0,this.originx=0,this.userData=null,this.maxdist=0,this.direction=null,(this.origin=null)==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),0==n.zpp_inner.x&&(null!=(e=n.zpp_inner)._validate&&e._validate(),0==n.zpp_inner.y)||(n.zpp_inner.x=0,n.zpp_inner.y=0,null!=(e=n.zpp_inner)._invalidate&&e._invalidate(e))),n.zpp_inner.weak=!1,this.origin=n,this.origin.zpp_inner._invalidate=X(this,this.origin_invalidate),null==Vi.poolVec2?i=new Cn:(i=Vi.poolVec2,Vi.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=0,p.y=0,i.zpp_inner=p,i.zpp_inner.outer=i):(null!=(p=i.zpp_inner)._validate&&p._validate(),0==i.zpp_inner.x&&(null!=(l=i.zpp_inner)._validate&&l._validate(),0==i.zpp_inner.y)||(i.zpp_inner.x=0,i.zpp_inner.y=0,null!=(l=i.zpp_inner)._invalidate&&l._invalidate(l))),i.zpp_inner.weak=!1,this.direction=i,this.direction.zpp_inner._invalidate=X(this,this.direction_invalidate),this.originx=0,this.originy=0,this.dirx=0,this.diry=0,this.zip_dir=!1};Mt.__name__=["zpp_nape","geom","ZPP_Ray"],Mt.prototype.origin=null,Mt.prototype.direction=null,Mt.prototype.maxdist=null,Mt.prototype.userData=null,Mt.prototype.originx=null,Mt.prototype.originy=null,Mt.prototype.dirx=null,Mt.prototype.diry=null,Mt.prototype.idirx=null,Mt.prototype.idiry=null,Mt.prototype.normalx=null,Mt.prototype.normaly=null,Mt.prototype.absnormalx=null,Mt.prototype.absnormaly=null,Mt.prototype.origin_invalidate=function(n){this.originx=n.x,this.originy=n.y},Mt.prototype.direction_invalidate=function(n){this.dirx=n.x,this.diry=n.y,this.zip_dir=!0},Mt.prototype.zip_dir=null,Mt.prototype.invalidate_dir=function(){this.zip_dir=!0},Mt.prototype.validate_dir=function(){var n;this.zip_dir&&(this.zip_dir=!1,n=1/Math.sqrt(this.dirx*this.dirx+this.diry*this.diry),this.dirx*=n,this.diry*=n,this.idirx=1/this.dirx,this.idiry=1/this.diry,this.normalx=-this.diry,this.normaly=this.dirx,n=this.normalx,this.absnormalx=n<0?-n:n,n=this.normaly,this.absnormaly=n<0?-n:n)},Mt.prototype.rayAABB=function(){var n,t,e=this.originx,i=e,p=this.originy,l=p;return this.maxdist>=1/0?(0<this.dirx?i=1/0:this.dirx<0&&(i=-1/0),0<this.diry?l=1/0:this.diry<0&&(l=-1/0)):(i+=this.maxdist*this.dirx,l+=this.maxdist*this.diry),i<e&&(n=e,e=i,i=n),l<p&&(n=p,p=l,l=n),null==Lt.zpp_pool?t=new Lt:(t=Lt.zpp_pool,Lt.zpp_pool=t.next,t.next=null),t.minx=e,t.miny=p,t.maxx=i,t.maxy=l,t},Mt.prototype.aabbtest=function(n){var t=this.normalx*(this.originx-.5*(n.minx+n.maxx))+this.normaly*(this.originy-.5*(n.miny+n.maxy));return(t<0?-t:t)<.5*this.absnormalx*(n.maxx-n.minx)+.5*this.absnormaly*(n.maxy-n.miny)},Mt.prototype.aabbsect=function(n){var t=this.originx>=n.minx&&this.originx<=n.maxx,e=this.originy>=n.miny&&this.originy<=n.maxy;if(t&&e)return 0;for(var i=-1;!(0<=this.dirx&&this.originx>=n.maxx||this.dirx<=0&&this.originx<=n.minx||0<=this.diry&&this.originy>=n.maxy||this.diry<=0&&this.originy<=n.miny);){if(0<this.dirx){var p=(n.minx-this.originx)*this.idirx;if(0<=p&&p<=this.maxdist){var l=this.originy+p*this.diry;if(l>=n.miny&&l<=n.maxy){i=p;break}}}else if(this.dirx<0){l=(n.maxx-this.originx)*this.idirx;if(0<=l&&l<=this.maxdist){p=this.originy+l*this.diry;if(p>=n.miny&&p<=n.maxy){i=l;break}}}if(0<this.diry){var r=(n.miny-this.originy)*this.idiry;if(0<=r&&r<=this.maxdist){var o=this.originx+r*this.dirx;if(o>=n.minx&&o<=n.maxx){i=r;break}}}else if(this.diry<0){o=(n.maxy-this.originy)*this.idiry;if(0<=o&&o<=this.maxdist){r=this.originx+o*this.dirx;if(r>=n.minx&&r<=n.maxx){i=o;break}}}break}return i},Mt.prototype.circlesect=function(n,t,e){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var y=n.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var z=0,z=this.originx-n.worldCOMx,h=this.originy-n.worldCOMy,_=this.dirx*this.dirx+this.diry*this.diry,u=2*(z*this.dirx+h*this.diry),x=z*z+h*h-n.radius*n.radius,d=u*u-4*_*x;if(0==d){var c=-u/2*_;if((!t||0<x)&&0<c&&c<e&&c<=this.maxdist){y=0,z=0,y=this.originx,z=this.originy;y+=this.dirx*c,z+=this.diry*c,y-=n.worldCOMx,z-=n.worldCOMy;var v,m,h=1/Math.sqrt(y*y+z*z);return y*=h,z*=h,x<=0&&(y=-y,z=-z),null==Vi.poolVec2?v=new Cn:(v=Vi.poolVec2,Vi.poolVec2=v.zpp_pool,v.zpp_pool=null),null==v.zpp_inner?(null==Ip.zpp_pool?m=new Ip:(m=Ip.zpp_pool,Ip.zpp_pool=m.next,m.next=null),m.weak=!1,m._immutable=!1,m.x=y,m.y=z,v.zpp_inner=m,v.zpp_inner.outer=v):(null!=(m=v.zpp_inner)._validate&&m._validate(),v.zpp_inner.x==y&&(null!=(m=v.zpp_inner)._validate&&m._validate(),v.zpp_inner.y==z)||(v.zpp_inner.x=y,v.zpp_inner.y=z,null!=(z=v.zpp_inner)._invalidate&&z._invalidate(z))),v.zpp_inner.weak=!1,dt.getRay(v,c,x<=0,n.outer)}return null}c=(-u-(d=Math.sqrt(d)))*(_=1/(2*_)),x=(-u+d)*_;if(0<c){if(c<e&&c<=this.maxdist){d=0,u=this.originx,d=this.originy;u+=this.dirx*c,d+=this.diry*c,u-=n.worldCOMx,d-=n.worldCOMy;var f,b,_=1/Math.sqrt(u*u+d*d);return u*=_,d*=_,null==Vi.poolVec2?f=new Cn:(f=Vi.poolVec2,Vi.poolVec2=f.zpp_pool,f.zpp_pool=null),null==f.zpp_inner?(null==Ip.zpp_pool?b=new Ip:(b=Ip.zpp_pool,Ip.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=u,b.y=d,f.zpp_inner=b,f.zpp_inner.outer=f):(null!=(b=f.zpp_inner)._validate&&b._validate(),f.zpp_inner.x==u&&(null!=(b=f.zpp_inner)._validate&&b._validate(),f.zpp_inner.y==d)||(f.zpp_inner.x=u,f.zpp_inner.y=d,null!=(d=f.zpp_inner)._invalidate&&d._invalidate(d))),f.zpp_inner.weak=!1,dt.getRay(f,c,!1,n.outer)}return null}if(0<x&&t){if(x<e&&x<=this.maxdist){t=0,c=this.originx,t=this.originy;c+=this.dirx*x,t+=this.diry*x,c-=n.worldCOMx,t-=n.worldCOMy;var g,w,e=1/Math.sqrt(c*c+t*t);return c=-(c*=e),t=-(t*=e),null==Vi.poolVec2?g=new Cn:(g=Vi.poolVec2,Vi.poolVec2=g.zpp_pool,g.zpp_pool=null),null==g.zpp_inner?(null==Ip.zpp_pool?w=new Ip:(w=Ip.zpp_pool,Ip.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=c,w.y=t,g.zpp_inner=w,g.zpp_inner.outer=g):(null!=(w=g.zpp_inner)._validate&&w._validate(),g.zpp_inner.x==c&&(null!=(w=g.zpp_inner)._validate&&w._validate(),g.zpp_inner.y==t)||(g.zpp_inner.x=c,g.zpp_inner.y=t,null!=(t=g.zpp_inner)._invalidate&&t._invalidate(t))),g.zpp_inner.weak=!1,dt.getRay(g,x,!0,n.outer)}return null}return null},Mt.prototype.circlesect2=function(n,t,e){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var y=n.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var z=0,z=this.originx-n.worldCOMx,c=this.originy-n.worldCOMy,h=this.dirx*this.dirx+this.diry*this.diry,_=2*(z*this.dirx+c*this.diry),u=z*z+c*c-n.radius*n.radius,x=_*_-4*h*u;if(0==x){d=-_/2*h;if((!t||0<u)&&0<d&&d<=this.maxdist){y=0,z=0,y=this.originx,z=this.originy;y+=this.dirx*d,z+=this.diry*d,y-=n.worldCOMx,z-=n.worldCOMy;var v,c=1/Math.sqrt(y*y+z*z);y*=c,z*=c,u<=0&&(y=-y,z=-z),null==Vi.poolVec2?g=new Cn:(g=Vi.poolVec2,Vi.poolVec2=g.zpp_pool,g.zpp_pool=null),null==g.zpp_inner?(null==Ip.zpp_pool?v=new Ip:(v=Ip.zpp_pool,Ip.zpp_pool=v.next,v.next=null),v.weak=!1,v._immutable=!1,v.x=y,v.y=z,g.zpp_inner=v,g.zpp_inner.outer=g):(null!=(v=g.zpp_inner)._validate&&v._validate(),g.zpp_inner.x==y&&(null!=(v=g.zpp_inner)._validate&&v._validate(),g.zpp_inner.y==z)||(g.zpp_inner.x=y,g.zpp_inner.y=z,null!=(z=g.zpp_inner)._invalidate&&z._invalidate(z))),g.zpp_inner.weak=!1;for(var m=dt.getRay(g,d,u<=0,n.outer),f=null,b=e.zpp_inner.inner.head;null!=b&&!(m.zpp_inner.toiDistance<b.elt.zpp_inner.toiDistance);)b=(f=b).next;var g=e.zpp_inner.inner;null==fi.zpp_pool?w=new fi:(w=fi.zpp_pool,fi.zpp_pool=w.next,w.next=null),w.elt=m;var w=w;null==f?(w.next=g.head,g.head=w):(w.next=f.next,f.next=w),g.pushmod=g.modified=!0,g.length++}}else{w=(-_-(x=Math.sqrt(x)))*(h=1/(2*h)),g=(-_+x)*h;if(0<w&&w<=this.maxdist){x=0,_=this.originx,x=this.originy;_+=this.dirx*w,x+=this.diry*w,_-=n.worldCOMx,x-=n.worldCOMy;var M,h=1/Math.sqrt(_*_+x*x);_*=h,x*=h,null==Vi.poolVec2?P=new Cn:(P=Vi.poolVec2,Vi.poolVec2=P.zpp_pool,P.zpp_pool=null),null==P.zpp_inner?(null==Ip.zpp_pool?M=new Ip:(M=Ip.zpp_pool,Ip.zpp_pool=M.next,M.next=null),M.weak=!1,M._immutable=!1,M.x=_,M.y=x,P.zpp_inner=M,P.zpp_inner.outer=P):(null!=(M=P.zpp_inner)._validate&&M._validate(),P.zpp_inner.x==_&&(null!=(M=P.zpp_inner)._validate&&M._validate(),P.zpp_inner.y==x)||(P.zpp_inner.x=_,P.zpp_inner.y=x,null!=(x=P.zpp_inner)._invalidate&&x._invalidate(x))),P.zpp_inner.weak=!1;for(var C=dt.getRay(P,w,!1,n.outer),k=null,O=e.zpp_inner.inner.head;null!=O&&!(C.zpp_inner.toiDistance<O.elt.zpp_inner.toiDistance);)O=(k=O).next;var P=e.zpp_inner.inner;null==fi.zpp_pool?S=new fi:(S=fi.zpp_pool,fi.zpp_pool=S.next,S.next=null),S.elt=C;var S=S;null==k?(S.next=P.head,P.head=S):(S.next=k.next,k.next=S),P.pushmod=P.modified=!0,P.length++}if(0<g&&g<=this.maxdist&&t){S=0,P=0,S=this.originx,P=this.originy;S+=this.dirx*g,P+=this.diry*g,S-=n.worldCOMx,P-=n.worldCOMy;var A,j,t=1/Math.sqrt(S*S+P*P);S=-(S*=t),P=-(P*=t),null==Vi.poolVec2?A=new Cn:(A=Vi.poolVec2,Vi.poolVec2=A.zpp_pool,A.zpp_pool=null),null==A.zpp_inner?(null==Ip.zpp_pool?j=new Ip:(j=Ip.zpp_pool,Ip.zpp_pool=j.next,j.next=null),j.weak=!1,j._immutable=!1,j.x=S,j.y=P,A.zpp_inner=j,A.zpp_inner.outer=A):(null!=(j=A.zpp_inner)._validate&&j._validate(),A.zpp_inner.x==S&&(null!=(j=A.zpp_inner)._validate&&j._validate(),A.zpp_inner.y==P)||(A.zpp_inner.x=S,A.zpp_inner.y=P,null!=(P=A.zpp_inner)._invalidate&&P._invalidate(P))),A.zpp_inner.weak=!1;for(var E=dt.getRay(A,g,!0,n.outer),I=null,T=e.zpp_inner.inner.head;null!=T&&!(E.zpp_inner.toiDistance<T.elt.zpp_inner.toiDistance);)T=(I=T).next;e=e.zpp_inner.inner;null==fi.zpp_pool?N=new fi:(N=fi.zpp_pool,fi.zpp_pool=N.next,N.next=null),N.elt=E;var N=N;null==I?(N.next=e.head,e.head=N):(N.next=I.next,I.next=N),e.pushmod=e.modified=!0,e.length++}}},Mt.prototype.polysect=function(n,t,e){for(var i=e,p=null,l=n.edges.head,r=n.gverts.next,o=r,a=r.next;null!=a;){var s,_,h,u,x=l.elt;(t||x.gnormx*this.dirx+x.gnormy*this.diry<0)&&(s=u=0,u=a.x-o.x,s=a.y-o.y,h=_=0,_=o.x-this.originx,h=o.y-this.originy,(x=s*this.dirx-u*this.diry)*x>jp.epsilon&&(0<(u=(s*_-u*h)*(x=1/x))&&u<i&&u<=this.maxdist&&((x=(this.diry*_-this.dirx*h)*x)>-jp.epsilon&&x<1+jp.epsilon&&(i=u,p=l.elt)))),l=l.next,a=(o=a).next}for(;;){a=n.gverts.next;var d,y,z,c,v=l.elt;(t||v.gnormx*this.dirx+v.gnormy*this.diry<0)&&(d=c=0,c=a.x-o.x,d=a.y-o.y,z=y=0,y=o.x-this.originx,z=o.y-this.originy,(v=d*this.dirx-c*this.diry)*v>jp.epsilon&&(0<(c=(d*y-c*z)*(v=1/v))&&c<i&&c<=this.maxdist&&((v=(this.diry*y-this.dirx*z)*v)>-jp.epsilon&&v<1+jp.epsilon&&(i=c,p=l.elt)))),l=l.next;break}if(null==p)return null;var m,f,b=0,g=0,b=p.gnormx,g=p.gnormy,e=0<b*this.dirx+g*this.diry;return e&&(b=-b,g=-g),null==Vi.poolVec2?m=new Cn:(m=Vi.poolVec2,Vi.poolVec2=m.zpp_pool,m.zpp_pool=null),null==m.zpp_inner?(null==Ip.zpp_pool?f=new Ip:(f=Ip.zpp_pool,Ip.zpp_pool=f.next,f.next=null),f.weak=!1,f._immutable=!1,f.x=b,f.y=g,m.zpp_inner=f,m.zpp_inner.outer=m):(null!=(f=m.zpp_inner)._validate&&f._validate(),m.zpp_inner.x==b&&(null!=(f=m.zpp_inner)._validate&&f._validate(),m.zpp_inner.y==g)||(m.zpp_inner.x=b,m.zpp_inner.y=g,null!=(g=m.zpp_inner)._invalidate&&g._invalidate(g))),m.zpp_inner.weak=!1,dt.getRay(m,i,e,n.outer)},Mt.prototype.polysect2=function(n,t,e){for(var i=1/0,p=-1,l=null,r=null,o=n.edges.head,a=n.gverts.next,s=a,_=a.next;null!=_;){var h,u,x,d,y=o.elt;(t||y.gnormx*this.dirx+y.gnormy*this.diry<0)&&(h=d=0,d=_.x-s.x,h=_.y-s.y,x=u=0,u=s.x-this.originx,x=s.y-this.originy,(y=h*this.dirx-d*this.diry)*y>jp.epsilon&&(0<(d=(h*u-d*x)*(y=1/y))&&d<=this.maxdist&&(d<i||p<d)&&((y=(this.diry*u-this.dirx*x)*y)>-jp.epsilon&&y<1+jp.epsilon&&(d<i&&(i=d,l=o.elt),p<d&&(p=d,r=o.elt))))),o=o.next,_=(s=_).next}for(;;){_=n.gverts.next;var z,c,v,m,f=o.elt;(t||f.gnormx*this.dirx+f.gnormy*this.diry<0)&&(z=m=0,m=_.x-s.x,z=_.y-s.y,v=c=0,c=s.x-this.originx,v=s.y-this.originy,(f=z*this.dirx-m*this.diry)*f>jp.epsilon&&(0<(m=(z*c-m*v)*(f=1/f))&&m<=this.maxdist&&(m<i||p<m)&&((f=(this.diry*c-this.dirx*v)*f)>-jp.epsilon&&f<1+jp.epsilon&&(m<i&&(i=m,l=o.elt),p<m&&(p=m,r=o.elt))))),o=o.next;break}if(null!=l){var b,g=0,w=0,g=l.gnormx,w=l.gnormy,M=0<g*this.dirx+w*this.diry;M&&(g=-g,w=-w),null==Vi.poolVec2?P=new Cn:(P=Vi.poolVec2,Vi.poolVec2=P.zpp_pool,P.zpp_pool=null),null==P.zpp_inner?(null==Ip.zpp_pool?b=new Ip:(b=Ip.zpp_pool,Ip.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=g,b.y=w,P.zpp_inner=b,P.zpp_inner.outer=P):(null!=(b=P.zpp_inner)._validate&&b._validate(),P.zpp_inner.x==g&&(null!=(b=P.zpp_inner)._validate&&b._validate(),P.zpp_inner.y==w)||(P.zpp_inner.x=g,P.zpp_inner.y=w,null!=(w=P.zpp_inner)._invalidate&&w._invalidate(w))),P.zpp_inner.weak=!1;for(var C=dt.getRay(P,i,M,n.outer),k=null,O=e.zpp_inner.inner.head;null!=O&&!(C.zpp_inner.toiDistance<O.elt.zpp_inner.toiDistance);)O=(k=O).next;var P=e.zpp_inner.inner;null==fi.zpp_pool?j=new fi:(j=fi.zpp_pool,fi.zpp_pool=j.next,j.next=null),j.elt=C;M=j;null==k?(M.next=P.head,P.head=M):(M.next=k.next,k.next=M),P.pushmod=P.modified=!0,P.length++}if(null!=r&&l!=r){var S,A,j=0,M=0,j=r.gnormx,M=r.gnormy,P=0<j*this.dirx+M*this.diry;P&&(j=-j,M=-M),null==Vi.poolVec2?S=new Cn:(S=Vi.poolVec2,Vi.poolVec2=S.zpp_pool,S.zpp_pool=null),null==S.zpp_inner?(null==Ip.zpp_pool?A=new Ip:(A=Ip.zpp_pool,Ip.zpp_pool=A.next,A.next=null),A.weak=!1,A._immutable=!1,A.x=j,A.y=M,S.zpp_inner=A,S.zpp_inner.outer=S):(null!=(A=S.zpp_inner)._validate&&A._validate(),S.zpp_inner.x==j&&(null!=(A=S.zpp_inner)._validate&&A._validate(),S.zpp_inner.y==M)||(S.zpp_inner.x=j,S.zpp_inner.y=M,null!=(M=S.zpp_inner)._invalidate&&M._invalidate(M))),S.zpp_inner.weak=!1;for(var E=dt.getRay(S,p,P,n.outer),I=null,T=e.zpp_inner.inner.head;null!=T&&!(E.zpp_inner.toiDistance<T.elt.zpp_inner.toiDistance);)T=(I=T).next;e=e.zpp_inner.inner;null==fi.zpp_pool?N=new fi:(N=fi.zpp_pool,fi.zpp_pool=N.next,N.next=null),N.elt=E;var N=N;null==I?(N.next=e.head,e.head=N):(N.next=I.next,I.next=N),e.pushmod=e.modified=!0,e.length++}},Mt.prototype.__class__=Mt;var Ct=zpp_nape.geom.ZPP_SimpleVert=function(){this.node=null,this.next=null,this.id=0,this.links=null,this.y=0,this.x=0,this.forced=!1,this.id=fn.ZPP_SimpleVert(),null==Bi.zpp_pool?this.links=new Bi:(this.links=Bi.zpp_pool,Bi.zpp_pool=this.links.next,this.links.next=null),this.links.lt=Ct.less_xy};Ct.__name__=["zpp_nape","geom","ZPP_SimpleVert"],Ct.less_xy=function(n,t){return n.y<t.y||n.y==t.y&&n.x<t.x},Ct.swap_nodes=function(n,t){var e=n.node;n.node=t.node,t.node=e},Ct.get=function(n,t){var e;return null==Ct.zpp_pool?e=new Ct:(e=Ct.zpp_pool,Ct.zpp_pool=e.next,e.next=null),e.x=n,e.y=t,e},Ct.prototype.forced=null,Ct.prototype.x=null,Ct.prototype.y=null,Ct.prototype.links=null,Ct.prototype.id=null,Ct.prototype.next=null,Ct.prototype.node=null,Ct.prototype.free=function(){this.links.clear(),this.node=null,this.forced=!1},Ct.prototype.alloc=function(){},Ct.prototype.__class__=Ct;var kt=zpp_nape.geom.ZPP_SimpleSeg=function(){this.node=null,this.prev=null,this.next=null,this.id=0,this.vertices=null,this.right=null,this.left=null,this.id=fn.ZPP_SimpleSeg(),null==Bi.zpp_pool?this.vertices=new Bi:(this.vertices=Bi.zpp_pool,Bi.zpp_pool=this.vertices.next,this.vertices.next=null),this.vertices.lt=X(this,this.less_xy)};kt.__name__=["zpp_nape","geom","ZPP_SimpleSeg"],kt.get=function(n,t){var e;return null==kt.zpp_pool?e=new kt:(e=kt.zpp_pool,kt.zpp_pool=e.next,e.next=null),e.left=n,e.right=t,e.vertices.insert(n),e.vertices.insert(t),e},kt.prototype.left=null,kt.prototype.right=null,kt.prototype.vertices=null,kt.prototype.id=null,kt.prototype.next=null,kt.prototype.free=function(){this.left=this.right=null,this.prev=null,this.node=null,this.vertices.clear()},kt.prototype.alloc=function(){},kt.prototype.prev=null,kt.prototype.node=null,kt.prototype.less_xy=function(n,t){return n.x<t.x||n.x==t.x&&n.y<t.y},kt.prototype.__class__=kt;var Ot=zpp_nape.geom.ZPP_SimpleEvent=function(){this.next=null,this.node=null,this.segment2=null,this.segment=null,this.vertex=null,this.type=0};Ot.__name__=["zpp_nape","geom","ZPP_SimpleEvent"],Ot.swap_nodes=function(n,t){var e=n.node;n.node=t.node,t.node=e},Ot.less_xy=function(n,t){return n.vertex.x<t.vertex.x||!(n.vertex.x>t.vertex.x)&&(n.vertex.y<t.vertex.y||!(n.vertex.y>t.vertex.y)&&n.type<t.type)},Ot.get=function(n){var t;return null==Ot.zpp_pool?t=new Ot:(t=Ot.zpp_pool,Ot.zpp_pool=t.next,t.next=null),t.vertex=n,t},Ot.prototype.type=null,Ot.prototype.vertex=null,Ot.prototype.segment=null,Ot.prototype.segment2=null,Ot.prototype.node=null,Ot.prototype.next=null,Ot.prototype.free=function(){this.vertex=null,this.segment=this.segment2=null,this.node=null},Ot.prototype.alloc=function(){},Ot.prototype.__class__=Ot;var Pt=zpp_nape.geom.ZPP_SimpleSweep=function(){this.tree=null,this.sweepx=0,null==Gi.zpp_pool?this.tree=new Gi:(this.tree=Gi.zpp_pool,Gi.zpp_pool=this.tree.next,this.tree.next=null),this.tree.lt=X(this,this.edge_lt),this.tree.swapped=X(this,this.swap_nodes)};Pt.__name__=["zpp_nape","geom","ZPP_SimpleSweep"],Pt.prototype.sweepx=null,Pt.prototype.tree=null,Pt.prototype.swap_nodes=function(n,t){var e=n.node;n.node=t.node,t.node=e},Pt.prototype.edge_lt=function(n,t){var e=0,i=0,p=0,l=0;if(n.left==t.left&&n.right==t.right)return!1;if(n.left==t.right)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>t.left.y:n.right.y>t.left.y:(o=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.left.x-n.left.x,l=t.left.y-n.left.y,(o?i*p-e*l:l*e-p*i)<0);if(n.right==t.left){var r=t.left.x==t.right.x?t.left.y<t.right.y?t.left.y>n.left.y:t.right.y>n.left.y:(o=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.left.x-t.left.x,l=n.left.y-t.left.y,(o?i*p-e*l:l*e-p*i)<0);return!r}if(n.left==t.left)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>t.right.y:n.right.y>t.right.y:(o=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.right.x-n.left.x,l=t.right.y-n.left.y,(o?i*p-e*l:l*e-p*i)<0);if(n.right==t.right)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>t.left.y:n.right.y>t.left.y:(o=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.left.x-n.left.x,l=t.left.y-n.left.y,(o?i*p-e*l:l*e-p*i)<0);if(n.left.x==n.right.x){if(t.left.x==t.right.x)return(n.left.y<n.right.y?n.right:n.left).y>(t.left.y<t.right.y?t.right:t.left).y;o=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.left.x-t.left.x,l=n.left.y-t.left.y;var r=o?i*p-e*l:l*e-p*i,o=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.right.x-t.left.x,l=n.right.y-t.left.y;return 0<=r*(o?i*p-e*l:l*e-p*i)?0<=r:this.sweepx>=n.left.x}if(t.left.x==t.right.x){o=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.left.x-n.left.x,l=t.left.y-n.left.y;var a=o?i*p-e*l:l*e-p*i;return o=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.right.x-n.left.x,l=t.right.y-n.left.y,0<=a*(o?i*p-e*l:l*e-p*i)?a<0:this.sweepx<t.left.x}o=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.left.x-n.left.x,l=t.left.y-n.left.y;a=(o?i*p-e*l:l*e-p*i)<0;if(o=n.right.x<n.left.x,e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=t.right.x-n.left.x,l=t.right.y-n.left.y,a==(o?i*p-e*l:l*e-p*i)<0)return a;o=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.left.x-t.left.x,l=n.left.y-t.left.y;a=0<=(o?i*p-e*l:l*e-p*i);return o=t.right.x<t.left.x,e=t.right.x-t.left.x,i=t.right.y-t.left.y,p=n.right.x-t.left.x,l=n.right.y-t.left.y,a==0<=(o?i*p-e*l:l*e-p*i)?a:(this.sweepx-n.left.x)/(n.right.x-n.left.x)*(n.right.y-n.left.y)+n.left.y>(this.sweepx-t.left.x)/(t.right.x-t.left.x)*(t.right.y-t.left.y)+t.left.y},Pt.prototype.clear=function(){this.tree.clear()},Pt.prototype.add=function(n){n.node=this.tree.insert(n);var t=this.tree.successor_node(n.node),e=this.tree.predecessor_node(n.node);return null!=t&&(n.next=t.data,t.data.prev=n),null!=e&&(n.prev=e.data,e.data.next=n),n},Pt.prototype.remove=function(n){var t=this.tree.successor_node(n.node),e=this.tree.predecessor_node(n.node);null!=t&&(t.data.prev=n.prev),null!=e&&(e.data.next=n.next),this.tree.remove_node(n.node),n.node=null},Pt.prototype.intersect=function(n,t){if(null==n||null==t)return!1;if(n.left==t.left||n.left==t.right||n.right==t.left||n.right==t.right)return!1;var e=(t.left.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(t.left.y-n.left.y),i=(t.right.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(t.right.y-n.left.y);if(0<e*i)return!1;i=(n.left.x-t.left.x)*(t.right.y-t.left.y)-(t.right.x-t.left.x)*(n.left.y-t.left.y),t=(n.right.x-t.left.x)*(t.right.y-t.left.y)-(t.right.x-t.left.x)*(n.right.y-t.left.y);return!(0<i*t)},Pt.prototype.intersection=function(n,t){if(null==n||null==t)return null;if(n.left==t.left||n.left==t.right||n.right==t.left||n.right==t.right)return null;var e=n.right.x-n.left.x,i=n.right.y-n.left.y,p=0,l=0,p=t.right.x-t.left.x,r=(l=t.right.y-t.left.y)*e-p*i;if(0==r)return null;r=1/r;var o=0,a=0,s=(l*(o=t.left.x-n.left.x)-p*(a=t.left.y-n.left.y))*r;if(s<0||1<s)return null;var _,r=(i*o-e*a)*r;if(r<0||1<r)return null;_=0==r||1==r||0==s||1==s?0==r?t.left:1==r?t.right:0==s?n.left:n.right:(p=.5*(n.left.x+e*s+t.left.x+p*r),r=.5*(n.left.y+i*s+t.left.y+l*r),null==Ct.zpp_pool?_=new Ct:(_=Ct.zpp_pool,Ct.zpp_pool=_.next,_.next=null),_.x=p,_.y=r,_),null==Ot.zpp_pool?h=new Ot:(h=Ot.zpp_pool,Ot.zpp_pool=h.next,h.next=null),h.vertex=_;var h=h;return h.type=0,h.segment=n,h.segment2=t,h},Pt.prototype.__class__=Pt;var St=zpp_nape.geom.ZPP_Simple=function(){};St.__name__=["zpp_nape","geom","ZPP_Simple"],St.decompose=function(n,t){null==St.sweep&&(St.sweep=new Pt,St.inthash=new _e),null==St.vertices&&(null==Bi.zpp_pool?St.vertices=new Bi:(St.vertices=Bi.zpp_pool,Bi.zpp_pool=St.vertices.next,St.vertices.next=null),St.vertices.lt=Ct.less_xy,St.vertices.swapped=Ct.swap_nodes),null==St.queue&&(null==qi.zpp_pool?St.queue=new qi:(St.queue=qi.zpp_pool,qi.zpp_pool=St.queue.next,St.queue.next=null),St.queue.lt=Ot.less_xy,St.queue.swapped=Ot.swap_nodes);var e=null,i=null;if(null!=n)for(var p=n;;){var l,r=p.x,o=p.y;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.x=r,l.y=o;for(var a=l,s=St.vertices.parent;null!=s;)if(St.vertices.lt(a,s.data))s=s.prev;else{if(!St.vertices.lt(s.data,a))break;s=s.next}var _,h,u,r=s;if(null!=r?((u=a).links.clear(),u.node=null,u.forced=!1,u.next=Ct.zpp_pool,Ct.zpp_pool=u,a=r.data):a.node=St.vertices.insert(a),null!=i&&(null==Ot.zpp_pool?_=new Ot:(_=Ot.zpp_pool,Ot.zpp_pool=_.next,_.next=null),_.vertex=i,o=_,null==Ot.zpp_pool?h=new Ot:(h=Ot.zpp_pool,Ot.zpp_pool=h.next,h.next=null),h.vertex=a,u=h,r=Ot.less_xy(o,u)?(o.type=1,u.type=2,kt.get(i,a)):(o.type=2,u.type=1,kt.get(a,i)),o.segment=u.segment=r,St.queue.insert(o),St.queue.insert(u),i.links.insert(a),a.links.insert(i)),i=a,null==e&&(e=a),(p=p.next)==n)break}null==Ot.zpp_pool?d=new Ot:(d=Ot.zpp_pool,Ot.zpp_pool=d.next,d.next=null),d.vertex=i;var x=d;null==Ot.zpp_pool?y=new Ot:(y=Ot.zpp_pool,Ot.zpp_pool=y.next,y.next=null),y.vertex=e;var d=y,y=Ot.less_xy(x,d)?(x.type=1,d.type=2,kt.get(i,e)):(x.type=2,d.type=1,kt.get(e,i));for(x.segment=d.segment=y,St.queue.insert(x),St.queue.insert(d),i.links.insert(e),e.links.insert(i),null==St.ints&&(null==qi.zpp_pool?St.ints=new qi:(St.ints=qi.zpp_pool,qi.zpp_pool=St.ints.next,St.ints.next=null),St.ints.lt=Ot.less_xy);!St.queue.empty();){var z=St.queue.pop_front();if(St.sweep.sweepx=z.vertex.x,1==z.type){var c=z.segment;if(St.sweep.add(c),null!=c.next&&null!=c&&!(c.next.id<c.id?St.inthash.has(c.next.id,c.id):St.inthash.has(c.id,c.next.id))){var v=St.sweep.intersection(c.next,c);if(null!=v)if(v.vertex.x>=St.sweep.sweepx){for(var m=St.queue.parent;null!=m;)if(St.queue.lt(v,m.data))m=m.prev;else{if(!St.queue.lt(m.data,v))break;m=m.next}if(null==m){for(var f=St.ints.parent;null!=f;)if(St.ints.lt(v,f.data))f=f.prev;else{if(!St.ints.lt(f.data,v))break;f=f.next}var b,g,w,M,C,k=f;null!=k?((b=v.vertex).links.clear(),b.node=null,b.forced=!1,b.next=Ct.zpp_pool,Ct.zpp_pool=b,v.vertex=k.data.vertex,k.data=v,St.queue.insert(v)):(St.queue.insert(v),St.ints.insert(v)),c.next.id<c.id?(C=c.next.id,w=c.id,null==se.zpp_pool?g=new se:(g=se.zpp_pool,se.zpp_pool=g.next,g.next=null),g.id=C,g.di=w,(C=g).value=!0,St.inthash.add(C)):(w=c.id,C=c.next.id,null==se.zpp_pool?M=new se:(M=se.zpp_pool,se.zpp_pool=M.next,M.next=null),M.id=w,M.di=C,(C=M).value=!0,St.inthash.add(C))}else{var O=v.vertex;O.links.clear(),O.node=null,O.forced=!1,O.next=Ct.zpp_pool,Ct.zpp_pool=O,v.vertex=null,v.segment=v.segment2=null,v.node=null,v.next=Ot.zpp_pool,Ot.zpp_pool=v}}else{var P=v.vertex;P.links.clear(),P.node=null,P.forced=!1,P.next=Ct.zpp_pool,Ct.zpp_pool=P,v.vertex=null,v.segment=v.segment2=null,v.node=null,v.next=Ot.zpp_pool,Ot.zpp_pool=v}}if(null!=c&&null!=c.prev&&!(c.id<c.prev.id?St.inthash.has(c.id,c.prev.id):St.inthash.has(c.prev.id,c.id))){var S=St.sweep.intersection(c,c.prev);if(null!=S)if(S.vertex.x>=St.sweep.sweepx){for(var A=St.queue.parent;null!=A;)if(St.queue.lt(S,A.data))A=A.prev;else{if(!St.queue.lt(A.data,S))break;A=A.next}if(null==A){for(var j=St.ints.parent;null!=j;)if(St.ints.lt(S,j.data))j=j.prev;else{if(!St.ints.lt(j.data,S))break;j=j.next}var E,I,T,O=j;null!=O?((P=S.vertex).links.clear(),P.node=null,P.forced=!1,P.next=Ct.zpp_pool,Ct.zpp_pool=P,S.vertex=O.data.vertex,O.data=S,St.queue.insert(S)):(St.queue.insert(S),St.ints.insert(S)),c.id<c.prev.id?(O=c.id,I=c.prev.id,null==se.zpp_pool?E=new se:(E=se.zpp_pool,se.zpp_pool=E.next,E.next=null),E.id=O,E.di=I,(I=E).value=!0,St.inthash.add(I)):(I=c.prev.id,V=c.id,null==se.zpp_pool?T=new se:(T=se.zpp_pool,se.zpp_pool=T.next,T.next=null),T.id=I,T.di=V,(V=T).value=!0,St.inthash.add(V))}else{var N=S.vertex;N.links.clear(),N.node=null,N.forced=!1,N.next=Ct.zpp_pool,Ct.zpp_pool=N,S.vertex=null,S.segment=S.segment2=null,S.node=null,S.next=Ot.zpp_pool,Ot.zpp_pool=S}}else{var L=S.vertex;L.links.clear(),L.node=null,L.forced=!1,L.next=Ct.zpp_pool,Ct.zpp_pool=L,S.vertex=null,S.segment=S.segment2=null,S.node=null,S.next=Ot.zpp_pool,Ot.zpp_pool=S}}}else if(2==z.type){var V=z.segment;if(null!=V.node){N=V.next,L=V.prev;if(St.sweep.remove(V),V.left=V.right=null,V.prev=null,V.node=null,V.vertices.clear(),V.next=kt.zpp_pool,kt.zpp_pool=V,null!=N&&null!=L&&!(N.id<L.id?St.inthash.has(N.id,L.id):St.inthash.has(L.id,N.id))){var D=St.sweep.intersection(N,L);if(null!=D)if(D.vertex.x>=St.sweep.sweepx){for(var F=St.queue.parent;null!=F;)if(St.queue.lt(D,F.data))F=F.prev;else{if(!St.queue.lt(F.data,D))break;F=F.next}if(null==F){for(var R=St.ints.parent;null!=R;)if(St.ints.lt(D,R.data))R=R.prev;else{if(!St.ints.lt(R.data,D))break;R=R.next}var Z,B,G,V=R;null!=V?((Z=D.vertex).links.clear(),Z.node=null,Z.forced=!1,Z.next=Ct.zpp_pool,Ct.zpp_pool=Z,D.vertex=V.data.vertex,V.data=D,St.queue.insert(D)):(St.queue.insert(D),St.ints.insert(D)),N.id<L.id?(Z=N.id,V=L.id,null==se.zpp_pool?B=new se:(B=se.zpp_pool,se.zpp_pool=B.next,B.next=null),B.id=Z,B.di=V,(V=B).value=!0,St.inthash.add(V)):(L=L.id,N=N.id,null==se.zpp_pool?G=new se:(G=se.zpp_pool,se.zpp_pool=G.next,G.next=null),G.id=L,G.di=N,(N=G).value=!0,St.inthash.add(N))}else{var q=D.vertex;q.links.clear(),q.node=null,q.forced=!1,q.next=Ct.zpp_pool,Ct.zpp_pool=q,D.vertex=null,D.segment=D.segment2=null,D.node=null,D.next=Ot.zpp_pool,Ot.zpp_pool=D}}else{var U=D.vertex;U.links.clear(),U.node=null,U.forced=!1,U.next=Ct.zpp_pool,Ct.zpp_pool=U,D.vertex=null,D.segment=D.segment2=null,D.node=null,D.next=Ot.zpp_pool,Ot.zpp_pool=D}}}}else{var K=z.vertex,q=null==K.node,W=z.segment,Y=z.segment2;Y.next!=W&&($=W,W=Y,Y=$);for(var J=W.vertices.parent;null!=J;)if(W.vertices.lt(K,J.data))J=J.prev;else{if(!W.vertices.lt(J.data,K))break;J=J.next}for(var U=null==J,X=Y.vertices.parent;null!=X;)if(Y.vertices.lt(K,X.data))X=X.prev;else{if(!Y.vertices.lt(X.data,K))break;X=X.next}var H,$=null==X;if(U&&(H=W.vertices.insert(K),U=K==W.left?K:W.vertices.predecessor_node(H).data,H=K==W.right?K:W.vertices.successor_node(H).data,U.links.remove(H),K!=U&&U.links.insert(K),H.links.remove(U),K!=H&&H.links.insert(K),K!=U&&K.links.insert(U),K!=H&&K.links.insert(H)),$&&(H=Y.vertices.insert(K),$=K==Y.left?K:Y.vertices.predecessor_node(H).data,H=K==Y.right?K:Y.vertices.successor_node(H).data,$.links.remove(H),K!=$&&$.links.insert(K),H.links.remove($),K!=H&&H.links.insert(K),K!=$&&K.links.insert($),K!=H&&K.links.insert(H)),q&&(K.node=St.vertices.insert(K)),K.forced=!0,q&&(en=W.node,an=Y.node,en.data=Y,(an.data=W).node=an,Y.node=en,Y.next=W.next,W.next=Y,W.prev=Y.prev,null!=(Y.prev=W).prev&&(W.prev.next=W),null!=Y.next&&(Y.next.prev=Y)),null!=Y.next&&null!=Y&&!(Y.next.id<Y.id?St.inthash.has(Y.next.id,Y.id):St.inthash.has(Y.id,Y.next.id))){var Q=St.sweep.intersection(Y.next,Y);if(null!=Q)if(Q.vertex.x>=St.sweep.sweepx){for(var nn=St.queue.parent;null!=nn;)if(St.queue.lt(Q,nn.data))nn=nn.prev;else{if(!St.queue.lt(nn.data,Q))break;nn=nn.next}if(null==nn){for(var tn=St.ints.parent;null!=tn;)if(St.ints.lt(Q,tn.data))tn=tn.prev;else{if(!St.ints.lt(tn.data,Q))break;tn=tn.next}var en,pn,ln,rn,on,an=tn;null!=an?((en=Q.vertex).links.clear(),en.node=null,en.forced=!1,en.next=Ct.zpp_pool,Ct.zpp_pool=en,Q.vertex=an.data.vertex,an.data=Q,St.queue.insert(Q)):(St.queue.insert(Q),St.ints.insert(Q)),Y.next.id<Y.id?(on=Y.next.id,ln=Y.id,null==se.zpp_pool?pn=new se:(pn=se.zpp_pool,se.zpp_pool=pn.next,pn.next=null),pn.id=on,pn.di=ln,(on=pn).value=!0,St.inthash.add(on)):(ln=Y.id,on=Y.next.id,null==se.zpp_pool?rn=new se:(rn=se.zpp_pool,se.zpp_pool=rn.next,rn.next=null),rn.id=ln,rn.di=on,(on=rn).value=!0,St.inthash.add(on))}else{var sn=Q.vertex;sn.links.clear(),sn.node=null,sn.forced=!1,sn.next=Ct.zpp_pool,Ct.zpp_pool=sn,Q.vertex=null,Q.segment=Q.segment2=null,Q.node=null,Q.next=Ot.zpp_pool,Ot.zpp_pool=Q}}else{var _n=Q.vertex;_n.links.clear(),_n.node=null,_n.forced=!1,_n.next=Ct.zpp_pool,Ct.zpp_pool=_n,Q.vertex=null,Q.segment=Q.segment2=null,Q.node=null,Q.next=Ot.zpp_pool,Ot.zpp_pool=Q}}if(null!=W&&null!=W.prev&&!(W.id<W.prev.id?St.inthash.has(W.id,W.prev.id):St.inthash.has(W.prev.id,W.id))){var hn=St.sweep.intersection(W,W.prev);if(null!=hn)if(hn.vertex.x>=St.sweep.sweepx){for(var un=St.queue.parent;null!=un;)if(St.queue.lt(hn,un.data))un=un.prev;else{if(!St.queue.lt(un.data,hn))break;un=un.next}if(null==un){for(var xn=St.ints.parent;null!=xn;)if(St.ints.lt(hn,xn.data))xn=xn.prev;else{if(!St.ints.lt(xn.data,hn))break;xn=xn.next}var dn,yn,zn,cn,sn=xn;null!=sn?((_n=hn.vertex).links.clear(),_n.node=null,_n.forced=!1,_n.next=Ct.zpp_pool,Ct.zpp_pool=_n,hn.vertex=sn.data.vertex,sn.data=hn,St.queue.insert(hn)):(St.queue.insert(hn),St.ints.insert(hn)),W.id<W.prev.id?(cn=W.id,yn=W.prev.id,null==se.zpp_pool?dn=new se:(dn=se.zpp_pool,se.zpp_pool=dn.next,dn.next=null),dn.id=cn,dn.di=yn,(cn=dn).value=!0,St.inthash.add(cn)):(yn=W.prev.id,cn=W.id,null==se.zpp_pool?zn=new se:(zn=se.zpp_pool,se.zpp_pool=zn.next,zn.next=null),zn.id=yn,zn.di=cn,(cn=zn).value=!0,St.inthash.add(cn))}else{var vn=hn.vertex;vn.links.clear(),vn.node=null,vn.forced=!1,vn.next=Ct.zpp_pool,Ct.zpp_pool=vn,hn.vertex=null,hn.segment=hn.segment2=null,hn.node=null,hn.next=Ot.zpp_pool,Ot.zpp_pool=hn}}else{vn=hn.vertex;vn.links.clear(),vn.node=null,vn.forced=!1,vn.next=Ct.zpp_pool,Ct.zpp_pool=vn,hn.vertex=null,hn.segment=hn.segment2=null,hn.node=null,hn.next=Ot.zpp_pool,Ot.zpp_pool=hn}}St.ints.remove(z)}z.vertex=null,z.segment=z.segment2=null,z.node=null,z.next=Ot.zpp_pool,Ot.zpp_pool=z}for(var mn=0,fn=St.inthash.table.length;mn<fn;){var bn=mn++,gn=St.inthash.table[bn];if(null!=gn){for(;null!=gn;){var wn=gn.hnext;gn.hnext=null;var Mn=gn;Mn.next=se.zpp_pool,se.zpp_pool=Mn,gn=wn}St.inthash.table[bn]=null}}for(null==t&&(t=new Oe);!St.vertices.empty();)St.clip_polygon(St.vertices,t);return t},St.clip_polygon=function(n,t){var e=null,i=n.first(),p=i,l=i.links.parent,r=null==l.prev?l.next:l.prev,o=l.data,a=r.data,s=i.x-o.x,l=i.y-o.y,r=a.x-i.x;(a.y-i.y)*s-r*l<0&&(a=o);l=i.x,o=i.y;null==ii.zpp_pool?_=new ii:(_=ii.zpp_pool,ii.zpp_pool=_.next,_.next=null),_.forced=!1,_.x=l,_.y=o;var _=_;for(null==e?e=_.prev=_.next=_:(_.prev=e,_.next=e.next,e.next.prev=_,e.next=_),(e=_).forced=i.forced;;){if(i.links.remove(a),a.links.remove(i),a==p){i.links.empty()&&(n.remove(i),(x=i).links.clear(),x.node=null,x.forced=!1,x.next=Ct.zpp_pool,Ct.zpp_pool=x);break}var h,u=a.x,x=a.y;null==ii.zpp_pool?h=new ii:(h=ii.zpp_pool,ii.zpp_pool=h.next,h.next=null),h.forced=!1,h.x=u,h.y=x;x=h;if(null==e?e=x.prev=x.next=x:(x.prev=e,x.next=e.next,e.next.prev=x,e.next=x),(e=x).forced=a.forced,a.links.singular())i.links.empty()&&(n.remove(i),(d=i).links.clear(),d.node=null,d.forced=!1,d.next=Ct.zpp_pool,Ct.zpp_pool=d),a=(i=a).links.parent.data;else{var d,y=null,z=0;if(!a.links.empty()){for(var c=a.links.parent;null!=c.prev;)c=c.prev;for(;null!=c;){var v,m,f,b,g=c.data;if(null==y?(y=g,v=b=0,b=a.x-i.x,v=a.y-i.y,f=0,f=g.x-a.x,z=(g.y-a.y)*b-f*v):(b=m=0,m=a.x-i.x,b=a.y-i.y,f=0,f=g.x-a.x,0<(v=(g.y-a.y)*m-f*b)&&z<=0?(y=g,z=v):0<=z*v&&(f=m=0,m=a.x-g.x,f=a.y-g.y,b=0,b=y.x-a.x,0<(y.y-a.y)*m-b*f&&(y=g,z=v))),null!=c.next)for(c=c.next;null!=c.prev;)c=c.prev;else{for(;null!=c.parent&&c==c.parent.next;)c=c.parent;c=c.parent}}}i.links.empty()&&(n.remove(i),(d=i).links.clear(),d.node=null,d.forced=!1,d.next=Ct.zpp_pool,Ct.zpp_pool=d),i=a,a=y}}n.remove(p),p.links.clear(),p.node=null,p.forced=!1,p.next=Ct.zpp_pool,Ct.zpp_pool=p,t.add(e)},St.isSimple=function(n){null==St.sweep&&(St.sweep=new Pt,St.inthash=new _e);var t=St.list_vertices;if(null==t&&(t=St.list_vertices=new Pe),null!=n)for(var e=n;;){var i,p=e.x,l=e.y;if(null==Ct.zpp_pool?i=new Ct:(i=Ct.zpp_pool,Ct.zpp_pool=i.next,i.next=null),i.x=p,i.y=l,t.add(i),(e=e.next)==n)break}var r=St.list_queue;null==r&&(r=St.list_queue=new Se);for(var o=(a=t.head).elt,a=a.next;null!=a;){var s,_=a.elt;null==Ot.zpp_pool?s=new Ot:(s=Ot.zpp_pool,Ot.zpp_pool=s.next,s.next=null),s.vertex=o;var h,u=r.add(s);null==Ot.zpp_pool?h=new Ot:(h=Ot.zpp_pool,Ot.zpp_pool=h.next,h.next=null),h.vertex=_;var x=r.add(h),d=Ot.less_xy(u,x)?(u.type=1,x.type=2,kt.get(o,_)):(u.type=2,x.type=1,kt.get(_,o));u.segment=x.segment=d,o=_,a=a.next}var y=t.head.elt;null==Ot.zpp_pool?z=new Ot:(z=Ot.zpp_pool,Ot.zpp_pool=z.next,z.next=null),z.vertex=o;var z=r.add(z);null==Ot.zpp_pool?c=new Ot:(c=Ot.zpp_pool,Ot.zpp_pool=c.next,c.next=null),c.vertex=y;var c=r.add(c),y=Ot.less_xy(z,c)?(z.type=1,c.type=2,kt.get(o,y)):(z.type=2,c.type=1,kt.get(y,o));z.segment=c.segment=y;y=r;if(null!=y.head&&null!=y.head.next){for(var v,m,f,b=y.head,g=null,w=null,M=null,C=null,k=1;;){for(v=0,w=b,g=b=null;null!=w;){for(++v,M=w,m=0,f=k;null!=M&&m<k;)++m,M=M.next;for(;0<m||0<f&&null!=M;)0!=m&&(0==f||null==M||Ot.less_xy(w.elt,M.elt))?(w=(C=w).next,--m):(M=(C=M).next,--f),null!=g?g.next=C:b=C,g=C;w=M}if(g.next=null,k<<=1,!(1<v))break}y.head=b,y.modified=!0,y.pushmod=!0}for(var O=!0;null!=r.head;){var P=r.pop_unsafe(),S=P.segment;if(1==P.type){if(St.sweep.add(S),St.sweep.intersect(S,S.next)||St.sweep.intersect(S,S.prev)){O=!1;break}}else if(2==P.type){if(St.sweep.intersect(S.prev,S.next)){O=!1;break}St.sweep.remove(S),S.left=S.right=null,S.prev=null,S.node=null,S.vertices.clear(),S.next=kt.zpp_pool,kt.zpp_pool=S}P.vertex=null,P.segment=P.segment2=null,P.node=null,P.next=Ot.zpp_pool,Ot.zpp_pool=P}for(;null!=r.head;){var A,j=r.pop_unsafe();2==j.type&&((A=j.segment).left=A.right=null,A.prev=null,A.node=null,A.vertices.clear(),A.next=kt.zpp_pool,kt.zpp_pool=A),j.vertex=null,j.segment=j.segment2=null,j.node=null,j.next=Ot.zpp_pool,Ot.zpp_pool=j}for(St.sweep.clear();null!=t.head;){var E=t.pop_unsafe();E.links.clear(),E.node=null,E.forced=!1,E.next=Ct.zpp_pool,Ct.zpp_pool=E}return O},St.prototype.__class__=St;var At=zpp_nape.geom.ZPP_SimplifyV=function(){this.forced=!1,this.flag=!1,this.prev=null,this.next=null,this.y=0,this.x=0};At.__name__=["zpp_nape","geom","ZPP_SimplifyV"],At.get=function(n){var t;return null==At.zpp_pool?t=new At:(t=At.zpp_pool,At.zpp_pool=t.next,t.next=null),t.x=n.x,t.y=n.y,t.flag=!1,t},At.prototype.x=null,At.prototype.y=null,At.prototype.next=null,At.prototype.prev=null,At.prototype.flag=null,At.prototype.forced=null,At.prototype.free=function(){},At.prototype.alloc=function(){},At.prototype.__class__=At;var jt=zpp_nape.geom.ZPP_SimplifyP=function(){this.max=null,this.min=null,this.next=null};jt.__name__=["zpp_nape","geom","ZPP_SimplifyP"],jt.get=function(n,t){var e;return null==jt.zpp_pool?e=new jt:(e=jt.zpp_pool,jt.zpp_pool=e.next,e.next=null),e.min=n,e.max=t,e},jt.prototype.next=null,jt.prototype.min=null,jt.prototype.max=null,jt.prototype.free=function(){this.min=this.max=null},jt.prototype.alloc=function(){},jt.prototype.__class__=jt;var Et=zpp_nape.geom.ZPP_Simplify=function(){};Et.__name__=["zpp_nape","geom","ZPP_Simplify"],Et.lessval=function(n,t){return n.x-t.x+(n.y-t.y)},Et.less=function(n,t){return n.x-t.x+(n.y-t.y)<0},Et.distance=function(n,t,e){var i=e.x-t.x,p=e.y-t.y,l=0,r=0,l=n.x-t.x,r=n.y-t.y;if(i*i+p*p==0)return l*l+r*r;var o=(l*i+r*p)/(i*i+p*p);if(o<=0)return l*l+r*r;if(1<=o){var a=n.x,s=n.y,t=0,n=0;return(t=a-e.x)*t+(n=s-e.y)*n}return(l-=i*o)*l+(r-=p*o)*r},Et.simplify=function(n,t){var e=null,i=null,p=null;t*=t,null==Et.stack&&(Et.stack=new Ce);for(var l,r,o,a,s,_,h,u,x=null,d=null,y=n;;){null==At.zpp_pool?l=new At:(l=At.zpp_pool,At.zpp_pool=l.next,l.next=null),l.x=y.x,l.y=y.y,l.flag=!1;var z,c=l;if(c.forced=y.forced,c.forced&&(c.flag=!0,null!=x?(null==jt.zpp_pool?z=new jt:(z=jt.zpp_pool,jt.zpp_pool=z.next,z.next=null),z.min=x,z.max=c,Et.stack.add(z)):d=c,x=c),null==e?e=c.prev=c.next=c:(c.prev=e,c.next=e.next,e.next.prev=c,e.next=c),e=c,null==i?p=i=c:(c.x-i.x+(c.y-i.y)<0&&(i=c),p.x-c.x+(p.y-c.y)<0&&(p=c)),(y=y.next)==n)break}for(null==Et.stack.head?null==d?(i.flag=p.flag=!0,null==jt.zpp_pool?r=new jt:(r=jt.zpp_pool,jt.zpp_pool=r.next,r.next=null),r.min=i,r.max=p,Et.stack.add(r),null==jt.zpp_pool?o=new jt:(o=jt.zpp_pool,jt.zpp_pool=o.next,o.next=null),o.min=p,o.max=i,Et.stack.add(o)):((r=i.x-d.x+(i.y-d.y))<0&&(r=-r),(o=p.x-d.x+(p.y-d.y))<0&&(o=-o),o<r?(i.flag=d.flag=!0,null==jt.zpp_pool?a=new jt:(a=jt.zpp_pool,jt.zpp_pool=a.next,a.next=null),a.min=i,a.max=d,Et.stack.add(a),null==jt.zpp_pool?s=new jt:(s=jt.zpp_pool,jt.zpp_pool=s.next,s.next=null),s.min=d,s.max=i,Et.stack.add(s)):(p.flag=d.flag=!0,null==jt.zpp_pool?_=new jt:(_=jt.zpp_pool,jt.zpp_pool=_.next,_.next=null),_.min=p,_.max=d,Et.stack.add(_),null==jt.zpp_pool?h=new jt:(h=jt.zpp_pool,jt.zpp_pool=h.next,h.next=null),h.min=d,h.max=p,Et.stack.add(h))):(null==jt.zpp_pool?u=new jt:(u=jt.zpp_pool,jt.zpp_pool=u.next,u.next=null),u.min=x,u.max=d,Et.stack.add(u));null!=Et.stack.head;){var v=Et.stack.pop_unsafe(),m=v.min,f=v.max;v.min=v.max=null,v.next=jt.zpp_pool,jt.zpp_pool=v;for(var b,g,w=t,M=null,C=m.next;C!=f;){var k=Et.distance(C,m,f);w<k&&(w=k,M=C),C=C.next}null!=M&&(M.flag=!0,null==jt.zpp_pool?b=new jt:(b=jt.zpp_pool,jt.zpp_pool=b.next,b.next=null),b.min=m,b.max=M,Et.stack.add(b),null==jt.zpp_pool?g=new jt:(g=jt.zpp_pool,jt.zpp_pool=g.next,g.next=null),g.min=M,g.max=f,Et.stack.add(g))}for(var O,P,S,A,j=null;null!=e;)e.flag&&(O=e.x,S=e.y,null==ii.zpp_pool?P=new ii:(P=ii.zpp_pool,ii.zpp_pool=P.next,P.next=null),P.forced=!1,P.x=O,P.y=S,S=P,null==j?j=S.prev=S.next=S:(S.prev=j,S.next=j.next,j.next.prev=S,j.next=S),(j=S).forced=e.forced),e=null!=e&&e.prev==e?(e.next=e.prev=null,(A=e).next=At.zpp_pool,At.zpp_pool=A,null):(S=e.next,e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,(A=e).next=At.zpp_pool,At.zpp_pool=A,e=null,S);return j},Et.prototype.__class__=Et;var It=zpp_nape.geom.ZPP_ToiEvent=function(){this.kinematic=!1,this.failed=!1,this.slipped=!1,this.axis=null,this.c2=null,this.c1=null,this.frozen2=!1,this.frozen1=!1,this.arbiter=null,this.s2=null,this.s1=null,this.toi=0,this.next=null,this.c1=new Ip,this.c2=new Ip,this.axis=new Ip};It.__name__=["zpp_nape","geom","ZPP_ToiEvent"],It.prototype.next=null,It.prototype.alloc=function(){this.failed=!1,this.s1=this.s2=null,this.arbiter=null},It.prototype.free=function(){},It.prototype.toi=null,It.prototype.s1=null,It.prototype.s2=null,It.prototype.arbiter=null,It.prototype.frozen1=null,It.prototype.frozen2=null,It.prototype.c1=null,It.prototype.c2=null,It.prototype.axis=null,It.prototype.slipped=null,It.prototype.failed=null,It.prototype.kinematic=null,It.prototype.__class__=It;var Tt=zpp_nape.geom.ZPP_SweepDistance=function(){};Tt.__name__=["zpp_nape","geom","ZPP_SweepDistance"],Tt.dynamicSweep=function(n,t,e,i,p){null==p&&(p=!1);var l=n.s1,r=n.s2,o=l.body,a=r.body,s=a.velx-o.velx,_=a.vely-o.vely,h=o.angvel;h<0&&(h=-h);var u=a.angvel;u<0&&(u=-u);var x=l.sweepCoef*h+r.sweepCoef*u;if(!p&&!n.kinematic&&s*s+_*_<jp.dynamicSweepLinearThreshold*jp.dynamicSweepLinearThreshold&&x<jp.dynamicSweepAngularThreshold)return n.toi=-1,void(n.failed=!0);for(var d=n.c1,y=n.c2,z=n.axis,c=e,v=0;;){var m,f,b=c*t,g=b-o.sweepTime;if(0!=g&&(o.sweepTime=b,o.posx+=o.velx*g,o.posy+=o.vely*g,0!=o.angvel&&(m=o.sweep_angvel*g,o.rot+=m,1e-4<m*m?(o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot)):(b=1-(f=m*m)*f/8,f=((g=1-.5*f)*o.axisx+m*o.axisy)*b,o.axisy=(g*o.axisy-m*o.axisx)*b,o.axisx=f))),0==l.type)l.worldCOMx=o.posx+(o.axisy*l.localCOMx-o.axisx*l.localCOMy),l.worldCOMy=o.posy+(l.localCOMx*o.axisx+l.localCOMy*o.axisy);else{for(var w=l.polygon,M=w.lverts.next,C=w.gverts.next;null!=C;){var k=C,O=M,M=M.next;k.x=o.posx+(o.axisy*O.x-o.axisx*O.y),k.y=o.posy+(O.x*o.axisx+O.y*o.axisy),C=C.next}for(var P=w.edges.head,S=A=w.gverts.next,A=A.next;null!=A;){var j=A,E=P.elt,P=P.next;E.gnormx=o.axisy*E.lnormx-o.axisx*E.lnormy,E.gnormy=E.lnormx*o.axisx+E.lnormy*o.axisy,E.gprojection=o.posx*E.gnormx+o.posy*E.gnormy+E.lprojection,E.tp0=S.y*E.gnormx-S.x*E.gnormy,E.tp1=j.y*E.gnormx-j.x*E.gnormy,S=j,A=A.next}var I=w.gverts.next,w=P.elt;w.gnormx=o.axisy*w.lnormx-o.axisx*w.lnormy,w.gnormy=w.lnormx*o.axisx+w.lnormy*o.axisy,w.gprojection=o.posx*w.gnormx+o.posy*w.gnormy+w.lprojection,w.tp0=S.y*w.gnormx-S.x*w.gnormy,w.tp1=I.y*w.gnormx-I.x*w.gnormy}I=c*t,w=I-a.sweepTime;if(0!=w&&(a.sweepTime=I,a.posx+=a.velx*w,a.posy+=a.vely*w,0!=a.angvel&&(W=a.sweep_angvel*w,a.rot+=W,1e-4<W*W?(a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)):(Y=1-(J=W*W)*J/8,J=((K=1-.5*J)*a.axisx+W*a.axisy)*Y,a.axisy=(K*a.axisy-W*a.axisx)*Y,a.axisx=J))),0==r.type)r.worldCOMx=a.posx+(a.axisy*r.localCOMx-a.axisx*r.localCOMy),r.worldCOMy=a.posy+(r.localCOMx*a.axisx+r.localCOMy*a.axisy);else{for(var T=r.polygon,N=T.lverts.next,L=T.gverts.next;null!=L;){var V=L,D=N,N=N.next;V.x=a.posx+(a.axisy*D.x-a.axisx*D.y),V.y=a.posy+(D.x*a.axisx+D.y*a.axisy),L=L.next}for(var F=T.edges.head,R=Z=T.gverts.next,Z=Z.next;null!=Z;){var B=Z,G=F.elt,F=F.next;G.gnormx=a.axisy*G.lnormx-a.axisx*G.lnormy,G.gnormy=G.lnormx*a.axisx+G.lnormy*a.axisy,G.gprojection=a.posx*G.gnormx+a.posy*G.gnormy+G.lprojection,G.tp0=R.y*G.gnormx-R.x*G.gnormy,G.tp1=B.y*G.gnormx-B.x*G.gnormy,R=B,Z=Z.next}var q=T.gverts.next,U=F.elt;U.gnormx=a.axisy*U.lnormx-a.axisx*U.lnormy,U.gnormy=U.lnormx*a.axisx+U.lnormy*a.axisy,U.gprojection=a.posx*U.gnormx+a.posy*U.gnormy+U.lprojection,U.tp0=R.y*U.gnormx-R.x*U.gnormy,U.tp1=q.y*U.gnormx-q.x*U.gnormy}var K=l,W=r,Y=d,J=y;if(0==l.type&&0==r.type){var X,T=l.circle,q=r.circle,H=0,$=0,H=q.worldCOMx-T.worldCOMx,$=q.worldCOMy-T.worldCOMy,U=Math.sqrt(H*H+$*$),Q=U-(T.radius+q.radius);Q<1e100&&(0==U?(H=1,$=0):(H*=X=1/U,$*=X),X=T.radius,d.x=T.worldCOMx+H*X,d.y=T.worldCOMy+$*X,X=-q.radius,y.x=q.worldCOMx+H*X,y.y=q.worldCOMy+$*X,z.x=H,z.y=$),H=Q}else{$=!1;if(0==l.type&&1==r.type&&(K=r,W=l,Y=y,J=d,$=!0),1==K.type&&0==W.type){for(var Q=K.polygon,nn=W.circle,tn=-1e100,en=null,pn=Q.edges.head;null!=pn;){var ln=pn.elt,rn=ln.gnormx*nn.worldCOMx+ln.gnormy*nn.worldCOMy-ln.gprojection-nn.radius;if(1e100<rn){tn=rn;break}0<rn?tn<rn&&(tn=rn,en=ln):tn<0&&tn<rn&&(tn=rn,en=ln),pn=pn.next}tn<1e100&&(kn=en.gp0,Vn=en.gp1,(Fn=nn.worldCOMy*en.gnormx-nn.worldCOMx*en.gnormy)<=kn.y*en.gnormx-kn.x*en.gnormy?(Dn=Nn=0,Nn=nn.worldCOMx-kn.x,Dn=nn.worldCOMy-kn.y,(tn=(Q=Math.sqrt(Nn*Nn+Dn*Dn))-nn.radius)<1e100&&(0==Q?(Nn=1,Dn=0):(Nn*=Cn=1/Q,Dn*=Cn),Y.x=kn.x+0*Nn,Y.y=kn.y+0*Dn,On=-nn.radius,J.x=nn.worldCOMx+Nn*On,J.y=nn.worldCOMy+Dn*On,z.x=Nn,z.y=Dn)):Fn>=Vn.y*en.gnormx-Vn.x*en.gnormy?(An=Sn=0,Sn=nn.worldCOMx-Vn.x,An=nn.worldCOMy-Vn.y,(tn=(Tn=Math.sqrt(Sn*Sn+An*An))-nn.radius)<1e100&&(0==Tn?(Sn=1,An=0):(Sn*=Ln=1/Tn,An*=Ln),Y.x=Vn.x+0*Sn,Y.y=Vn.y+0*An,Pn=-nn.radius,J.x=nn.worldCOMx+Sn*Pn,J.y=nn.worldCOMy+An*Pn,z.x=Sn,z.y=An)):(jn=-nn.radius,J.x=nn.worldCOMx+en.gnormx*jn,J.y=nn.worldCOMy+en.gnormy*jn,En=-tn,Y.x=J.x+en.gnormx*En,Y.y=J.y+en.gnormy*En,z.x=en.gnormx,z.y=en.gnormy)),$&&(z.x=-z.x,z.y=-z.y),H=tn}else{for(var on=K.polygon,an=W.polygon,sn=-1e100,_n=null,hn=null,un=0,xn=on.edges.head;null!=xn;){for(var dn=xn.elt,yn=1e100,zn=an.gverts.next;null!=zn;){var cn=dn.gnormx*zn.x+dn.gnormy*zn.y;cn<yn&&(yn=cn),zn=zn.next}if(1e100<(yn-=dn.gprojection)){sn=yn;break}0<yn?sn<yn&&(sn=yn,_n=dn,un=1):sn<0&&sn<yn&&(sn=yn,_n=dn,un=1),xn=xn.next}if(sn<1e100){for(var vn,mn,fn=an.edges.head;null!=fn;){for(var bn=fn.elt,gn=1e100,wn=on.gverts.next;null!=wn;){var Mn=bn.gnormx*wn.x+bn.gnormy*wn.y;Mn<gn&&(gn=Mn),wn=wn.next}if(1e100<(gn-=bn.gprojection)){sn=gn;break}0<gn?sn<gn&&(sn=gn,hn=bn,un=2):sn<0&&sn<gn&&(sn=gn,hn=bn,un=2),fn=fn.next}if(sn<1e100){1==un?(vn=an,mn=_n):(vn=on,mn=hn,In=Y,Y=J,J=In,$=!$);for(var Cn,kn,On,Pn,Sn,An,jn,En,In,Tn,Nn,Ln,Vn,Dn,Fn,Rn,Zn,Bn,Gn,qn,Un,Kn,Wn=null,Yn=1e100,Jn=vn.edges.head;null!=Jn;){var Xn=Jn.elt,Hn=mn.gnormx*Xn.gnormx+mn.gnormy*Xn.gnormy;Hn<Yn&&(Yn=Hn,Wn=Xn),Jn=Jn.next}$?(z.x=-mn.gnormx,z.y=-mn.gnormy):(z.x=mn.gnormx,z.y=mn.gnormy),H=0<=sn?(Cn=mn.gp0,kn=mn.gp1,On=Wn.gp0,Bn=Wn.gp1,Fn=Dn=Un=Nn=0,Kn=1/((Nn=kn.x-Cn.x)*Nn+(Un=kn.y-Cn.y)*Un),Tn=1/((Dn=Bn.x-On.x)*Dn+(Fn=Bn.y-On.y)*Fn),(Gn=-(Nn*(Cn.x-On.x)+Un*(Cn.y-On.y))*Kn)<0?Gn=0:1<Gn&&(Gn=1),(Ln=-(Nn*(Cn.x-Bn.x)+Un*(Cn.y-Bn.y))*Kn)<0?Ln=0:1<Ln&&(Ln=1),(Vn=-(Dn*(On.x-Cn.x)+Fn*(On.y-Cn.y))*Tn)<0?Vn=0:1<Vn&&(Vn=1),(Rn=-(Dn*(On.x-kn.x)+Fn*(On.y-kn.y))*Tn)<0?Rn=0:1<Rn&&(Rn=1),Sn=Pn=0,Pn=Cn.x+Nn*Gn,Sn=Cn.y+Un*Gn,Zn=An=0,An=Cn.x+Nn*Ln,Zn=Cn.y+Un*Ln,En=jn=0,jn=On.x+Dn*Vn,En=On.y+Fn*Vn,W=K=0,K=On.x+Dn*Rn,W=On.y+Fn*Rn,Fn=Dn=Vn=Ln=Un=Nn=Gn=Tn=Kn=In=0,Rn=null,(Kn=(In=Pn-On.x)*In+(Kn=Sn-On.y)*Kn)<(Gn=(Tn=An-Bn.x)*Tn+(Gn=Zn-Bn.y)*Gn)?(Dn=Pn,Fn=Sn,Rn=On):(Dn=An,Fn=Zn,Rn=Bn,Kn=Gn),Bn=Zn=0,Gn=null,(Un=(Nn=jn-Cn.x)*Nn+(Un=En-Cn.y)*Un)<(Vn=(Ln=K-kn.x)*Ln+(Vn=W-kn.y)*Vn)?(Zn=jn,Bn=En,Gn=Cn):(Zn=K,Bn=W,Gn=kn,Un=Vn),0!=(sn=Kn<Un?(Y.x=Dn,Y.y=Fn,J.x=Rn.x,J.y=Rn.y,Math.sqrt(Kn)):(J.x=Zn,J.y=Bn,Y.x=Gn.x,Y.y=Gn.y,Math.sqrt(Un)))&&(z.x=J.x-Y.x,z.y=J.y-Y.y,qn=1/sn,z.x*=qn,z.y*=qn,$&&(z.x=-z.x,z.y=-z.y)),sn):(Kn=Rn=0,Rn=Wn.gp0.x,Kn=Wn.gp0.y,Un=Gn=Bn=Zn=0,Gn=(Zn=Wn.gp1.x)-Rn,Un=(Bn=Wn.gp1.y)-Kn,qn=mn.gnormy*Rn-mn.gnormx*Kn,Qn=1/(($=mn.gnormy*Zn-mn.gnormx*Bn)-qn),(qn=(-mn.tp1-qn)*Qn)>jp.epsilon&&(Rn+=Gn*qn,Kn+=Un*qn),(Qn=(-mn.tp0-$)*Qn)<-jp.epsilon&&(Zn+=Gn*Qn,Bn+=Un*Qn),(Un=Rn*mn.gnormx+Kn*mn.gnormy-mn.gprojection)<(Qn=Zn*mn.gnormx+Bn*mn.gnormy-mn.gprojection)?(J.x=Rn,J.y=Kn,Kn=-Un,Y.x=J.x+mn.gnormx*Kn,Y.y=J.y+mn.gnormy*Kn,Un):(J.x=Zn,J.y=Bn,$n=-Qn,Y.x=J.x+mn.gnormx*$n,Y.y=J.y+mn.gnormy*$n,Qn))}else H=1e100}else H=1e100}}var J=H+i,$n=s*z.x+_*z.y;if(J<jp.distanceThresholdCCD){if(p)break;var Qn=0,nt=0,Qn=d.x-o.posx,nt=d.y-o.posy,tt=0,et=0,tt=y.x-a.posx,et=y.y-a.posy,nt=$n-o.sweep_angvel*(z.y*Qn-z.x*nt)+a.sweep_angvel*(z.y*tt-z.x*et);if(0<nt&&(n.slipped=!0),nt<=0||J<.5*jp.distanceThresholdCCD)break}tt=(x-$n)*t;if(tt<=0){c=-1;break}et=J/tt;if(et<1e-6&&(et=1e-6),1<=(c+=et)){nt=(c=1)*t,$n=nt-o.sweepTime;if(0!=$n&&(o.sweepTime=nt,o.posx+=o.velx*$n,o.posy+=o.vely*$n,0!=o.angvel&&(tt=o.sweep_angvel*$n,o.rot+=tt,1e-4<tt*tt?(o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot)):(nt=1-(et=tt*tt)*et/8,et=(($n=1-.5*et)*o.axisx+tt*o.axisy)*nt,o.axisy=($n*o.axisy-tt*o.axisx)*nt,o.axisx=et))),0==l.type)l.worldCOMx=o.posx+(o.axisy*l.localCOMx-o.axisx*l.localCOMy),l.worldCOMy=o.posy+(l.localCOMx*o.axisx+l.localCOMy*o.axisy);else{for(var it=l.polygon,pt=it.lverts.next,lt=it.gverts.next;null!=lt;){var rt=lt,ot=pt,pt=pt.next;rt.x=o.posx+(o.axisy*ot.x-o.axisx*ot.y),rt.y=o.posy+(ot.x*o.axisx+ot.y*o.axisy),lt=lt.next}for(var at=it.edges.head,st=_t=it.gverts.next,_t=_t.next;null!=_t;){var ht=_t,ut=at.elt,at=at.next;ut.gnormx=o.axisy*ut.lnormx-o.axisx*ut.lnormy,ut.gnormy=ut.lnormx*o.axisx+ut.lnormy*o.axisy,ut.gprojection=o.posx*ut.gnormx+o.posy*ut.gnormy+ut.lprojection,ut.tp0=st.y*ut.gnormx-st.x*ut.gnormy,ut.tp1=ht.y*ut.gnormx-ht.x*ut.gnormy,st=ht,_t=_t.next}var xt=it.gverts.next,it=at.elt;it.gnormx=o.axisy*it.lnormx-o.axisx*it.lnormy,it.gnormy=it.lnormx*o.axisx+it.lnormy*o.axisy,it.gprojection=o.posx*it.gnormx+o.posy*it.gnormy+it.lprojection,it.tp0=st.y*it.gnormx-st.x*it.gnormy,it.tp1=xt.y*it.gnormx-xt.x*it.gnormy}xt=c*t,it=xt-a.sweepTime;if(0!=it&&(a.sweepTime=xt,a.posx+=a.velx*it,a.posy+=a.vely*it,0!=a.angvel&&(Pt=a.sweep_angvel*it,a.rot+=Pt,1e-4<Pt*Pt?(a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)):(St=1-(kt=Pt*Pt)*kt/8,jt=((Ot=1-.5*kt)*a.axisx+Pt*a.axisy)*St,a.axisy=(Ot*a.axisy-Pt*a.axisx)*St,a.axisx=jt))),0==r.type)r.worldCOMx=a.posx+(a.axisy*r.localCOMx-a.axisx*r.localCOMy),r.worldCOMy=a.posy+(r.localCOMx*a.axisx+r.localCOMy*a.axisy);else{for(var dt=r.polygon,yt=dt.lverts.next,zt=dt.gverts.next;null!=zt;){var ct=zt,vt=yt,yt=yt.next;ct.x=a.posx+(a.axisy*vt.x-a.axisx*vt.y),ct.y=a.posy+(vt.x*a.axisx+vt.y*a.axisy),zt=zt.next}for(var mt=dt.edges.head,ft=bt=dt.gverts.next,bt=bt.next;null!=bt;){var gt=bt,wt=mt.elt,mt=mt.next;wt.gnormx=a.axisy*wt.lnormx-a.axisx*wt.lnormy,wt.gnormy=wt.lnormx*a.axisx+wt.lnormy*a.axisy,wt.gprojection=a.posx*wt.gnormx+a.posy*wt.gnormy+wt.lprojection,wt.tp0=ft.y*wt.gnormx-ft.x*wt.gnormy,wt.tp1=gt.y*wt.gnormx-gt.x*wt.gnormy,ft=gt,bt=bt.next}var Mt=dt.gverts.next,Ct=mt.elt;Ct.gnormx=a.axisy*Ct.lnormx-a.axisx*Ct.lnormy,Ct.gnormy=Ct.lnormx*a.axisx+Ct.lnormy*a.axisy,Ct.gprojection=a.posx*Ct.gnormx+a.posy*Ct.gnormy+Ct.lprojection,Ct.tp0=ft.y*Ct.gnormx-ft.x*Ct.gnormy,Ct.tp1=Mt.y*Ct.gnormx-Mt.x*Ct.gnormy}var kt=l,Ot=r,Pt=d,St=y;if(0==l.type&&0==r.type){var At,jt=l.circle,dt=r.circle,Mt=0,Et=0,Mt=dt.worldCOMx-jt.worldCOMx,Et=dt.worldCOMy-jt.worldCOMy,Ct=Math.sqrt(Mt*Mt+Et*Et),It=Ct-(jt.radius+dt.radius);It<1e100&&(0==Ct?(Mt=1,Et=0):(Mt*=At=1/Ct,Et*=At),At=jt.radius,d.x=jt.worldCOMx+Mt*At,d.y=jt.worldCOMy+Et*At,At=-dt.radius,y.x=dt.worldCOMx+Mt*At,y.y=dt.worldCOMy+Et*At,z.x=Mt,z.y=Et),Et=It}else{It=!1;if(0==l.type&&1==r.type&&(kt=r,Ot=l,Pt=y,St=d,It=!0),1==kt.type&&0==Ot.type){for(var Tt=kt.polygon,Nt=Ot.circle,Lt=-1e100,Vt=null,Dt=Tt.edges.head;null!=Dt;){var Ft=Dt.elt,Rt=Ft.gnormx*Nt.worldCOMx+Ft.gnormy*Nt.worldCOMy-Ft.gprojection-Nt.radius;if(1e100<Rt){Lt=Rt;break}0<Rt?Lt<Rt&&(Lt=Rt,Vt=Ft):Lt<0&&Lt<Rt&&(Lt=Rt,Vt=Ft),Dt=Dt.next}Lt<1e100&&(ye=Vt.gp0,fe=Vt.gp1,(de=Nt.worldCOMy*Vt.gnormx-Nt.worldCOMx*Vt.gnormy)<=ye.y*Vt.gnormx-ye.x*Vt.gnormy?(xe=me=0,me=Nt.worldCOMx-ye.x,xe=Nt.worldCOMy-ye.y,(Lt=(le=Math.sqrt(me*me+xe*xe))-Nt.radius)<1e100&&(0==le?(me=1,xe=0):(me*=re=1/le,xe*=re),Pt.x=ye.x+0*me,Pt.y=ye.y+0*xe,ve=-Nt.radius,St.x=Nt.worldCOMx+me*ve,St.y=Nt.worldCOMy+xe*ve,z.x=me,z.y=xe)):de>=fe.y*Vt.gnormx-fe.x*Vt.gnormy?(se=ae=0,ae=Nt.worldCOMx-fe.x,se=Nt.worldCOMy-fe.y,(Lt=(ze=Math.sqrt(ae*ae+se*se))-Nt.radius)<1e100&&(0==ze?(ae=1,se=0):(ae*=ce=1/ze,se*=ce),Pt.x=fe.x+0*ae,Pt.y=fe.y+0*se,oe=-Nt.radius,St.x=Nt.worldCOMx+ae*oe,St.y=Nt.worldCOMy+se*oe,z.x=ae,z.y=se)):(_e=-Nt.radius,St.x=Nt.worldCOMx+Vt.gnormx*_e,St.y=Nt.worldCOMy+Vt.gnormy*_e,he=-Lt,Pt.x=St.x+Vt.gnormx*he,Pt.y=St.y+Vt.gnormy*he,z.x=Vt.gnormx,z.y=Vt.gnormy)),It&&(z.x=-z.x,z.y=-z.y),Et=Lt}else{for(var Zt=kt.polygon,Bt=Ot.polygon,Gt=-1e100,qt=null,Ut=null,Kt=0,Wt=Zt.edges.head;null!=Wt;){for(var Yt=Wt.elt,Jt=1e100,Xt=Bt.gverts.next;null!=Xt;){var Ht=Yt.gnormx*Xt.x+Yt.gnormy*Xt.y;Ht<Jt&&(Jt=Ht),Xt=Xt.next}if(1e100<(Jt-=Yt.gprojection)){Gt=Jt;break}0<Jt?Gt<Jt&&(Gt=Jt,qt=Yt,Kt=1):Gt<0&&Gt<Jt&&(Gt=Jt,qt=Yt,Kt=1),Wt=Wt.next}if(Gt<1e100){for(var $t,Qt,ne=Bt.edges.head;null!=ne;){for(var te=ne.elt,ee=1e100,ie=Zt.gverts.next;null!=ie;){var pe=te.gnormx*ie.x+te.gnormy*ie.y;pe<ee&&(ee=pe),ie=ie.next}if(1e100<(ee-=te.gprojection)){Gt=ee;break}0<ee?Gt<ee&&(Gt=ee,Ut=te,Kt=2):Gt<0&&Gt<ee&&(Gt=ee,Ut=te,Kt=2),ne=ne.next}if(Gt<1e100){1==Kt?($t=Bt,Qt=qt):($t=Zt,Qt=Ut,ue=Pt,Pt=St,St=ue,It=!It);for(var le,re,oe,ae,se,_e,he,ue,xe,de,ye,ze,ce,ve,me,fe,be,ge,we,Me,Ce,ke=null,Oe=1e100,Pe=$t.edges.head;null!=Pe;){var Se=Pe.elt,Ae=Qt.gnormx*Se.gnormx+Qt.gnormy*Se.gnormy;Ae<Oe&&(Oe=Ae,ke=Se),Pe=Pe.next}It?(z.x=-Qt.gnormx,z.y=-Qt.gnormy):(z.x=Qt.gnormx,z.y=Qt.gnormy),Et=0<=Gt?(Tt=Qt.gp0,le=Qt.gp1,re=ke.gp0,Ce=ke.gp1,me=ve=Me=ye=0,xe=1/((ye=le.x-Tt.x)*ye+(Me=le.y-Tt.y)*Me),de=1/((ve=Ce.x-re.x)*ve+(me=Ce.y-re.y)*me),(ge=-(ye*(Tt.x-re.x)+Me*(Tt.y-re.y))*xe)<0?ge=0:1<ge&&(ge=1),(ze=-(ye*(Tt.x-Ce.x)+Me*(Tt.y-Ce.y))*xe)<0?ze=0:1<ze&&(ze=1),(ce=-(ve*(re.x-Tt.x)+me*(re.y-Tt.y))*de)<0?ce=0:1<ce&&(ce=1),(fe=-(ve*(re.x-le.x)+me*(re.y-le.y))*de)<0?fe=0:1<fe&&(fe=1),ae=oe=0,oe=Tt.x+ye*ge,ae=Tt.y+Me*ge,be=se=0,se=Tt.x+ye*ze,be=Tt.y+Me*ze,he=_e=0,_e=re.x+ve*ce,he=re.y+me*ce,Ot=kt=0,kt=re.x+ve*fe,Ot=re.y+me*fe,me=ve=ce=ze=Me=ye=ge=de=xe=ue=0,fe=null,(xe=(ue=oe-re.x)*ue+(xe=ae-re.y)*xe)<(ge=(de=se-Ce.x)*de+(ge=be-Ce.y)*ge)?(ve=oe,me=ae,fe=re):(ve=se,me=be,fe=Ce,xe=ge),Ce=be=0,ge=null,(Me=(ye=_e-Tt.x)*ye+(Me=he-Tt.y)*Me)<(ce=(ze=kt-le.x)*ze+(ce=Ot-le.y)*ce)?(be=_e,Ce=he,ge=Tt):(be=kt,Ce=Ot,ge=le,Me=ce),0!=(Gt=xe<Me?(Pt.x=ve,Pt.y=me,St.x=fe.x,St.y=fe.y,Math.sqrt(xe)):(St.x=be,St.y=Ce,Pt.x=ge.x,Pt.y=ge.y,Math.sqrt(Me)))&&(z.x=St.x-Pt.x,z.y=St.y-Pt.y,we=1/Gt,z.x*=we,z.y*=we,It&&(z.x=-z.x,z.y=-z.y)),Gt):(Ce=be=0,be=ke.gp0.x,Ce=ke.gp0.y,Me=ge=Ee=je=0,ge=(je=ke.gp1.x)-be,Me=(Ee=ke.gp1.y)-Ce,we=Qt.gnormy*be-Qt.gnormx*Ce,Te=1/((It=Qt.gnormy*je-Qt.gnormx*Ee)-we),(we=(-Qt.tp1-we)*Te)>jp.epsilon&&(be+=ge*we,Ce+=Me*we),(Te=(-Qt.tp0-It)*Te)<-jp.epsilon&&(je+=ge*Te,Ee+=Me*Te),(Me=be*Qt.gnormx+Ce*Qt.gnormy-Qt.gprojection)<(Te=je*Qt.gnormx+Ee*Qt.gnormy-Qt.gprojection)?(St.x=be,St.y=Ce,Ce=-Me,Pt.x=St.x+Qt.gnormx*Ce,Pt.y=St.y+Qt.gnormy*Ce,Me):(St.x=je,St.y=Ee,Ie=-Te,Pt.x=St.x+Qt.gnormx*Ie,Pt.y=St.y+Qt.gnormy*Ie,Te))}else Et=1e100}else Et=1e100}}var je=Et+i,Ee=s*z.x+_*z.y;if(je<jp.distanceThresholdCCD){if(p)break;var Pt=0,St=0,Pt=d.x-o.posx,St=d.y-o.posy,Ie=0,Te=0,Ie=y.x-a.posx,Te=y.y-a.posy,Te=Ee-o.sweep_angvel*(z.y*Pt-z.x*St)+a.sweep_angvel*(z.y*Ie-z.x*Te);if(0<Te&&(n.slipped=!0),Te<=0||je<.5*jp.distanceThresholdCCD)break}c=-1;break}if(40<=++v){i<J&&(n.failed=!0);break}}n.toi=c},Tt.staticSweep=function(n,t,e,i){var p=n.s1,l=n.s2,r=p.body,o=-r.velx,a=-r.vely,s=r.sweep_angvel;s<0&&(s=-s);for(var _=p.sweepCoef*s,h=n.c1,u=n.c2,x=n.axis,d=e,y=0;;){var z=d*t,c=z-r.sweepTime;if(0!=c&&(r.sweepTime=z,r.posx+=r.velx*c,r.posy+=r.vely*c,0!=r.angvel&&(j=r.sweep_angvel*c,r.rot+=j,1e-4<j*j?(r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)):(E=1-(I=j*j)*I/8,I=((A=1-.5*I)*r.axisx+j*r.axisy)*E,r.axisy=(A*r.axisy-j*r.axisx)*E,r.axisx=I))),0==p.type)p.worldCOMx=r.posx+(r.axisy*p.localCOMx-r.axisx*p.localCOMy),p.worldCOMy=r.posy+(p.localCOMx*r.axisx+p.localCOMy*r.axisy);else{for(var v=p.polygon,m=v.lverts.next,f=v.gverts.next;null!=f;){var b=f,g=m,m=m.next;b.x=r.posx+(r.axisy*g.x-r.axisx*g.y),b.y=r.posy+(g.x*r.axisx+g.y*r.axisy),f=f.next}for(var w=v.edges.head,M=C=v.gverts.next,C=C.next;null!=C;){var k=C,O=w.elt,w=w.next;O.gnormx=r.axisy*O.lnormx-r.axisx*O.lnormy,O.gnormy=O.lnormx*r.axisx+O.lnormy*r.axisy,O.gprojection=r.posx*O.gnormx+r.posy*O.gnormy+O.lprojection,O.tp0=M.y*O.gnormx-M.x*O.gnormy,O.tp1=k.y*O.gnormx-k.x*O.gnormy,M=k,C=C.next}var P=v.gverts.next,S=w.elt;S.gnormx=r.axisy*S.lnormx-r.axisx*S.lnormy,S.gnormy=S.lnormx*r.axisx+S.lnormy*r.axisy,S.gprojection=r.posx*S.gnormx+r.posy*S.gnormy+S.lprojection,S.tp0=M.y*S.gnormx-M.x*S.gnormy,S.tp1=P.y*S.gnormx-P.x*S.gnormy}var A=p,j=l,E=h,I=u;if(0==p.type&&0==l.type){var T,v=p.circle,P=l.circle,N=0,L=0,N=P.worldCOMx-v.worldCOMx,L=P.worldCOMy-v.worldCOMy,S=Math.sqrt(N*N+L*L),V=S-(v.radius+P.radius);V<1e100&&(0==S?(N=1,L=0):(N*=T=1/S,L*=T),T=v.radius,h.x=v.worldCOMx+N*T,h.y=v.worldCOMy+L*T,T=-P.radius,u.x=P.worldCOMx+N*T,u.y=P.worldCOMy+L*T,x.x=N,x.y=L),N=V}else{L=!1;if(0==p.type&&1==l.type&&(A=l,j=p,E=u,I=h,L=!0),1==A.type&&0==j.type){for(var V=A.polygon,D=j.circle,F=-1e100,R=null,Z=V.edges.head;null!=Z;){var B=Z.elt,G=B.gnormx*D.worldCOMx+B.gnormy*D.worldCOMy-B.gprojection-D.radius;if(1e100<G){F=G;break}0<G?F<G&&(F=G,R=B):F<0&&F<G&&(F=G,R=B),Z=Z.next}F<1e100&&(_n=R.gp0,bn=R.gp1,(wn=D.worldCOMy*R.gnormx-D.worldCOMx*R.gnormy)<=_n.y*R.gnormx-_n.x*R.gnormy?(gn=mn=0,mn=D.worldCOMx-_n.x,gn=D.worldCOMy-_n.y,(F=(V=Math.sqrt(mn*mn+gn*gn))-D.radius)<1e100&&(0==V?(mn=1,gn=0):(mn*=sn=1/V,gn*=sn),E.x=_n.x+0*mn,E.y=_n.y+0*gn,hn=-D.radius,I.x=D.worldCOMx+mn*hn,I.y=D.worldCOMy+gn*hn,x.x=mn,x.y=gn)):wn>=bn.y*R.gnormx-bn.x*R.gnormy?(dn=xn=0,xn=D.worldCOMx-bn.x,dn=D.worldCOMy-bn.y,(F=(vn=Math.sqrt(xn*xn+dn*dn))-D.radius)<1e100&&(0==vn?(xn=1,dn=0):(xn*=fn=1/vn,dn*=fn),E.x=bn.x+0*xn,E.y=bn.y+0*dn,un=-D.radius,I.x=D.worldCOMx+xn*un,I.y=D.worldCOMy+dn*un,x.x=xn,x.y=dn)):(yn=-D.radius,I.x=D.worldCOMx+R.gnormx*yn,I.y=D.worldCOMy+R.gnormy*yn,zn=-F,E.x=I.x+R.gnormx*zn,E.y=I.y+R.gnormy*zn,x.x=R.gnormx,x.y=R.gnormy)),L&&(x.x=-x.x,x.y=-x.y),N=F}else{for(var q=A.polygon,U=j.polygon,K=-1e100,W=null,Y=null,J=0,X=q.edges.head;null!=X;){for(var H=X.elt,$=1e100,Q=U.gverts.next;null!=Q;){var nn=H.gnormx*Q.x+H.gnormy*Q.y;nn<$&&($=nn),Q=Q.next}if(1e100<($-=H.gprojection)){K=$;break}0<$?K<$&&(K=$,W=H,J=1):K<0&&K<$&&(K=$,W=H,J=1),X=X.next}if(K<1e100){for(var tn,en,pn=U.edges.head;null!=pn;){for(var ln=pn.elt,rn=1e100,on=q.gverts.next;null!=on;){var an=ln.gnormx*on.x+ln.gnormy*on.y;an<rn&&(rn=an),on=on.next}if(1e100<(rn-=ln.gprojection)){K=rn;break}0<rn?K<rn&&(K=rn,Y=ln,J=2):K<0&&K<rn&&(K=rn,Y=ln,J=2),pn=pn.next}if(K<1e100){1==J?(tn=U,en=W):(tn=q,en=Y,cn=E,E=I,I=cn,L=!L);for(var sn,_n,hn,un,xn,dn,yn,zn,cn,vn,mn,fn,bn,gn,wn,Mn,Cn,kn,On,Pn,Sn,An,jn=null,En=1e100,In=tn.edges.head;null!=In;){var Tn=In.elt,Nn=en.gnormx*Tn.gnormx+en.gnormy*Tn.gnormy;Nn<En&&(En=Nn,jn=Tn),In=In.next}L?(x.x=-en.gnormx,x.y=-en.gnormy):(x.x=en.gnormx,x.y=en.gnormy),N=0<=K?(sn=en.gp0,_n=en.gp1,hn=jn.gp0,kn=jn.gp1,wn=gn=Sn=mn=0,An=1/((mn=_n.x-sn.x)*mn+(Sn=_n.y-sn.y)*Sn),vn=1/((gn=kn.x-hn.x)*gn+(wn=kn.y-hn.y)*wn),(On=-(mn*(sn.x-hn.x)+Sn*(sn.y-hn.y))*An)<0?On=0:1<On&&(On=1),(fn=-(mn*(sn.x-kn.x)+Sn*(sn.y-kn.y))*An)<0?fn=0:1<fn&&(fn=1),(bn=-(gn*(hn.x-sn.x)+wn*(hn.y-sn.y))*vn)<0?bn=0:1<bn&&(bn=1),(Mn=-(gn*(hn.x-_n.x)+wn*(hn.y-_n.y))*vn)<0?Mn=0:1<Mn&&(Mn=1),xn=un=0,un=sn.x+mn*On,xn=sn.y+Sn*On,Cn=dn=0,dn=sn.x+mn*fn,Cn=sn.y+Sn*fn,zn=yn=0,yn=hn.x+gn*bn,zn=hn.y+wn*bn,j=A=0,A=hn.x+gn*Mn,j=hn.y+wn*Mn,wn=gn=bn=fn=Sn=mn=On=vn=An=cn=0,Mn=null,(An=(cn=un-hn.x)*cn+(An=xn-hn.y)*An)<(On=(vn=dn-kn.x)*vn+(On=Cn-kn.y)*On)?(gn=un,wn=xn,Mn=hn):(gn=dn,wn=Cn,Mn=kn,An=On),kn=Cn=0,On=null,(Sn=(mn=yn-sn.x)*mn+(Sn=zn-sn.y)*Sn)<(bn=(fn=A-_n.x)*fn+(bn=j-_n.y)*bn)?(Cn=yn,kn=zn,On=sn):(Cn=A,kn=j,On=_n,Sn=bn),0!=(K=An<Sn?(E.x=gn,E.y=wn,I.x=Mn.x,I.y=Mn.y,Math.sqrt(An)):(I.x=Cn,I.y=kn,E.x=On.x,E.y=On.y,Math.sqrt(Sn)))&&(x.x=I.x-E.x,x.y=I.y-E.y,Pn=1/K,x.x*=Pn,x.y*=Pn,L&&(x.x=-x.x,x.y=-x.y)),K):(An=Mn=0,Mn=jn.gp0.x,An=jn.gp0.y,Sn=On=kn=Cn=0,On=(Cn=jn.gp1.x)-Mn,Sn=(kn=jn.gp1.y)-An,Pn=en.gnormy*Mn-en.gnormx*An,Vn=1/((L=en.gnormy*Cn-en.gnormx*kn)-Pn),(Pn=(-en.tp1-Pn)*Vn)>jp.epsilon&&(Mn+=On*Pn,An+=Sn*Pn),(Vn=(-en.tp0-L)*Vn)<-jp.epsilon&&(Cn+=On*Vn,kn+=Sn*Vn),(Sn=Mn*en.gnormx+An*en.gnormy-en.gprojection)<(Vn=Cn*en.gnormx+kn*en.gnormy-en.gprojection)?(I.x=Mn,I.y=An,An=-Sn,E.x=I.x+en.gnormx*An,E.y=I.y+en.gnormy*An,Sn):(I.x=Cn,I.y=kn,Ln=-Vn,E.x=I.x+en.gnormx*Ln,E.y=I.y+en.gnormy*Ln,Vn))}else N=1e100}else N=1e100}}var I=N+i,Ln=o*x.x+a*x.y;if(I<jp.distanceThresholdCCD){var Vn=0,Vn=h.x-r.posx,Dn=h.y-r.posy,Dn=Ln-r.sweep_angvel*(x.y*Vn-x.x*Dn);if(0<Dn&&(n.slipped=!0),Dn<=0||I<.5*jp.distanceThresholdCCD)break}Dn=(_-Ln)*t;if(Dn<=0){d=-1;break}Ln=I/Dn;if(Ln<1e-6&&(Ln=1e-6),1<=(d+=Ln)){Dn=(d=1)*t,Ln=Dn-r.sweepTime;if(0!=Ln&&(r.sweepTime=Dn,r.posx+=r.velx*Ln,r.posy+=r.vely*Ln,0!=r.angvel&&($n=r.sweep_angvel*Ln,r.rot+=$n,1e-4<$n*$n?(r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)):(Qn=1-(nt=$n*$n)*nt/8,nt=((Hn=1-.5*nt)*r.axisx+$n*r.axisy)*Qn,r.axisy=(Hn*r.axisy-$n*r.axisx)*Qn,r.axisx=nt))),0==p.type)p.worldCOMx=r.posx+(r.axisy*p.localCOMx-r.axisx*p.localCOMy),p.worldCOMy=r.posy+(p.localCOMx*r.axisx+p.localCOMy*r.axisy);else{for(var Fn=p.polygon,Rn=Fn.lverts.next,Zn=Fn.gverts.next;null!=Zn;){var Bn=Zn,Gn=Rn,Rn=Rn.next;Bn.x=r.posx+(r.axisy*Gn.x-r.axisx*Gn.y),Bn.y=r.posy+(Gn.x*r.axisx+Gn.y*r.axisy),Zn=Zn.next}for(var qn=Fn.edges.head,Un=Kn=Fn.gverts.next,Kn=Kn.next;null!=Kn;){var Wn=Kn,Yn=qn.elt,qn=qn.next;Yn.gnormx=r.axisy*Yn.lnormx-r.axisx*Yn.lnormy,Yn.gnormy=Yn.lnormx*r.axisx+Yn.lnormy*r.axisy,Yn.gprojection=r.posx*Yn.gnormx+r.posy*Yn.gnormy+Yn.lprojection,Yn.tp0=Un.y*Yn.gnormx-Un.x*Yn.gnormy,Yn.tp1=Wn.y*Yn.gnormx-Wn.x*Yn.gnormy,Un=Wn,Kn=Kn.next}var Jn=Fn.gverts.next,Xn=qn.elt;Xn.gnormx=r.axisy*Xn.lnormx-r.axisx*Xn.lnormy,Xn.gnormy=Xn.lnormx*r.axisx+Xn.lnormy*r.axisy,Xn.gprojection=r.posx*Xn.gnormx+r.posy*Xn.gnormy+Xn.lprojection,Xn.tp0=Un.y*Xn.gnormx-Un.x*Xn.gnormy,Xn.tp1=Jn.y*Xn.gnormx-Jn.x*Xn.gnormy}var Hn=p,$n=l,Qn=h,nt=u;if(0==p.type&&0==l.type){var tt,Fn=p.circle,Jn=l.circle,et=0,it=0,et=Jn.worldCOMx-Fn.worldCOMx,it=Jn.worldCOMy-Fn.worldCOMy,Xn=Math.sqrt(et*et+it*it),pt=Xn-(Fn.radius+Jn.radius);pt<1e100&&(0==Xn?(et=1,it=0):(et*=tt=1/Xn,it*=tt),tt=Fn.radius,h.x=Fn.worldCOMx+et*tt,h.y=Fn.worldCOMy+it*tt,tt=-Jn.radius,u.x=Jn.worldCOMx+et*tt,u.y=Jn.worldCOMy+it*tt,x.x=et,x.y=it),et=pt}else{it=!1;if(0==p.type&&1==l.type&&(Hn=l,$n=p,Qn=u,nt=h,it=!0),1==Hn.type&&0==$n.type){for(var pt=Hn.polygon,lt=$n.circle,rt=-1e100,ot=null,at=pt.edges.head;null!=at;){var st=at.elt,_t=st.gnormx*lt.worldCOMx+st.gnormy*lt.worldCOMy-st.gprojection-lt.radius;if(1e100<_t){rt=_t;break}0<_t?rt<_t&&(rt=_t,ot=st):rt<0&&rt<_t&&(rt=_t,ot=st),at=at.next}rt<1e100&&(At=ot.gp0,Zt=ot.gp1,(Gt=lt.worldCOMy*ot.gnormx-lt.worldCOMx*ot.gnormy)<=At.y*ot.gnormx-At.x*ot.gnormy?(Bt=Ft=0,Ft=lt.worldCOMx-At.x,Bt=lt.worldCOMy-At.y,(rt=(pt=Math.sqrt(Ft*Ft+Bt*Bt))-lt.radius)<1e100&&(0==pt?(Ft=1,Bt=0):(Ft*=St=1/pt,Bt*=St),Qn.x=At.x+0*Ft,Qn.y=At.y+0*Bt,jt=-lt.radius,nt.x=lt.worldCOMx+Ft*jt,nt.y=lt.worldCOMy+Bt*jt,x.x=Ft,x.y=Bt)):Gt>=Zt.y*ot.gnormx-Zt.x*ot.gnormy?(Tt=It=0,It=lt.worldCOMx-Zt.x,Tt=lt.worldCOMy-Zt.y,(rt=(Dt=Math.sqrt(It*It+Tt*Tt))-lt.radius)<1e100&&(0==Dt?(It=1,Tt=0):(It*=Rt=1/Dt,Tt*=Rt),Qn.x=Zt.x+0*It,Qn.y=Zt.y+0*Tt,Et=-lt.radius,nt.x=lt.worldCOMx+It*Et,nt.y=lt.worldCOMy+Tt*Et,x.x=It,x.y=Tt)):(Nt=-lt.radius,nt.x=lt.worldCOMx+ot.gnormx*Nt,nt.y=lt.worldCOMy+ot.gnormy*Nt,Lt=-rt,Qn.x=nt.x+ot.gnormx*Lt,Qn.y=nt.y+ot.gnormy*Lt,x.x=ot.gnormx,x.y=ot.gnormy)),it&&(x.x=-x.x,x.y=-x.y),et=rt}else{for(var ht=Hn.polygon,ut=$n.polygon,xt=-1e100,dt=null,yt=null,zt=0,ct=ht.edges.head;null!=ct;){for(var vt=ct.elt,mt=1e100,ft=ut.gverts.next;null!=ft;){var bt=vt.gnormx*ft.x+vt.gnormy*ft.y;bt<mt&&(mt=bt),ft=ft.next}if(1e100<(mt-=vt.gprojection)){xt=mt;break}0<mt?xt<mt&&(xt=mt,dt=vt,zt=1):xt<0&&xt<mt&&(xt=mt,dt=vt,zt=1),ct=ct.next}if(xt<1e100){for(var gt,wt,Mt=ut.edges.head;null!=Mt;){for(var Ct=Mt.elt,kt=1e100,Ot=ht.gverts.next;null!=Ot;){var Pt=Ct.gnormx*Ot.x+Ct.gnormy*Ot.y;Pt<kt&&(kt=Pt),Ot=Ot.next}if(1e100<(kt-=Ct.gprojection)){xt=kt;break}0<kt?xt<kt&&(xt=kt,yt=Ct,zt=2):xt<0&&xt<kt&&(xt=kt,yt=Ct,zt=2),Mt=Mt.next}if(xt<1e100){1==zt?(gt=ut,wt=dt):(gt=ht,wt=yt,Vt=Qn,Qn=nt,nt=Vt,it=!it);for(var St,At,jt,Et,It,Tt,Nt,Lt,Vt,Dt,Ft,Rt,Zt,Bt,Gt,qt,Ut,Kt,Wt,Yt,Jt,Xt,Ht=null,$t=1e100,Qt=gt.edges.head;null!=Qt;){var ne=Qt.elt,te=wt.gnormx*ne.gnormx+wt.gnormy*ne.gnormy;te<$t&&($t=te,Ht=ne),Qt=Qt.next}it?(x.x=-wt.gnormx,x.y=-wt.gnormy):(x.x=wt.gnormx,x.y=wt.gnormy),et=0<=xt?(St=wt.gp0,At=wt.gp1,jt=Ht.gp0,Kt=Ht.gp1,Gt=Bt=Jt=Ft=0,Xt=1/((Ft=At.x-St.x)*Ft+(Jt=At.y-St.y)*Jt),Dt=1/((Bt=Kt.x-jt.x)*Bt+(Gt=Kt.y-jt.y)*Gt),(Wt=-(Ft*(St.x-jt.x)+Jt*(St.y-jt.y))*Xt)<0?Wt=0:1<Wt&&(Wt=1),(Rt=-(Ft*(St.x-Kt.x)+Jt*(St.y-Kt.y))*Xt)<0?Rt=0:1<Rt&&(Rt=1),(Zt=-(Bt*(jt.x-St.x)+Gt*(jt.y-St.y))*Dt)<0?Zt=0:1<Zt&&(Zt=1),(qt=-(Bt*(jt.x-At.x)+Gt*(jt.y-At.y))*Dt)<0?qt=0:1<qt&&(qt=1),It=Et=0,Et=St.x+Ft*Wt,It=St.y+Jt*Wt,Ut=Tt=0,Tt=St.x+Ft*Rt,Ut=St.y+Jt*Rt,Lt=Nt=0,Nt=jt.x+Bt*Zt,Lt=jt.y+Gt*Zt,$n=Hn=0,Hn=jt.x+Bt*qt,$n=jt.y+Gt*qt,Gt=Bt=Zt=Rt=Jt=Ft=Wt=Dt=Xt=Vt=0,qt=null,(Xt=(Vt=Et-jt.x)*Vt+(Xt=It-jt.y)*Xt)<(Wt=(Dt=Tt-Kt.x)*Dt+(Wt=Ut-Kt.y)*Wt)?(Bt=Et,Gt=It,qt=jt):(Bt=Tt,Gt=Ut,qt=Kt,Xt=Wt),Kt=Ut=0,Wt=null,(Jt=(Ft=Nt-St.x)*Ft+(Jt=Lt-St.y)*Jt)<(Zt=(Rt=Hn-At.x)*Rt+(Zt=$n-At.y)*Zt)?(Ut=Nt,Kt=Lt,Wt=St):(Ut=Hn,Kt=$n,Wt=At,Jt=Zt),0!=(xt=Xt<Jt?(Qn.x=Bt,Qn.y=Gt,nt.x=qt.x,nt.y=qt.y,Math.sqrt(Xt)):(nt.x=Ut,nt.y=Kt,Qn.x=Wt.x,Qn.y=Wt.y,Math.sqrt(Jt)))&&(x.x=nt.x-Qn.x,x.y=nt.y-Qn.y,Yt=1/xt,x.x*=Yt,x.y*=Yt,it&&(x.x=-x.x,x.y=-x.y)),xt):(Xt=qt=0,qt=Ht.gp0.x,Xt=Ht.gp0.y,Jt=Wt=Kt=Ut=0,Wt=(Ut=Ht.gp1.x)-qt,Jt=(Kt=Ht.gp1.y)-Xt,Yt=wt.gnormy*qt-wt.gnormx*Xt,ie=1/((it=wt.gnormy*Ut-wt.gnormx*Kt)-Yt),(Yt=(-wt.tp1-Yt)*ie)>jp.epsilon&&(qt+=Wt*Yt,Xt+=Jt*Yt),(ie=(-wt.tp0-it)*ie)<-jp.epsilon&&(Ut+=Wt*ie,Kt+=Jt*ie),(Jt=qt*wt.gnormx+Xt*wt.gnormy-wt.gprojection)<(ie=Ut*wt.gnormx+Kt*wt.gnormy-wt.gprojection)?(nt.x=qt,nt.y=Xt,Xt=-Jt,Qn.x=nt.x+wt.gnormx*Xt,Qn.y=nt.y+wt.gnormy*Xt,Jt):(nt.x=Ut,nt.y=Kt,ee=-ie,Qn.x=nt.x+wt.gnormx*ee,Qn.y=nt.y+wt.gnormy*ee,ie))}else et=1e100}else et=1e100}}Qn=et+i,nt=o*x.x+a*x.y;if(Qn<jp.distanceThresholdCCD){var ee=0,ie=0,ee=h.x-r.posx,ie=h.y-r.posy,ie=nt-r.sweep_angvel*(x.y*ee-x.x*ie);if(0<ie&&(n.slipped=!0),ie<=0||Qn<.5*jp.distanceThresholdCCD)break}d=-1;break}if(40<=++y){i<I&&(n.failed=!0);break}}n.toi=d},Tt.distanceBody=function(n,t,e,i){var p,l,r;null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,null==Ip.zpp_pool?l=new Ip:(l=Ip.zpp_pool,Ip.zpp_pool=l.next,l.next=null),l.weak=!1,null==Ip.zpp_pool?r=new Ip:(r=Ip.zpp_pool,Ip.zpp_pool=r.next,r.next=null),r.weak=!1;for(var o=1e100,a=n.shapes.head;null!=a;){for(var s=a.elt,_=t.shapes.head;null!=_;){var h=_.elt,u=s,x=h,d=p,y=l;if(0==s.type&&0==h.type){var z,c=s.circle,v=h.circle,m=0,f=0,m=v.worldCOMx-c.worldCOMx,f=v.worldCOMy-c.worldCOMy,b=Math.sqrt(m*m+f*f),g=b-(c.radius+v.radius);g<o&&(0==b?(m=1,f=0):(m*=z=1/b,f*=z),z=c.radius,d.x=c.worldCOMx+m*z,d.y=c.worldCOMy+f*z,z=-v.radius,y.x=v.worldCOMx+m*z,y.y=v.worldCOMy+f*z,r.x=m,r.y=f),f=g}else{g=!1;if(0==s.type&&1==h.type&&(u=h,x=s,w=d,d=y,y=w,g=!0),1==u.type&&0==x.type){for(var w=u.polygon,M=x.circle,C=-1e100,k=null,O=w.edges.head;null!=O;){var P=O.elt,S=P.gnormx*M.worldCOMx+P.gnormy*M.worldCOMy-P.gprojection-M.radius;if(o<S){C=S;break}0<S?C<S&&(C=S,k=P):C<0&&C<S&&(C=S,k=P),O=O.next}C<o&&(Y=k.gp0,on=k.gp1,(an=M.worldCOMy*k.gnormx-M.worldCOMx*k.gnormy)<=Y.y*k.gnormx-Y.x*k.gnormy?(ln=X=0,X=M.worldCOMx-Y.x,ln=M.worldCOMy-Y.y,(C=(w=Math.sqrt(X*X+ln*ln))-M.radius)<o&&(0==w?(X=1,ln=0):(X*=J=1/w,ln*=J),d.x=Y.x+0*X,d.y=Y.y+0*ln,J=-M.radius,y.x=M.worldCOMx+X*J,y.y=M.worldCOMy+ln*J,r.x=X,r.y=ln)):an>=on.y*k.gnormx-on.x*k.gnormy?(Q=$=0,$=M.worldCOMx-on.x,Q=M.worldCOMy-on.y,(C=(pn=Math.sqrt($*$+Q*Q))-M.radius)<o&&(0==pn?($=1,Q=0):($*=rn=1/pn,Q*=rn),d.x=on.x+0*$,d.y=on.y+0*Q,H=-M.radius,y.x=M.worldCOMx+$*H,y.y=M.worldCOMy+Q*H,r.x=$,r.y=Q)):(nn=-M.radius,y.x=M.worldCOMx+k.gnormx*nn,y.y=M.worldCOMy+k.gnormy*nn,tn=-C,d.x=y.x+k.gnormx*tn,d.y=y.y+k.gnormy*tn,r.x=k.gnormx,r.y=k.gnormy)),g&&(r.x=-r.x,r.y=-r.y),f=C}else{for(var A=u.polygon,j=x.polygon,E=-1e100,I=null,T=null,N=0,L=A.edges.head;null!=L;){for(var V=L.elt,D=1e100,F=j.gverts.next;null!=F;){var R=V.gnormx*F.x+V.gnormy*F.y;R<D&&(D=R),F=F.next}if(o<(D-=V.gprojection)){E=D;break}0<D?E<D&&(E=D,I=V,N=1):E<0&&E<D&&(E=D,I=V,N=1),L=L.next}if(E<o){for(var Z,B,G=j.edges.head;null!=G;){for(var q=G.elt,U=1e100,K=A.gverts.next;null!=K;){var W=q.gnormx*K.x+q.gnormy*K.y;W<U&&(U=W),K=K.next}if(o<(U-=q.gprojection)){E=U;break}0<U?E<U&&(E=U,T=q,N=2):E<0&&E<U&&(E=U,T=q,N=2),G=G.next}if(E<o){1==N?(Z=j,B=I):(Z=A,B=T,en=d,d=y,y=en,g=!g);for(var Y,J,X,H,$,Q,nn,tn,en,pn,ln,rn,on,an,sn,_n,hn,un,xn,dn,yn,zn,cn=null,vn=1e100,mn=Z.edges.head;null!=mn;){var fn=mn.elt,bn=B.gnormx*fn.gnormx+B.gnormy*fn.gnormy;bn<vn&&(vn=bn,cn=fn),mn=mn.next}g?(r.x=-B.gnormx,r.y=-B.gnormy):(r.x=B.gnormx,r.y=B.gnormy),f=0<=E?(Y=B.gp0,J=B.gp1,X=cn.gp0,hn=cn.gp1,sn=an=xn=ln=0,_n=1/((ln=J.x-Y.x)*ln+(xn=J.y-Y.y)*xn),pn=1/((an=hn.x-X.x)*an+(sn=hn.y-X.y)*sn),(dn=-(ln*(Y.x-X.x)+xn*(Y.y-X.y))*_n)<0?dn=0:1<dn&&(dn=1),(rn=-(ln*(Y.x-hn.x)+xn*(Y.y-hn.y))*_n)<0?rn=0:1<rn&&(rn=1),(on=-(an*(X.x-Y.x)+sn*(X.y-Y.y))*pn)<0?on=0:1<on&&(on=1),(yn=-(an*(X.x-J.x)+sn*(X.y-J.y))*pn)<0?yn=0:1<yn&&(yn=1),$=H=0,H=Y.x+ln*dn,$=Y.y+xn*dn,zn=Q=0,Q=Y.x+ln*rn,zn=Y.y+xn*rn,tn=nn=0,nn=X.x+an*on,tn=X.y+sn*on,x=u=0,u=X.x+an*yn,x=X.y+sn*yn,sn=an=on=rn=xn=ln=dn=pn=_n=en=0,yn=null,(_n=(en=H-X.x)*en+(_n=$-X.y)*_n)<(dn=(pn=Q-hn.x)*pn+(dn=zn-hn.y)*dn)?(an=H,sn=$,yn=X):(an=Q,sn=zn,yn=hn,_n=dn),hn=zn=0,dn=null,(xn=(ln=nn-Y.x)*ln+(xn=tn-Y.y)*xn)<(on=(rn=u-J.x)*rn+(on=x-J.y)*on)?(zn=nn,hn=tn,dn=Y):(zn=u,hn=x,dn=J,xn=on),0!=(E=_n<xn?(d.x=an,d.y=sn,y.x=yn.x,y.y=yn.y,Math.sqrt(_n)):(y.x=zn,y.y=hn,d.x=dn.x,d.y=dn.y,Math.sqrt(xn)))&&(r.x=y.x-d.x,r.y=y.y-d.y,un=1/E,r.x*=un,r.y*=un,g&&(r.x=-r.x,r.y=-r.y)),E):(yn=sn=0,sn=cn.gp0.x,yn=cn.gp0.y,dn=hn=zn=_n=0,hn=(_n=cn.gp1.x)-sn,dn=(zn=cn.gp1.y)-yn,xn=B.gnormy*sn-B.gnormx*yn,g=1/((un=B.gnormy*_n-B.gnormx*zn)-xn),(xn=(-B.tp1-xn)*g)>jp.epsilon&&(sn+=hn*xn,yn+=dn*xn),(g=(-B.tp0-un)*g)<-jp.epsilon&&(_n+=hn*g,zn+=dn*g),(dn=sn*B.gnormx+yn*B.gnormy-B.gprojection)<(g=_n*B.gnormx+zn*B.gnormy-B.gprojection)?(y.x=sn,y.y=yn,yn=-dn,d.x=y.x+B.gnormx*yn,d.y=y.y+B.gnormy*yn,dn):(y.x=_n,y.y=zn,zn=-g,d.x=y.x+B.gnormx*zn,d.y=y.y+B.gnormy*zn,g))}else f=o}else f=o}}f<o&&(o=f,e.x=p.x,e.y=p.y,i.x=l.x,i.y=l.y),_=_.next}a=a.next}n=p;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n;n=l;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n;n=r;return null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n,o},Tt.distance=function(n,t,e,i,p,l){if(null==l&&(l=1e100),0==n.type&&0==t.type){var r,o=n.circle,a=t.circle,s=0,_=0,s=a.worldCOMx-o.worldCOMx,_=a.worldCOMy-o.worldCOMy,h=Math.sqrt(s*s+_*_),u=h-(o.radius+a.radius);return u<l&&(0==h?(s=1,_=0):(s*=r=1/h,_*=r),r=o.radius,e.x=o.worldCOMx+s*r,e.y=o.worldCOMy+_*r,r=-a.radius,i.x=a.worldCOMx+s*r,i.y=a.worldCOMy+_*r,p.x=s,p.y=_),u}s=!1;if(0==n.type&&1==t.type&&(x=n,n=t,t=x,d=e,e=i,i=d,s=!0),1==n.type&&0==t.type){for(var x,d,_=n.polygon,y=t.circle,z=-1e100,c=null,v=_.edges.head;null!=v;){var m=v.elt,f=m.gnormx*y.worldCOMx+m.gnormy*y.worldCOMy-m.gprojection-y.radius;if(l<f){z=f;break}0<f?z<f&&(z=f,c=m):z<0&&z<f&&(z=f,c=m),v=v.next}return z<l&&(u=c.gp0,W=c.gp1,(G=y.worldCOMy*c.gnormx-y.worldCOMx*c.gnormy)<=u.y*c.gnormx-u.x*c.gnormy?(d=x=0,x=y.worldCOMx-u.x,d=y.worldCOMy-u.y,(z=(_=Math.sqrt(x*x+d*d))-y.radius)<l&&(0==_?(x=1,d=0):(x*=_=1/_,d*=_),e.x=u.x+0*x,e.y=u.y+0*d,u=-y.radius,i.x=y.worldCOMx+x*u,i.y=y.worldCOMy+d*u,p.x=x,p.y=d)):G>=W.y*c.gnormx-W.x*c.gnormy?(Q=$=0,$=y.worldCOMx-W.x,Q=y.worldCOMy-W.y,(z=(q=Math.sqrt($*$+Q*Q))-y.radius)<l&&(0==q?($=1,Q=0):($*=U=1/q,Q*=U),e.x=W.x+0*$,e.y=W.y+0*Q,H=-y.radius,i.x=y.worldCOMx+$*H,i.y=y.worldCOMy+Q*H,p.x=$,p.y=Q)):(tn=-y.radius,i.x=y.worldCOMx+c.gnormx*tn,i.y=y.worldCOMy+c.gnormy*tn,en=-z,e.x=i.x+c.gnormx*en,e.y=i.y+c.gnormy*en,p.x=c.gnormx,p.y=c.gnormy)),s&&(p.x=-p.x,p.y=-p.y),z}for(var b=n.polygon,g=t.polygon,w=-1e100,M=null,C=null,k=0,O=b.edges.head;null!=O;){for(var P=O.elt,S=1e100,A=g.gverts.next;null!=A;){var j=P.gnormx*A.x+P.gnormy*A.y;j<S&&(S=j),A=A.next}if(l<(S-=P.gprojection)){w=S;break}0<S?w<S&&(w=S,M=P,k=1):w<0&&w<S&&(w=S,M=P,k=1),O=O.next}if(w<l){for(var E,I=g.edges.head;null!=I;){for(var T=I.elt,N=1e100,L=b.gverts.next;null!=L;){var V=T.gnormx*L.x+T.gnormy*L.y;V<N&&(N=V),L=L.next}if(l<(N-=T.gprojection)){w=N;break}0<N?w<N&&(w=N,C=T,k=2):w<0&&w<N&&(w=N,C=T,k=2),I=I.next}if(w<l){1==k?(rn=g,E=M):(rn=b,E=C,pn=e,e=i,i=pn,s=!s);for(var D=null,F=1e100,R=rn.edges.head;null!=R;){var Z=R.elt,B=E.gnormx*Z.gnormx+E.gnormy*Z.gnormy;B<F&&(F=B,D=Z),R=R.next}if(s?(p.x=-E.gnormx,p.y=-E.gnormy):(p.x=E.gnormx,p.y=E.gnormy),0<=w){var G=E.gp0,q=E.gp1,U=D.gp0,K=D.gp1,W=0,Y=0,J=0,X=0,H=1/((W=q.x-G.x)*W+(Y=q.y-G.y)*Y),$=1/((J=K.x-U.x)*J+(X=K.y-U.y)*X),Q=-(W*(G.x-U.x)+Y*(G.y-U.y))*H,nn=-(W*(G.x-K.x)+Y*(G.y-K.y))*H,tn=-(J*(U.x-G.x)+X*(U.y-G.y))*$,en=-(J*(U.x-q.x)+X*(U.y-q.y))*$;Q<0?Q=0:1<Q&&(Q=1),nn<0?nn=0:1<nn&&(nn=1),tn<0?tn=0:1<tn&&(tn=1),en<0?en=0:1<en&&(en=1);var n=0,t=0,n=G.x+W*Q,t=G.y+Y*Q,pn=0,ln=0,pn=G.x+W*nn,ln=G.y+Y*nn,rn=0,H=0,rn=U.x+J*tn,H=U.y+X*tn,$=0,Q=0,$=U.x+J*en,Q=U.y+X*en,W=0,Y=0,nn=(W=n-U.x)*W+(Y=t-U.y)*Y,tn=0,J=0,X=(tn=pn-K.x)*tn+(J=ln-K.y)*J,en=0,W=0,Y=(en=rn-G.x)*en+(W=H-G.y)*W,tn=0,J=0,en=(tn=$-q.x)*tn+(J=Q-q.y)*J,W=0,tn=0,J=null;nn<X?(W=n,tn=t,J=U):(W=pn,tn=ln,J=K,nn=X);ln=0,K=0,X=null;return Y<en?(ln=rn,K=H,X=G):(ln=$,K=Q,X=q,Y=en),0!=(w=nn<Y?(e.x=W,e.y=tn,i.x=J.x,i.y=J.y,Math.sqrt(nn)):(i.x=ln,i.y=K,e.x=X.x,e.y=X.y,Math.sqrt(Y)))&&(p.x=i.x-e.x,p.y=i.y-e.y,on=1/w,p.x*=on,p.y*=on,s&&(p.x=-p.x,p.y=-p.y)),w}var J=0,nn=0,J=D.gp0.x,nn=D.gp0.y,ln=0,K=0,X=0,Y=0,X=(ln=D.gp1.x)-J,Y=(K=D.gp1.y)-nn,on=E.gnormy*J-E.gnormx*nn,s=E.gnormy*ln-E.gnormx*K,p=1/(s-on),on=(-E.tp1-on)*p;on>jp.epsilon&&(J+=X*on,nn+=Y*on);p=(-E.tp0-s)*p;p<-jp.epsilon&&(ln+=X*p,K+=Y*p);Y=J*E.gnormx+nn*E.gnormy-E.gprojection,p=ln*E.gnormx+K*E.gnormy-E.gprojection;if(Y<p){i.x=J,i.y=nn;nn=-Y;return e.x=i.x+E.gnormx*nn,e.y=i.y+E.gnormy*nn,Y}i.x=ln,i.y=K;K=-p;return e.x=i.x+E.gnormx*K,e.y=i.y+E.gnormy*K,p}return l}return l},Tt.prototype.__class__=Tt;var Nt=zpp_nape.geom.ZPP_PartitionPair=function(){this.node=null,this.di=0,this.id=0,this.b=null,this.a=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null};Nt.__name__=["zpp_nape","geom","ZPP_PartitionPair"],Nt.get=function(n,t){var e;return null==Nt.zpp_pool?e=new Nt:(e=Nt.zpp_pool,Nt.zpp_pool=e.next,e.next=null),e.a=n,e.b=t,n.id<t.id?(e.id=n.id,e.di=t.id):(e.id=t.id,e.di=n.id),e},Nt.edge_swap=function(n,t){var e=n.node;n.node=t.node,t.node=e},Nt.edge_lt=function(n,t){return!(n.id>=t.id)||n.id==t.id&&n.di<t.di},Nt.prototype.next=null,Nt.prototype.elem=function(){return this},Nt.prototype.begin=function(){return this.next},Nt.prototype._inuse=null,Nt.prototype.modified=null,Nt.prototype.pushmod=null,Nt.prototype.length=null,Nt.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},Nt.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Nt.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Nt.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},Nt.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Nt.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Nt.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Nt.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Nt.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},Nt.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},Nt.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Nt.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Nt.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Nt.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Nt.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Nt.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Nt.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Nt.prototype.clear=function(){},Nt.prototype.inlined_clear=function(){},Nt.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},Nt.prototype.empty=function(){return null==this.next},Nt.prototype.size=function(){return this.length},Nt.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Nt.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Nt.prototype.front=function(){return this.next},Nt.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},Nt.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},Nt.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n:null},Nt.prototype.free=function(){this.a=this.b=null,this.node=null},Nt.prototype.alloc=function(){},Nt.prototype.a=null,Nt.prototype.b=null,Nt.prototype.id=null,Nt.prototype.di=null,Nt.prototype.node=null,Nt.prototype.__class__=Nt;var Vt=zpp_nape.geom.ZPP_Triangular=function(){};Vt.__name__=["zpp_nape","geom","ZPP_Triangular"],Vt.lt=function(n,t){return n.y<t.y||n.y==t.y&&n.x<t.x},Vt.right_turn=function(n,t,e){var i=e.x-t.x,p=e.y-t.y,e=0,e=t.x-n.x;return(t.y-n.y)*i-e*p},Vt.delaunay=function(n,t,e,i){var p=0,l=0,r=0,p=e.x-t.x,l=e.y-t.y,r=t.x-n.x,o=0<=(t.y-n.y)*p-r*l||(p=i.x-e.x,l=i.y-e.y,r=e.x-t.x,0<=(e.y-t.y)*p-r*l),o=!!o||(p=n.x-i.x,l=n.y-i.y,r=i.x-e.x,0<=(i.y-e.y)*p-r*l),l=!!o||(p=t.x-n.x,l=t.y-n.y,r=n.x-i.x,0<=(n.y-i.y)*p-r*l);return!!l||0<t.x*(e.y*i.mag-e.mag*i.y)-e.x*(t.y*i.mag-t.mag*i.y)+i.x*(t.y*e.mag-t.mag*e.y)-(n.x*(e.y*i.mag-e.mag*i.y)-e.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*e.mag-n.mag*e.y))+(n.x*(t.y*i.mag-t.mag*i.y)-t.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*t.mag-n.mag*t.y))-(n.x*(t.y*e.mag-t.mag*e.y)-t.x*(n.y*e.mag-n.mag*e.y)+e.x*(n.y*t.mag-n.mag*t.y))},Vt.optimise=function(n){var t,e=n.vertices,i=n.vertices;if(null!=e)for(var p=e;;){var l=p;if(l.sort(),l.mag=l.x*l.x+l.y*l.y,(p=p.next)==i)break}null==Vt.edgeSet&&(null==Zi.zpp_pool?Vt.edgeSet=new Zi:(Vt.edgeSet=Zi.zpp_pool,Zi.zpp_pool=Vt.edgeSet.next,Vt.edgeSet.next=null),Vt.edgeSet.lt=Nt.edge_lt,Vt.edgeSet.swapped=Nt.edge_swap),null==Nt.zpp_pool?t=new Nt:(t=Nt.zpp_pool,Nt.zpp_pool=t.next,t.next=null);var e=n.vertices,r=n.vertices;if(null!=e)for(var o=e;;){var a=o,s=a.next;a.diagonals.reverse();for(var _=a.diagonals.head;null!=_;){var h,u,x=_.elt;x.id<a.id?(s=x,_=_.next):(Vt.delaunay(a,s,x,null==_.next?a.prev:_.next.elt)||(null==Nt.zpp_pool?h=new Nt:(h=Nt.zpp_pool,Nt.zpp_pool=h.next,h.next=null),h.a=a,h.b=x,a.id<x.id?(h.id=a.id,h.di=x.id):(h.id=x.id,h.di=a.id),u=h,t.add(u),u.node=Vt.edgeSet.insert(u)),s=x,_=_.next)}if((o=o.next)==r)break}for(;null!=t.next;){for(var d=t.pop_unsafe(),y=d.a,z=d.b,c=y.next,v=null,m=y.diagonals.head;null!=m;){var f=m.elt;if(f==z){v=null==(m=m.next)?y.prev:m.elt;break}c=f,m=m.next}if(y.diagonals.remove(z),z.diagonals.remove(y),z==c.next)c.diagonals.add(v);else for(var b=c.diagonals.head;null!=b;){if(b.elt==z){c.diagonals.insert(b,v);break}b=b.next}if(y==v.next)v.diagonals.add(c);else for(var g=v.diagonals.head;null!=g;){if(g.elt==y){v.diagonals.insert(g,c);break}g=g.next}Vt.edgeSet.remove_node(d.node),d.a=d.b=null,d.node=null,d.next=Nt.zpp_pool,Nt.zpp_pool=d}e=t;e.a=e.b=null,e.node=null,e.next=Nt.zpp_pool,Nt.zpp_pool=e},Vt.triangulate=function(n){var t=n.vertices,e=n.vertices,i=n.vertices.next,p=n.vertices;if(null!=i)for(var l=i;;)if((l.y<t.y||l.y==t.y&&l.x<t.x)&&(t=l),(e.y<l.y||e.y==l.y&&e.x<l.x)&&(e=l),(l=l.next)==p)break;null==Vt.queue&&(Vt.queue=new Me);var r=e.prev,o=e.next;for(Vt.queue.add(e);r!=t||o!=t;)r==t||o!=t&&(r.y<o.y||r.y==o.y&&r.x<o.x)?(Vt.queue.add(o),o.rightchain=!1,o=o.next):(Vt.queue.add(r),r.rightchain=!0,r=r.prev);Vt.queue.add(t),null==Vt.stack&&(Vt.stack=new Me),Vt.stack.add(Vt.queue.pop_unsafe());var a=Vt.queue.pop_unsafe();for(Vt.stack.add(a);;){var s=Vt.queue.pop_unsafe();if(null==Vt.queue.head)break;if(s.rightchain!=Vt.stack.head.elt.rightchain){for(;;){var _=Vt.stack.pop_unsafe();if(null==Vt.stack.head)break;n.add_diagonal(_,s)}Vt.stack.add(a)}else{for(var h=Vt.stack.pop_unsafe();null!=Vt.stack.head;){var u=Vt.stack.head.elt,x=s.x-h.x,d=s.y-h.y,y=h.x-u.x,d=(h.y-u.y)*x-y*d;if(s.rightchain&&0<=d||!s.rightchain&&d<=0)break;n.add_diagonal(u,s),h=u,Vt.stack.pop()}Vt.stack.add(h)}Vt.stack.add(s),a=s}if(null!=Vt.stack.head)for(Vt.stack.pop();null!=Vt.stack.head;){var z=Vt.stack.pop_unsafe();if(null==Vt.stack.head)break;n.add_diagonal(e,z)}return n},Vt.prototype.__class__=Vt;var Ip=zpp_nape.geom.ZPP_Vec2=function(){this.y=0,this.x=0,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.weak=!1,this.outer=null,this._isimmutable=null,this._immutable=!1,this._validate=null,this._invalidate=null};Ip.__name__=["zpp_nape","geom","ZPP_Vec2"],Ip.get=function(n,t,e){var i;return null==e&&(e=!1),null==Ip.zpp_pool?i=new Ip:(i=Ip.zpp_pool,Ip.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=e,i.x=n,i.y=t,i},Ip.prototype._invalidate=null,Ip.prototype._validate=null,Ip.prototype.validate=function(){null!=this._validate&&this._validate()},Ip.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},Ip.prototype._immutable=null,Ip.prototype._isimmutable=null,Ip.prototype.immutable=function(){},Ip.prototype.outer=null,Ip.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new Cn,null!=(n=this.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n,this.outer.zpp_inner=this),this.outer},Ip.prototype.weak=null,Ip.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this._isimmutable=null,this._validate=null,this._invalidate=null},Ip.prototype.alloc=function(){this.weak=!1},Ip.prototype.next=null,Ip.prototype.elem=function(){return this},Ip.prototype.begin=function(){return this.next},Ip.prototype._inuse=null,Ip.prototype.modified=null,Ip.prototype.pushmod=null,Ip.prototype.length=null,Ip.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},Ip.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Ip.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Ip.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},Ip.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Ip.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},Ip.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Ip.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Ip.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},Ip.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},Ip.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ip.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ip.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ip.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ip.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Ip.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},Ip.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ip.prototype.clear=function(){},Ip.prototype.inlined_clear=function(){},Ip.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},Ip.prototype.empty=function(){return null==this.next},Ip.prototype.size=function(){return this.length},Ip.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Ip.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},Ip.prototype.front=function(){return this.next},Ip.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},Ip.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},Ip.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n:null},Ip.prototype.x=null,Ip.prototype.y=null,Ip.prototype.copy=function(){var n,t=this.x,e=this.y;return null==Ip.zpp_pool?n=new Ip:(n=Ip.zpp_pool,Ip.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=!1,n.x=t,n.y=e,n},Ip.prototype.toString=function(){return"{ x: "+this.x+" y: "+this.y+" }"},Ip.prototype.__class__=Ip;var Ft=zpp_nape.geom.ZPP_Vec3=function(){this._validate=null,this.immutable=!1,this.z=0,this.y=0,this.x=0,this.outer=null,this.immutable=!1,this._validate=null};Ft.__name__=["zpp_nape","geom","ZPP_Vec3"],Ft.prototype.outer=null,Ft.prototype.x=null,Ft.prototype.y=null,Ft.prototype.z=null,Ft.prototype.immutable=null,Ft.prototype._validate=null,Ft.prototype.validate=function(){null!=this._validate&&this._validate()},Ft.prototype.__class__=Ft,(l=zpp_nape.geom.ZPP_VecMath=function(){}).__name__=["zpp_nape","geom","ZPP_VecMath"],l.vec_dsq=function(n,t,e,i){var p=0,l=0;return(p=n-e)*p+(l=t-i)*l},l.vec_distance=function(n,t,e,i){var p=n-e,l=t-i;return Math.sqrt(p*p+l*l)},l.prototype.__class__=l;var Qi=zpp_nape.phys.ZPP_Interactor=function(){this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.group=null,this.cbsets=null,this.icompound=null,this.ibody=null,this.ishape=null,this.userData=null,this.id=0,this.outer_i=null,this.id=fn.Interactor(),this.cbsets=new he,this.cbTypes=new In};Qi.__name__=["zpp_nape","phys","ZPP_Interactor"],Qi.get=function(n,t){for(var e=(n.id<t.id?n:t).id,i=(n.id<t.id?t:n).id,p=null,l=(n.cbsets.length<t.cbsets.length?n:t).cbsets.head;null!=l;){var r=l.elt;if(r.id==e&&r.di==i){p=r;break}l=l.next}return p},Qi.int_callback=function(n,t,e){var i=n.int1,p=n.int2,l=t.options1,n=i.cbTypes;!(!l.nonemptyintersection(n,l.includes)||l.nonemptyintersection(n,l.excludes))&&(l=t.options2,t=p.cbTypes,!!l.nonemptyintersection(t,l.includes)&&!l.nonemptyintersection(t,l.excludes))?(e.int1=i,e.int2=p):(e.int1=p,e.int2=i)},Qi.prototype.outer_i=null,Qi.prototype.id=null,Qi.prototype.userData=null,Qi.prototype.ishape=null,Qi.prototype.ibody=null,Qi.prototype.icompound=null,Qi.prototype.isShape=function(){return null!=this.ishape},Qi.prototype.isBody=function(){return null!=this.ibody},Qi.prototype.isCompound=function(){return null!=this.icompound},Qi.prototype.__iaddedToSpace=function(){null!=this.group&&this.group.interactors.add(this);for(var n=this.cbTypes.head;null!=n;)n.elt.interactors.add(this),n=n.next;this.alloc_cbSet()},Qi.prototype.__iremovedFromSpace=function(){null!=this.group&&this.group.interactors.remove(this);for(var n=this.cbTypes.head;null!=n;)n.elt.interactors.remove(this),n=n.next;this.dealloc_cbSet()},Qi.prototype.wake=function(){var n;null!=this.ishape?null!=(n=this.ishape.body)&&null!=n.space&&n.space.non_inlined_wake(n):null!=this.ibody?null!=this.ibody.space&&this.ibody.space.non_inlined_wake(this.ibody):null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound)},Qi.prototype.cbsets=null,Qi.prototype.getSpace=function(){return null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space},Qi.prototype.group=null,Qi.prototype.cbTypes=null,Qi.prototype.cbSet=null,Qi.prototype.wrap_cbTypes=null,Qi.prototype.setupcbTypes=function(){this.wrap_cbTypes=Oi.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=X(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=X(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},Qi.prototype.wrap_cbTypes_subber=function(n){var t=n.zpp_inner;this.cbTypes.has(t)&&(null!=(n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space)&&(this.dealloc_cbSet(),t.interactors.remove(this)),this.cbTypes.remove(t),null!=n&&(this.alloc_cbSet(),this.wake()))},Qi.prototype.wrap_cbTypes_adder=function(n){return this.insert_cbtype(n.zpp_inner),!1},Qi.prototype.insert_cbtype=function(n){if(!this.cbTypes.has(n)){var t=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space;null!=t&&(this.dealloc_cbSet(),n.interactors.add(this));for(var e=null,i=this.cbTypes.head;null!=i&&!(n.id<i.elt.id);)i=(e=i).next;var p=this.cbTypes;null==Ge.zpp_pool?l=new Ge:(l=Ge.zpp_pool,Ge.zpp_pool=l.next,l.next=null),l.elt=n;var l=l;null==e?(l.next=p.head,p.head=l):(l.next=e.next,e.next=l),p.pushmod=p.modified=!0,p.length++,null!=t&&(this.alloc_cbSet(),this.wake())}},Qi.prototype.alloc_cbSet=function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space;null!=(this.cbSet=n.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),n.freshInteractorType(this))},Qi.prototype.dealloc_cbSet=function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space;if(null!=this.cbSet){if(this.cbSet.interactors.remove(this),n.nullInteractorType(this),0==--this.cbSet.count){n.cbsets.remove(this.cbSet);var t=this.cbSet;for(t.listeners.clear(),t.zip_listeners=!0,t.bodylisteners.clear(),t.zip_bodylisteners=!0,t.conlisteners.clear(),t.zip_conlisteners=!0;null!=t.cbTypes.head;)t.cbTypes.pop_unsafe().cbsets.remove(t);t.next=Ki.zpp_pool,Ki.zpp_pool=t}this.cbSet=null}},Qi.prototype.setGroup=function(n){var t;this.group!=n&&((t=null!=(null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:(null!=this.ibody?this.ibody:this.icompound).space))&&null!=this.group&&this.group.interactors.remove(this),this.group=n,t&&null!=n&&n.interactors.add(this),t&&(null!=this.ishape?this.ishape.body:null!=this.ibody?this.ibody:this.icompound).wake())},Qi.prototype.immutable_midstep=function(n){null==this.ibody&&(null!=this.ishape?this.ishape.__immutable_midstep(n):this.icompound.__imutable_midstep(n))},Qi.prototype.lookup_group=function(){for(var n=this;null!=n&&null==n.group;)n=null!=n.ishape?n.ishape.body:(null!=n.icompound?n.icompound:n.ibody).compound;return null==n?null:n.group},Qi.prototype.copyto=function(n){n.zpp_inner_i.group=this.group;var t=this.outer_i;null==t.zpp_inner_i.wrap_cbTypes&&t.zpp_inner_i.setupcbTypes();t=t.zpp_inner_i.wrap_cbTypes;t.zpp_inner.valmod();for(var e=qn.get(t);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p=i.zpp_inner.user_length;if(e.zpp_critical=!0,!(e.zpp_i<p||(e.zpp_next=qn.zpp_pool,(qn.zpp_pool=e).zpp_inner=null,!1)))break;e.zpp_critical=!1;i=e.zpp_inner.at(e.zpp_i++);null==n.zpp_inner_i.wrap_cbTypes&&n.zpp_inner_i.setupcbTypes();p=n.zpp_inner_i.wrap_cbTypes;p.zpp_inner.reverse_flag?p.push(i):p.unshift(i)}null!=this.userData&&(n.zpp_inner_i.userData=a.copy(this.userData))},Qi.prototype.__class__=Qi;var Rt=zpp_nape.phys.ZPP_Body=function(){var n;this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_aabb=!1,this.aabb=null,this.norotate=!1,this.sinertia=0,this.iinertia=0,this.cinertia=0,this.zip_inertia=!1,this.inertia=0,this.inertiaMode=0,this.zip_gravMassScale=!1,this.gravMassScale=0,this.gravMassMode=0,this.zip_gravMass=!1,this.gravMass=0,this.nomove=!1,this.cmass=0,this.smass=0,this.imass=0,this.massMode=0,this.zip_mass=!1,this.mass=0,this.zip_axis=!1,this.axisy=0,this.axisx=0,this.rot=0,this.pre_rot=0,this.kinangvel=0,this.torque=0,this.angvel=0,this.wrapcvel=null,this.wrap_svel=null,this.svely=0,this.svelx=0,this.wrap_kinvel=null,this.kinvely=0,this.kinvelx=0,this.wrap_force=null,this.forcey=0,this.forcex=0,this.wrap_vel=null,this.vely=0,this.velx=0,this.wrap_pos=null,this.posy=0,this.posx=0,this.pre_posy=0,this.pre_posx=0,this.disableCCD=!1,this.bulletEnabled=!1,this.bullet=!1,this.sweepRadius=0,this.sweepFrozen=!1,this.sweep_angvel=0,this.sweepTime=0,this.graph_depth=0,this.component=null,this.wrap_constraints=null,this.constraints=null,this.wrap_arbiters=null,this.arbiters=null,this.space=null,this.wrap_shapes=null,this.shapes=null,this.compound=null,this.type=0,this.world=!1,this.outer=null,Qi.call(this),(this.ibody=this).world=!1,this.bulletEnabled=!1,this.sweepTime=0,this.sweep_angvel=0,this.norotate=this.nomove=!1,this.disableCCD=!1,this.posx=0,this.posy=0,this.rot=0,this.axisx=0,this.axisy=1,this.svelx=0,this.svely=0,this.velx=0,this.vely=0,this.kinvelx=0,this.kinvely=0,this.forcex=0,this.forcey=0,this.torque=this.angvel=this.kinangvel=0,this.pre_posx=1/0,this.pre_posy=1/0,this.pre_rot=1/0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.zip_aabb=!0,null==Lt.zpp_pool?n=new Lt:(n=Lt.zpp_pool,Lt.zpp_pool=n.next,n.next=null),n.minx=0,n.miny=0,n.maxx=0,n.maxy=0,this.aabb=n,this.aabb._immutable=!0,this.aabb._validate=X(this,this.aabb_validate),this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.arbiters=new fe,this.constraints=new kn,this.shapes=new ue,this.wrap_shapes=Ii.get(this.shapes),this.wrap_shapes.zpp_inner.adder=X(this,this.shapes_adder),this.wrap_shapes.zpp_inner.subber=X(this,this.shapes_subber),this.wrap_shapes.zpp_inner._invalidate=X(this,this.shapes_invalidate),this.kinematicDelaySleep=!1};Rt.__name__=["zpp_nape","phys","ZPP_Body"],Rt.__super__=Qi,Rt.prototype=Object.create(Qi.prototype),Rt.bodysetlt=function(n,t){return n.id<t.id},Rt.__static=function(){null==Yi.BodyType_STATIC&&(Yi.internal=!0,Yi.BodyType_STATIC=new tn,Yi.internal=!1);var n=new Q(Yi.BodyType_STATIC),t=n.zpp_inner;return t.world=!0,t.wrap_shapes.zpp_inner.immutable=!0,t.smass=t.imass=t.cmass=t.mass=t.gravMass=0,t.sinertia=t.iinertia=t.cinertia=t.inertia=0,t.cbTypes.clear(),n},Rt.prototype.outer=null,Rt.prototype.world=null,Rt.prototype.type=null,Rt.prototype.isStatic=function(){return 1==this.type},Rt.prototype.isDynamic=function(){return 2==this.type},Rt.prototype.isKinematic=function(){return 3==this.type},Rt.prototype.invalidate_type=function(){this.invalidate_mass(),this.invalidate_inertia()},Rt.prototype.compound=null,Rt.prototype.shapes=null,Rt.prototype.wrap_shapes=null,Rt.prototype.invalidate_shapes=function(){this.zip_aabb=!0,this.zip_localCOM=!0,this.zip_worldCOM=!0,this.invalidate_mass(),this.invalidate_inertia()},Rt.prototype.space=null,Rt.prototype.arbiters=null,Rt.prototype.wrap_arbiters=null,Rt.prototype.constraints=null,Rt.prototype.wrap_constraints=null,Rt.prototype.component=null,Rt.prototype.graph_depth=null,Rt.prototype.init_bodysetlist=function(){null==Rt.bodyset&&(Rt.bodyset=new Di,Rt.bodyset.lt=Rt.bodysetlt,Rt.bodystack=new ve)},Rt.prototype.connectedBodies_cont=function(n){Rt.bodyset.try_insert_bool(n.zpp_inner)&&(Rt.bodystack.add(n.zpp_inner),n.zpp_inner.graph_depth=Rt.cur_graph_depth+1)},Rt.prototype.connectedBodies=function(n,t){null==Rt.bodyset&&(Rt.bodyset=new Di,Rt.bodyset.lt=Rt.bodysetlt,Rt.bodystack=new ve);var e=null==t?new nn:t;for(Rt.bodystack.add(this),Rt.bodyset.insert(this),this.graph_depth=0;null!=Rt.bodystack.head;){var i=Rt.bodystack.pop_unsafe();if(i.graph_depth!=n){Rt.cur_graph_depth=i.graph_depth;for(var p=i.constraints.head;null!=p;)p.elt.outer.visitBodies(X(this,this.connectedBodies_cont)),p=p.next}}t=Rt.bodyset;if(null!=t.parent){for(var l,r,o=t.parent;null!=o;)o=null!=o.prev?o.prev:null!=o.next?o.next:((l=o.data)!=this&&(r=l.outer,e.zpp_inner.reverse_flag?e.push(r):e.unshift(r)),null!=(l=o.parent)&&(o==l.prev?l.prev=null:l.next=null,o.parent=null),(r=o).data=null,r.lt=null,r.swapped=null,r.next=Di.zpp_pool,Di.zpp_pool=r,l);t.parent=null}return e},Rt.prototype.interactingBodies=function(n,t,e){null==Rt.bodyset&&(Rt.bodyset=new Di,Rt.bodyset.lt=Rt.bodysetlt,Rt.bodystack=new ve);var i=null==e?new nn:e;for(Rt.bodyset.insert(this),Rt.bodystack.add(this),this.graph_depth=0;null!=Rt.bodystack.head;){var p=Rt.bodystack.pop_unsafe();if(p.graph_depth!=t)for(var l=p.arbiters.head;null!=l;){var r=l.elt;0!=(r.type&n)&&(r=r.b1==p?r.b2:r.b1,Rt.bodyset.try_insert_bool(r)&&(Rt.bodystack.add(r),r.graph_depth=p.graph_depth+1)),l=l.next}}e=Rt.bodyset;if(null!=e.parent){for(var o,a,s=e.parent;null!=s;)s=null!=s.prev?s.prev:null!=s.next?s.next:((o=s.data)!=this&&(a=o.outer,i.zpp_inner.reverse_flag?i.push(a):i.unshift(a)),null!=(o=s.parent)&&(s==o.prev?o.prev=null:o.next=null,s.parent=null),(a=s).data=null,a.lt=null,a.swapped=null,a.next=Di.zpp_pool,Di.zpp_pool=a,o);e.parent=null}return i},Rt.prototype.atRest=function(n){if(2!=this.type)return this.component.sleeping;var t,e,i,p,l=jp.linearSleepThreshold;return l*=l,!(this.velx*this.velx+this.vely*this.vely>l)&&(t=this.posx,e=this.posy,p=i=0,!(.25*l*n*n<(i=t-this.pre_posx)*i+(p=e-this.pre_posy)*p)&&(p=e=0,e=(e=this.aabb.maxx-this.aabb.minx)*e+(p=this.aabb.maxy-this.aabb.miny)*p,p=jp.angularSleepThreshold,p*=p,!(4*this.angvel*this.angvel*e>p)&&!(p*n*n<(n=this.rot-this.pre_rot)*n*e)))||(this.component.waket=this.space.stamp),this.component.waket+jp.sleepDelay<this.space.stamp},Rt.prototype.refreshArbiters=function(){for(var n=this.arbiters.head;null!=n;)n.elt.invalidated=!0,n=n.next},Rt.prototype.sweepTime=null,Rt.prototype.sweep_angvel=null,Rt.prototype.sweepFrozen=null,Rt.prototype.sweepRadius=null,Rt.prototype.bullet=null,Rt.prototype.bulletEnabled=null,Rt.prototype.disableCCD=null,Rt.prototype.sweepIntegrate=function(n){var t,e,i=n-this.sweepTime;0!=i&&(this.sweepTime=n,this.posx+=this.velx*i,this.posy+=this.vely*i,0!=this.angvel&&(t=this.sweep_angvel*i,this.rot+=t,1e-4<t*t?(this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)):(n=1-(e=t*t)*e/8,e=((i=1-.5*e)*this.axisx+t*this.axisy)*n,this.axisy=(i*this.axisy-t*this.axisx)*n,this.axisx=e)))},Rt.prototype.sweepValidate=function(n){if(0==n.type)n.worldCOMx=this.posx+(this.axisy*n.localCOMx-this.axisx*n.localCOMy),n.worldCOMy=this.posy+(n.localCOMx*this.axisx+n.localCOMy*this.axisy);else{for(var t=n.polygon,e=t.lverts.next,i=t.gverts.next;null!=i;){var p=i,l=e,e=e.next;p.x=this.posx+(this.axisy*l.x-this.axisx*l.y),p.y=this.posy+(l.x*this.axisx+l.y*this.axisy),i=i.next}for(var r=t.edges.head,o=a=t.gverts.next,a=a.next;null!=a;){var s=a,_=r.elt,r=r.next;_.gnormx=this.axisy*_.lnormx-this.axisx*_.lnormy,_.gnormy=_.lnormx*this.axisx+_.lnormy*this.axisy,_.gprojection=this.posx*_.gnormx+this.posy*_.gnormy+_.lprojection,_.tp0=o.y*_.gnormx-o.x*_.gnormy,_.tp1=s.y*_.gnormx-s.x*_.gnormy,o=s,a=a.next}n=t.gverts.next,t=r.elt;t.gnormx=this.axisy*t.lnormx-this.axisx*t.lnormy,t.gnormy=t.lnormx*this.axisx+t.lnormy*this.axisy,t.gprojection=this.posx*t.gnormx+this.posy*t.gnormy+t.lprojection,t.tp0=o.y*t.gnormx-o.x*t.gnormy,t.tp1=n.y*t.gnormx-n.x*t.gnormy}},Rt.prototype.pre_posx=null,Rt.prototype.pre_posy=null,Rt.prototype.posx=null,Rt.prototype.posy=null,Rt.prototype.wrap_pos=null,Rt.prototype.velx=null,Rt.prototype.vely=null,Rt.prototype.wrap_vel=null,Rt.prototype.forcex=null,Rt.prototype.forcey=null,Rt.prototype.wrap_force=null,Rt.prototype.kinvelx=null,Rt.prototype.kinvely=null,Rt.prototype.wrap_kinvel=null,Rt.prototype.svelx=null,Rt.prototype.svely=null,Rt.prototype.wrap_svel=null,Rt.prototype.invalidate_pos=function(){for(var n=this.shapes.head;null!=n;){var t=n.elt;1==t.type&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},Rt.prototype.pos_invalidate=function(n){if(this.immutable_midstep("Body::position"),this.posx!=n.x||this.posy!=n.y){this.posx=n.x,this.posy=n.y;for(var t=this.shapes.head;null!=t;){var e=t.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0,this.wake()}},Rt.prototype.pos_validate=function(){this.wrap_pos.zpp_inner.x=this.posx,this.wrap_pos.zpp_inner.y=this.posy},Rt.prototype.vel_invalidate=function(n){this.velx=n.x,this.vely=n.y,this.wake()},Rt.prototype.vel_validate=function(){this.wrap_vel.zpp_inner.x=this.velx,this.wrap_vel.zpp_inner.y=this.vely},Rt.prototype.kinvel_invalidate=function(n){this.kinvelx=n.x,this.kinvely=n.y,this.wake()},Rt.prototype.kinvel_validate=function(){this.wrap_kinvel.zpp_inner.x=this.kinvelx,this.wrap_kinvel.zpp_inner.y=this.kinvely},Rt.prototype.svel_invalidate=function(n){this.svelx=n.x,this.svely=n.y,this.wake()},Rt.prototype.svel_validate=function(){this.wrap_svel.zpp_inner.x=this.svelx,this.wrap_svel.zpp_inner.y=this.svely},Rt.prototype.force_invalidate=function(n){this.forcex=n.x,this.forcey=n.y,this.wake()},Rt.prototype.force_validate=function(){this.wrap_force.zpp_inner.x=this.forcex,this.wrap_force.zpp_inner.y=this.forcey},Rt.prototype.setupPosition=function(){var n,t,e=this.posx,i=this.posy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_pos=n,this.wrap_pos.zpp_inner._inuse=!0,this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=X(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=X(this,this.pos_validate))},Rt.prototype.setupVelocity=function(){var n,t,e=this.velx,i=this.vely;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_vel=n,this.wrap_vel.zpp_inner._inuse=!0,this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=X(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=X(this,this.vel_validate))},Rt.prototype.setupkinvel=function(){var n,t,e=this.kinvelx,i=this.kinvely;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_kinvel=n,this.wrap_kinvel.zpp_inner._inuse=!0,this.world?this.wrap_kinvel.zpp_inner._immutable=!0:(this.wrap_kinvel.zpp_inner._invalidate=X(this,this.kinvel_invalidate),this.wrap_kinvel.zpp_inner._validate=X(this,this.kinvel_validate))},Rt.prototype.setupsvel=function(){var n,t,e=this.svelx,i=this.svely;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_svel=n,this.wrap_svel.zpp_inner._inuse=!0,this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=X(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=X(this,this.svel_validate))},Rt.prototype.setupForce=function(){var n,t,e=this.forcex,i=this.forcey;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_force=n,this.wrap_force.zpp_inner._inuse=!0,this.world?this.wrap_force.zpp_inner._immutable=!0:(this.wrap_force.zpp_inner._invalidate=X(this,this.force_invalidate),this.wrap_force.zpp_inner._validate=X(this,this.force_validate))},Rt.prototype.cvel_validate=function(){this.wrapcvel.zpp_inner.x=this.velx+this.kinvelx,this.wrapcvel.zpp_inner.y=this.vely+this.kinvely,this.wrapcvel.zpp_inner.z=this.angvel+this.kinangvel},Rt.prototype.wrapcvel=null,Rt.prototype.setup_cvel=function(){this.wrapcvel=J.get(),this.wrapcvel.zpp_inner.immutable=!0,this.wrapcvel.zpp_inner._validate=X(this,this.cvel_validate)},Rt.prototype.angvel=null,Rt.prototype.torque=null,Rt.prototype.kinangvel=null,Rt.prototype.pre_rot=null,Rt.prototype.rot=null,Rt.prototype.invalidate_rot=function(){this.zip_axis=!0;for(var n=this.shapes.head;null!=n;){var t=n.elt;1==t.type&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},Rt.prototype.axisx=null,Rt.prototype.axisy=null,Rt.prototype.zip_axis=null,Rt.prototype.validate_axis=function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot))},Rt.prototype.quick_validate_axis=function(){this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)},Rt.prototype.delta_rot=function(n){var t,e,i;this.rot+=n,1e-4<n*n?(this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)):(e=1-(i=n*n)*i/8,i=((t=1-.5*i)*this.axisx+n*this.axisy)*e,this.axisy=(t*this.axisy-n*this.axisx)*e,this.axisx=i)},Rt.prototype.kinematicDelaySleep=null,Rt.prototype.mass=null,Rt.prototype.zip_mass=null,Rt.prototype.massMode=null,Rt.prototype.imass=null,Rt.prototype.smass=null,Rt.prototype.cmass=null,Rt.prototype.nomove=null,Rt.prototype.invalidate_mass=function(){this.zip_mass=!0,this.invalidate_gravMass()},Rt.prototype.validate_mass=function(){if(this.zip_mass||(this.massMode,0)){if(this.zip_mass=!1,0==this.massMode){this.cmass=0;for(var n=this.shapes.head;null!=n;){var t=n.elt;t.refmaterial.density=t.material.density,t.validate_area_inertia(),this.cmass+=t.area*t.material.density,n=n.next}}2!=this.type||this.nomove?(this.mass=1/0,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},Rt.prototype.gravMass=null,Rt.prototype.zip_gravMass=null,Rt.prototype.gravMassMode=null,Rt.prototype.gravMassScale=null,Rt.prototype.zip_gravMassScale=null,Rt.prototype.invalidate_gravMass=function(){1!=this.gravMassMode&&(this.zip_gravMass=!0),2!=this.gravMassMode&&(this.zip_gravMassScale=!0),this.wake()},Rt.prototype.validate_gravMass=function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),0==this.gravMassMode?(this.validate_mass(),this.gravMass=this.cmass):2==this.gravMassMode&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},Rt.prototype.invalidate_gravMassScale=function(){2!=this.gravMassMode?this.zip_gravMassScale=!0:this.invalidate_gravMass()},Rt.prototype.validate_gravMassScale=function(){this.zip_gravMassScale&&(this.zip_gravMassScale=!1,0==this.gravMassMode?this.gravMassScale=1:1==this.gravMassMode&&(this.validate_mass(),this.gravMassScale=this.gravMass/this.cmass))},Rt.prototype.inertiaMode=null,Rt.prototype.inertia=null,Rt.prototype.zip_inertia=null,Rt.prototype.cinertia=null,Rt.prototype.iinertia=null,Rt.prototype.sinertia=null,Rt.prototype.norotate=null,Rt.prototype.invalidate_inertia=function(){this.zip_inertia=!0,this.wake()},Rt.prototype.validate_inertia=function(){if(this.zip_inertia||(this.inertiaMode,0)){if(this.zip_inertia=!1,0==this.inertiaMode){this.cinertia=0;for(var n=this.shapes.head;null!=n;){var t=n.elt;t.refmaterial.density=t.material.density,t.validate_area_inertia(),this.cinertia+=t.inertia*t.area*t.material.density,n=n.next}}2!=this.type||this.norotate?(this.inertia=1/0,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},Rt.prototype.invalidate_wake=function(){this.wake()},Rt.prototype.aabb=null,Rt.prototype.zip_aabb=null,Rt.prototype.validate_aabb=function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var n=this.shapes.head;null!=n;){var t=n.elt;if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var e=t.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);h=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*h,i.localCOMy+=(_.y+u.y)*h;u=p=1/(3*p);i.localCOMx*=u,i.localCOMy*=u}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}h=e.body;h.zip_axis&&(h.zip_axis=!1,h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}u=e.radius,h=e.radius;e.aabb.minx=e.worldCOMx-u,e.aabb.miny=e.worldCOMy-h,e.aabb.maxx=e.worldCOMx+u,e.aabb.maxy=e.worldCOMy+h}else{var x=t.polygon;if(x.zip_gverts&&null!=x.body){x.zip_gverts=!1,x.validate_lverts();var d=x.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot));for(var y=x.lverts.next,z=x.gverts.next;null!=z;){var c=z,v=y,y=y.next;c.x=x.body.posx+(x.body.axisy*v.x-x.body.axisx*v.y),c.y=x.body.posy+(v.x*x.body.axisx+v.y*x.body.axisy),z=z.next}}d=x.gverts.next;x.aabb.minx=d.x,x.aabb.miny=d.y,x.aabb.maxx=d.x,x.aabb.maxy=d.y;for(var m=x.gverts.next.next;null!=m;){var f=m;f.x<x.aabb.minx&&(x.aabb.minx=f.x),f.x>x.aabb.maxx&&(x.aabb.maxx=f.x),f.y<x.aabb.miny&&(x.aabb.miny=f.y),f.y>x.aabb.maxy&&(x.aabb.maxy=f.y),m=m.next}}d=this.aabb,t=t.aabb;t.minx<d.minx&&(d.minx=t.minx),t.maxx>d.maxx&&(d.maxx=t.maxx),t.miny<d.miny&&(d.miny=t.miny),t.maxy>d.maxy&&(d.maxy=t.maxy),n=n.next}}},Rt.prototype.invalidate_aabb=function(){this.zip_aabb=!0},Rt.prototype.localCOMx=null,Rt.prototype.localCOMy=null,Rt.prototype.zip_localCOM=null,Rt.prototype.worldCOMx=null,Rt.prototype.worldCOMy=null,Rt.prototype.zip_worldCOM=null,Rt.prototype.wrap_localCOM=null,Rt.prototype.wrap_worldCOM=null,Rt.prototype.invalidate_localCOM=function(){this.zip_localCOM=!0,this.zip_worldCOM=!0},Rt.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0},Rt.prototype.validate_localCOM=function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var n,t=0,e=0,i=0,p=this.shapes.head;null!=p;){var l=p.elt;if(l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var r=l.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=r.lverts.next.next.x,r.localCOMy+=r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0;var o=r.localCOMy=0,a=r.lverts.next,s=a,_=a=a.next;for(a=a.next;null!=a;){var h=a;o+=_.x*(h.y-s.y);var u=h.y*_.x-h.x*_.y;r.localCOMx+=(_.x+h.x)*u,r.localCOMy+=(_.y+h.y)*u,s=_,_=h,a=a.next}var x=a=r.lverts.next;o+=_.x*(x.y-s.y);var d=x.y*_.x-x.x*_.y;r.localCOMx+=(_.x+x.x)*d,r.localCOMy+=(_.y+x.y)*d,s=_;var y=a=a.next;o+=x.x*(y.y-s.y);d=y.y*x.x-y.x*x.y;r.localCOMx+=(x.x+y.x)*d,r.localCOMy+=(x.y+y.y)*d;d=o=1/(3*o);r.localCOMx*=d,r.localCOMy*=d}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}l.validate_area_inertia();d=l.area*l.material.density;t+=l.localCOMx*d,e+=l.localCOMy*d,i+=l.area*l.material.density,p=p.next}0!=i&&(n=1/i,this.localCOMx=t*n,this.localCOMy=e*n),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy),this.zip_mass&&0==this.massMode&&(this.zip_mass=!1,this.cmass=i,2==this.type?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=1/0,this.imass=this.smass=0))}},Rt.prototype.validate_worldCOM=function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},Rt.prototype.getlocalCOM=function(){this.validate_localCOM()},Rt.prototype.getworldCOM=function(){this.validate_worldCOM()},Rt.prototype.__immutable_midstep=function(n){},Rt.prototype.clear=function(){for(;null!=this.shapes.head;){var n=this.shapes.pop_unsafe();n.removedFromBody(),n.body=null}this.invalidate_shapes(),this.pre_posx=0,this.pre_posy=0,this.posx=0,this.posy=0,this.velx=0,this.vely=0,this.forcex=0,this.forcey=0,this.kinvelx=0,this.kinvely=0,this.svelx=0,this.svely=0,this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=0;for(var t=this.shapes.head;null!=t;){var e=t.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0,this.zip_axis=!0;for(var i=this.shapes.head;null!=i;){var p=i.elt;1==p.type&&(p.polygon.invalidate_gverts(),p.polygon.invalidate_gaxi()),p.invalidate_worldCOM(),i=i.next}this.zip_worldCOM=!0,this.axisx=0,this.axisy=1,this.zip_axis=!1,this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.norotate=!1,this.nomove=!1},Rt.prototype.aabb_validate=function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var n=this.shapes.head;null!=n;){var t=n.elt;if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var e=t.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);h=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*h,i.localCOMy+=(_.y+u.y)*h;u=p=1/(3*p);i.localCOMx*=u,i.localCOMy*=u}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}h=e.body;h.zip_axis&&(h.zip_axis=!1,h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}u=e.radius,h=e.radius;e.aabb.minx=e.worldCOMx-u,e.aabb.miny=e.worldCOMy-h,e.aabb.maxx=e.worldCOMx+u,e.aabb.maxy=e.worldCOMy+h}else{var x=t.polygon;if(x.zip_gverts&&null!=x.body){x.zip_gverts=!1,x.validate_lverts();var d=x.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot));for(var y=x.lverts.next,z=x.gverts.next;null!=z;){var c=z,v=y,y=y.next;c.x=x.body.posx+(x.body.axisy*v.x-x.body.axisx*v.y),c.y=x.body.posy+(v.x*x.body.axisx+v.y*x.body.axisy),z=z.next}}d=x.gverts.next;x.aabb.minx=d.x,x.aabb.miny=d.y,x.aabb.maxx=d.x,x.aabb.maxy=d.y;for(var m=x.gverts.next.next;null!=m;){var f=m;f.x<x.aabb.minx&&(x.aabb.minx=f.x),f.x>x.aabb.maxx&&(x.aabb.maxx=f.x),f.y<x.aabb.miny&&(x.aabb.miny=f.y),f.y>x.aabb.maxy&&(x.aabb.maxy=f.y),m=m.next}}d=this.aabb,t=t.aabb;t.minx<d.minx&&(d.minx=t.minx),t.maxx>d.maxx&&(d.maxx=t.maxx),t.miny<d.miny&&(d.miny=t.miny),t.maxy>d.maxy&&(d.maxy=t.maxy),n=n.next}}},Rt.prototype.shapes_adder=function(n){return n.zpp_inner.body!=this&&(null!=n.zpp_inner.body&&n.zpp_inner.body.wrap_shapes.remove(n),n.zpp_inner.body=this,n.zpp_inner.addedToBody(),null!=this.space&&(t=this.space,(i=(e=n.zpp_inner).body).world||(i.component.waket=t.stamp+(t.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&t.really_wake(i,!1)),t.bphase.insert(e),e.addedToSpace()),1==n.zpp_inner.type&&(n.zpp_inner.polygon.invalidate_gaxi(),n.zpp_inner.polygon.invalidate_gverts()),!0);var t,e,i},Rt.prototype.shapes_subber=function(n){null!=this.space&&this.space.removed_shape(n.zpp_inner),n.zpp_inner.body=null,n.zpp_inner.removedFromBody()},Rt.prototype.shapes_invalidate=function(n){this.invalidate_shapes()},Rt.prototype.addedToSpace=function(){null==te.zpp_pool?this.component=new te:(this.component=te.zpp_pool,te.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!0,(this.component.body=this).__iaddedToSpace()},Rt.prototype.removedFromSpace=function(){for(;null!=this.arbiters.head;){var n=this.arbiters.pop_unsafe();if(n.cleared=!0,n.b2==this)for(var t,e,i=n.b1.arbiters,p=null,l=i.head;null!=l;){if(l.elt==n){null==p?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=p.next).next,null==(p.next=e)&&(i.pushmod=!0));var r=t;r.elt=null,r.next=tp.zpp_pool,tp.zpp_pool=r,i.modified=!0,i.length--,i.pushmod=!0;break}l=(p=l).next}if(n.b1==this)for(var o,a,s=n.b2.arbiters,_=null,h=s.head;null!=h;){if(h.elt==n){null==_?(a=(o=s.head).next,s.head=a,null==s.head&&(s.pushmod=!0)):(a=(o=_.next).next,null==(_.next=a)&&(s.pushmod=!0));var u=o;u.elt=null,u.next=tp.zpp_pool,tp.zpp_pool=u,s.modified=!0,s.length--,s.pushmod=!0;break}h=(_=h).next}null!=n.pair&&(n.pair.arb=null,n.pair=null),n.active=!1,this.space.f_arbiters.modified=!0}var x=this.component;x.body=null,x.constraint=null,x.next=te.zpp_pool,te.zpp_pool=x,this.component=null,this.__iremovedFromSpace()},Rt.prototype.copy=function(){var n=(new Q).zpp_inner;n.type=this.type,n.bulletEnabled=this.bulletEnabled,n.disableCCD=this.disableCCD;for(var t=this.shapes.head;null!=t;){var e=n.outer.zpp_inner.wrap_shapes,i=t.elt.outer.copy();e.zpp_inner.reverse_flag?e.push(i):e.unshift(i),t=t.next}if(n.posx=this.posx,n.posy=this.posy,n.velx=this.velx,n.vely=this.vely,n.forcex=this.forcex,n.forcey=this.forcey,n.rot=this.rot,n.angvel=this.angvel,n.torque=this.torque,n.kinvelx=this.kinvelx,n.kinvely=this.kinvely,n.kinangvel=this.kinangvel,n.svelx=this.svelx,n.svely=this.svely,this.zip_axis){n.zip_axis=!0;for(var p=n.shapes.head;null!=p;){var l=p.elt;1==l.type&&(l.polygon.invalidate_gverts(),l.polygon.invalidate_gaxi()),l.invalidate_worldCOM(),p=p.next}n.zip_worldCOM=!0}else n.axisx=this.axisx,n.axisy=this.axisy;return n.rot=this.rot,n.massMode=this.massMode,n.gravMassMode=this.gravMassMode,n.inertiaMode=this.inertiaMode,n.norotate=this.norotate,n.nomove=this.nomove,n.cmass=this.cmass,n.cinertia=this.cinertia,this.zip_mass?n.invalidate_mass():n.mass=this.mass,this.zip_gravMass?n.invalidate_gravMass():n.gravMass=this.gravMass,this.zip_gravMassScale?n.invalidate_gravMassScale():n.gravMassScale=this.gravMassScale,this.zip_inertia?n.invalidate_inertia():n.inertia=this.inertia,this.zip_aabb?n.zip_aabb=!0:(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy),this.zip_localCOM?(n.zip_localCOM=!0,n.zip_worldCOM=!0):(n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy),this.zip_worldCOM?n.zip_worldCOM=!0:(n.worldCOMx=this.worldCOMx,n.worldCOMy=this.worldCOMy),this.copyto(n.outer),n.outer},Rt.prototype.__class__=Rt;var Zt=zpp_nape.phys.ZPP_Compound=function(){this.space=null,this.compound=null,this.depth=0,this.wrap_compounds=null,this.wrap_constraints=null,this.wrap_bodies=null,this.compounds=null,this.constraints=null,this.bodies=null,this.outer=null,Qi.call(this),(this.icompound=this).depth=1,this.bodies=new ve,this.wrap_bodies=wi.get(this.bodies),this.wrap_bodies.zpp_inner.adder=X(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=X(this,this.bodies_subber),this.constraints=new kn,this.wrap_constraints=gi.get(this.constraints),this.wrap_constraints.zpp_inner.adder=X(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=X(this,this.constraints_subber),this.compounds=new me,this.wrap_compounds=Ci.get(this.compounds),this.wrap_compounds.zpp_inner.adder=X(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=X(this,this.compounds_subber)};Zt.__name__=["zpp_nape","phys","ZPP_Compound"],Zt.__super__=Qi,Zt.prototype=Object.create(Qi.prototype),Zt.prototype.outer=null,Zt.prototype.bodies=null,Zt.prototype.constraints=null,Zt.prototype.compounds=null,Zt.prototype.wrap_bodies=null,Zt.prototype.wrap_constraints=null,Zt.prototype.wrap_compounds=null,Zt.prototype.depth=null,Zt.prototype.compound=null,Zt.prototype.space=null,Zt.prototype.__imutable_midstep=function(n){},Zt.prototype.addedToSpace=function(){this.__iaddedToSpace()},Zt.prototype.removedFromSpace=function(){this.__iremovedFromSpace()},Zt.prototype.breakApart=function(){for(null!=this.space&&(this.__iremovedFromSpace(),this.space.nullInteractorType(this)),null!=this.compound?this.compound.compounds.remove(this):null!=this.space&&this.space.compounds.remove(this);null!=this.bodies.head;){var n=this.bodies.pop_unsafe();null!=(n.compound=this.compound)?this.compound.bodies.add(n):null!=this.space&&this.space.bodies.add(n),null!=this.space&&this.space.freshInteractorType(n)}for(;null!=this.constraints.head;){var t=this.constraints.pop_unsafe();null!=(t.compound=this.compound)?this.compound.constraints.add(t):null!=this.space&&this.space.constraints.add(t)}for(;null!=this.compounds.head;){var e=this.compounds.pop_unsafe();null!=(e.compound=this.compound)?this.compound.compounds.add(e):null!=this.space&&this.space.compounds.add(e),null!=this.space&&this.space.freshInteractorType(e)}this.compound=null,this.space=null},Zt.prototype.bodies_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_bodies.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_bodies.remove(n),null!=(n.zpp_inner.compound=this).space&&this.space.addBody(n.zpp_inner),!0)},Zt.prototype.bodies_subber=function(n){(n.zpp_inner.compound=null)!=this.space&&this.space.remBody(n.zpp_inner)},Zt.prototype.constraints_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_constraints.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_constraints.remove(n),null!=(n.zpp_inner.compound=this).space&&this.space.addConstraint(n.zpp_inner),!0)},Zt.prototype.constraints_subber=function(n){(n.zpp_inner.compound=null)!=this.space&&this.space.remConstraint(n.zpp_inner)},Zt.prototype.compounds_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_compounds.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),n.zpp_inner.compound=this,n.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(n.zpp_inner),!0)},Zt.prototype.compounds_subber=function(n){n.zpp_inner.compound=null,n.zpp_inner.depth=1,null!=this.space&&this.space.remCompound(n.zpp_inner)},Zt.prototype.copy=function(n,t){var e=null==n;null==n&&(n=[]),null==t&&(t=[]);for(var i=new en,p=this.compounds.head;null!=p;){var l,r=p.elt.copy(n,t);r.zpp_inner.immutable_midstep("Compound::compound"),(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer)!=i&&(null!=(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer)&&(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(r),null!=i&&((l=i.zpp_inner.wrap_compounds).zpp_inner.reverse_flag?l.push(r):l.unshift(r))),p=p.next}for(var o=this.bodies.head;null!=o;){var a=o.elt,s=a.outer.copy();n.push(Vn.dict(a.id,s)),(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer)!=i&&(null!=(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer)&&(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(s),null!=i&&((a=i.zpp_inner.wrap_bodies).zpp_inner.reverse_flag?a.push(s):a.unshift(s))),o=o.next}for(var _=this.constraints.head;null!=_;){var h,u=_.elt.copy(n,t);(null==u.zpp_inner.compound?null:u.zpp_inner.compound.outer)!=i&&(null!=(null==u.zpp_inner.compound?null:u.zpp_inner.compound.outer)&&(null==u.zpp_inner.compound?null:u.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(u),null!=i&&((h=i.zpp_inner.wrap_constraints).zpp_inner.reverse_flag?h.push(u):h.unshift(u))),_=_.next}if(e)for(;0<t.length;)for(var x=t.pop(),d=0;d<n.length;){var y=n[d];if(++d,y.id==x.id){x.cb(y.bc);break}}return this.copyto(i),i},Zt.prototype.__class__=Zt;var Bt=zpp_nape.phys.ZPP_FluidProperties=function(){this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.density=0,this.viscosity=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ue,this.density=this.viscosity=1,this.wrap_gravity=null,this.gravityx=0,this.gravityy=0};Bt.__name__=["zpp_nape","phys","ZPP_FluidProperties"],Bt.prototype.next=null,Bt.prototype.userData=null,Bt.prototype.outer=null,Bt.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new ln,(n=this.outer.zpp_inner).outer=null,n.next=Bt.zpp_pool,Bt.zpp_pool=n,this.outer.zpp_inner=this),this.outer},Bt.prototype.free=function(){this.outer=null},Bt.prototype.alloc=function(){},Bt.prototype.shapes=null,Bt.prototype.wrap_shapes=null,Bt.prototype.feature_cons=function(){this.shapes=new ue},Bt.prototype.addShape=function(n){this.shapes.add(n)},Bt.prototype.remShape=function(n){this.shapes.remove(n)},Bt.prototype.copy=function(){var n;return null==Bt.zpp_pool?n=new Bt:(n=Bt.zpp_pool,Bt.zpp_pool=n.next,n.next=null),n.viscosity=this.viscosity,n.density=this.density,n},Bt.prototype.viscosity=null,Bt.prototype.density=null,Bt.prototype.gravityx=null,Bt.prototype.gravityy=null,Bt.prototype.wrap_gravity=null,Bt.prototype.gravity_invalidate=function(n){this.gravityx=n.x,this.gravityy=n.y,this.invalidate()},Bt.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},Bt.prototype.getgravity=function(){var n,t,e=this.gravityx,i=this.gravityy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=X(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=X(this,this.gravity_validate)},Bt.prototype.invalidate=function(){for(var n=this.shapes.head;null!=n;)n.elt.invalidate_fluidprops(),n=n.next},Bt.prototype.__class__=Bt;var Gt=zpp_nape.phys.ZPP_Material=function(){this.rollingFriction=0,this.elasticity=0,this.density=0,this.staticFriction=0,this.dynamicFriction=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ue,this.elasticity=0,this.dynamicFriction=1,this.staticFriction=2,this.density=.001,this.rollingFriction=.01};Gt.__name__=["zpp_nape","phys","ZPP_Material"],Gt.prototype.next=null,Gt.prototype.userData=null,Gt.prototype.outer=null,Gt.prototype.wrapper=function(){var n;return null==this.outer&&(this.outer=new _n,(n=this.outer.zpp_inner).outer=null,n.next=Gt.zpp_pool,Gt.zpp_pool=n,this.outer.zpp_inner=this),this.outer},Gt.prototype.free=function(){this.outer=null},Gt.prototype.alloc=function(){},Gt.prototype.shapes=null,Gt.prototype.wrap_shapes=null,Gt.prototype.feature_cons=function(){this.shapes=new ue},Gt.prototype.addShape=function(n){this.shapes.add(n)},Gt.prototype.remShape=function(n){this.shapes.remove(n)},Gt.prototype.dynamicFriction=null,Gt.prototype.staticFriction=null,Gt.prototype.density=null,Gt.prototype.elasticity=null,Gt.prototype.rollingFriction=null,Gt.prototype.copy=function(){var n=new Gt;return n.dynamicFriction=this.dynamicFriction,n.staticFriction=this.staticFriction,n.density=this.density,n.elasticity=this.elasticity,n.rollingFriction=this.rollingFriction,n},Gt.prototype.set=function(n){this.dynamicFriction=n.dynamicFriction,this.staticFriction=n.staticFriction,this.density=n.density,this.elasticity=n.elasticity,this.rollingFriction=n.rollingFriction},Gt.prototype.invalidate=function(n){for(var t=this.shapes.head;null!=t;)t.elt.invalidate_material(n),t=t.next},Gt.prototype.__class__=Gt;var qt=zpp_nape.shape.ZPP_Shape=function(n){var t;this.zip_aabb=!1,this.aabb=null,this.pairs=null,this.node=null,this.sweep=null,this.sensorEnabled=!1,this.fluidEnabled=!1,this.fluidProperties=null,this.filter=null,this.material=null,this.refmaterial=null,this.polygon=null,this.circle=null,this.sweepCoef=0,this.zip_sweepRadius=!1,this.sweepRadius=0,this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_angDrag=!1,this.angDrag=0,this.inertia=0,this.zip_area_inertia=!1,this.area=0,this.type=0,this.body=null,this.outer=null,Qi.call(this),this.pairs=new Ae,(this.ishape=this).type=n,null==Lt.zpp_pool?t=new Lt:(t=Lt.zpp_pool,Lt.zpp_pool=t.next,t.next=null),t.minx=0,t.miny=0,t.maxx=0,t.maxy=0,this.aabb=t,this.aabb._immutable=!0,this.aabb._validate=X(this,this.aabb_validate),this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.fluidEnabled=!1,this.sensorEnabled=!1,this.fluidProperties=null,this.body=null,this.refmaterial=new Gt,this.sweepRadius=this.sweepCoef=0};qt.__name__=["zpp_nape","shape","ZPP_Shape"],qt.__super__=Qi,qt.prototype=Object.create(Qi.prototype),qt.prototype.outer=null,qt.prototype.body=null,qt.prototype.type=null,qt.prototype.isCircle=function(){return 0==this.type},qt.prototype.isPolygon=function(){return 1==this.type},qt.prototype.area=null,qt.prototype.zip_area_inertia=null,qt.prototype.inertia=null,qt.prototype.angDrag=null,qt.prototype.zip_angDrag=null,qt.prototype.localCOMx=null,qt.prototype.localCOMy=null,qt.prototype.zip_localCOM=null,qt.prototype.worldCOMx=null,qt.prototype.worldCOMy=null,qt.prototype.zip_worldCOM=null,qt.prototype.wrap_localCOM=null,qt.prototype.wrap_worldCOM=null,qt.prototype.sweepRadius=null,qt.prototype.zip_sweepRadius=null,qt.prototype.sweepCoef=null,qt.prototype.invalidate_sweepRadius=function(){this.zip_sweepRadius=!0},qt.prototype.validate_sweepRadius=function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,(0==this.type?this.circle:this.polygon).__validate_sweepRadius())},qt.prototype.circle=null,qt.prototype.polygon=null,qt.prototype.refmaterial=null,qt.prototype.material=null,qt.prototype.filter=null,qt.prototype.fluidProperties=null,qt.prototype.fluidEnabled=null,qt.prototype.sensorEnabled=null,qt.prototype.sweep=null,qt.prototype.node=null,qt.prototype.pairs=null,qt.prototype.clear=function(){(0==this.type?this.circle:this.polygon).__clear()},qt.prototype.aabb=null,qt.prototype.zip_aabb=null,qt.prototype.validate_aabb=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var t=n.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;e+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;t.localCOMx+=(l.x+r.x)*o,t.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=t.lverts.next;e+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;t.localCOMx+=(l.x+a.x)*s,t.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;e+=a.x*(_.y-p.y);s=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*s,t.localCOMy+=(a.y+_.y)*s;_=e=1/(3*e);t.localCOMx*=_,t.localCOMy*=_}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}s=n.body;s.zip_axis&&(s.zip_axis=!1,s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}_=n.radius,s=n.radius;n.aabb.minx=n.worldCOMx-_,n.aabb.miny=n.worldCOMy-s,n.aabb.maxx=n.worldCOMx+_,n.aabb.maxy=n.worldCOMy+s}else{var h=this.polygon;if(h.zip_gverts&&null!=h.body){h.zip_gverts=!1,h.validate_lverts();var u=h.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot));for(var x=h.lverts.next,d=h.gverts.next;null!=d;){var y=d,z=x,x=x.next;y.x=h.body.posx+(h.body.axisy*z.x-h.body.axisx*z.y),y.y=h.body.posy+(z.x*h.body.axisx+z.y*h.body.axisy),d=d.next}}u=h.gverts.next;h.aabb.minx=u.x,h.aabb.miny=u.y,h.aabb.maxx=u.x,h.aabb.maxy=u.y;for(var c=h.gverts.next.next;null!=c;){var v=c;v.x<h.aabb.minx&&(h.aabb.minx=v.x),v.x>h.aabb.maxx&&(h.aabb.maxx=v.x),v.y<h.aabb.miny&&(h.aabb.miny=v.y),v.y>h.aabb.maxy&&(h.aabb.maxy=v.y),c=c.next}}},qt.prototype.force_validate_aabb=function(){if(0==this.type){var n=this.circle;n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy),n.aabb.minx=n.worldCOMx-n.radius,n.aabb.miny=n.worldCOMy-n.radius,n.aabb.maxx=n.worldCOMx+n.radius,n.aabb.maxy=n.worldCOMy+n.radius}else{var t=this.polygon,e=t.lverts.next,i=t.gverts.next,n=e;e=e.next,i.x=t.body.posx+(t.body.axisy*n.x-t.body.axisx*n.y),i.y=t.body.posy+(n.x*t.body.axisx+n.y*t.body.axisy),t.aabb.minx=i.x,t.aabb.miny=i.y,t.aabb.maxx=i.x,t.aabb.maxy=i.y;for(var p=t.gverts.next.next;null!=p;){var l=p,r=e,e=e.next;l.x=t.body.posx+(t.body.axisy*r.x-t.body.axisx*r.y),l.y=t.body.posy+(r.x*t.body.axisx+r.y*t.body.axisy),l.x<t.aabb.minx&&(t.aabb.minx=l.x),l.x>t.aabb.maxx&&(t.aabb.maxx=l.x),l.y<t.aabb.miny&&(t.aabb.miny=l.y),l.y>t.aabb.maxy&&(t.aabb.maxy=l.y),p=p.next}}},qt.prototype.invalidate_aabb=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},qt.prototype.validate_area_inertia=function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,(0==this.type?this.circle:this.polygon).__validate_area_inertia())},qt.prototype.validate_angDrag=function(){!this.zip_angDrag&&this.refmaterial.dynamicFriction==this.material.dynamicFriction||(this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,(0==this.type?this.circle:this.polygon).__validate_angDrag())},qt.prototype.validate_localCOM=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);a=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*a,n.localCOMy+=(o.y+s.y)*a;a=t=1/(3*t);n.localCOMx*=a,n.localCOMy*=a}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},qt.prototype.validate_worldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);a=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*a,n.localCOMy+=(o.y+s.y)*a;a=t=1/(3*t);n.localCOMx*=a,n.localCOMy*=a}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}a=this.body;a.zip_axis&&(a.zip_axis=!1,a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}},qt.prototype.getworldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);a=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*a,n.localCOMy+=(o.y+s.y)*a;a=t=1/(3*t);n.localCOMx*=a,n.localCOMy*=a}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}a=this.body;a.zip_axis&&(a.zip_axis=!1,a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy},qt.prototype.invalidate_area_inertia=function(){var n;this.zip_area_inertia=!0,null!=this.body&&((n=this.body).zip_localCOM=!0,n.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia())},qt.prototype.invalidate_angDrag=function(){this.zip_angDrag=!0},qt.prototype.invalidate_localCOM=function(){var n;this.zip_localCOM=!0,this.invalidate_area_inertia(),0==this.type&&(this.zip_sweepRadius=!0),this.invalidate_angDrag(),this.invalidate_worldCOM(),null!=this.body&&((n=this.body).zip_localCOM=!0,n.zip_worldCOM=!0)},qt.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0,this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},qt.prototype.invalidate_material=function(n){var t;0!=(n&Gt.WAKE)&&this.wake(),0!=(n&Gt.ARBITERS)&&null!=this.body&&this.body.refreshArbiters(),0!=(n&Gt.PROPS)&&null!=this.body&&((t=this.body).zip_localCOM=!0,t.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()),0!=(n&Gt.ANGDRAG)&&this.invalidate_angDrag(),this.refmaterial.set(this.material)},qt.prototype.invalidate_filter=function(){this.wake()},qt.prototype.invalidate_fluidprops=function(){this.fluidEnabled&&this.wake()},qt.prototype.aabb_validate=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var t=n.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;e+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;t.localCOMx+=(l.x+r.x)*o,t.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=t.lverts.next;e+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;t.localCOMx+=(l.x+a.x)*s,t.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;e+=a.x*(_.y-p.y);s=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*s,t.localCOMy+=(a.y+_.y)*s;_=e=1/(3*e);t.localCOMx*=_,t.localCOMy*=_}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}s=n.body;s.zip_axis&&(s.zip_axis=!1,s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}_=n.radius,s=n.radius;n.aabb.minx=n.worldCOMx-_,n.aabb.miny=n.worldCOMy-s,n.aabb.maxx=n.worldCOMx+_,n.aabb.maxy=n.worldCOMy+s}else{var h=this.polygon;if(h.zip_gverts&&null!=h.body){h.zip_gverts=!1,h.validate_lverts();var u=h.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot));for(var x=h.lverts.next,d=h.gverts.next;null!=d;){var y=d,z=x,x=x.next;y.x=h.body.posx+(h.body.axisy*z.x-h.body.axisx*z.y),y.y=h.body.posy+(z.x*h.body.axisx+z.y*h.body.axisy),d=d.next}}u=h.gverts.next;h.aabb.minx=u.x,h.aabb.miny=u.y,h.aabb.maxx=u.x,h.aabb.maxy=u.y;for(var c=h.gverts.next.next;null!=c;){var v=c;v.x<h.aabb.minx&&(h.aabb.minx=v.x),v.x>h.aabb.maxx&&(h.aabb.maxx=v.x),v.y<h.aabb.miny&&(h.aabb.miny=v.y),v.y>h.aabb.maxy&&(h.aabb.maxy=v.y),c=c.next}}},qt.prototype.setMaterial=function(n){this.material!=n&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},qt.prototype.setFilter=function(n){this.filter!=n&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake())},qt.prototype.setFluid=function(n){this.fluidProperties!=n&&(null!=this.body&&null!=this.body.space&&null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this),this.fluidProperties=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.fluidEnabled&&this.wake())},qt.prototype.__immutable_midstep=function(n){},qt.prototype.addedToBody=function(){this.invalidate_worldCOM(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},qt.prototype.removedFromBody=function(){},qt.prototype.addedToSpace=function(){this.__iaddedToSpace(),this.material.shapes.add(this),this.filter.shapes.add(this),null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},qt.prototype.removedFromSpace=function(){this.__iremovedFromSpace(),this.material.shapes.remove(this),this.filter.shapes.remove(this),null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},qt.prototype.copy=function(){var n=null,n=(0==this.type?this.circle:this.polygon).__copy();this.zip_area_inertia?n.invalidate_area_inertia():(n.area=this.area,n.inertia=this.inertia),this.zip_sweepRadius?n.zip_sweepRadius=!0:(n.sweepRadius=this.sweepRadius,n.sweepCoef=this.sweepCoef),this.zip_angDrag?n.invalidate_angDrag():n.angDrag=this.angDrag,this.zip_aabb?(n.zip_aabb=!0,null!=n.body&&(n.body.zip_aabb=!0)):(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy);var t=n.material;t.outer=null,t.next=Gt.zpp_pool,Gt.zpp_pool=t;t=n.filter;return t.outer=null,t.next=st.zpp_pool,st.zpp_pool=t,n.material=this.material,n.filter=this.filter,null!=this.fluidProperties&&(n.fluidProperties=this.fluidProperties),n.fluidEnabled=this.fluidEnabled,n.sensorEnabled=this.sensorEnabled,null!=this.userData&&(n.userData=a.copy(this.userData)),this.copyto(n.outer),n.outer},qt.prototype.__class__=qt;var Ut=zpp_nape.shape.ZPP_Circle=function(){this.radius=0,this.outer_zn=null,qt.call(this,0),(this.circle=this).zip_localCOM=!1};Ut.__name__=["zpp_nape","shape","ZPP_Circle"],Ut.__super__=qt,Ut.prototype=Object.create(qt.prototype),Ut.prototype.outer_zn=null,Ut.prototype.radius=null,Ut.prototype.__clear=function(){},Ut.prototype.invalidate_radius=function(){this.invalidate_area_inertia(),this.invalidate_angDrag(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),null!=this.body&&this.body.wake()},Ut.prototype.localCOM_validate=function(){this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy},Ut.prototype.localCOM_invalidate=function(n){this.localCOMx=n.x,this.localCOMy=n.y,this.invalidate_localCOM(),null!=this.body&&this.body.wake()},Ut.prototype.setupLocalCOM=function(){var n,t,e=this.localCOMx,i=this.localCOMy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=X(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=X(this,this.localCOM_invalidate)},Ut.prototype.__validate_aabb=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);a=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*a,n.localCOMy+=(o.y+s.y)*a;s=t=1/(3*t);n.localCOMx*=s,n.localCOMy*=s}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}a=this.body;a.zip_axis&&(a.zip_axis=!1,a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}s=this.radius,a=this.radius;this.aabb.minx=this.worldCOMx-s,this.aabb.miny=this.worldCOMy-a,this.aabb.maxx=this.worldCOMx+s,this.aabb.maxy=this.worldCOMy+a},Ut.prototype._force_validate_aabb=function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy),this.aabb.minx=this.worldCOMx-this.radius,this.aabb.miny=this.worldCOMy-this.radius,this.aabb.maxx=this.worldCOMx+this.radius,this.aabb.maxy=this.worldCOMy+this.radius},Ut.prototype.__validate_sweepRadius=function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy),this.sweepRadius=this.sweepCoef+this.radius},Ut.prototype.__validate_area_inertia=function(){var n=this.radius*this.radius;this.area=n*Math.PI,this.inertia=.5*n+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},Ut.prototype.__validate_angDrag=function(){var n=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,t=this.radius*this.radius;this.angDrag=(n+2*t)*(this.material.dynamicFriction*jp.fluidAngularDragFriction)+.5*jp.fluidAngularDrag*(1+jp.fluidVacuumDrag)*n,this.angDrag/=2*(n+.5*t)},Ut.prototype.__scale=function(n,t){var e=((n<0?-n:n)+(t<0?-t:t))/2;this.radius*=e<0?-e:e,this.invalidate_radius(),0<this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy&&(this.localCOMx*=n,this.localCOMy*=t,this.invalidate_localCOM())},Ut.prototype.__translate=function(n,t){this.localCOMx+=n,this.localCOMy+=t,this.invalidate_localCOM()},Ut.prototype.__rotate=function(n,t){var e,i;0<this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy&&(i=e=0,e=t*this.localCOMx-n*this.localCOMy,i=this.localCOMx*n+this.localCOMy*t,this.localCOMx=e,this.localCOMy=i,this.invalidate_localCOM())},Ut.prototype.__transform=function(n){var t=n.zpp_inner.a*n.zpp_inner.d-n.zpp_inner.b*n.zpp_inner.c;t<0&&(t=-t),this.radius*=Math.sqrt(t);t=n.zpp_inner.a*this.localCOMx+n.zpp_inner.b*this.localCOMy+n.zpp_inner.tx;this.localCOMy=n.zpp_inner.c*this.localCOMx+n.zpp_inner.d*this.localCOMy+n.zpp_inner.ty,this.localCOMx=t,this.invalidate_radius(),this.invalidate_localCOM()},Ut.prototype.__copy=function(){var n=new un(this.radius).zpp_inner_zn;return n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy,n.zip_localCOM=!1,n},Ut.prototype.__class__=Ut;var Kt=zpp_nape.shape.ZPP_Edge=function(){this.tp1=0,this.tp0=0,this.gp1=null,this.lp1=null,this.gp0=null,this.lp0=null,this.gprojection=0,this.lprojection=0,this.length=0,this.wrap_gnorm=null,this.gnormy=0,this.gnormx=0,this.wrap_lnorm=null,this.lnormy=0,this.lnormx=0,this.outer=null,this.polygon=null,this.next=null,this.lnormx=0,this.lnormy=0,this.gnormx=0,this.gnormy=0,this.length=0,this.lprojection=0,this.gprojection=0};Kt.__name__=["zpp_nape","shape","ZPP_Edge"],Kt.prototype.next=null,Kt.prototype.free=function(){this.polygon=null},Kt.prototype.alloc=function(){},Kt.prototype.polygon=null,Kt.prototype.outer=null,Kt.prototype.wrapper=function(){return null==this.outer&&(Kt.internal=!0,this.outer=new xn,Kt.internal=!1,this.outer.zpp_inner=this),this.outer},Kt.prototype.lnormx=null,Kt.prototype.lnormy=null,Kt.prototype.wrap_lnorm=null,Kt.prototype.gnormx=null,Kt.prototype.gnormy=null,Kt.prototype.wrap_gnorm=null,Kt.prototype.length=null,Kt.prototype.lprojection=null,Kt.prototype.gprojection=null,Kt.prototype.lp0=null,Kt.prototype.gp0=null,Kt.prototype.lp1=null,Kt.prototype.gp1=null,Kt.prototype.tp0=null,Kt.prototype.tp1=null,Kt.prototype.lnorm_validate=function(){this.polygon.validate_laxi(),this.wrap_lnorm.zpp_inner.x=this.lnormx,this.wrap_lnorm.zpp_inner.y=this.lnormy},Kt.prototype.gnorm_validate=function(){var n=this.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var t=n.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var e=n.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i,i=i.next;l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}for(var o=n.edges.head,a=s=n.gverts.next,s=s.next;null!=s;){var _=s,h=o.elt,o=o.next;h.gp0=a,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,a=_,s=s.next}e=o.elt;e.gp0=a,e.gp1=n.gverts.next,e.gnormx=n.body.axisy*e.lnormx-n.body.axisx*e.lnormy,e.gnormy=e.lnormx*n.body.axisx+e.lnormy*n.body.axisy,e.gprojection=n.body.posx*e.gnormx+n.body.posy*e.gnormy+e.lprojection,null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy),e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy,e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy}this.wrap_gnorm.zpp_inner.x=this.gnormx,this.wrap_gnorm.zpp_inner.y=this.gnormy},Kt.prototype.getlnorm=function(){var n,t,e=this.lnormx,i=this.lnormy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_lnorm=n,this.wrap_lnorm.zpp_inner._immutable=!0,this.wrap_lnorm.zpp_inner._validate=X(this,this.lnorm_validate)},Kt.prototype.getgnorm=function(){var n,t,e=this.gnormx,i=this.gnormy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_gnorm=n,this.wrap_gnorm.zpp_inner._immutable=!0,this.wrap_gnorm.zpp_inner._validate=X(this,this.gnorm_validate)},Kt.prototype.__class__=Kt;var Wt=zpp_nape.shape.ZPP_Polygon=function(){this.zip_sanitation=!1,this.zip_valid=!1,this.zip_gaxi=!1,this.zip_gverts=!1,this.zip_laxi=!1,this.zip_lverts=!1,this.reverse_flag=!1,this.edgeCnt=0,this.wrap_edges=null,this.edges=null,this.wrap_gverts=null,this.gverts=null,this.wrap_lverts=null,this.lverts=null,this.outer_zn=null,qt.call(this,1),(this.polygon=this).lverts=new Ip,this.gverts=new Ip,this.edges=new je,this.edgeCnt=0};Wt.__name__=["zpp_nape","shape","ZPP_Polygon"],Wt.__super__=qt,Wt.prototype=Object.create(qt.prototype),Wt.prototype.outer_zn=null,Wt.prototype.lverts=null,Wt.prototype.wrap_lverts=null,Wt.prototype.gverts=null,Wt.prototype.wrap_gverts=null,Wt.prototype.edges=null,Wt.prototype.wrap_edges=null,Wt.prototype.edgeCnt=null,Wt.prototype.reverse_flag=null,Wt.prototype.__clear=function(){},Wt.prototype.lverts_pa_invalidate=function(n){this.invalidate_lverts()},Wt.prototype.gverts_pa_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var t=this.lverts.next,e=this.gverts.next;null!=e;){var i=e,p=t,t=t.next;i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),e=e.next}}},Wt.prototype.lverts_post_adder=function(n){n.zpp_inner._invalidate=X(this,this.lverts_pa_invalidate);for(var t=null,e=null,i=this.lverts.next;null!=i&&i!=n.zpp_inner;)t=(null==t?this.gverts:t).next,e=null==e?this.edges.head:e.next,i=i.next;null==Ip.zpp_pool?o=new Ip:(o=Ip.zpp_pool,Ip.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!0,o.x=0,o.y=0;var p,l,r,o=o;this.gverts.insert(t,o),null!=this.lverts.next.next&&(null==this.lverts.next.next.next?(null==Kt.zpp_pool?p=new Kt:(p=Kt.zpp_pool,Kt.zpp_pool=p.next,p.next=null),(p.polygon=this).edges.add(p),null==Kt.zpp_pool?l=new Kt:(l=Kt.zpp_pool,Kt.zpp_pool=l.next,l.next=null),(l.polygon=this).edges.add(l),this.edgeCnt+=2):(null==Kt.zpp_pool?r=new Kt:(r=Kt.zpp_pool,Kt.zpp_pool=r.next,r.next=null),(r.polygon=this).edges.insert(e,r),this.edgeCnt++)),o._validate=X(this,this.gverts_pa_validate)},Wt.prototype.lverts_subber=function(n){this.cleanup_lvert(n.zpp_inner)},Wt.prototype.lverts_invalidate=function(n){this.invalidate_lverts()},Wt.prototype.lverts_validate=function(){this.validate_lverts()},Wt.prototype.gverts_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var t=this.lverts.next,e=this.gverts.next;null!=e;){var i=e,p=t,t=t.next;i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),e=e.next}}},Wt.prototype.edges_validate=function(){this.validate_lverts()},Wt.prototype.getlverts=function(){this.wrap_lverts=bi.get(this.lverts),this.wrap_lverts.zpp_inner.post_adder=X(this,this.lverts_post_adder),this.wrap_lverts.zpp_inner.subber=X(this,this.lverts_subber),this.wrap_lverts.zpp_inner._invalidate=X(this,this.lverts_invalidate),this.wrap_lverts.zpp_inner._validate=X(this,this.lverts_validate),this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},Wt.prototype.getgverts=function(){this.wrap_gverts=bi.get(this.gverts,!0),this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_gverts.zpp_inner._validate=X(this,this.gverts_validate)},Wt.prototype.getedges=function(){this.wrap_edges=Ei.get(this.edges,!0),this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_edges.zpp_inner._validate=X(this,this.edges_validate)},Wt.prototype.zip_lverts=null,Wt.prototype.invalidate_lverts=function(){this.invalidate_laxi(),this.invalidate_area_inertia(),this.invalidate_angDrag(),this.invalidate_localCOM(),this.invalidate_gverts(),this.zip_lverts=!0,this.zip_valid=!0,this.zip_sanitation=!0,null!=this.body&&this.body.wake()},Wt.prototype.zip_laxi=null,Wt.prototype.invalidate_laxi=function(){this.invalidate_gaxi(),this.zip_sweepRadius=!0,this.zip_laxi=!0},Wt.prototype.zip_gverts=null,Wt.prototype.invalidate_gverts=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),this.zip_gverts=!0},Wt.prototype.zip_gaxi=null,Wt.prototype.invalidate_gaxi=function(){this.zip_gaxi=!0},Wt.prototype.zip_valid=null,Wt.prototype.validation=null,Wt.prototype.valid=function(){if(this.zip_valid){if(this.zip_valid=!1,this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real()),this.lverts.length<3)return null==Yi.ValidationResult_DEGENERATE&&(Yi.internal=!0,Yi.ValidationResult_DEGENERATE=new vn,Yi.internal=!1),this.validation=Yi.ValidationResult_DEGENERATE;if(this.validate_lverts(),this.validate_area_inertia(),this.area<jp.epsilon)return null==Yi.ValidationResult_DEGENERATE&&(Yi.internal=!0,Yi.ValidationResult_DEGENERATE=new vn,Yi.internal=!1),this.validation=Yi.ValidationResult_DEGENERATE;var n=!1,t=!1,e=!0,i=this.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i,o=r.x-l.x,a=r.y-l.y,s=l.x-p.x,a=(l.y-p.y)*o-s*a;if(a>jp.epsilon?t=!0:a<-jp.epsilon&&(n=!0),t&&n){e=!1;break}p=l,l=r,i=i.next}if(e){for(var _=i=this.lverts.next;;){var h=_.x-l.x,u=_.y-l.y,x=l.x-p.x,u=(l.y-p.y)*h-x*u;if(u>jp.epsilon?t=!0:u<-jp.epsilon&&(n=!0),t&&n){e=!1;break}break}if(e){p=l,l=_;for(var d=i=i.next;;){var y=d.x-_.x,z=d.y-_.y,c=_.x-p.x,z=(_.y-p.y)*y-c*z;if(z>jp.epsilon?t=!0:z<-jp.epsilon&&(n=!0),t&&n)break;break}}}if(t&&n)return null==Yi.ValidationResult_CONCAVE&&(Yi.internal=!0,Yi.ValidationResult_CONCAVE=new vn,Yi.internal=!1),this.validation=Yi.ValidationResult_CONCAVE;for(var v=!0,m=!0,f=b=this.lverts.next,b=b.next;null!=b;){var g=b;if(!v){m=!1;break}for(var w=!0,M=C=this.lverts.next,C=C.next;null!=C;){var k=C;if(f!=M&&f!=k&&g!=M&&g!=k){var O=f.x-M.x,P=f.y-M.y,S=0,A=g.x-f.x,j=0,E=0,I=(S=g.y-f.y)*(j=k.x-M.x)-A*(E=k.y-M.y);if(I*I>jp.epsilon){j=(E*O-j*P)*(I=1/I);if(j>jp.epsilon&&j<1-jp.epsilon){I=(S*O-A*P)*I;if(I>jp.epsilon&&I<1-jp.epsilon){w=v=!1;break}}}M=k,C=C.next}else M=k,C=C.next}if(w)for(;;){var T=this.lverts.next;if(f==M||f==T||g==M||g==T)break;var N=f.x-M.x,L=f.y-M.y,V=0,D=g.x-f.x,F=0,R=0,T=(V=g.y-f.y)*(F=T.x-M.x)-D*(R=T.y-M.y);if(T*T>jp.epsilon){F=(R*N-F*L)*(T=1/T);if(F>jp.epsilon&&F<1-jp.epsilon){T=(V*N-D*L)*T;if(T>jp.epsilon&&T<1-jp.epsilon){v=!1;break}}}break}f=g,b=b.next}if(m)for(;;){var Z=this.lverts.next;if(!v)break;for(var B=!0,G=q=this.lverts.next,q=q.next;null!=q;){var U=q;if(f!=G&&f!=U&&Z!=G&&Z!=U){var K=f.x-G.x,W=f.y-G.y,Y=0,J=Z.x-f.x,X=0,H=0,$=(Y=Z.y-f.y)*(X=U.x-G.x)-J*(H=U.y-G.y);if($*$>jp.epsilon){X=(H*K-X*W)*($=1/$);if(X>jp.epsilon&&X<1-jp.epsilon){$=(Y*K-J*W)*$;if($>jp.epsilon&&$<1-jp.epsilon){B=v=!1;break}}}G=U,q=q.next}else G=U,q=q.next}if(B)for(;;){var Q=this.lverts.next;if(f==G||f==Q||Z==G||Z==Q)break;var nn=f.x-G.x,tn=f.y-G.y,en=0,pn=Z.x-f.x,ln=0,rn=0,Q=(en=Z.y-f.y)*(ln=Q.x-G.x)-pn*(rn=Q.y-G.y);if(Q*Q>jp.epsilon){ln=(rn*nn-ln*tn)*(Q=1/Q);if(ln>jp.epsilon&&ln<1-jp.epsilon){Q=(en*nn-pn*tn)*Q;if(Q>jp.epsilon&&Q<1-jp.epsilon){v=!1;break}}}break}break}return v?(null==Yi.ValidationResult_VALID&&(Yi.internal=!0,Yi.ValidationResult_VALID=new vn,Yi.internal=!1),this.validation=Yi.ValidationResult_VALID):(null==Yi.ValidationResult_SELF_INTERSECTING&&(Yi.internal=!0,Yi.ValidationResult_SELF_INTERSECTING=new vn,Yi.internal=!1),this.validation=Yi.ValidationResult_SELF_INTERSECTING)}return this.validation},Wt.prototype.validate_lverts=function(){this.zip_lverts&&(this.zip_lverts=!1,2<this.lverts.length&&(this.validate_area_inertia(),this.area<0&&(this.reverse_vertices(),this.area=-this.area)))},Wt.prototype.cleanup_lvert=function(n){for(var t=null,e=null,i=this.lverts.next;null!=i&&i!=n;)t=(null==t?this.gverts:t).next,e=null==e?this.edges.head:e.next,i=i.next;var p=(null==t?this.gverts:t).next;this.gverts.erase(t);var l,p=p;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ip.zpp_pool,Ip.zpp_pool=p,2==this.edgeCnt?((l=this.edges.pop_unsafe()).polygon=null,l.next=Kt.zpp_pool,Kt.zpp_pool=l,(l=this.edges.pop_unsafe()).polygon=null,l.next=Kt.zpp_pool,Kt.zpp_pool=l,this.edgeCnt=0):0!=this.edgeCnt&&(l=(null==e?this.edges.head:e.next).elt,this.edges.erase(e),(l=l).polygon=null,l.next=Kt.zpp_pool,Kt.zpp_pool=l,this.edgeCnt--)},Wt.prototype.zip_sanitation=null,Wt.prototype.splice_collinear=function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},Wt.prototype.splice_collinear_real=function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var n,t=null,e=this.lverts.next;null!=e;)var i=(null==e.next?this.lverts:e).next,p=e.x,l=e.y,r=0,o=0,e=(r=p-i.x)*r+(o=l-i.y)*o<jp.epsilon*jp.epsilon?(this.cleanup_lvert(e),this.lverts.erase(t)):(t=e).next;if(null!=this.lverts.next)for(;;){n=!1;for(var a=this.lverts.next;null!=a;)var s=(null==a.next?this.lverts:a).next,_=(null==s.next?this.lverts:s).next,h=s.x-a.x,u=s.y-a.y,x=_.x-s.x,u=(_.y-s.y)*h-x*u,a=(u*u>=jp.epsilon*jp.epsilon||(this.cleanup_lvert(s),this.lverts.erase(null==a.next?null:a),n=!0),a.next);if(!n)break}}},Wt.prototype.reverse_vertices=function(){this.lverts.reverse(),this.gverts.reverse(),this.edges.reverse(),this.edges.insert(this.edges.iterator_at(this.edgeCnt-1),this.edges.pop_unsafe()),this.reverse_flag=!this.reverse_flag,null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},Wt.prototype.validate_laxi=function(){if(this.zip_laxi){this.zip_laxi=!1,this.validate_lverts();for(var n=this.edges.head,t=e=this.lverts.next,e=e.next;null!=e;){var i=e,p=n.elt,n=n.next;p.lp0=t,p.lp1=i;var l=t.x-i.x,r=t.y-i.y,o=Math.sqrt(l*l+r*r),a=1/(p.length=o),o=l*=a;l=-(r*=a),r=o,p.lprojection=l*t.x+r*t.y,p.lnormx=l,p.lnormy=r,null!=p.wrap_lnorm&&(p.wrap_lnorm.zpp_inner.x=l,p.wrap_lnorm.zpp_inner.y=r),t=i,e=e.next}var s=this.lverts.next,_=n.elt;_.lp0=t,_.lp1=s;var h=t.x-s.x,u=t.y-s.y,x=Math.sqrt(h*h+u*u),s=1/(_.length=x),x=h*=s;h=-(u*=s),u=x,_.lprojection=h*t.x+u*t.y,_.lnormx=h,_.lnormy=u,null!=_.wrap_lnorm&&(_.wrap_lnorm.zpp_inner.x=h,_.wrap_lnorm.zpp_inner.y=u)}},Wt.prototype.validate_gverts=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var t=this.lverts.next,e=this.gverts.next;null!=e;){var i=e,p=t,t=t.next;i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),e=e.next}}},Wt.prototype.validate_gaxi=function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1,this.validate_laxi();var n=this.body;if(n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)),this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var t=this.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var p=i,l=e,e=e.next;p.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),p.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),i=i.next}}for(var r=this.edges.head,o=a=this.gverts.next,a=a.next;null!=a;){var s=a,_=r.elt,r=r.next;_.gp0=o,_.gp1=s,_.gnormx=this.body.axisy*_.lnormx-this.body.axisx*_.lnormy,_.gnormy=_.lnormx*this.body.axisx+_.lnormy*this.body.axisy,_.gprojection=this.body.posx*_.gnormx+this.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,o=s,a=a.next}t=r.elt;t.gp0=o,t.gp1=this.gverts.next,t.gnormx=this.body.axisy*t.lnormx-this.body.axisx*t.lnormy,t.gnormy=t.lnormx*this.body.axisx+t.lnormy*this.body.axisy,t.gprojection=this.body.posx*t.gnormx+this.body.posy*t.gnormy+t.lprojection,null!=t.wrap_gnorm&&(t.wrap_gnorm.zpp_inner.x=t.gnormx,t.wrap_gnorm.zpp_inner.y=t.gnormy),t.tp0=t.gp0.y*t.gnormx-t.gp0.x*t.gnormy,t.tp1=t.gp1.y*t.gnormx-t.gp1.x*t.gnormy}},Wt.prototype.__validate_aabb=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var t=this.lverts.next,e=this.gverts.next;null!=e;){var i=e,p=t,t=t.next;i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),e=e.next}}n=this.gverts.next;this.aabb.minx=n.x,this.aabb.miny=n.y,this.aabb.maxx=n.x,this.aabb.maxy=n.y;for(var l=this.gverts.next.next;null!=l;){var r=l;r.x<this.aabb.minx&&(this.aabb.minx=r.x),r.x>this.aabb.maxx&&(this.aabb.maxx=r.x),r.y<this.aabb.miny&&(this.aabb.miny=r.y),r.y>this.aabb.maxy&&(this.aabb.maxy=r.y),l=l.next}},Wt.prototype._force_validate_aabb=function(){var n=this.lverts.next,t=this.gverts.next,e=n;n=n.next,t.x=this.body.posx+(this.body.axisy*e.x-this.body.axisx*e.y),t.y=this.body.posy+(e.x*this.body.axisx+e.y*this.body.axisy),this.aabb.minx=t.x,this.aabb.miny=t.y,this.aabb.maxx=t.x,this.aabb.maxy=t.y;for(var i=this.gverts.next.next;null!=i;){var p=i,l=n,n=n.next;p.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),p.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),p.x<this.aabb.minx&&(this.aabb.minx=p.x),p.x>this.aabb.maxx&&(this.aabb.maxx=p.x),p.y<this.aabb.miny&&(this.aabb.miny=p.y),p.y>this.aabb.maxy&&(this.aabb.maxy=p.y),i=i.next}},Wt.prototype.__validate_sweepRadius=function(){var n=0,t=0;this.validate_laxi();for(var e=this.lverts.next;null!=e;){var i=e.x*e.x+e.y*e.y;n<i&&(n=i),e=e.next}for(var p=this.edges.head;null!=p;){var l=p.elt;if(l.lprojection<t&&(t=l.lprojection)<0)break;p=p.next}t<0&&(t=0),this.sweepRadius=Math.sqrt(n),this.sweepCoef=this.sweepRadius-t},Wt.prototype.__validate_area_inertia=function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.area=0,this.inertia=0;else{var n=this.area=0,t=0,e=this.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e,r=p.y*i.x-p.x*i.y;n+=r*(p.x*p.x+p.y*p.y+(p.x*i.x+p.y*i.y)+(i.x*i.x+i.y*i.y)),t+=r,this.area+=p.x*(l.y-i.y),i=p,p=l,e=e.next}var o=e=this.lverts.next,a=p.y*i.x-p.x*i.y;n+=a*(p.x*p.x+p.y*p.y+(p.x*i.x+p.y*i.y)+(i.x*i.x+i.y*i.y)),t+=a,this.area+=p.x*(o.y-i.y),i=p,e=e.next;a=o.y*i.x-o.x*i.y;n+=a*(o.x*o.x+o.y*o.y+(o.x*i.x+o.y*i.y)+(i.x*i.x+i.y*i.y)),t+=a,this.area+=o.x*(e.y-i.y),this.inertia=n/(6*t),this.area*=.5,this.area<0&&(this.area=-this.area,this.reverse_vertices())}},Wt.prototype.__validate_angDrag=function(){this.validate_area_inertia(),this.validate_laxi();for(var n=0,t=this.edges.head,e=0,i=this.lverts.next,p=i,l=i.next;null!=l;){var r=t.elt,t=t.next;e+=r.length;var o=l.x-p.x,a=l.y-p.y;n+=r.length*jp.fluidAngularDragFriction*this.material.dynamicFriction*r.lprojection*r.lprojection;var s,_,h,u,x=-(p.y*r.lnormx-p.x*r.lnormy)/(a*r.lnormx-o*r.lnormy);0<x&&(u=1<x?1:x,_=s=0,s=p.x,_=p.y,s+=o*u,_+=a*u,h=r.lnormy*p.x-r.lnormx*p.y,n+=((_=r.lnormy*s-r.lnormx*_)*_*_-h*h*h)/(3*(_-h))*u*r.length*jp.fluidAngularDrag),x<1&&(h=x<0?0:x,x=u=0,u=p.x,x=p.y,u+=o*h,x+=a*h,u=r.lnormy*u-r.lnormx*x,n+=((x=r.lnormy*l.x-r.lnormx*l.y)*x*x-u*u*u)/(3*(x-u))*jp.fluidVacuumDrag*(1-h)*r.length*jp.fluidAngularDrag),l=(p=l).next}for(;;){l=this.lverts.next;var d=t.elt;t=t.next,e+=d.length;var y=l.x-p.x,z=l.y-p.y;n+=d.length*jp.fluidAngularDragFriction*this.material.dynamicFriction*d.lprojection*d.lprojection;var c,v,m,f,b=-(p.y*d.lnormx-p.x*d.lnormy)/(z*d.lnormx-y*d.lnormy);0<b&&(f=1<b?1:b,v=c=0,c=p.x,v=p.y,c+=y*f,v+=z*f,m=d.lnormy*p.x-d.lnormx*p.y,n+=((v=d.lnormy*c-d.lnormx*v)*v*v-m*m*m)/(3*(v-m))*f*d.length*jp.fluidAngularDrag),b<1&&(m=b<0?0:b,b=f=0,f=p.x,b=p.y,f+=y*m,b+=z*m,f=d.lnormy*f-d.lnormx*b,n+=((b=d.lnormy*l.x-d.lnormx*l.y)*b*b-f*f*f)/(3*(b-f))*jp.fluidVacuumDrag*(1-m)*d.length*jp.fluidAngularDrag);break}this.angDrag=n/(this.inertia*e)},Wt.prototype.__validate_localCOM=function(){if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y,this.localCOMx+=this.lverts.next.next.x,this.localCOMy+=this.lverts.next.next.y,this.localCOMx*=.5,this.localCOMy*=.5;else{this.localCOMx=0;var n=this.localCOMy=0,t=this.lverts.next,e=t,i=t=t.next;for(t=t.next;null!=t;){var p=t;n+=i.x*(p.y-e.y);var l=p.y*i.x-p.x*i.y;this.localCOMx+=(i.x+p.x)*l,this.localCOMy+=(i.y+p.y)*l,e=i,i=p,t=t.next}var r=t=this.lverts.next;n+=i.x*(r.y-e.y);var o=r.y*i.x-r.x*i.y;this.localCOMx+=(i.x+r.x)*o,this.localCOMy+=(i.y+r.y)*o,e=i;var a=t=t.next;n+=r.x*(a.y-e.y);o=a.y*r.x-a.x*r.y;this.localCOMx+=(r.x+a.x)*o,this.localCOMy+=(r.y+a.y)*o;o=n=1/(3*n);this.localCOMx*=o,this.localCOMy*=o}},Wt.prototype.localCOM_validate=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0;var t=n.localCOMy=0,e=n.lverts.next,i=e,p=e=e.next;for(e=e.next;null!=e;){var l=e;t+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,e=e.next}var o=e=n.lverts.next;t+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=e=e.next;t+=o.x*(s.y-i.y);a=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*a,n.localCOMy+=(o.y+s.y)*a;a=t=1/(3*t);n.localCOMx*=a,n.localCOMy*=a}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},Wt.prototype.localCOM_invalidate=function(n){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var t=this.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0;var e=t.localCOMy=0,i=t.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;e+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;t.localCOMx+=(l.x+r.x)*o,t.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=t.lverts.next;e+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;t.localCOMx+=(l.x+a.x)*s,t.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;e+=a.x*(_.y-p.y);s=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*s,t.localCOMy+=(a.y+_.y)*s;s=e=1/(3*e);t.localCOMx*=s,t.localCOMy*=s}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}for(var h=n.x-this.localCOMx,u=n.y-this.localCOMy,x=this.lverts.next;null!=x;){var d=x;d.x+=h,d.y+=u,x=x.next}this.invalidate_lverts()},Wt.prototype.setupLocalCOM=function(){var n,t,e=this.localCOMx,i=this.localCOMy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=X(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=X(this,this.localCOM_invalidate)},Wt.prototype.__translate=function(n,t){for(var e=this.lverts.next;null!=e;){var i=e;i.x+=n,i.y+=t,e=e.next}this.invalidate_lverts()},Wt.prototype.__scale=function(n,t){for(var e=this.lverts.next;null!=e;){var i=e;i.x*=n,i.y*=t,e=e.next}this.invalidate_lverts()},Wt.prototype.__rotate=function(n,t){for(var e=this.lverts.next;null!=e;){var i=e,p=t*i.x-n*i.y,l=i.x*n+i.y*t;i.x=p,i.y=l,e=e.next}this.invalidate_lverts()},Wt.prototype.__transform=function(n){for(var t=this.lverts.next;null!=t;){var e=t,i=n.zpp_inner.a*e.x+n.zpp_inner.b*e.y+n.zpp_inner.tx;e.y=n.zpp_inner.c*e.x+n.zpp_inner.d*e.y+n.zpp_inner.ty,e.x=i,t=t.next}this.invalidate_lverts()},Wt.prototype.__copy=function(){var n=this.outer_zn;return null==n.zpp_inner_zn.wrap_lverts&&n.zpp_inner_zn.getlverts(),new yn(n.zpp_inner_zn.wrap_lverts).zpp_inner_zn},Wt.prototype.__class__=Wt;var Yt=zpp_nape.space.ZPP_Broadphase=function(){this.circShape=null,this.matrix=null,this.aabbShape=null,this.dynab=null,this.sweep=null,this.is_sweep=!1,this.space=null};Yt.__name__=["zpp_nape","space","ZPP_Broadphase"],Yt.prototype.space=null,Yt.prototype.is_sweep=null,Yt.prototype.sweep=null,Yt.prototype.dynab=null,Yt.prototype.insert=function(n){(this.is_sweep?this.sweep:this.dynab).__insert(n)},Yt.prototype.remove=function(n){(this.is_sweep?this.sweep:this.dynab).__remove(n)},Yt.prototype.sync=function(n){if(this.is_sweep){if(!this.sweep.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var t=n.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var e=t.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,p=e.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;e.localCOMx+=(r.x+o.x)*a,e.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=e.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*_,e.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);_=h.y*s.x-h.x*s.y;e.localCOMx+=(s.x+h.x)*_,e.localCOMy+=(s.y+h.y)*_;h=i=1/(3*i);e.localCOMx*=h,e.localCOMy*=h}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}_=t.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}h=t.radius,_=t.radius;t.aabb.minx=t.worldCOMx-h,t.aabb.miny=t.worldCOMy-_,t.aabb.maxx=t.worldCOMx+h,t.aabb.maxy=t.worldCOMy+_}else{var u=n.polygon;if(u.zip_gverts&&null!=u.body){u.zip_gverts=!1,u.validate_lverts();var x=u.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot));for(var d=u.lverts.next,y=u.gverts.next;null!=y;){var z=y,c=d,d=d.next;z.x=u.body.posx+(u.body.axisy*c.x-u.body.axisx*c.y),z.y=u.body.posy+(c.x*u.body.axisx+c.y*u.body.axisy),y=y.next}}var v=u.gverts.next;u.aabb.minx=v.x,u.aabb.miny=v.y,u.aabb.maxx=v.x,u.aabb.maxy=v.y;for(var m=u.gverts.next.next;null!=m;){var f=m;f.x<u.aabb.minx&&(u.aabb.minx=f.x),f.x>u.aabb.maxx&&(u.aabb.maxx=f.x),f.y<u.aabb.miny&&(u.aabb.miny=f.y),f.y>u.aabb.maxy&&(u.aabb.maxy=f.y),m=m.next}}}else{t=this.dynab,_=n.node;if(!_.synced){if(!t.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){x=n.circle;if(x.zip_worldCOM&&null!=x.body){if(x.zip_worldCOM=!1,x.zip_localCOM){if(x.zip_localCOM=!1,1==x.type){var b=x.polygon;if(null==b.lverts.next.next)b.localCOMx=b.lverts.next.x,b.localCOMy=b.lverts.next.y;else if(null==b.lverts.next.next.next)b.localCOMx=b.lverts.next.x,b.localCOMy=b.lverts.next.y,b.localCOMx+=b.lverts.next.next.x,b.localCOMy+=b.lverts.next.next.y,b.localCOMx*=.5,b.localCOMy*=.5;else{b.localCOMx=0;var g=b.localCOMy=0,w=b.lverts.next,M=w,C=w=w.next;for(w=w.next;null!=w;){var k=w;g+=C.x*(k.y-M.y);var O=k.y*C.x-k.x*C.y;b.localCOMx+=(C.x+k.x)*O,b.localCOMy+=(C.y+k.y)*O,M=C,C=k,w=w.next}v=w=b.lverts.next;g+=C.x*(v.y-M.y);var P=v.y*C.x-v.x*C.y;b.localCOMx+=(C.x+v.x)*P,b.localCOMy+=(C.y+v.y)*P,M=C;var S=w=w.next;g+=v.x*(S.y-M.y);P=S.y*v.x-S.x*v.y;b.localCOMx+=(v.x+S.x)*P,b.localCOMy+=(v.y+S.y)*P;S=g=1/(3*g);b.localCOMx*=S,b.localCOMy*=S}}null!=x.wrap_localCOM&&(x.wrap_localCOM.zpp_inner.x=x.localCOMx,x.wrap_localCOM.zpp_inner.y=x.localCOMy)}P=x.body;P.zip_axis&&(P.zip_axis=!1,P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot)),x.worldCOMx=x.body.posx+(x.body.axisy*x.localCOMx-x.body.axisx*x.localCOMy),x.worldCOMy=x.body.posy+(x.localCOMx*x.body.axisx+x.localCOMy*x.body.axisy)}S=x.radius,P=x.radius;x.aabb.minx=x.worldCOMx-S,x.aabb.miny=x.worldCOMy-P,x.aabb.maxx=x.worldCOMx+S,x.aabb.maxy=x.worldCOMy+P}else{var A=n.polygon;if(A.zip_gverts&&null!=A.body){A.zip_gverts=!1,A.validate_lverts();var j=A.body;j.zip_axis&&(j.zip_axis=!1,j.axisx=Math.sin(j.rot),j.axisy=Math.cos(j.rot));for(var E=A.lverts.next,I=A.gverts.next;null!=I;){var T=I,N=E,E=E.next;T.x=A.body.posx+(A.body.axisy*N.x-A.body.axisx*N.y),T.y=A.body.posy+(N.x*A.body.axisx+N.y*A.body.axisy),I=I.next}}var j=A.gverts.next;A.aabb.minx=j.x,A.aabb.miny=j.y,A.aabb.maxx=j.x,A.aabb.maxy=j.y;for(var L=A.gverts.next.next;null!=L;){var V=L;V.x<A.aabb.minx&&(A.aabb.minx=V.x),V.x>A.aabb.maxx&&(A.aabb.maxx=V.x),V.y<A.aabb.miny&&(A.aabb.miny=V.y),V.y>A.aabb.maxy&&(A.aabb.maxy=V.y),L=L.next}}(_.dyn!=(1!=n.body.type&&!n.body.component.sleeping)||(j=_.aabb,!((n=n.aabb).minx>=j.minx&&n.miny>=j.miny&&n.maxx<=j.maxx&&n.maxy<=j.maxy)))&&(_.synced=!0,_.snext=t.syncs,t.syncs=_)}}},Yt.prototype.broadphase=function(n,t){},Yt.prototype.clear=function(){},Yt.prototype.shapesUnderPoint=function(n,t,e,i){return null},Yt.prototype.bodiesUnderPoint=function(n,t,e,i){return null},Yt.prototype.aabbShape=null,Yt.prototype.matrix=null,Yt.prototype.updateAABBShape=function(n){var t,e,i;null==this.aabbShape?(null==Yi.BodyType_STATIC&&(Yi.internal=!0,Yi.BodyType_STATIC=new tn,Yi.internal=!1),e=new Q(Yi.BodyType_STATIC).zpp_inner.wrap_shapes,i=this.aabbShape=new yn(yn.rect(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny)),e.zpp_inner.reverse_flag?e.push(i):e.unshift(i)):(p=this.aabbShape.zpp_inner.aabb,t=(n.maxx-n.minx)/(p.maxx-p.minx),x=(n.maxy-n.miny)/(p.maxy-p.miny),null==this.matrix&&(this.matrix=new G),(e=this.matrix).zpp_inner.a=t,null!=(i=e.zpp_inner)._invalidate&&i._invalidate(),l=this.matrix,(e=this.matrix).zpp_inner.c=0,null!=(i=e.zpp_inner)._invalidate&&i._invalidate(),l.zpp_inner.b=e.zpp_inner.c,null!=(l=l.zpp_inner)._invalidate&&l._invalidate(),(l=this.matrix).zpp_inner.d=x,null!=(l=l.zpp_inner)._invalidate&&l._invalidate(),(l=this.matrix).zpp_inner.tx=n.minx-t*p.minx,null!=(l=l.zpp_inner)._invalidate&&l._invalidate(),(l=this.matrix).zpp_inner.ty=n.miny-x*p.miny,null!=(x=l.zpp_inner)._invalidate&&x._invalidate(),this.aabbShape.transform(this.matrix));var p=this.aabbShape.zpp_inner;if(p.zip_aabb&&null!=p.body)if(p.zip_aabb=!1,0==p.type){var l=p.circle;if(l.zip_worldCOM&&null!=l.body){if(l.zip_worldCOM=!1,l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var r=l.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=r.lverts.next.next.x,r.localCOMy+=r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0;var o=r.localCOMy=0,a=r.lverts.next,s=a,_=a=a.next;for(a=a.next;null!=a;){var h=a;o+=_.x*(h.y-s.y);var u=h.y*_.x-h.x*_.y;r.localCOMx+=(_.x+h.x)*u,r.localCOMy+=(_.y+h.y)*u,s=_,_=h,a=a.next}var x=a=r.lverts.next;o+=_.x*(x.y-s.y);var d=x.y*_.x-x.x*_.y;r.localCOMx+=(_.x+x.x)*d,r.localCOMy+=(_.y+x.y)*d,s=_;var y=a=a.next;o+=x.x*(y.y-s.y);d=y.y*x.x-y.x*x.y;r.localCOMx+=(x.x+y.x)*d,r.localCOMy+=(x.y+y.y)*d;y=o=1/(3*o);r.localCOMx*=y,r.localCOMy*=y}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}d=l.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),l.worldCOMx=l.body.posx+(l.body.axisy*l.localCOMx-l.body.axisx*l.localCOMy),l.worldCOMy=l.body.posy+(l.localCOMx*l.body.axisx+l.localCOMy*l.body.axisy)}y=l.radius,d=l.radius;l.aabb.minx=l.worldCOMx-y,l.aabb.miny=l.worldCOMy-d,l.aabb.maxx=l.worldCOMx+y,l.aabb.maxy=l.worldCOMy+d}else{var z=p.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var c=z.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var v=z.lverts.next,m=z.gverts.next;null!=m;){var f=m,b=v,v=v.next;f.x=z.body.posx+(z.body.axisy*b.x-z.body.axisx*b.y),f.y=z.body.posy+(b.x*z.body.axisx+b.y*z.body.axisy),m=m.next}}c=z.gverts.next;z.aabb.minx=c.x,z.aabb.miny=c.y,z.aabb.maxx=c.x,z.aabb.maxy=c.y;for(var g=z.gverts.next.next;null!=g;){var w=g;w.x<z.aabb.minx&&(z.aabb.minx=w.x),w.x>z.aabb.maxx&&(z.aabb.maxx=w.x),w.y<z.aabb.miny&&(z.aabb.miny=w.y),w.y>z.aabb.maxy&&(z.aabb.maxy=w.y),g=g.next}}var M=this.aabbShape.zpp_inner.polygon;if(M.zip_gaxi&&null!=M.body){M.zip_gaxi=!1,M.validate_laxi();c=M.body;if(c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),M.zip_gverts&&null!=M.body){M.zip_gverts=!1,M.validate_lverts();var C=M.body;C.zip_axis&&(C.zip_axis=!1,C.axisx=Math.sin(C.rot),C.axisy=Math.cos(C.rot));for(var k=M.lverts.next,O=M.gverts.next;null!=O;){var P=O,S=k,k=k.next;P.x=M.body.posx+(M.body.axisy*S.x-M.body.axisx*S.y),P.y=M.body.posy+(S.x*M.body.axisx+S.y*M.body.axisy),O=O.next}}for(var A=M.edges.head,j=E=M.gverts.next,E=E.next;null!=E;){var I=E,T=A.elt,A=A.next;T.gp0=j,T.gp1=I,T.gnormx=M.body.axisy*T.lnormx-M.body.axisx*T.lnormy,T.gnormy=T.lnormx*M.body.axisx+T.lnormy*M.body.axisy,T.gprojection=M.body.posx*T.gnormx+M.body.posy*T.gnormy+T.lprojection,null!=T.wrap_gnorm&&(T.wrap_gnorm.zpp_inner.x=T.gnormx,T.wrap_gnorm.zpp_inner.y=T.gnormy),T.tp0=T.gp0.y*T.gnormx-T.gp0.x*T.gnormy,T.tp1=T.gp1.y*T.gnormx-T.gp1.x*T.gnormy,j=I,E=E.next}C=A.elt;C.gp0=j,C.gp1=M.gverts.next,C.gnormx=M.body.axisy*C.lnormx-M.body.axisx*C.lnormy,C.gnormy=C.lnormx*M.body.axisx+C.lnormy*M.body.axisy,C.gprojection=M.body.posx*C.gnormx+M.body.posy*C.gnormy+C.lprojection,null!=C.wrap_gnorm&&(C.wrap_gnorm.zpp_inner.x=C.gnormx,C.wrap_gnorm.zpp_inner.y=C.gnormy),C.tp0=C.gp0.y*C.gnormx-C.gp0.x*C.gnormy,C.tp1=C.gp1.y*C.gnormx-C.gp1.x*C.gnormy}},Yt.prototype.shapesInAABB=function(n,t,e,i,p){return null},Yt.prototype.bodiesInAABB=function(n,t,e,i,p){return null},Yt.prototype.circShape=null,Yt.prototype.updateCircShape=function(n,t,e){var i,p,l,r;null==this.circShape?(null==Yi.BodyType_STATIC&&(Yi.internal=!0,Yi.BodyType_STATIC=new tn,Yi.internal=!1),i=new Q(Yi.BodyType_STATIC).zpp_inner.wrap_shapes,null==Vi.poolVec2?r=new Cn:(r=Vi.poolVec2,Vi.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner?(null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t,r.zpp_inner=p,r.zpp_inner.outer=r):(null!=(p=r.zpp_inner)._validate&&p._validate(),r.zpp_inner.x==n&&(null!=(l=r.zpp_inner)._validate&&l._validate(),r.zpp_inner.y==t)||(r.zpp_inner.x=n,r.zpp_inner.y=t,null!=(l=r.zpp_inner)._invalidate&&l._invalidate(l))),r.zpp_inner.weak=!1,r=this.circShape=new un(e,r),i.zpp_inner.reverse_flag?i.push(r):i.unshift(r)):(z=e/(o=this.circShape.zpp_inner.circle).radius,null==this.matrix&&(this.matrix=new G),r=this.matrix,(a=this.matrix).zpp_inner.d=z,null!=(e=a.zpp_inner)._invalidate&&e._invalidate(),r.zpp_inner.a=a.zpp_inner.d,null!=(e=r.zpp_inner)._invalidate&&e._invalidate(),a=this.matrix,(r=this.matrix).zpp_inner.c=0,null!=(e=r.zpp_inner)._invalidate&&e._invalidate(),a.zpp_inner.b=r.zpp_inner.c,null!=(a=a.zpp_inner)._invalidate&&a._invalidate(),(a=this.matrix).zpp_inner.tx=n-z*o.localCOMx,null!=(a=a.zpp_inner)._invalidate&&a._invalidate(),(a=this.matrix).zpp_inner.ty=t-z*o.localCOMy,null!=(z=a.zpp_inner)._invalidate&&z._invalidate(),this.circShape.transform(this.matrix));var o=this.circShape.zpp_inner;if(o.zip_aabb&&null!=o.body)if(o.zip_aabb=!1,0==o.type){var a=o.circle;if(a.zip_worldCOM&&null!=a.body){if(a.zip_worldCOM=!1,a.zip_localCOM){if(a.zip_localCOM=!1,1==a.type){var s=a.polygon;if(null==s.lverts.next.next)s.localCOMx=s.lverts.next.x,s.localCOMy=s.lverts.next.y;else if(null==s.lverts.next.next.next)s.localCOMx=s.lverts.next.x,s.localCOMy=s.lverts.next.y,s.localCOMx+=s.lverts.next.next.x,s.localCOMy+=s.lverts.next.next.y,s.localCOMx*=.5,s.localCOMy*=.5;else{s.localCOMx=0;var _=s.localCOMy=0,h=s.lverts.next,u=h,x=h=h.next;for(h=h.next;null!=h;){var d=h;_+=x.x*(d.y-u.y);var y=d.y*x.x-d.x*x.y;s.localCOMx+=(x.x+d.x)*y,s.localCOMy+=(x.y+d.y)*y,u=x,x=d,h=h.next}var z=h=s.lverts.next;_+=x.x*(z.y-u.y);var c=z.y*x.x-z.x*x.y;s.localCOMx+=(x.x+z.x)*c,s.localCOMy+=(x.y+z.y)*c,u=x;var v=h=h.next;_+=z.x*(v.y-u.y);c=v.y*z.x-v.x*z.y;s.localCOMx+=(z.x+v.x)*c,s.localCOMy+=(z.y+v.y)*c;v=_=1/(3*_);s.localCOMx*=v,s.localCOMy*=v}}null!=a.wrap_localCOM&&(a.wrap_localCOM.zpp_inner.x=a.localCOMx,a.wrap_localCOM.zpp_inner.y=a.localCOMy)}c=a.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),a.worldCOMx=a.body.posx+(a.body.axisy*a.localCOMx-a.body.axisx*a.localCOMy),a.worldCOMy=a.body.posy+(a.localCOMx*a.body.axisx+a.localCOMy*a.body.axisy)}v=a.radius,c=a.radius;a.aabb.minx=a.worldCOMx-v,a.aabb.miny=a.worldCOMy-c,a.aabb.maxx=a.worldCOMx+v,a.aabb.maxy=a.worldCOMy+c}else{var m=o.polygon;if(m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var f=m.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var b=m.lverts.next,g=m.gverts.next;null!=g;){var w=g,M=b,b=b.next;w.x=m.body.posx+(m.body.axisy*M.x-m.body.axisx*M.y),w.y=m.body.posy+(M.x*m.body.axisx+M.y*m.body.axisy),g=g.next}}f=m.gverts.next;m.aabb.minx=f.x,m.aabb.miny=f.y,m.aabb.maxx=f.x,m.aabb.maxy=f.y;for(var C=m.gverts.next.next;null!=C;){var k=C;k.x<m.aabb.minx&&(m.aabb.minx=k.x),k.x>m.aabb.maxx&&(m.aabb.maxx=k.x),k.y<m.aabb.miny&&(m.aabb.miny=k.y),k.y>m.aabb.maxy&&(m.aabb.maxy=k.y),C=C.next}}},Yt.prototype.shapesInCircle=function(n,t,e,i,p,l){return null},Yt.prototype.bodiesInCircle=function(n,t,e,i,p,l){return null},Yt.prototype.validateShape=function(n){if(1==n.type){var t=n.polygon;if(t.zip_gaxi&&null!=t.body){t.zip_gaxi=!1,t.validate_laxi();var e=t.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),t.zip_gverts&&null!=t.body){t.zip_gverts=!1,t.validate_lverts();var i=t.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var p=t.lverts.next,l=t.gverts.next;null!=l;){var r=l,o=p,p=p.next;r.x=t.body.posx+(t.body.axisy*o.x-t.body.axisx*o.y),r.y=t.body.posy+(o.x*t.body.axisx+o.y*t.body.axisy),l=l.next}}for(var a=t.edges.head,s=_=t.gverts.next,_=_.next;null!=_;){var h=_,u=a.elt,a=a.next;u.gp0=s,u.gp1=h,u.gnormx=t.body.axisy*u.lnormx-t.body.axisx*u.lnormy,u.gnormy=u.lnormx*t.body.axisx+u.lnormy*t.body.axisy,u.gprojection=t.body.posx*u.gnormx+t.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,s=h,_=_.next}e=a.elt;e.gp0=s,e.gp1=t.gverts.next,e.gnormx=t.body.axisy*e.lnormx-t.body.axisx*e.lnormy,e.gnormy=e.lnormx*t.body.axisx+e.lnormy*t.body.axisy,e.gprojection=t.body.posx*e.gnormx+t.body.posy*e.gnormy+e.lprojection,null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy),e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy,e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){i=n.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var x=i.polygon;if(null==x.lverts.next.next)x.localCOMx=x.lverts.next.x,x.localCOMy=x.lverts.next.y;else if(null==x.lverts.next.next.next)x.localCOMx=x.lverts.next.x,x.localCOMy=x.lverts.next.y,x.localCOMx+=x.lverts.next.next.x,x.localCOMy+=x.lverts.next.next.y,x.localCOMx*=.5,x.localCOMy*=.5;else{x.localCOMx=0;var d=x.localCOMy=0,y=x.lverts.next,z=y,c=y=y.next;for(y=y.next;null!=y;){var v=y;d+=c.x*(v.y-z.y);var m=v.y*c.x-v.x*c.y;x.localCOMx+=(c.x+v.x)*m,x.localCOMy+=(c.y+v.y)*m,z=c,c=v,y=y.next}e=y=x.lverts.next;d+=c.x*(e.y-z.y);var f=e.y*c.x-e.x*c.y;x.localCOMx+=(c.x+e.x)*f,x.localCOMy+=(c.y+e.y)*f,z=c;var b=y=y.next;d+=e.x*(b.y-z.y);f=b.y*e.x-b.x*e.y;x.localCOMx+=(e.x+b.x)*f,x.localCOMy+=(e.y+b.y)*f;b=d=1/(3*d);x.localCOMx*=b,x.localCOMy*=b}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}f=i.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}b=i.radius,f=i.radius;i.aabb.minx=i.worldCOMx-b,i.aabb.miny=i.worldCOMy-f,i.aabb.maxx=i.worldCOMx+b,i.aabb.maxy=i.worldCOMy+f}else{var g=n.polygon;if(g.zip_gverts&&null!=g.body){g.zip_gverts=!1,g.validate_lverts();var w=g.body;w.zip_axis&&(w.zip_axis=!1,w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot));for(var M=g.lverts.next,C=g.gverts.next;null!=C;){var k=C,O=M,M=M.next;k.x=g.body.posx+(g.body.axisy*O.x-g.body.axisx*O.y),k.y=g.body.posy+(O.x*g.body.axisx+O.y*g.body.axisy),C=C.next}}var P=g.gverts.next;g.aabb.minx=P.x,g.aabb.miny=P.y,g.aabb.maxx=P.x,g.aabb.maxy=P.y;for(var S=g.gverts.next.next;null!=S;){var A=S;A.x<g.aabb.minx&&(g.aabb.minx=A.x),A.x>g.aabb.maxx&&(g.aabb.maxx=A.x),A.y<g.aabb.miny&&(g.aabb.miny=A.y),A.y>g.aabb.maxy&&(g.aabb.maxy=A.y),S=S.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var j=n.polygon;if(null==j.lverts.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y;else if(null==j.lverts.next.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y,j.localCOMx+=j.lverts.next.next.x,j.localCOMy+=j.lverts.next.next.y,j.localCOMx*=.5,j.localCOMy*=.5;else{j.localCOMx=0;var E=j.localCOMy=0,I=j.lverts.next,T=I,N=I=I.next;for(I=I.next;null!=I;){var L=I;E+=N.x*(L.y-T.y);var V=L.y*N.x-L.x*N.y;j.localCOMx+=(N.x+L.x)*V,j.localCOMy+=(N.y+L.y)*V,T=N,N=L,I=I.next}w=I=j.lverts.next;E+=N.x*(w.y-T.y);var D=w.y*N.x-w.x*N.y;j.localCOMx+=(N.x+w.x)*D,j.localCOMy+=(N.y+w.y)*D,T=N;P=I=I.next;E+=w.x*(P.y-T.y);D=P.y*w.x-P.x*w.y;j.localCOMx+=(w.x+P.x)*D,j.localCOMy+=(w.y+P.y)*D;D=E=1/(3*E);j.localCOMx*=D,j.localCOMy*=D}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}D=n.body;D.zip_axis&&(D.zip_axis=!1,D.axisx=Math.sin(D.rot),D.axisy=Math.cos(D.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}},Yt.prototype.shapesInShape=function(n,t,e,i){return null},Yt.prototype.bodiesInShape=function(n,t,e,i){return null},Yt.prototype.rayCast=function(n,t,e){return null},Yt.prototype.rayMultiCast=function(n,t,e,i){return null},Yt.prototype.__class__=Yt;var Jt=zpp_nape.space.ZPP_AABBNode=function(){this.first_sync=!1,this.synced=!1,this.snext=null,this.moved=!1,this.mnext=null,this.next=null,this.rayt=0,this.height=0,this.child2=null,this.child1=null,this.parent=null,this.dyn=!1,this.shape=null,this.aabb=null,this.height=-1};Jt.__name__=["zpp_nape","space","ZPP_AABBNode"],Jt.prototype.aabb=null,Jt.prototype.shape=null,Jt.prototype.dyn=null,Jt.prototype.parent=null,Jt.prototype.child1=null,Jt.prototype.child2=null,Jt.prototype.height=null,Jt.prototype.rayt=null,Jt.prototype.next=null,Jt.prototype.alloc=function(){null==Lt.zpp_pool?this.aabb=new Lt:(this.aabb=Lt.zpp_pool,Lt.zpp_pool=this.aabb.next,this.aabb.next=null),this.moved=!1,this.synced=!1,this.first_sync=!1},Jt.prototype.free=function(){this.height=-1;var n=this.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Lt.zpp_pool,Lt.zpp_pool=n,this.child1=this.child2=this.parent=null,this.next=null,this.snext=null,this.mnext=null},Jt.prototype.mnext=null,Jt.prototype.moved=null,Jt.prototype.snext=null,Jt.prototype.synced=null,Jt.prototype.first_sync=null,Jt.prototype.isLeaf=function(){return null==this.child1},Jt.prototype.__class__=Jt;var Xt=zpp_nape.space.ZPP_AABBPair=function(){this.next=null,this.arb=null,this.di=0,this.id=0,this.sleeping=!1,this.first=!1,this.n2=null,this.n1=null};Xt.__name__=["zpp_nape","space","ZPP_AABBPair"],Xt.prototype.n1=null,Xt.prototype.n2=null,Xt.prototype.first=null,Xt.prototype.sleeping=null,Xt.prototype.id=null,Xt.prototype.di=null,Xt.prototype.arb=null,Xt.prototype.next=null,Xt.prototype.alloc=function(){},Xt.prototype.free=function(){this.n1=this.n2=null,this.sleeping=!1},Xt.prototype.__class__=Xt;var Ht=zpp_nape.space.ZPP_AABBTree=function(){this.root=null};Ht.__name__=["zpp_nape","space","ZPP_AABBTree"],Ht.prototype.root=null,Ht.prototype.clear=function(){if(null!=this.root){var n=null;for(this.root.next=n,n=this.root;null!=n;){var t=n,n=t.next;(t.next=null)==t.child1?(t.shape.node=null,t.shape.removedFromSpace(),t.shape=null):(null!=t.child1&&(t.child1.next=n,n=t.child1),null!=t.child2&&(t.child2.next=n,n=t.child2)),t.height=-1;var e=t.aabb;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e.wrap_min=e.wrap_max=null,e._invalidate=null,e._validate=null,e.next=Lt.zpp_pool,Lt.zpp_pool=e,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=Jt.zpp_pool,Jt.zpp_pool=t}this.root=null}},Ht.prototype.insertLeaf=function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var t=n.aabb,e=this.root;null!=e.child1;){var i=e.child1,p=e.child2,l=e.aabb,r=2*(l.maxx-l.minx+(l.maxy-l.miny)),o=Ht.tmpaabb,a=e.aabb;o.minx=(a.minx<t.minx?a:t).minx,o.miny=(a.miny<t.miny?a:t).miny,o.maxx=(a.maxx>t.maxx?a:t).maxx,o.maxy=(a.maxy>t.maxy?a:t).maxy;var s,l=Ht.tmpaabb,o=2*(l.maxx-l.minx+(l.maxy-l.miny)),a=2*o,l=2*(o-r),o=Ht.tmpaabb,r=i.aabb;o.minx=(t.minx<r.minx?t:r).minx,o.miny=(t.miny<r.miny?t:r).miny,o.maxx=(t.maxx>r.maxx?t:r).maxx,o.maxy=(t.maxy>r.maxy?t:r).maxy,s=null==i.child1?2*((r=Ht.tmpaabb).maxx-r.minx+(r.maxy-r.miny))+l:(u=2*((s=i.aabb).maxx-s.minx+(s.maxy-s.miny)),2*((h=Ht.tmpaabb).maxx-h.minx+(h.maxy-h.miny))-u+l);var _,h=Ht.tmpaabb,u=p.aabb;if(h.minx=(t.minx<u.minx?t:u).minx,h.miny=(t.miny<u.miny?t:u).miny,h.maxx=(t.maxx>u.maxx?t:u).maxx,h.maxy=(t.maxy>u.maxy?t:u).maxy,l=null==p.child1?2*((_=Ht.tmpaabb).maxx-_.minx+(_.maxy-_.miny))+l:(_=2*((u=p.aabb).maxx-u.minx+(u.maxy-u.miny)),2*((u=Ht.tmpaabb).maxx-u.minx+(u.maxy-u.miny))-_+l),a<s&&a<l)break;e=s<l?i:p}var x,d=e,y=d.parent;null==Jt.zpp_pool?x=new Jt:(x=Jt.zpp_pool,Jt.zpp_pool=x.next,x.next=null),null==Lt.zpp_pool?x.aabb=new Lt:(x.aabb=Lt.zpp_pool,Lt.zpp_pool=x.aabb.next,x.aabb.next=null),x.moved=!1,x.synced=!1,x.first_sync=!1,x.parent=y;var z,c,v,m,f,b,g,w,M,C,k=x.aabb,O=d.aabb;for(k.minx=(t.minx<O.minx?t:O).minx,k.miny=(t.miny<O.miny?t:O).miny,k.maxx=(t.maxx>O.maxx?t:O).maxx,k.maxy=(t.maxy>O.maxy?t:O).maxy,x.height=d.height+1,null!=y?(y.child1==d?y.child1=x:y.child2=x,x.child1=d,x.child2=n,d.parent=x,n.parent=x):(x.child1=d,x.child2=n,d.parent=x,n.parent=x,this.root=x),e=n.parent;null!=e;){null==e.child1||e.height<2||(j=e.child1,1<(M=(z=e.child2).height-j.height)?(c=z.child1,v=z.child2,z.child1=e,z.parent=e.parent,null!=(e.parent=z).parent?z.parent.child1==e?z.parent.child1=z:z.parent.child2=z:this.root=z,c.height>v.height?(z.child2=c,m=((e.child2=v).parent=e).aabb,f=j.aabb,b=v.aabb,m.minx=(f.minx<b.minx?f:b).minx,m.miny=(f.miny<b.miny?f:b).miny,m.maxx=(f.maxx>b.maxx?f:b).maxx,m.maxy=(f.maxy>b.maxy?f:b).maxy,m=z.aabb,f=e.aabb,b=c.aabb,m.minx=(f.minx<b.minx?f:b).minx,m.miny=(f.miny<b.miny?f:b).miny,m.maxx=(f.maxx>b.maxx?f:b).maxx,m.maxy=(f.maxy>b.maxy?f:b).maxy,f=j.height,b=v.height,e.height=1+(b<f?f:b),f=e.height,b=c.height,z.height=1+(b<f?f:b)):(z.child2=v,b=((e.child2=c).parent=e).aabb,g=j.aabb,w=c.aabb,b.minx=(g.minx<w.minx?g:w).minx,b.miny=(g.miny<w.miny?g:w).miny,b.maxx=(g.maxx>w.maxx?g:w).maxx,b.maxy=(g.maxy>w.maxy?g:w).maxy,b=z.aabb,g=e.aabb,w=v.aabb,b.minx=(g.minx<w.minx?g:w).minx,b.miny=(g.miny<w.miny?g:w).miny,b.maxx=(g.maxx>w.maxx?g:w).maxx,b.maxy=(g.maxy>w.maxy?g:w).maxy,g=j.height,w=c.height,e.height=1+(w<g?g:w),g=e.height,w=v.height,z.height=1+(w<g?g:w)),e=z):M<-1&&(g=j.child1,P=j.child2,j.child1=e,j.parent=e.parent,null!=(e.parent=j).parent?j.parent.child1==e?j.parent.child1=j:j.parent.child2=j:this.root=j,g.height>P.height?(j.child2=g,w=((e.child1=P).parent=e).aabb,M=z.aabb,C=P.aabb,w.minx=(M.minx<C.minx?M:C).minx,w.miny=(M.miny<C.miny?M:C).miny,w.maxx=(M.maxx>C.maxx?M:C).maxx,w.maxy=(M.maxy>C.maxy?M:C).maxy,w=j.aabb,M=e.aabb,C=g.aabb,w.minx=(M.minx<C.minx?M:C).minx,w.miny=(M.miny<C.miny?M:C).miny,w.maxx=(M.maxx>C.maxx?M:C).maxx,w.maxy=(M.maxy>C.maxy?M:C).maxy,M=z.height,C=P.height,e.height=1+(C<M?M:C),M=e.height,C=g.height,j.height=1+(C<M?M:C)):(j.child2=P,C=((e.child1=g).parent=e).aabb,S=z.aabb,A=g.aabb,C.minx=(S.minx<A.minx?S:A).minx,C.miny=(S.miny<A.miny?S:A).miny,C.maxx=(S.maxx>A.maxx?S:A).maxx,C.maxy=(S.maxy>A.maxy?S:A).maxy,C=j.aabb,S=e.aabb,A=P.aabb,C.minx=(S.minx<A.minx?S:A).minx,C.miny=(S.miny<A.miny?S:A).miny,C.maxx=(S.maxx>A.maxx?S:A).maxx,C.maxy=(S.maxy>A.maxy?S:A).maxy,S=z.height,A=g.height,e.height=1+(A<S?S:A),S=e.height,A=P.height,j.height=1+(A<S?S:A)),e=j));var P=e.child1,S=e.child2,A=P.height,j=S.height;e.height=1+(j<A?A:j);j=e.aabb,P=P.aabb,S=S.aabb;j.minx=(P.minx<S.minx?P:S).minx,j.miny=(P.miny<S.miny?P:S).miny,j.maxx=(P.maxx>S.maxx?P:S).maxx,j.maxy=(P.maxy>S.maxy?P:S).maxy,e=e.parent}}},Ht.prototype.inlined_insertLeaf=function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var t=n.aabb,e=this.root;null!=e.child1;){var i=e.child1,p=e.child2,l=e.aabb,r=2*(l.maxx-l.minx+(l.maxy-l.miny)),o=Ht.tmpaabb,a=e.aabb;o.minx=(a.minx<t.minx?a:t).minx,o.miny=(a.miny<t.miny?a:t).miny,o.maxx=(a.maxx>t.maxx?a:t).maxx,o.maxy=(a.maxy>t.maxy?a:t).maxy;var s,l=Ht.tmpaabb,o=2*(l.maxx-l.minx+(l.maxy-l.miny)),a=2*o,l=2*(o-r),o=Ht.tmpaabb,r=i.aabb;o.minx=(t.minx<r.minx?t:r).minx,o.miny=(t.miny<r.miny?t:r).miny,o.maxx=(t.maxx>r.maxx?t:r).maxx,o.maxy=(t.maxy>r.maxy?t:r).maxy,s=null==i.child1?2*((r=Ht.tmpaabb).maxx-r.minx+(r.maxy-r.miny))+l:(u=2*((s=i.aabb).maxx-s.minx+(s.maxy-s.miny)),2*((h=Ht.tmpaabb).maxx-h.minx+(h.maxy-h.miny))-u+l);var _,h=Ht.tmpaabb,u=p.aabb;if(h.minx=(t.minx<u.minx?t:u).minx,h.miny=(t.miny<u.miny?t:u).miny,h.maxx=(t.maxx>u.maxx?t:u).maxx,h.maxy=(t.maxy>u.maxy?t:u).maxy,l=null==p.child1?2*((_=Ht.tmpaabb).maxx-_.minx+(_.maxy-_.miny))+l:(_=2*((u=p.aabb).maxx-u.minx+(u.maxy-u.miny)),2*((u=Ht.tmpaabb).maxx-u.minx+(u.maxy-u.miny))-_+l),a<s&&a<l)break;e=s<l?i:p}var x,d=e,y=d.parent;null==Jt.zpp_pool?x=new Jt:(x=Jt.zpp_pool,Jt.zpp_pool=x.next,x.next=null),null==Lt.zpp_pool?x.aabb=new Lt:(x.aabb=Lt.zpp_pool,Lt.zpp_pool=x.aabb.next,x.aabb.next=null),x.moved=!1,x.synced=!1,x.first_sync=!1,x.parent=y;var z,c,v,m,f,b,g,w,M,C,k=x.aabb,O=d.aabb;for(k.minx=(t.minx<O.minx?t:O).minx,k.miny=(t.miny<O.miny?t:O).miny,k.maxx=(t.maxx>O.maxx?t:O).maxx,k.maxy=(t.maxy>O.maxy?t:O).maxy,x.height=d.height+1,null!=y?(y.child1==d?y.child1=x:y.child2=x,x.child1=d,x.child2=n,d.parent=x,n.parent=x):(x.child1=d,x.child2=n,d.parent=x,n.parent=x,this.root=x),e=n.parent;null!=e;){null==e.child1||e.height<2||(j=e.child1,1<(M=(z=e.child2).height-j.height)?(c=z.child1,v=z.child2,z.child1=e,z.parent=e.parent,null!=(e.parent=z).parent?z.parent.child1==e?z.parent.child1=z:z.parent.child2=z:this.root=z,c.height>v.height?(z.child2=c,m=((e.child2=v).parent=e).aabb,f=j.aabb,b=v.aabb,m.minx=(f.minx<b.minx?f:b).minx,m.miny=(f.miny<b.miny?f:b).miny,m.maxx=(f.maxx>b.maxx?f:b).maxx,m.maxy=(f.maxy>b.maxy?f:b).maxy,m=z.aabb,f=e.aabb,b=c.aabb,m.minx=(f.minx<b.minx?f:b).minx,m.miny=(f.miny<b.miny?f:b).miny,m.maxx=(f.maxx>b.maxx?f:b).maxx,m.maxy=(f.maxy>b.maxy?f:b).maxy,f=j.height,b=v.height,e.height=1+(b<f?f:b),f=e.height,b=c.height,z.height=1+(b<f?f:b)):(z.child2=v,b=((e.child2=c).parent=e).aabb,g=j.aabb,w=c.aabb,b.minx=(g.minx<w.minx?g:w).minx,b.miny=(g.miny<w.miny?g:w).miny,b.maxx=(g.maxx>w.maxx?g:w).maxx,b.maxy=(g.maxy>w.maxy?g:w).maxy,b=z.aabb,g=e.aabb,w=v.aabb,b.minx=(g.minx<w.minx?g:w).minx,b.miny=(g.miny<w.miny?g:w).miny,b.maxx=(g.maxx>w.maxx?g:w).maxx,b.maxy=(g.maxy>w.maxy?g:w).maxy,g=j.height,w=c.height,e.height=1+(w<g?g:w),g=e.height,w=v.height,z.height=1+(w<g?g:w)),e=z):M<-1&&(g=j.child1,P=j.child2,j.child1=e,j.parent=e.parent,null!=(e.parent=j).parent?j.parent.child1==e?j.parent.child1=j:j.parent.child2=j:this.root=j,g.height>P.height?(j.child2=g,w=((e.child1=P).parent=e).aabb,M=z.aabb,C=P.aabb,w.minx=(M.minx<C.minx?M:C).minx,w.miny=(M.miny<C.miny?M:C).miny,w.maxx=(M.maxx>C.maxx?M:C).maxx,w.maxy=(M.maxy>C.maxy?M:C).maxy,w=j.aabb,M=e.aabb,C=g.aabb,w.minx=(M.minx<C.minx?M:C).minx,w.miny=(M.miny<C.miny?M:C).miny,w.maxx=(M.maxx>C.maxx?M:C).maxx,w.maxy=(M.maxy>C.maxy?M:C).maxy,M=z.height,C=P.height,e.height=1+(C<M?M:C),M=e.height,C=g.height,j.height=1+(C<M?M:C)):(j.child2=P,C=((e.child1=g).parent=e).aabb,S=z.aabb,A=g.aabb,C.minx=(S.minx<A.minx?S:A).minx,C.miny=(S.miny<A.miny?S:A).miny,C.maxx=(S.maxx>A.maxx?S:A).maxx,C.maxy=(S.maxy>A.maxy?S:A).maxy,C=j.aabb,S=e.aabb,A=P.aabb,C.minx=(S.minx<A.minx?S:A).minx,C.miny=(S.miny<A.miny?S:A).miny,C.maxx=(S.maxx>A.maxx?S:A).maxx,C.maxy=(S.maxy>A.maxy?S:A).maxy,S=z.height,A=g.height,e.height=1+(A<S?S:A),S=e.height,A=P.height,j.height=1+(A<S?S:A)),e=j));var P=e.child1,S=e.child2,A=P.height,j=S.height;e.height=1+(j<A?A:j);j=e.aabb,P=P.aabb,S=S.aabb;j.minx=(P.minx<S.minx?P:S).minx,j.miny=(P.miny<S.miny?P:S).miny,j.maxx=(P.maxx>S.maxx?P:S).maxx,j.maxy=(P.maxy>S.maxy?P:S).maxy,e=e.parent}}},Ht.prototype.removeLeaf=function(n){if(n==this.root)this.root=null;else{var t=n.parent,e=t.parent,i=t.child1==n?t.child2:t.child1;if(null!=e){e.child1==t?e.child1=i:e.child2=i,i.parent=e,t.height=-1;n=t.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Lt.zpp_pool,Lt.zpp_pool=n,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=Jt.zpp_pool,Jt.zpp_pool=t;for(var p,l,r,o,a,s,_,h,u,x=e;null!=x;){null==x.child1||x.height<2||(v=x.child1,1<(u=(p=x.child2).height-v.height)?(l=p.child1,s=p.child2,p.child1=x,p.parent=x.parent,null!=(x.parent=p).parent?p.parent.child1==x?p.parent.child1=p:p.parent.child2=p:this.root=p,l.height>s.height?(p.child2=l,r=((x.child2=s).parent=x).aabb,o=v.aabb,a=s.aabb,r.minx=(o.minx<a.minx?o:a).minx,r.miny=(o.miny<a.miny?o:a).miny,r.maxx=(o.maxx>a.maxx?o:a).maxx,r.maxy=(o.maxy>a.maxy?o:a).maxy,r=p.aabb,o=x.aabb,a=l.aabb,r.minx=(o.minx<a.minx?o:a).minx,r.miny=(o.miny<a.miny?o:a).miny,r.maxx=(o.maxx>a.maxx?o:a).maxx,r.maxy=(o.maxy>a.maxy?o:a).maxy,o=v.height,a=s.height,x.height=1+(a<o?o:a),o=x.height,a=l.height,p.height=1+(a<o?o:a)):(p.child2=s,a=((x.child2=l).parent=x).aabb,_=v.aabb,h=l.aabb,a.minx=(_.minx<h.minx?_:h).minx,a.miny=(_.miny<h.miny?_:h).miny,a.maxx=(_.maxx>h.maxx?_:h).maxx,a.maxy=(_.maxy>h.maxy?_:h).maxy,a=p.aabb,_=x.aabb,h=s.aabb,a.minx=(_.minx<h.minx?_:h).minx,a.miny=(_.miny<h.miny?_:h).miny,a.maxx=(_.maxx>h.maxx?_:h).maxx,a.maxy=(_.maxy>h.maxy?_:h).maxy,_=v.height,h=l.height,x.height=1+(h<_?_:h),_=x.height,h=s.height,p.height=1+(h<_?_:h)),x=p):u<-1&&(s=v.child1,y=v.child2,v.child1=x,v.parent=x.parent,null!=(x.parent=v).parent?v.parent.child1==x?v.parent.child1=v:v.parent.child2=v:this.root=v,s.height>y.height?(v.child2=s,_=((x.child1=y).parent=x).aabb,h=p.aabb,u=y.aabb,_.minx=(h.minx<u.minx?h:u).minx,_.miny=(h.miny<u.miny?h:u).miny,_.maxx=(h.maxx>u.maxx?h:u).maxx,_.maxy=(h.maxy>u.maxy?h:u).maxy,_=v.aabb,h=x.aabb,u=s.aabb,_.minx=(h.minx<u.minx?h:u).minx,_.miny=(h.miny<u.miny?h:u).miny,_.maxx=(h.maxx>u.maxx?h:u).maxx,_.maxy=(h.maxy>u.maxy?h:u).maxy,h=p.height,u=y.height,x.height=1+(u<h?h:u),h=x.height,u=s.height,v.height=1+(u<h?h:u)):(v.child2=y,c=((x.child1=s).parent=x).aabb,d=p.aabb,z=s.aabb,c.minx=(d.minx<z.minx?d:z).minx,c.miny=(d.miny<z.miny?d:z).miny,c.maxx=(d.maxx>z.maxx?d:z).maxx,c.maxy=(d.maxy>z.maxy?d:z).maxy,c=v.aabb,d=x.aabb,z=y.aabb,c.minx=(d.minx<z.minx?d:z).minx,c.miny=(d.miny<z.miny?d:z).miny,c.maxx=(d.maxx>z.maxx?d:z).maxx,c.maxy=(d.maxy>z.maxy?d:z).maxy,c=p.height,d=s.height,x.height=1+(d<c?c:d),z=x.height,c=y.height,v.height=1+(c<z?z:c)),x=v));var d=x.child1,y=x.child2,z=x.aabb,c=d.aabb,v=y.aabb;z.minx=(c.minx<v.minx?c:v).minx,z.miny=(c.miny<v.miny?c:v).miny,z.maxx=(c.maxx>v.maxx?c:v).maxx,z.maxy=(c.maxy>v.maxy?c:v).maxy;d=d.height,y=y.height;x.height=1+(y<d?d:y),x=x.parent}}else{(this.root=i).parent=null,t.height=-1;i=t.aabb;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i.wrap_min=i.wrap_max=null,i._invalidate=null,i._validate=null,i.next=Lt.zpp_pool,Lt.zpp_pool=i,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=Jt.zpp_pool,Jt.zpp_pool=t}}},Ht.prototype.inlined_removeLeaf=function(n){if(n==this.root)this.root=null;else{var t=n.parent,e=t.parent,i=t.child1==n?t.child2:t.child1;if(null!=e){e.child1==t?e.child1=i:e.child2=i,i.parent=e,t.height=-1;n=t.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Lt.zpp_pool,Lt.zpp_pool=n,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=Jt.zpp_pool,Jt.zpp_pool=t;for(var p,l,r,o,a,s,_,h,u,x=e;null!=x;){null==x.child1||x.height<2||(v=x.child1,1<(u=(p=x.child2).height-v.height)?(l=p.child1,s=p.child2,p.child1=x,p.parent=x.parent,null!=(x.parent=p).parent?p.parent.child1==x?p.parent.child1=p:p.parent.child2=p:this.root=p,l.height>s.height?(p.child2=l,r=((x.child2=s).parent=x).aabb,o=v.aabb,a=s.aabb,r.minx=(o.minx<a.minx?o:a).minx,r.miny=(o.miny<a.miny?o:a).miny,r.maxx=(o.maxx>a.maxx?o:a).maxx,r.maxy=(o.maxy>a.maxy?o:a).maxy,r=p.aabb,o=x.aabb,a=l.aabb,r.minx=(o.minx<a.minx?o:a).minx,r.miny=(o.miny<a.miny?o:a).miny,r.maxx=(o.maxx>a.maxx?o:a).maxx,r.maxy=(o.maxy>a.maxy?o:a).maxy,o=v.height,a=s.height,x.height=1+(a<o?o:a),o=x.height,a=l.height,p.height=1+(a<o?o:a)):(p.child2=s,a=((x.child2=l).parent=x).aabb,_=v.aabb,h=l.aabb,a.minx=(_.minx<h.minx?_:h).minx,a.miny=(_.miny<h.miny?_:h).miny,a.maxx=(_.maxx>h.maxx?_:h).maxx,a.maxy=(_.maxy>h.maxy?_:h).maxy,a=p.aabb,_=x.aabb,h=s.aabb,a.minx=(_.minx<h.minx?_:h).minx,a.miny=(_.miny<h.miny?_:h).miny,a.maxx=(_.maxx>h.maxx?_:h).maxx,a.maxy=(_.maxy>h.maxy?_:h).maxy,_=v.height,h=l.height,x.height=1+(h<_?_:h),_=x.height,h=s.height,p.height=1+(h<_?_:h)),x=p):u<-1&&(s=v.child1,y=v.child2,v.child1=x,v.parent=x.parent,null!=(x.parent=v).parent?v.parent.child1==x?v.parent.child1=v:v.parent.child2=v:this.root=v,s.height>y.height?(v.child2=s,_=((x.child1=y).parent=x).aabb,h=p.aabb,u=y.aabb,_.minx=(h.minx<u.minx?h:u).minx,_.miny=(h.miny<u.miny?h:u).miny,_.maxx=(h.maxx>u.maxx?h:u).maxx,_.maxy=(h.maxy>u.maxy?h:u).maxy,_=v.aabb,h=x.aabb,u=s.aabb,_.minx=(h.minx<u.minx?h:u).minx,_.miny=(h.miny<u.miny?h:u).miny,_.maxx=(h.maxx>u.maxx?h:u).maxx,_.maxy=(h.maxy>u.maxy?h:u).maxy,h=p.height,u=y.height,x.height=1+(u<h?h:u),h=x.height,u=s.height,v.height=1+(u<h?h:u)):(v.child2=y,c=((x.child1=s).parent=x).aabb,d=p.aabb,z=s.aabb,c.minx=(d.minx<z.minx?d:z).minx,c.miny=(d.miny<z.miny?d:z).miny,c.maxx=(d.maxx>z.maxx?d:z).maxx,c.maxy=(d.maxy>z.maxy?d:z).maxy,c=v.aabb,d=x.aabb,z=y.aabb,c.minx=(d.minx<z.minx?d:z).minx,c.miny=(d.miny<z.miny?d:z).miny,c.maxx=(d.maxx>z.maxx?d:z).maxx,c.maxy=(d.maxy>z.maxy?d:z).maxy,c=p.height,d=s.height,x.height=1+(d<c?c:d),z=x.height,c=y.height,v.height=1+(c<z?z:c)),x=v));var d=x.child1,y=x.child2,z=x.aabb,c=d.aabb,v=y.aabb;z.minx=(c.minx<v.minx?c:v).minx,z.miny=(c.miny<v.miny?c:v).miny,z.maxx=(c.maxx>v.maxx?c:v).maxx,z.maxy=(c.maxy>v.maxy?c:v).maxy;d=d.height,y=y.height;x.height=1+(y<d?d:y),x=x.parent}}else{(this.root=i).parent=null,t.height=-1;i=t.aabb;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i.wrap_min=i.wrap_max=null,i._invalidate=null,i._validate=null,i.next=Lt.zpp_pool,Lt.zpp_pool=i,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=Jt.zpp_pool,Jt.zpp_pool=t}}},Ht.prototype.balance=function(n){if(null==n.child1||n.height<2)return n;var t=n.child1,e=n.child2,i=e.height-t.height;if(1<i){var p,l,r,o=e.child1,a=e.child2;return e.child1=n,e.parent=n.parent,null!=(n.parent=e).parent?e.parent.child1==n?e.parent.child1=e:e.parent.child2=e:this.root=e,o.height>a.height?(e.child2=o,p=((n.child2=a).parent=n).aabb,l=t.aabb,r=a.aabb,p.minx=(l.minx<r.minx?l:r).minx,p.miny=(l.miny<r.miny?l:r).miny,p.maxx=(l.maxx>r.maxx?l:r).maxx,p.maxy=(l.maxy>r.maxy?l:r).maxy,p=e.aabb,l=n.aabb,r=o.aabb,p.minx=(l.minx<r.minx?l:r).minx,p.miny=(l.miny<r.miny?l:r).miny,p.maxx=(l.maxx>r.maxx?l:r).maxx,p.maxy=(l.maxy>r.maxy?l:r).maxy,l=t.height,r=a.height,n.height=1+(r<l?l:r),l=n.height,r=o.height,e.height=1+(r<l?l:r)):(e.child2=a,l=((n.child2=o).parent=n).aabb,r=t.aabb,u=o.aabb,l.minx=(r.minx<u.minx?r:u).minx,l.miny=(r.miny<u.miny?r:u).miny,l.maxx=(r.maxx>u.maxx?r:u).maxx,l.maxy=(r.maxy>u.maxy?r:u).maxy,l=e.aabb,r=n.aabb,u=a.aabb,l.minx=(r.minx<u.minx?r:u).minx,l.miny=(r.miny<u.miny?r:u).miny,l.maxx=(r.maxx>u.maxx?r:u).maxx,l.maxy=(r.maxy>u.maxy?r:u).maxy,r=t.height,u=o.height,n.height=1+(u<r?r:u),r=n.height,u=a.height,e.height=1+(u<r?r:u)),e}if(i<-1){var s,_,h,u=t.child1,i=t.child2;return t.child1=n,t.parent=n.parent,null!=(n.parent=t).parent?t.parent.child1==n?t.parent.child1=t:t.parent.child2=t:this.root=t,u.height>i.height?(t.child2=u,h=((n.child1=i).parent=n).aabb,s=e.aabb,_=i.aabb,h.minx=(s.minx<_.minx?s:_).minx,h.miny=(s.miny<_.miny?s:_).miny,h.maxx=(s.maxx>_.maxx?s:_).maxx,h.maxy=(s.maxy>_.maxy?s:_).maxy,h=t.aabb,s=n.aabb,_=u.aabb,h.minx=(s.minx<_.minx?s:_).minx,h.miny=(s.miny<_.miny?s:_).miny,h.maxx=(s.maxx>_.maxx?s:_).maxx,h.maxy=(s.maxy>_.maxy?s:_).maxy,h=e.height,s=i.height,n.height=1+(s<h?h:s),_=n.height,h=u.height,t.height=1+(h<_?_:h)):(t.child2=i,s=((n.child1=u).parent=n).aabb,_=e.aabb,h=u.aabb,s.minx=(_.minx<h.minx?_:h).minx,s.miny=(_.miny<h.miny?_:h).miny,s.maxx=(_.maxx>h.maxx?_:h).maxx,s.maxy=(_.maxy>h.maxy?_:h).maxy,s=t.aabb,_=n.aabb,h=i.aabb,s.minx=(_.minx<h.minx?_:h).minx,s.miny=(_.miny<h.miny?_:h).miny,s.maxx=(_.maxx>h.maxx?_:h).maxx,s.maxy=(_.maxy>h.maxy?_:h).maxy,e=e.height,u=u.height,n.height=1+(u<e?e:u),u=n.height,i=i.height,t.height=1+(i<u?u:i)),t}return n},Ht.prototype.__class__=Ht;var $t=zpp_nape.space.ZPP_DynAABBPhase=function(n){this.openlist=null,this.failed=null,this.treeStack2=null,this.treeStack=null,this.moves=null,this.syncs=null,this.pairs=null,this.dtree=null,this.stree=null,Yt.call(this),this.space=n,this.is_sweep=!1,(this.dynab=this).stree=new Ht,this.dtree=new Ht};$t.__name__=["zpp_nape","space","ZPP_DynAABBPhase"],$t.__super__=Yt,$t.prototype=Object.create(Yt.prototype),$t.prototype.stree=null,$t.prototype.dtree=null,$t.prototype.pairs=null,$t.prototype.syncs=null,$t.prototype.moves=null,$t.prototype.dyn=function(n){return 1!=n.body.type&&!n.body.component.sleeping},$t.prototype.__insert=function(n){var t;null==Jt.zpp_pool?t=new Jt:(t=Jt.zpp_pool,Jt.zpp_pool=t.next,t.next=null),null==Lt.zpp_pool?t.aabb=new Lt:(t.aabb=Lt.zpp_pool,Lt.zpp_pool=t.aabb.next,t.aabb.next=null),t.moved=!1,t.synced=!1,t.first_sync=!1,((t.shape=n).node=t).synced=!0,t.first_sync=!0,t.snext=this.syncs,this.syncs=t},$t.prototype.__remove=function(n){var t=n.node;if(t.first_sync||(t.dyn?this.dtree:this.stree).removeLeaf(t),n.node=null,t.synced){for(var e=null,i=this.syncs;null!=i&&i!=t;)i=(e=i).snext;null==e?this.syncs=i.snext:e.snext=i.snext,i.snext=null,t.synced=!1}if(t.moved){for(var p=null,l=this.moves;null!=l&&l!=t;)l=(p=l).mnext;null==p?this.moves=l.mnext:p.mnext=l.mnext,l.mnext=null,t.moved=!1}for(var r=null,o=this.pairs;null!=o;){var a,s=o.next;o.n1!=t&&o.n2!=t?(r=o,o=s):(null==r?this.pairs=s:r.next=s,null!=o.arb&&(o.arb.pair=null),o.arb=null,o.n1.shape.pairs.remove(o),o.n2.shape.pairs.remove(o),(a=o).n1=a.n2=null,a.sleeping=!1,a.next=Xt.zpp_pool,Xt.zpp_pool=a,o=s)}for(;null!=n.pairs.head;){var _=n.pairs.pop_unsafe();(_.n1==t?_.n2:_.n1).shape.pairs.remove(_),null!=_.arb&&(_.arb.pair=null),_.arb=null,_.n1=_.n2=null,_.sleeping=!1,_.next=Xt.zpp_pool,Xt.zpp_pool=_}t.height=-1;var h=t.aabb;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h.wrap_min=h.wrap_max=null,h._invalidate=null,h._validate=null,h.next=Lt.zpp_pool,Lt.zpp_pool=h,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=Jt.zpp_pool,Jt.zpp_pool=t},$t.prototype.__sync=function(n){var t=n.node;if(!t.synced){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0;var p=i.localCOMy=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);h=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*h,i.localCOMy+=(_.y+u.y)*h;u=p=1/(3*p);i.localCOMx*=u,i.localCOMy*=u}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}h=e.body;h.zip_axis&&(h.zip_axis=!1,h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}u=e.radius,h=e.radius;e.aabb.minx=e.worldCOMx-u,e.aabb.miny=e.worldCOMy-h,e.aabb.maxx=e.worldCOMx+u,e.aabb.maxy=e.worldCOMy+h}else{var x=n.polygon;if(x.zip_gverts&&null!=x.body){x.zip_gverts=!1,x.validate_lverts();var d=x.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot));for(var y=x.lverts.next,z=x.gverts.next;null!=z;){var c=z,v=y,y=y.next;c.x=x.body.posx+(x.body.axisy*v.x-x.body.axisx*v.y),c.y=x.body.posy+(v.x*x.body.axisx+v.y*x.body.axisy),z=z.next}}var d=x.gverts.next;x.aabb.minx=d.x,x.aabb.miny=d.y,x.aabb.maxx=d.x,x.aabb.maxy=d.y;for(var m=x.gverts.next.next;null!=m;){var f=m;f.x<x.aabb.minx&&(x.aabb.minx=f.x),f.x>x.aabb.maxx&&(x.aabb.maxx=f.x),f.y<x.aabb.miny&&(x.aabb.miny=f.y),f.y>x.aabb.maxy&&(x.aabb.maxy=f.y),m=m.next}}(t.dyn!=(1!=n.body.type&&!n.body.component.sleeping)||(d=t.aabb,!((n=n.aabb).minx>=d.minx&&n.miny>=d.miny&&n.maxx<=d.maxx&&n.maxy<=d.maxy)))&&(t.synced=!0,t.snext=this.syncs,this.syncs=t)}},$t.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.syncs)if(null==this.moves){for(var n=this.syncs;null!=n;){var t=n.shape;if(n.first_sync)n.first_sync=!1;else{var e=n.dyn?this.dtree:this.stree;if(n==e.root)e.root=null;else{var i=n.parent,p=i.parent,l=i.child1==n?i.child2:i.child1;if(null!=p){p.child1==i?p.child1=l:p.child2=l,l.parent=p,i.height=-1;var r=i.aabb;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r.wrap_min=r.wrap_max=null,r._invalidate=null,r._validate=null,r.next=Lt.zpp_pool,Lt.zpp_pool=r,i.child1=i.child2=i.parent=null,i.next=null,i.snext=null,i.mnext=null,i.next=Jt.zpp_pool,Jt.zpp_pool=i;for(var o,a,s,_,h,u,x,d,y,z=p;null!=z;){null==z.child1||z.height<2||(b=z.child1,1<(y=(o=z.child2).height-b.height)?(a=o.child1,u=o.child2,o.child1=z,o.parent=z.parent,null!=(z.parent=o).parent?o.parent.child1==z?o.parent.child1=o:o.parent.child2=o:e.root=o,a.height>u.height?(o.child2=a,s=((z.child2=u).parent=z).aabb,_=b.aabb,h=u.aabb,s.minx=(_.minx<h.minx?_:h).minx,s.miny=(_.miny<h.miny?_:h).miny,s.maxx=(_.maxx>h.maxx?_:h).maxx,s.maxy=(_.maxy>h.maxy?_:h).maxy,s=o.aabb,_=z.aabb,h=a.aabb,s.minx=(_.minx<h.minx?_:h).minx,s.miny=(_.miny<h.miny?_:h).miny,s.maxx=(_.maxx>h.maxx?_:h).maxx,s.maxy=(_.maxy>h.maxy?_:h).maxy,_=b.height,h=u.height,z.height=1+(h<_?_:h),_=z.height,h=a.height,o.height=1+(h<_?_:h)):(o.child2=u,h=((z.child2=a).parent=z).aabb,x=b.aabb,d=a.aabb,h.minx=(x.minx<d.minx?x:d).minx,h.miny=(x.miny<d.miny?x:d).miny,h.maxx=(x.maxx>d.maxx?x:d).maxx,h.maxy=(x.maxy>d.maxy?x:d).maxy,h=o.aabb,x=z.aabb,d=u.aabb,h.minx=(x.minx<d.minx?x:d).minx,h.miny=(x.miny<d.miny?x:d).miny,h.maxx=(x.maxx>d.maxx?x:d).maxx,h.maxy=(x.maxy>d.maxy?x:d).maxy,x=b.height,d=a.height,z.height=1+(d<x?x:d),x=z.height,d=u.height,o.height=1+(d<x?x:d)),z=o):y<-1&&(u=b.child1,v=b.child2,b.child1=z,b.parent=z.parent,null!=(z.parent=b).parent?b.parent.child1==z?b.parent.child1=b:b.parent.child2=b:e.root=b,u.height>v.height?(b.child2=u,x=((z.child1=v).parent=z).aabb,d=o.aabb,y=v.aabb,x.minx=(d.minx<y.minx?d:y).minx,x.miny=(d.miny<y.miny?d:y).miny,x.maxx=(d.maxx>y.maxx?d:y).maxx,x.maxy=(d.maxy>y.maxy?d:y).maxy,x=b.aabb,d=z.aabb,y=u.aabb,x.minx=(d.minx<y.minx?d:y).minx,x.miny=(d.miny<y.miny?d:y).miny,x.maxx=(d.maxx>y.maxx?d:y).maxx,x.maxy=(d.maxy>y.maxy?d:y).maxy,d=o.height,y=v.height,z.height=1+(y<d?d:y),d=z.height,y=u.height,b.height=1+(y<d?d:y)):(b.child2=v,f=((z.child1=u).parent=z).aabb,c=o.aabb,m=u.aabb,f.minx=(c.minx<m.minx?c:m).minx,f.miny=(c.miny<m.miny?c:m).miny,f.maxx=(c.maxx>m.maxx?c:m).maxx,f.maxy=(c.maxy>m.maxy?c:m).maxy,f=b.aabb,c=z.aabb,m=v.aabb,f.minx=(c.minx<m.minx?c:m).minx,f.miny=(c.miny<m.miny?c:m).miny,f.maxx=(c.maxx>m.maxx?c:m).maxx,f.maxy=(c.maxy>m.maxy?c:m).maxy,f=o.height,c=u.height,z.height=1+(c<f?f:c),m=z.height,f=v.height,b.height=1+(f<m?m:f)),z=b));var c=z.child1,v=z.child2,m=z.aabb,f=c.aabb,b=v.aabb;m.minx=(f.minx<b.minx?f:b).minx,m.miny=(f.miny<b.miny?f:b).miny,m.maxx=(f.maxx>b.maxx?f:b).maxx,m.maxy=(f.maxy>b.maxy?f:b).maxy;c=c.height,v=v.height;z.height=1+(v<c?c:v),z=z.parent}}else{(e.root=l).parent=null,i.height=-1;var g=i.aabb;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g.wrap_min=g.wrap_max=null,g._invalidate=null,g._validate=null,g.next=Lt.zpp_pool,Lt.zpp_pool=g,i.child1=i.child2=i.parent=null,i.next=null,i.snext=null,i.mnext=null,i.next=Jt.zpp_pool,Jt.zpp_pool=i}}}l=n.aabb;if(!this.space.continuous&&t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){g=t.circle;if(g.zip_worldCOM&&null!=g.body){if(g.zip_worldCOM=!1,g.zip_localCOM){if(g.zip_localCOM=!1,1==g.type){var w=g.polygon;if(null==w.lverts.next.next)w.localCOMx=w.lverts.next.x,w.localCOMy=w.lverts.next.y;else if(null==w.lverts.next.next.next)w.localCOMx=w.lverts.next.x,w.localCOMy=w.lverts.next.y,w.localCOMx+=w.lverts.next.next.x,w.localCOMy+=w.lverts.next.next.y,w.localCOMx*=.5,w.localCOMy*=.5;else{w.localCOMx=0;var M=w.localCOMy=0,C=w.lverts.next,k=C,O=C=C.next;for(C=C.next;null!=C;){var P=C;M+=O.x*(P.y-k.y);var S=P.y*O.x-P.x*O.y;w.localCOMx+=(O.x+P.x)*S,w.localCOMy+=(O.y+P.y)*S,k=O,O=P,C=C.next}i=C=w.lverts.next;M+=O.x*(i.y-k.y);var A=i.y*O.x-i.x*O.y;w.localCOMx+=(O.x+i.x)*A,w.localCOMy+=(O.y+i.y)*A,k=O;var j=C=C.next;M+=i.x*(j.y-k.y);A=j.y*i.x-j.x*i.y;w.localCOMx+=(i.x+j.x)*A,w.localCOMy+=(i.y+j.y)*A;j=M=1/(3*M);w.localCOMx*=j,w.localCOMy*=j}}null!=g.wrap_localCOM&&(g.wrap_localCOM.zpp_inner.x=g.localCOMx,g.wrap_localCOM.zpp_inner.y=g.localCOMy)}A=g.body;A.zip_axis&&(A.zip_axis=!1,A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot)),g.worldCOMx=g.body.posx+(g.body.axisy*g.localCOMx-g.body.axisx*g.localCOMy),g.worldCOMy=g.body.posy+(g.localCOMx*g.body.axisx+g.localCOMy*g.body.axisy)}j=g.radius,A=g.radius;g.aabb.minx=g.worldCOMx-j,g.aabb.miny=g.worldCOMy-A,g.aabb.maxx=g.worldCOMx+j,g.aabb.maxy=g.worldCOMy+A}else{var E=t.polygon;if(E.zip_gverts&&null!=E.body){E.zip_gverts=!1,E.validate_lverts();var I=E.body;I.zip_axis&&(I.zip_axis=!1,I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot));for(var T=E.lverts.next,N=E.gverts.next;null!=N;){var L=N,V=T,T=T.next;L.x=E.body.posx+(E.body.axisy*V.x-E.body.axisx*V.y),L.y=E.body.posy+(V.x*E.body.axisx+V.y*E.body.axisy),N=N.next}}var D=E.gverts.next;E.aabb.minx=D.x,E.aabb.miny=D.y,E.aabb.maxx=D.x,E.aabb.maxy=D.y;for(var F=E.gverts.next.next;null!=F;){var R=F;R.x<E.aabb.minx&&(E.aabb.minx=R.x),R.x>E.aabb.maxx&&(E.aabb.maxx=R.x),R.y<E.aabb.miny&&(E.aabb.miny=R.y),R.y>E.aabb.maxy&&(E.aabb.maxy=R.y),F=F.next}}I=t.aabb;l.minx=I.minx-3,l.miny=I.miny-3,l.maxx=I.maxx+3,l.maxy=I.maxy+3;var Z=(n.dyn=1!=t.body.type&&!t.body.component.sleeping)?this.dtree:this.stree;if(null==Z.root)Z.root=n,Z.root.parent=null;else{for(var B=n.aabb,G=Z.root;null!=G.child1;){var q=G.child1,U=G.child2,K=G.aabb,W=2*(K.maxx-K.minx+(K.maxy-K.miny)),Y=Ht.tmpaabb,J=G.aabb;Y.minx=(J.minx<B.minx?J:B).minx,Y.miny=(J.miny<B.miny?J:B).miny,Y.maxx=(J.maxx>B.maxx?J:B).maxx,Y.maxy=(J.maxy>B.maxy?J:B).maxy;var X,K=Ht.tmpaabb,Y=2*(K.maxx-K.minx+(K.maxy-K.miny)),J=2*Y,K=2*(Y-W),Y=Ht.tmpaabb,W=q.aabb;Y.minx=(B.minx<W.minx?B:W).minx,Y.miny=(B.miny<W.miny?B:W).miny,Y.maxx=(B.maxx>W.maxx?B:W).maxx,Y.maxy=(B.maxy>W.maxy?B:W).maxy,X=null==q.child1?2*((W=Ht.tmpaabb).maxx-W.minx+(W.maxy-W.miny))+K:(Q=2*((X=q.aabb).maxx-X.minx+(X.maxy-X.miny)),2*(($=Ht.tmpaabb).maxx-$.minx+($.maxy-$.miny))-Q+K);var H,$=Ht.tmpaabb,Q=U.aabb;if($.minx=(B.minx<Q.minx?B:Q).minx,$.miny=(B.miny<Q.miny?B:Q).miny,$.maxx=(B.maxx>Q.maxx?B:Q).maxx,$.maxy=(B.maxy>Q.maxy?B:Q).maxy,K=null==U.child1?2*((H=Ht.tmpaabb).maxx-H.minx+(H.maxy-H.miny))+K:(H=2*((Q=U.aabb).maxx-Q.minx+(Q.maxy-Q.miny)),2*((Q=Ht.tmpaabb).maxx-Q.minx+(Q.maxy-Q.miny))-H+K),J<X&&J<K)break;G=X<K?q:U}var nn,D=G,l=D.parent;null==Jt.zpp_pool?nn=new Jt:(nn=Jt.zpp_pool,Jt.zpp_pool=nn.next,nn.next=null),null==Lt.zpp_pool?nn.aabb=new Lt:(nn.aabb=Lt.zpp_pool,Lt.zpp_pool=nn.aabb.next,nn.aabb.next=null),nn.moved=!1,nn.synced=!1,nn.first_sync=!1,nn.parent=l;var tn,en,pn,ln,rn,on,an,sn,_n,hn,I=nn.aabb,t=D.aabb;for(I.minx=(B.minx<t.minx?B:t).minx,I.miny=(B.miny<t.miny?B:t).miny,I.maxx=(B.maxx>t.maxx?B:t).maxx,I.maxy=(B.maxy>t.maxy?B:t).maxy,nn.height=D.height+1,null!=l?(l.child1==D?l.child1=nn:l.child2=nn,nn.child1=D,nn.child2=n,D.parent=nn,n.parent=nn):(nn.child1=D,nn.child2=n,D.parent=nn,n.parent=nn,Z.root=nn),G=n.parent;null!=G;){null==G.child1||G.height<2||(yn=G.child1,1<(_n=(tn=G.child2).height-yn.height)?(en=tn.child1,pn=tn.child2,tn.child1=G,tn.parent=G.parent,null!=(G.parent=tn).parent?tn.parent.child1==G?tn.parent.child1=tn:tn.parent.child2=tn:Z.root=tn,en.height>pn.height?(tn.child2=en,ln=((G.child2=pn).parent=G).aabb,rn=yn.aabb,on=pn.aabb,ln.minx=(rn.minx<on.minx?rn:on).minx,ln.miny=(rn.miny<on.miny?rn:on).miny,ln.maxx=(rn.maxx>on.maxx?rn:on).maxx,ln.maxy=(rn.maxy>on.maxy?rn:on).maxy,ln=tn.aabb,rn=G.aabb,on=en.aabb,ln.minx=(rn.minx<on.minx?rn:on).minx,ln.miny=(rn.miny<on.miny?rn:on).miny,ln.maxx=(rn.maxx>on.maxx?rn:on).maxx,ln.maxy=(rn.maxy>on.maxy?rn:on).maxy,rn=yn.height,on=pn.height,G.height=1+(on<rn?rn:on),rn=G.height,on=en.height,tn.height=1+(on<rn?rn:on)):(tn.child2=pn,on=((G.child2=en).parent=G).aabb,an=yn.aabb,sn=en.aabb,on.minx=(an.minx<sn.minx?an:sn).minx,on.miny=(an.miny<sn.miny?an:sn).miny,on.maxx=(an.maxx>sn.maxx?an:sn).maxx,on.maxy=(an.maxy>sn.maxy?an:sn).maxy,on=tn.aabb,an=G.aabb,sn=pn.aabb,on.minx=(an.minx<sn.minx?an:sn).minx,on.miny=(an.miny<sn.miny?an:sn).miny,on.maxx=(an.maxx>sn.maxx?an:sn).maxx,on.maxy=(an.maxy>sn.maxy?an:sn).maxy,an=yn.height,sn=en.height,G.height=1+(sn<an?an:sn),an=G.height,sn=pn.height,tn.height=1+(sn<an?an:sn)),G=tn):_n<-1&&(an=yn.child1,un=yn.child2,yn.child1=G,yn.parent=G.parent,null!=(G.parent=yn).parent?yn.parent.child1==G?yn.parent.child1=yn:yn.parent.child2=yn:Z.root=yn,an.height>un.height?(yn.child2=an,sn=((G.child1=un).parent=G).aabb,_n=tn.aabb,hn=un.aabb,sn.minx=(_n.minx<hn.minx?_n:hn).minx,sn.miny=(_n.miny<hn.miny?_n:hn).miny,sn.maxx=(_n.maxx>hn.maxx?_n:hn).maxx,sn.maxy=(_n.maxy>hn.maxy?_n:hn).maxy,sn=yn.aabb,_n=G.aabb,hn=an.aabb,sn.minx=(_n.minx<hn.minx?_n:hn).minx,sn.miny=(_n.miny<hn.miny?_n:hn).miny,sn.maxx=(_n.maxx>hn.maxx?_n:hn).maxx,sn.maxy=(_n.maxy>hn.maxy?_n:hn).maxy,_n=tn.height,hn=un.height,G.height=1+(hn<_n?_n:hn),_n=G.height,hn=an.height,yn.height=1+(hn<_n?_n:hn)):(yn.child2=un,hn=((G.child1=an).parent=G).aabb,xn=tn.aabb,dn=an.aabb,hn.minx=(xn.minx<dn.minx?xn:dn).minx,hn.miny=(xn.miny<dn.miny?xn:dn).miny,hn.maxx=(xn.maxx>dn.maxx?xn:dn).maxx,hn.maxy=(xn.maxy>dn.maxy?xn:dn).maxy,hn=yn.aabb,xn=G.aabb,dn=un.aabb,hn.minx=(xn.minx<dn.minx?xn:dn).minx,hn.miny=(xn.miny<dn.miny?xn:dn).miny,hn.maxx=(xn.maxx>dn.maxx?xn:dn).maxx,hn.maxy=(xn.maxy>dn.maxy?xn:dn).maxy,xn=tn.height,dn=an.height,G.height=1+(dn<xn?xn:dn),xn=G.height,dn=un.height,yn.height=1+(dn<xn?xn:dn)),G=yn));var un=G.child1,xn=G.child2,dn=un.height,yn=xn.height;G.height=1+(yn<dn?dn:yn);yn=G.aabb,un=un.aabb,xn=xn.aabb;yn.minx=(un.minx<xn.minx?un:xn).minx,yn.miny=(un.miny<xn.miny?un:xn).miny,yn.maxx=(un.maxx>xn.maxx?un:xn).maxx,yn.maxy=(un.maxy>xn.maxy?un:xn).maxy,G=G.parent}}n.synced=!1,n.moved=!0,n.mnext=n.snext,n.snext=null,n=n.mnext}var zn=this.syncs;this.syncs=this.moves,this.moves=zn}else for(;null!=this.syncs;){var cn=this.syncs;this.syncs=cn.snext,cn.snext=null;var vn=cn.shape;if(cn.first_sync)cn.first_sync=!1;else{var mn=cn.dyn?this.dtree:this.stree;if(cn==mn.root)mn.root=null;else{var fn=cn.parent,bn=fn.parent,gn=fn.child1==cn?fn.child2:fn.child1;if(null!=bn){bn.child1==fn?bn.child1=gn:bn.child2=gn,gn.parent=bn,fn.height=-1;var wn=fn.aabb;null!=wn.outer&&(wn.outer.zpp_inner=null,wn.outer=null),wn.wrap_min=wn.wrap_max=null,wn._invalidate=null,wn._validate=null,wn.next=Lt.zpp_pool,Lt.zpp_pool=wn,fn.child1=fn.child2=fn.parent=null,fn.next=null,fn.snext=null,fn.mnext=null,fn.next=Jt.zpp_pool,Jt.zpp_pool=fn;for(var Mn,Cn,kn,On,Pn,Sn,An,jn,En,In=bn;null!=In;){null==In.child1||In.height<2||(Dn=In.child1,1<(En=(Mn=In.child2).height-Dn.height)?(Cn=Mn.child1,Sn=Mn.child2,Mn.child1=In,Mn.parent=In.parent,null!=(In.parent=Mn).parent?Mn.parent.child1==In?Mn.parent.child1=Mn:Mn.parent.child2=Mn:mn.root=Mn,Cn.height>Sn.height?(Mn.child2=Cn,kn=((In.child2=Sn).parent=In).aabb,On=Dn.aabb,Pn=Sn.aabb,kn.minx=(On.minx<Pn.minx?On:Pn).minx,kn.miny=(On.miny<Pn.miny?On:Pn).miny,kn.maxx=(On.maxx>Pn.maxx?On:Pn).maxx,kn.maxy=(On.maxy>Pn.maxy?On:Pn).maxy,kn=Mn.aabb,On=In.aabb,Pn=Cn.aabb,kn.minx=(On.minx<Pn.minx?On:Pn).minx,kn.miny=(On.miny<Pn.miny?On:Pn).miny,kn.maxx=(On.maxx>Pn.maxx?On:Pn).maxx,kn.maxy=(On.maxy>Pn.maxy?On:Pn).maxy,On=Dn.height,Pn=Sn.height,In.height=1+(Pn<On?On:Pn),On=In.height,Pn=Cn.height,Mn.height=1+(Pn<On?On:Pn)):(Mn.child2=Sn,Pn=((In.child2=Cn).parent=In).aabb,An=Dn.aabb,jn=Cn.aabb,Pn.minx=(An.minx<jn.minx?An:jn).minx,Pn.miny=(An.miny<jn.miny?An:jn).miny,Pn.maxx=(An.maxx>jn.maxx?An:jn).maxx,Pn.maxy=(An.maxy>jn.maxy?An:jn).maxy,Pn=Mn.aabb,An=In.aabb,jn=Sn.aabb,Pn.minx=(An.minx<jn.minx?An:jn).minx,Pn.miny=(An.miny<jn.miny?An:jn).miny,Pn.maxx=(An.maxx>jn.maxx?An:jn).maxx,Pn.maxy=(An.maxy>jn.maxy?An:jn).maxy,An=Dn.height,jn=Cn.height,In.height=1+(jn<An?An:jn),An=In.height,jn=Sn.height,Mn.height=1+(jn<An?An:jn)),In=Mn):En<-1&&(Sn=Dn.child1,Nn=Dn.child2,Dn.child1=In,Dn.parent=In.parent,null!=(In.parent=Dn).parent?Dn.parent.child1==In?Dn.parent.child1=Dn:Dn.parent.child2=Dn:mn.root=Dn,Sn.height>Nn.height?(Dn.child2=Sn,An=((In.child1=Nn).parent=In).aabb,jn=Mn.aabb,En=Nn.aabb,An.minx=(jn.minx<En.minx?jn:En).minx,An.miny=(jn.miny<En.miny?jn:En).miny,An.maxx=(jn.maxx>En.maxx?jn:En).maxx,An.maxy=(jn.maxy>En.maxy?jn:En).maxy,An=Dn.aabb,jn=In.aabb,En=Sn.aabb,An.minx=(jn.minx<En.minx?jn:En).minx,An.miny=(jn.miny<En.miny?jn:En).miny,An.maxx=(jn.maxx>En.maxx?jn:En).maxx,An.maxy=(jn.maxy>En.maxy?jn:En).maxy,jn=Mn.height,En=Nn.height,In.height=1+(En<jn?jn:En),jn=In.height,En=Sn.height,Dn.height=1+(En<jn?jn:En)):(Dn.child2=Nn,Vn=((In.child1=Sn).parent=In).aabb,Tn=Mn.aabb,Ln=Sn.aabb,Vn.minx=(Tn.minx<Ln.minx?Tn:Ln).minx,Vn.miny=(Tn.miny<Ln.miny?Tn:Ln).miny,Vn.maxx=(Tn.maxx>Ln.maxx?Tn:Ln).maxx,Vn.maxy=(Tn.maxy>Ln.maxy?Tn:Ln).maxy,Vn=Dn.aabb,Tn=In.aabb,Ln=Nn.aabb,Vn.minx=(Tn.minx<Ln.minx?Tn:Ln).minx,Vn.miny=(Tn.miny<Ln.miny?Tn:Ln).miny,Vn.maxx=(Tn.maxx>Ln.maxx?Tn:Ln).maxx,Vn.maxy=(Tn.maxy>Ln.maxy?Tn:Ln).maxy,Vn=Mn.height,Tn=Sn.height,In.height=1+(Tn<Vn?Vn:Tn),Ln=In.height,Vn=Nn.height,Dn.height=1+(Vn<Ln?Ln:Vn)),In=Dn));var Tn=In.child1,Nn=In.child2,Ln=In.aabb,Vn=Tn.aabb,Dn=Nn.aabb;Ln.minx=(Vn.minx<Dn.minx?Vn:Dn).minx,Ln.miny=(Vn.miny<Dn.miny?Vn:Dn).miny,Ln.maxx=(Vn.maxx>Dn.maxx?Vn:Dn).maxx,Ln.maxy=(Vn.maxy>Dn.maxy?Vn:Dn).maxy;Tn=Tn.height,Nn=Nn.height;In.height=1+(Nn<Tn?Tn:Nn),In=In.parent}}else{(mn.root=gn).parent=null,fn.height=-1;var Fn=fn.aabb;null!=Fn.outer&&(Fn.outer.zpp_inner=null,Fn.outer=null),Fn.wrap_min=Fn.wrap_max=null,Fn._invalidate=null,Fn._validate=null,Fn.next=Lt.zpp_pool,Lt.zpp_pool=Fn,fn.child1=fn.child2=fn.parent=null,fn.next=null,fn.snext=null,fn.mnext=null,fn.next=Jt.zpp_pool,Jt.zpp_pool=fn}}}gn=cn.aabb;if(!this.space.continuous&&vn.zip_aabb&&null!=vn.body)if(vn.zip_aabb=!1,0==vn.type){Fn=vn.circle;if(Fn.zip_worldCOM&&null!=Fn.body){if(Fn.zip_worldCOM=!1,Fn.zip_localCOM){if(Fn.zip_localCOM=!1,1==Fn.type){var Rn=Fn.polygon;if(null==Rn.lverts.next.next)Rn.localCOMx=Rn.lverts.next.x,Rn.localCOMy=Rn.lverts.next.y;else if(null==Rn.lverts.next.next.next)Rn.localCOMx=Rn.lverts.next.x,Rn.localCOMy=Rn.lverts.next.y,Rn.localCOMx+=Rn.lverts.next.next.x,Rn.localCOMy+=Rn.lverts.next.next.y,Rn.localCOMx*=.5,Rn.localCOMy*=.5;else{Rn.localCOMx=0;var Zn=Rn.localCOMy=0,Bn=Rn.lverts.next,Gn=Bn,qn=Bn=Bn.next;for(Bn=Bn.next;null!=Bn;){var Un=Bn;Zn+=qn.x*(Un.y-Gn.y);var Kn=Un.y*qn.x-Un.x*qn.y;Rn.localCOMx+=(qn.x+Un.x)*Kn,Rn.localCOMy+=(qn.y+Un.y)*Kn,Gn=qn,qn=Un,Bn=Bn.next}fn=Bn=Rn.lverts.next;Zn+=qn.x*(fn.y-Gn.y);var Wn=fn.y*qn.x-fn.x*qn.y;Rn.localCOMx+=(qn.x+fn.x)*Wn,Rn.localCOMy+=(qn.y+fn.y)*Wn,Gn=qn;var Yn=Bn=Bn.next;Zn+=fn.x*(Yn.y-Gn.y);Wn=Yn.y*fn.x-Yn.x*fn.y;Rn.localCOMx+=(fn.x+Yn.x)*Wn,Rn.localCOMy+=(fn.y+Yn.y)*Wn;Yn=Zn=1/(3*Zn);Rn.localCOMx*=Yn,Rn.localCOMy*=Yn}}null!=Fn.wrap_localCOM&&(Fn.wrap_localCOM.zpp_inner.x=Fn.localCOMx,Fn.wrap_localCOM.zpp_inner.y=Fn.localCOMy)}Wn=Fn.body;Wn.zip_axis&&(Wn.zip_axis=!1,Wn.axisx=Math.sin(Wn.rot),Wn.axisy=Math.cos(Wn.rot)),Fn.worldCOMx=Fn.body.posx+(Fn.body.axisy*Fn.localCOMx-Fn.body.axisx*Fn.localCOMy),Fn.worldCOMy=Fn.body.posy+(Fn.localCOMx*Fn.body.axisx+Fn.localCOMy*Fn.body.axisy)}Yn=Fn.radius,Wn=Fn.radius;Fn.aabb.minx=Fn.worldCOMx-Yn,Fn.aabb.miny=Fn.worldCOMy-Wn,Fn.aabb.maxx=Fn.worldCOMx+Yn,Fn.aabb.maxy=Fn.worldCOMy+Wn}else{var Jn=vn.polygon;if(Jn.zip_gverts&&null!=Jn.body){Jn.zip_gverts=!1,Jn.validate_lverts();var Xn=Jn.body;Xn.zip_axis&&(Xn.zip_axis=!1,Xn.axisx=Math.sin(Xn.rot),Xn.axisy=Math.cos(Xn.rot));for(var Hn=Jn.lverts.next,$n=Jn.gverts.next;null!=$n;){var Qn=$n,nt=Hn,Hn=Hn.next;Qn.x=Jn.body.posx+(Jn.body.axisy*nt.x-Jn.body.axisx*nt.y),Qn.y=Jn.body.posy+(nt.x*Jn.body.axisx+nt.y*Jn.body.axisy),$n=$n.next}}var tt=Jn.gverts.next;Jn.aabb.minx=tt.x,Jn.aabb.miny=tt.y,Jn.aabb.maxx=tt.x,Jn.aabb.maxy=tt.y;for(var et=Jn.gverts.next.next;null!=et;){var it=et;it.x<Jn.aabb.minx&&(Jn.aabb.minx=it.x),it.x>Jn.aabb.maxx&&(Jn.aabb.maxx=it.x),it.y<Jn.aabb.miny&&(Jn.aabb.miny=it.y),it.y>Jn.aabb.maxy&&(Jn.aabb.maxy=it.y),et=et.next}}Xn=vn.aabb;gn.minx=Xn.minx-3,gn.miny=Xn.miny-3,gn.maxx=Xn.maxx+3,gn.maxy=Xn.maxy+3;var pt=(cn.dyn=1!=vn.body.type&&!vn.body.component.sleeping)?this.dtree:this.stree;if(null==pt.root)pt.root=cn,pt.root.parent=null;else{for(var lt=cn.aabb,rt=pt.root;null!=rt.child1;){var ot=rt.child1,at=rt.child2,st=rt.aabb,_t=2*(st.maxx-st.minx+(st.maxy-st.miny)),ht=Ht.tmpaabb,ut=rt.aabb;ht.minx=(ut.minx<lt.minx?ut:lt).minx,ht.miny=(ut.miny<lt.miny?ut:lt).miny,ht.maxx=(ut.maxx>lt.maxx?ut:lt).maxx,ht.maxy=(ut.maxy>lt.maxy?ut:lt).maxy;var xt,st=Ht.tmpaabb,ht=2*(st.maxx-st.minx+(st.maxy-st.miny)),ut=2*ht,st=2*(ht-_t),ht=Ht.tmpaabb,_t=ot.aabb;ht.minx=(lt.minx<_t.minx?lt:_t).minx,ht.miny=(lt.miny<_t.miny?lt:_t).miny,ht.maxx=(lt.maxx>_t.maxx?lt:_t).maxx,ht.maxy=(lt.maxy>_t.maxy?lt:_t).maxy,xt=null==ot.child1?2*((_t=Ht.tmpaabb).maxx-_t.minx+(_t.maxy-_t.miny))+st:(zt=2*((xt=ot.aabb).maxx-xt.minx+(xt.maxy-xt.miny)),2*((yt=Ht.tmpaabb).maxx-yt.minx+(yt.maxy-yt.miny))-zt+st);var dt,yt=Ht.tmpaabb,zt=at.aabb;if(yt.minx=(lt.minx<zt.minx?lt:zt).minx,yt.miny=(lt.miny<zt.miny?lt:zt).miny,yt.maxx=(lt.maxx>zt.maxx?lt:zt).maxx,yt.maxy=(lt.maxy>zt.maxy?lt:zt).maxy,st=null==at.child1?2*((dt=Ht.tmpaabb).maxx-dt.minx+(dt.maxy-dt.miny))+st:(dt=2*((zt=at.aabb).maxx-zt.minx+(zt.maxy-zt.miny)),2*((zt=Ht.tmpaabb).maxx-zt.minx+(zt.maxy-zt.miny))-dt+st),ut<xt&&ut<st)break;rt=xt<st?ot:at}var ct,tt=rt,gn=tt.parent;null==Jt.zpp_pool?ct=new Jt:(ct=Jt.zpp_pool,Jt.zpp_pool=ct.next,ct.next=null),null==Lt.zpp_pool?ct.aabb=new Lt:(ct.aabb=Lt.zpp_pool,Lt.zpp_pool=ct.aabb.next,ct.aabb.next=null),ct.moved=!1,ct.synced=!1,ct.first_sync=!1,ct.parent=gn;var vt,mt,ft,bt,gt,wt,Mt,Ct,kt,Ot,Xn=ct.aabb,vn=tt.aabb;for(Xn.minx=(lt.minx<vn.minx?lt:vn).minx,Xn.miny=(lt.miny<vn.miny?lt:vn).miny,Xn.maxx=(lt.maxx>vn.maxx?lt:vn).maxx,Xn.maxy=(lt.maxy>vn.maxy?lt:vn).maxy,ct.height=tt.height+1,null!=gn?(gn.child1==tt?gn.child1=ct:gn.child2=ct,ct.child1=tt,ct.child2=cn,tt.parent=ct,cn.parent=ct):(ct.child1=tt,ct.child2=cn,tt.parent=ct,cn.parent=ct,pt.root=ct),rt=cn.parent;null!=rt;){null==rt.child1||rt.height<2||(jt=rt.child1,1<(kt=(vt=rt.child2).height-jt.height)?(mt=vt.child1,ft=vt.child2,vt.child1=rt,vt.parent=rt.parent,null!=(rt.parent=vt).parent?vt.parent.child1==rt?vt.parent.child1=vt:vt.parent.child2=vt:pt.root=vt,mt.height>ft.height?(vt.child2=mt,bt=((rt.child2=ft).parent=rt).aabb,gt=jt.aabb,wt=ft.aabb,bt.minx=(gt.minx<wt.minx?gt:wt).minx,bt.miny=(gt.miny<wt.miny?gt:wt).miny,bt.maxx=(gt.maxx>wt.maxx?gt:wt).maxx,bt.maxy=(gt.maxy>wt.maxy?gt:wt).maxy,bt=vt.aabb,gt=rt.aabb,wt=mt.aabb,bt.minx=(gt.minx<wt.minx?gt:wt).minx,bt.miny=(gt.miny<wt.miny?gt:wt).miny,bt.maxx=(gt.maxx>wt.maxx?gt:wt).maxx,bt.maxy=(gt.maxy>wt.maxy?gt:wt).maxy,gt=jt.height,wt=ft.height,rt.height=1+(wt<gt?gt:wt),gt=rt.height,wt=mt.height,vt.height=1+(wt<gt?gt:wt)):(vt.child2=ft,wt=((rt.child2=mt).parent=rt).aabb,Mt=jt.aabb,Ct=mt.aabb,wt.minx=(Mt.minx<Ct.minx?Mt:Ct).minx,wt.miny=(Mt.miny<Ct.miny?Mt:Ct).miny,wt.maxx=(Mt.maxx>Ct.maxx?Mt:Ct).maxx,wt.maxy=(Mt.maxy>Ct.maxy?Mt:Ct).maxy,wt=vt.aabb,Mt=rt.aabb,Ct=ft.aabb,wt.minx=(Mt.minx<Ct.minx?Mt:Ct).minx,wt.miny=(Mt.miny<Ct.miny?Mt:Ct).miny,wt.maxx=(Mt.maxx>Ct.maxx?Mt:Ct).maxx,wt.maxy=(Mt.maxy>Ct.maxy?Mt:Ct).maxy,Mt=jt.height,Ct=mt.height,rt.height=1+(Ct<Mt?Mt:Ct),Mt=rt.height,Ct=ft.height,vt.height=1+(Ct<Mt?Mt:Ct)),rt=vt):kt<-1&&(Mt=jt.child1,Pt=jt.child2,jt.child1=rt,jt.parent=rt.parent,null!=(rt.parent=jt).parent?jt.parent.child1==rt?jt.parent.child1=jt:jt.parent.child2=jt:pt.root=jt,Mt.height>Pt.height?(jt.child2=Mt,Ct=((rt.child1=Pt).parent=rt).aabb,kt=vt.aabb,Ot=Pt.aabb,Ct.minx=(kt.minx<Ot.minx?kt:Ot).minx,Ct.miny=(kt.miny<Ot.miny?kt:Ot).miny,Ct.maxx=(kt.maxx>Ot.maxx?kt:Ot).maxx,Ct.maxy=(kt.maxy>Ot.maxy?kt:Ot).maxy,Ct=jt.aabb,kt=rt.aabb,Ot=Mt.aabb,Ct.minx=(kt.minx<Ot.minx?kt:Ot).minx,Ct.miny=(kt.miny<Ot.miny?kt:Ot).miny,Ct.maxx=(kt.maxx>Ot.maxx?kt:Ot).maxx,Ct.maxy=(kt.maxy>Ot.maxy?kt:Ot).maxy,kt=vt.height,Ot=Pt.height,rt.height=1+(Ot<kt?kt:Ot),kt=rt.height,Ot=Mt.height,jt.height=1+(Ot<kt?kt:Ot)):(jt.child2=Pt,Ot=((rt.child1=Mt).parent=rt).aabb,St=vt.aabb,At=Mt.aabb,Ot.minx=(St.minx<At.minx?St:At).minx,Ot.miny=(St.miny<At.miny?St:At).miny,Ot.maxx=(St.maxx>At.maxx?St:At).maxx,Ot.maxy=(St.maxy>At.maxy?St:At).maxy,Ot=jt.aabb,St=rt.aabb,At=Pt.aabb,Ot.minx=(St.minx<At.minx?St:At).minx,Ot.miny=(St.miny<At.miny?St:At).miny,Ot.maxx=(St.maxx>At.maxx?St:At).maxx,Ot.maxy=(St.maxy>At.maxy?St:At).maxy,St=vt.height,At=Mt.height,rt.height=1+(At<St?St:At),St=rt.height,At=Pt.height,jt.height=1+(At<St?St:At)),rt=jt));var Pt=rt.child1,St=rt.child2,At=Pt.height,jt=St.height;rt.height=1+(jt<At?At:jt);jt=rt.aabb,Pt=Pt.aabb,St=St.aabb;jt.minx=(Pt.minx<St.minx?Pt:St).minx,jt.miny=(Pt.miny<St.miny?Pt:St).miny,jt.maxx=(Pt.maxx>St.maxx?Pt:St).maxx,jt.maxy=(Pt.maxy>St.maxy?Pt:St).maxy,rt=rt.parent}}cn.synced=!1,cn.moved||(cn.moved=!0,cn.mnext=this.moves,this.moves=cn)}},$t.prototype.broadphase=function(n,t){for(var e=this.syncs;null!=e;){var i=e.shape;if(e.first_sync)e.first_sync=!1;else{var p=e.dyn?this.dtree:this.stree;if(e==p.root)p.root=null;else{var l=e.parent,r=l.parent,o=l.child1==e?l.child2:l.child1;if(null!=r){r.child1==l?r.child1=o:r.child2=o,o.parent=r,l.height=-1;var a=l.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a.wrap_min=a.wrap_max=null,a._invalidate=null,a._validate=null,a.next=Lt.zpp_pool,Lt.zpp_pool=a,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=Jt.zpp_pool,Jt.zpp_pool=l;for(var s,_,h,u,x,d,y,z,c,v=r;null!=v;){null==v.child1||v.height<2||(w=v.child1,1<(c=(s=v.child2).height-w.height)?(_=s.child1,d=s.child2,s.child1=v,s.parent=v.parent,null!=(v.parent=s).parent?s.parent.child1==v?s.parent.child1=s:s.parent.child2=s:p.root=s,_.height>d.height?(s.child2=_,h=((v.child2=d).parent=v).aabb,u=w.aabb,x=d.aabb,h.minx=(u.minx<x.minx?u:x).minx,h.miny=(u.miny<x.miny?u:x).miny,h.maxx=(u.maxx>x.maxx?u:x).maxx,h.maxy=(u.maxy>x.maxy?u:x).maxy,h=s.aabb,u=v.aabb,x=_.aabb,h.minx=(u.minx<x.minx?u:x).minx,h.miny=(u.miny<x.miny?u:x).miny,h.maxx=(u.maxx>x.maxx?u:x).maxx,h.maxy=(u.maxy>x.maxy?u:x).maxy,u=w.height,x=d.height,v.height=1+(x<u?u:x),u=v.height,x=_.height,s.height=1+(x<u?u:x)):(s.child2=d,x=((v.child2=_).parent=v).aabb,y=w.aabb,z=_.aabb,x.minx=(y.minx<z.minx?y:z).minx,x.miny=(y.miny<z.miny?y:z).miny,x.maxx=(y.maxx>z.maxx?y:z).maxx,x.maxy=(y.maxy>z.maxy?y:z).maxy,x=s.aabb,y=v.aabb,z=d.aabb,x.minx=(y.minx<z.minx?y:z).minx,x.miny=(y.miny<z.miny?y:z).miny,x.maxx=(y.maxx>z.maxx?y:z).maxx,x.maxy=(y.maxy>z.maxy?y:z).maxy,y=w.height,z=_.height,v.height=1+(z<y?y:z),y=v.height,z=d.height,s.height=1+(z<y?y:z)),v=s):c<-1&&(d=w.child1,f=w.child2,w.child1=v,w.parent=v.parent,null!=(v.parent=w).parent?w.parent.child1==v?w.parent.child1=w:w.parent.child2=w:p.root=w,d.height>f.height?(w.child2=d,y=((v.child1=f).parent=v).aabb,z=s.aabb,c=f.aabb,y.minx=(z.minx<c.minx?z:c).minx,y.miny=(z.miny<c.miny?z:c).miny,y.maxx=(z.maxx>c.maxx?z:c).maxx,y.maxy=(z.maxy>c.maxy?z:c).maxy,y=w.aabb,z=v.aabb,c=d.aabb,y.minx=(z.minx<c.minx?z:c).minx,y.miny=(z.miny<c.miny?z:c).miny,y.maxx=(z.maxx>c.maxx?z:c).maxx,y.maxy=(z.maxy>c.maxy?z:c).maxy,z=s.height,c=f.height,v.height=1+(c<z?z:c),z=v.height,c=d.height,w.height=1+(c<z?z:c)):(w.child2=f,g=((v.child1=d).parent=v).aabb,m=s.aabb,b=d.aabb,g.minx=(m.minx<b.minx?m:b).minx,g.miny=(m.miny<b.miny?m:b).miny,g.maxx=(m.maxx>b.maxx?m:b).maxx,g.maxy=(m.maxy>b.maxy?m:b).maxy,g=w.aabb,m=v.aabb,b=f.aabb,g.minx=(m.minx<b.minx?m:b).minx,g.miny=(m.miny<b.miny?m:b).miny,g.maxx=(m.maxx>b.maxx?m:b).maxx,g.maxy=(m.maxy>b.maxy?m:b).maxy,g=s.height,m=d.height,v.height=1+(m<g?g:m),b=v.height,g=f.height,w.height=1+(g<b?b:g)),v=w));var m=v.child1,f=v.child2,b=v.aabb,g=m.aabb,w=f.aabb;b.minx=(g.minx<w.minx?g:w).minx,b.miny=(g.miny<w.miny?g:w).miny,b.maxx=(g.maxx>w.maxx?g:w).maxx,b.maxy=(g.maxy>w.maxy?g:w).maxy;m=m.height,f=f.height;v.height=1+(f<m?m:f),v=v.parent}}else{(p.root=o).parent=null,l.height=-1;var M=l.aabb;null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M.wrap_min=M.wrap_max=null,M._invalidate=null,M._validate=null,M.next=Lt.zpp_pool,Lt.zpp_pool=M,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=Jt.zpp_pool,Jt.zpp_pool=l}}}o=e.aabb;if(!n.continuous&&i.zip_aabb&&null!=i.body)if(i.zip_aabb=!1,0==i.type){M=i.circle;if(M.zip_worldCOM&&null!=M.body){if(M.zip_worldCOM=!1,M.zip_localCOM){if(M.zip_localCOM=!1,1==M.type){var C=M.polygon;if(null==C.lverts.next.next)C.localCOMx=C.lverts.next.x,C.localCOMy=C.lverts.next.y;else if(null==C.lverts.next.next.next)C.localCOMx=C.lverts.next.x,C.localCOMy=C.lverts.next.y,C.localCOMx+=C.lverts.next.next.x,C.localCOMy+=C.lverts.next.next.y,C.localCOMx*=.5,C.localCOMy*=.5;else{C.localCOMx=0;var k=C.localCOMy=0,O=C.lverts.next,P=O,S=O=O.next;for(O=O.next;null!=O;){var A=O;k+=S.x*(A.y-P.y);var j=A.y*S.x-A.x*S.y;C.localCOMx+=(S.x+A.x)*j,C.localCOMy+=(S.y+A.y)*j,P=S,S=A,O=O.next}l=O=C.lverts.next;k+=S.x*(l.y-P.y);var E=l.y*S.x-l.x*S.y;C.localCOMx+=(S.x+l.x)*E,C.localCOMy+=(S.y+l.y)*E,P=S;var I=O=O.next;k+=l.x*(I.y-P.y);E=I.y*l.x-I.x*l.y;C.localCOMx+=(l.x+I.x)*E,C.localCOMy+=(l.y+I.y)*E;I=k=1/(3*k);C.localCOMx*=I,C.localCOMy*=I}}null!=M.wrap_localCOM&&(M.wrap_localCOM.zpp_inner.x=M.localCOMx,M.wrap_localCOM.zpp_inner.y=M.localCOMy)}E=M.body;E.zip_axis&&(E.zip_axis=!1,E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot)),M.worldCOMx=M.body.posx+(M.body.axisy*M.localCOMx-M.body.axisx*M.localCOMy),M.worldCOMy=M.body.posy+(M.localCOMx*M.body.axisx+M.localCOMy*M.body.axisy)}I=M.radius,E=M.radius;M.aabb.minx=M.worldCOMx-I,M.aabb.miny=M.worldCOMy-E,M.aabb.maxx=M.worldCOMx+I,M.aabb.maxy=M.worldCOMy+E}else{var T=i.polygon;if(T.zip_gverts&&null!=T.body){T.zip_gverts=!1,T.validate_lverts();var N=T.body;N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot));for(var L=T.lverts.next,V=T.gverts.next;null!=V;){var D=V,F=L,L=L.next;D.x=T.body.posx+(T.body.axisy*F.x-T.body.axisx*F.y),D.y=T.body.posy+(F.x*T.body.axisx+F.y*T.body.axisy),V=V.next}}var R=T.gverts.next;T.aabb.minx=R.x,T.aabb.miny=R.y,T.aabb.maxx=R.x,T.aabb.maxy=R.y;for(var Z=T.gverts.next.next;null!=Z;){var B=Z;B.x<T.aabb.minx&&(T.aabb.minx=B.x),B.x>T.aabb.maxx&&(T.aabb.maxx=B.x),B.y<T.aabb.miny&&(T.aabb.miny=B.y),B.y>T.aabb.maxy&&(T.aabb.maxy=B.y),Z=Z.next}}N=i.aabb;o.minx=N.minx-3,o.miny=N.miny-3,o.maxx=N.maxx+3,o.maxy=N.maxy+3;var G=(e.dyn=1!=i.body.type&&!i.body.component.sleeping)?this.dtree:this.stree;if(null==G.root)G.root=e,G.root.parent=null;else{for(var q=e.aabb,U=G.root;null!=U.child1;){var K=U.child1,W=U.child2,Y=U.aabb,J=2*(Y.maxx-Y.minx+(Y.maxy-Y.miny)),X=Ht.tmpaabb,H=U.aabb;X.minx=(H.minx<q.minx?H:q).minx,X.miny=(H.miny<q.miny?H:q).miny,X.maxx=(H.maxx>q.maxx?H:q).maxx,X.maxy=(H.maxy>q.maxy?H:q).maxy;var $,Y=Ht.tmpaabb,X=2*(Y.maxx-Y.minx+(Y.maxy-Y.miny)),H=2*X,Y=2*(X-J),X=Ht.tmpaabb,J=K.aabb;X.minx=(q.minx<J.minx?q:J).minx,X.miny=(q.miny<J.miny?q:J).miny,X.maxx=(q.maxx>J.maxx?q:J).maxx,X.maxy=(q.maxy>J.maxy?q:J).maxy,$=null==K.child1?2*((J=Ht.tmpaabb).maxx-J.minx+(J.maxy-J.miny))+Y:(tn=2*(($=K.aabb).maxx-$.minx+($.maxy-$.miny)),2*((nn=Ht.tmpaabb).maxx-nn.minx+(nn.maxy-nn.miny))-tn+Y);var Q,nn=Ht.tmpaabb,tn=W.aabb;if(nn.minx=(q.minx<tn.minx?q:tn).minx,nn.miny=(q.miny<tn.miny?q:tn).miny,nn.maxx=(q.maxx>tn.maxx?q:tn).maxx,nn.maxy=(q.maxy>tn.maxy?q:tn).maxy,Y=null==W.child1?2*((Q=Ht.tmpaabb).maxx-Q.minx+(Q.maxy-Q.miny))+Y:(Q=2*((tn=W.aabb).maxx-tn.minx+(tn.maxy-tn.miny)),2*((tn=Ht.tmpaabb).maxx-tn.minx+(tn.maxy-tn.miny))-Q+Y),H<$&&H<Y)break;U=$<Y?K:W}var en,R=U,o=R.parent;null==Jt.zpp_pool?en=new Jt:(en=Jt.zpp_pool,Jt.zpp_pool=en.next,en.next=null),null==Lt.zpp_pool?en.aabb=new Lt:(en.aabb=Lt.zpp_pool,Lt.zpp_pool=en.aabb.next,en.aabb.next=null),en.moved=!1,en.synced=!1,en.first_sync=!1,en.parent=o;var pn,ln,rn,on,an,sn,_n,hn,un,xn,N=en.aabb,i=R.aabb;for(N.minx=(q.minx<i.minx?q:i).minx,N.miny=(q.miny<i.miny?q:i).miny,N.maxx=(q.maxx>i.maxx?q:i).maxx,N.maxy=(q.maxy>i.maxy?q:i).maxy,en.height=R.height+1,null!=o?(o.child1==R?o.child1=en:o.child2=en,en.child1=R,en.child2=e,R.parent=en,e.parent=en):(en.child1=R,en.child2=e,R.parent=en,e.parent=en,G.root=en),U=e.parent;null!=U;){null==U.child1||U.height<2||(cn=U.child1,1<(un=(pn=U.child2).height-cn.height)?(ln=pn.child1,rn=pn.child2,pn.child1=U,pn.parent=U.parent,null!=(U.parent=pn).parent?pn.parent.child1==U?pn.parent.child1=pn:pn.parent.child2=pn:G.root=pn,ln.height>rn.height?(pn.child2=ln,on=((U.child2=rn).parent=U).aabb,an=cn.aabb,sn=rn.aabb,on.minx=(an.minx<sn.minx?an:sn).minx,on.miny=(an.miny<sn.miny?an:sn).miny,on.maxx=(an.maxx>sn.maxx?an:sn).maxx,on.maxy=(an.maxy>sn.maxy?an:sn).maxy,on=pn.aabb,an=U.aabb,sn=ln.aabb,on.minx=(an.minx<sn.minx?an:sn).minx,on.miny=(an.miny<sn.miny?an:sn).miny,on.maxx=(an.maxx>sn.maxx?an:sn).maxx,on.maxy=(an.maxy>sn.maxy?an:sn).maxy,an=cn.height,sn=rn.height,U.height=1+(sn<an?an:sn),an=U.height,sn=ln.height,pn.height=1+(sn<an?an:sn)):(pn.child2=rn,sn=((U.child2=ln).parent=U).aabb,_n=cn.aabb,hn=ln.aabb,sn.minx=(_n.minx<hn.minx?_n:hn).minx,sn.miny=(_n.miny<hn.miny?_n:hn).miny,sn.maxx=(_n.maxx>hn.maxx?_n:hn).maxx,sn.maxy=(_n.maxy>hn.maxy?_n:hn).maxy,sn=pn.aabb,_n=U.aabb,hn=rn.aabb,sn.minx=(_n.minx<hn.minx?_n:hn).minx,sn.miny=(_n.miny<hn.miny?_n:hn).miny,sn.maxx=(_n.maxx>hn.maxx?_n:hn).maxx,sn.maxy=(_n.maxy>hn.maxy?_n:hn).maxy,_n=cn.height,hn=ln.height,U.height=1+(hn<_n?_n:hn),_n=U.height,hn=rn.height,pn.height=1+(hn<_n?_n:hn)),U=pn):un<-1&&(_n=cn.child1,dn=cn.child2,cn.child1=U,cn.parent=U.parent,null!=(U.parent=cn).parent?cn.parent.child1==U?cn.parent.child1=cn:cn.parent.child2=cn:G.root=cn,_n.height>dn.height?(cn.child2=_n,hn=((U.child1=dn).parent=U).aabb,un=pn.aabb,xn=dn.aabb,hn.minx=(un.minx<xn.minx?un:xn).minx,hn.miny=(un.miny<xn.miny?un:xn).miny,hn.maxx=(un.maxx>xn.maxx?un:xn).maxx,hn.maxy=(un.maxy>xn.maxy?un:xn).maxy,hn=cn.aabb,un=U.aabb,xn=_n.aabb,hn.minx=(un.minx<xn.minx?un:xn).minx,hn.miny=(un.miny<xn.miny?un:xn).miny,hn.maxx=(un.maxx>xn.maxx?un:xn).maxx,hn.maxy=(un.maxy>xn.maxy?un:xn).maxy,un=pn.height,xn=dn.height,U.height=1+(xn<un?un:xn),un=U.height,xn=_n.height,cn.height=1+(xn<un?un:xn)):(cn.child2=dn,xn=((U.child1=_n).parent=U).aabb,yn=pn.aabb,zn=_n.aabb,xn.minx=(yn.minx<zn.minx?yn:zn).minx,xn.miny=(yn.miny<zn.miny?yn:zn).miny,xn.maxx=(yn.maxx>zn.maxx?yn:zn).maxx,xn.maxy=(yn.maxy>zn.maxy?yn:zn).maxy,xn=cn.aabb,yn=U.aabb,zn=dn.aabb,xn.minx=(yn.minx<zn.minx?yn:zn).minx,xn.miny=(yn.miny<zn.miny?yn:zn).miny,xn.maxx=(yn.maxx>zn.maxx?yn:zn).maxx,xn.maxy=(yn.maxy>zn.maxy?yn:zn).maxy,yn=pn.height,zn=_n.height,U.height=1+(zn<yn?yn:zn),yn=U.height,zn=dn.height,cn.height=1+(zn<yn?yn:zn)),U=cn));var dn=U.child1,yn=U.child2,zn=dn.height,cn=yn.height;U.height=1+(cn<zn?zn:cn);cn=U.aabb,dn=dn.aabb,yn=yn.aabb;cn.minx=(dn.minx<yn.minx?dn:yn).minx,cn.miny=(dn.miny<yn.miny?dn:yn).miny,cn.maxx=(dn.maxx>yn.maxx?dn:yn).maxx,cn.maxy=(dn.maxy>yn.maxy?dn:yn).maxy,U=U.parent}}e.synced=!1,e=e.snext}for(;null!=this.syncs;){var vn=this.syncs;if(this.syncs=vn.snext,vn.snext=null,!vn.moved){vn.moved=!1;var mn=vn.shape;if(!mn.body.component.sleeping){var fn=vn.aabb,bn=null;for(null!=this.dtree.root&&(this.dtree.root.next=bn,bn=this.dtree.root);null!=bn;){var gn=bn,bn=gn.next;if(gn.next=null,gn!=vn)if(null==gn.child1){var wn=gn.shape;if(wn.body!=mn.body&&(1!=wn.body.type||1!=mn.body.type)){var Mn=gn.aabb;if(Mn.miny<=fn.maxy&&fn.miny<=Mn.maxy&&Mn.minx<=fn.maxx&&fn.minx<=Mn.maxx){for(var Cn,kn,On,Pn=mn.id<wn.id?(Cn=mn.id,wn.id):(Cn=wn.id,mn.id),Sn=null,An=(mn.pairs.length<wn.pairs.length?mn:wn).pairs.head;null!=An;){var jn=An.elt;if(jn.id==Cn&&jn.di==Pn){Sn=jn;break}An=An.next}null==Sn?(null==Xt.zpp_pool?Sn=new Xt:(Sn=Xt.zpp_pool,Xt.zpp_pool=Sn.next,Sn.next=null),Sn.n1=vn,Sn.n2=gn,Sn.id=Cn,Sn.di=Pn,Sn.next=this.pairs,(this.pairs=Sn).first=!0,En=mn.pairs,null==hi.zpp_pool?kn=new hi:(kn=hi.zpp_pool,hi.zpp_pool=kn.next,kn.next=null),kn.elt=Sn,(Mn=kn).next=En.head,En.head=Mn,En.modified=!0,En.length++,En=wn.pairs,null==hi.zpp_pool?On=new hi:(On=hi.zpp_pool,hi.zpp_pool=On.next,On.next=null),On.elt=Sn,(wn=On).next=En.head,En.head=wn,En.modified=!0,En.length++):Sn.sleeping&&(Sn.sleeping=!1,Sn.next=this.pairs,(this.pairs=Sn).first=!0)}}}else{var En=gn.aabb;En.miny<=fn.maxy&&fn.miny<=En.maxy&&En.minx<=fn.maxx&&fn.minx<=En.maxx&&(null!=gn.child1&&(gn.child1.next=bn,bn=gn.child1),null!=gn.child2&&(gn.child2.next=bn,bn=gn.child2))}}for(null!=this.stree.root&&(this.stree.root.next=bn,bn=this.stree.root);null!=bn;){var In=bn;if(bn=In.next,In.next=null,In!=vn)if(null==In.child1){var Tn=In.shape;if(Tn.body!=mn.body&&(1!=Tn.body.type||1!=mn.body.type)){var Nn=In.aabb;if(Nn.miny<=fn.maxy&&fn.miny<=Nn.maxy&&Nn.minx<=fn.maxx&&fn.minx<=Nn.maxx){for(var Ln,Vn,Dn,Fn=mn.id<Tn.id?(Ln=mn.id,Tn.id):(Ln=Tn.id,mn.id),Rn=null,Zn=(mn.pairs.length<Tn.pairs.length?mn:Tn).pairs.head;null!=Zn;){var Bn=Zn.elt;if(Bn.id==Ln&&Bn.di==Fn){Rn=Bn;break}Zn=Zn.next}null==Rn?(null==Xt.zpp_pool?Rn=new Xt:(Rn=Xt.zpp_pool,Xt.zpp_pool=Rn.next,Rn.next=null),Rn.n1=vn,Rn.n2=In,Rn.id=Ln,Rn.di=Fn,Rn.next=this.pairs,(this.pairs=Rn).first=!0,Gn=mn.pairs,null==hi.zpp_pool?Vn=new hi:(Vn=hi.zpp_pool,hi.zpp_pool=Vn.next,Vn.next=null),Vn.elt=Rn,(Nn=Vn).next=Gn.head,Gn.head=Nn,Gn.modified=!0,Gn.length++,Gn=Tn.pairs,null==hi.zpp_pool?Dn=new hi:(Dn=hi.zpp_pool,hi.zpp_pool=Dn.next,Dn.next=null),Dn.elt=Rn,(Tn=Dn).next=Gn.head,Gn.head=Tn,Gn.modified=!0,Gn.length++):Rn.sleeping&&(Rn.sleeping=!1,Rn.next=this.pairs,(this.pairs=Rn).first=!0)}}}else{var Gn=In.aabb;Gn.miny<=fn.maxy&&fn.miny<=Gn.maxy&&Gn.minx<=fn.maxx&&fn.minx<=Gn.maxx&&(null!=In.child1&&(In.child1.next=bn,bn=In.child1),null!=In.child2&&(In.child2.next=bn,bn=In.child2))}}}}}for(;null!=this.moves;){var qn=this.moves;this.moves=qn.mnext,qn.mnext=null,qn.moved=!1;var Un=qn.shape;if(!Un.body.component.sleeping){var Kn=qn.aabb,Wn=null;for(null!=this.dtree.root&&(this.dtree.root.next=Wn,Wn=this.dtree.root);null!=Wn;){var Yn=Wn,Wn=Yn.next;if(Yn.next=null,Yn!=qn)if(null==Yn.child1){var Jn=Yn.shape;if(Jn.body!=Un.body&&(1!=Jn.body.type||1!=Un.body.type)){var Xn=Yn.aabb;if(Xn.miny<=Kn.maxy&&Kn.miny<=Xn.maxy&&Xn.minx<=Kn.maxx&&Kn.minx<=Xn.maxx){for(var Hn,$n,Qn,nt=Un.id<Jn.id?(Hn=Un.id,Jn.id):(Hn=Jn.id,Un.id),tt=null,et=(Un.pairs.length<Jn.pairs.length?Un:Jn).pairs.head;null!=et;){var it=et.elt;if(it.id==Hn&&it.di==nt){tt=it;break}et=et.next}null==tt?(null==Xt.zpp_pool?tt=new Xt:(tt=Xt.zpp_pool,Xt.zpp_pool=tt.next,tt.next=null),tt.n1=qn,tt.n2=Yn,tt.id=Hn,tt.di=nt,tt.next=this.pairs,(this.pairs=tt).first=!0,pt=Un.pairs,null==hi.zpp_pool?$n=new hi:($n=hi.zpp_pool,hi.zpp_pool=$n.next,$n.next=null),$n.elt=tt,(Xn=$n).next=pt.head,pt.head=Xn,pt.modified=!0,pt.length++,pt=Jn.pairs,null==hi.zpp_pool?Qn=new hi:(Qn=hi.zpp_pool,hi.zpp_pool=Qn.next,Qn.next=null),Qn.elt=tt,(Jn=Qn).next=pt.head,pt.head=Jn,pt.modified=!0,pt.length++):tt.sleeping&&(tt.sleeping=!1,tt.next=this.pairs,(this.pairs=tt).first=!0)}}}else{var pt=Yn.aabb;pt.miny<=Kn.maxy&&Kn.miny<=pt.maxy&&pt.minx<=Kn.maxx&&Kn.minx<=pt.maxx&&(null!=Yn.child1&&(Yn.child1.next=Wn,Wn=Yn.child1),null!=Yn.child2&&(Yn.child2.next=Wn,Wn=Yn.child2))}}for(null!=this.stree.root&&(this.stree.root.next=Wn,Wn=this.stree.root);null!=Wn;){var lt=Wn;if(Wn=lt.next,lt.next=null,lt!=qn)if(null==lt.child1){var rt=lt.shape;if(rt.body!=Un.body&&(1!=rt.body.type||1!=Un.body.type)){var ot=lt.aabb;if(ot.miny<=Kn.maxy&&Kn.miny<=ot.maxy&&ot.minx<=Kn.maxx&&Kn.minx<=ot.maxx){for(var at,st,_t,ht=Un.id<rt.id?(at=Un.id,rt.id):(at=rt.id,Un.id),ut=null,xt=(Un.pairs.length<rt.pairs.length?Un:rt).pairs.head;null!=xt;){var dt=xt.elt;if(dt.id==at&&dt.di==ht){ut=dt;break}xt=xt.next}null==ut?(null==Xt.zpp_pool?ut=new Xt:(ut=Xt.zpp_pool,Xt.zpp_pool=ut.next,ut.next=null),ut.n1=qn,ut.n2=lt,ut.id=at,ut.di=ht,ut.next=this.pairs,(this.pairs=ut).first=!0,yt=Un.pairs,null==hi.zpp_pool?st=new hi:(st=hi.zpp_pool,hi.zpp_pool=st.next,st.next=null),st.elt=ut,(ot=st).next=yt.head,yt.head=ot,yt.modified=!0,yt.length++,yt=rt.pairs,null==hi.zpp_pool?_t=new hi:(_t=hi.zpp_pool,hi.zpp_pool=_t.next,_t.next=null),_t.elt=ut,(rt=_t).next=yt.head,yt.head=rt,yt.modified=!0,yt.length++):ut.sleeping&&(ut.sleeping=!1,ut.next=this.pairs,(this.pairs=ut).first=!0)}}}else{var yt=lt.aabb;yt.miny<=Kn.maxy&&Kn.miny<=yt.maxy&&yt.minx<=Kn.maxx&&Kn.minx<=yt.maxx&&(null!=lt.child1&&(lt.child1.next=Wn,Wn=lt.child1),null!=lt.child2&&(lt.child2.next=Wn,Wn=lt.child2))}}}}for(var zt=null,ct=this.pairs;null!=ct;)if(!ct.first&&(Tt=ct.n1.aabb,!((Nt=ct.n2.aabb).miny<=Tt.maxy&&Tt.miny<=Nt.maxy&&Nt.minx<=Tt.maxx&&Tt.minx<=Nt.maxx))){null==zt?this.pairs=ct.next:zt.next=ct.next;for(var vt,mt,ft=ct.n1.shape.pairs,bt=null,gt=ft.head;null!=gt;){if(gt.elt==ct){null==bt?(mt=(vt=ft.head).next,ft.head=mt,null==ft.head&&(ft.pushmod=!0)):(mt=(vt=bt.next).next,null==(bt.next=mt)&&(ft.pushmod=!0));var wt=vt;wt.elt=null,wt.next=hi.zpp_pool,hi.zpp_pool=wt,ft.modified=!0,ft.length--,ft.pushmod=!0;break}gt=(bt=gt).next}for(var Mt,Ct,kt=ct.n2.shape.pairs,Ot=null,Pt=kt.head;null!=Pt;){if(Pt.elt==ct){null==Ot?(Ct=(Mt=kt.head).next,kt.head=Ct,null==kt.head&&(kt.pushmod=!0)):(Ct=(Mt=Ot.next).next,null==(Ot.next=Ct)&&(kt.pushmod=!0));var St=Mt;St.elt=null,St.next=hi.zpp_pool,hi.zpp_pool=St,kt.modified=!0,kt.length--,kt.pushmod=!0;break}Pt=(Ot=Pt).next}var At=ct.next;null!=ct.arb&&(ct.arb.pair=null),ct.arb=null;var jt=ct;jt.n1=jt.n2=null,jt.sleeping=!1,jt.next=Xt.zpp_pool,Xt.zpp_pool=jt,ct=At}else var Et=ct.n1.shape,It=Et.body,Tt=ct.n2.shape,Nt=Tt.body,ct=ct.first||!It.component.sleeping&&1!=It.type||!Nt.component.sleeping&&1!=Nt.type?(ct.first=!1,jt=Et.aabb,(At=Tt.aabb).miny<=jt.maxy&&jt.miny<=At.maxy&&At.minx<=jt.maxx&&jt.minx<=At.maxx&&(At=ct.arb,ct.arb=t?n.narrowPhase(Et,Tt,2!=It.type||2!=Nt.type,ct.arb,!1):n.continuousEvent(Et,Tt,2!=It.type||2!=Nt.type,ct.arb,!1),null==ct.arb?null!=At&&(At.pair=null):ct.arb.pair=ct),(zt=ct).next):(ct.sleeping=!0,null==zt?this.pairs=ct.next:zt.next=ct.next,ct.next)},$t.prototype.clear=function(){for(;null!=this.syncs;){var n=this.syncs.snext;this.syncs.snext=null,this.syncs.first_sync&&(this.syncs.shape.node=null,this.syncs.shape.removedFromSpace(),this.syncs.shape=null),this.syncs=n}for(;null!=this.moves;){var t=this.moves.mnext;this.moves.mnext=null,this.moves.first_sync&&(this.moves.shape.node=null,this.moves.shape.removedFromSpace(),this.moves.shape=null),this.moves=t}for(;null!=this.pairs;){var e=this.pairs.next;null!=this.pairs.arb&&(this.pairs.arb.pair=null),this.pairs.arb=null;for(var i,p,l=this.pairs.n1.shape.pairs,r=this.pairs,o=null,a=l.head;null!=a;){if(a.elt==r){null==o?(p=(i=l.head).next,l.head=p,null==l.head&&(l.pushmod=!0)):(p=(i=o.next).next,null==(o.next=p)&&(l.pushmod=!0));var s=i;s.elt=null,s.next=hi.zpp_pool,hi.zpp_pool=s,l.modified=!0,l.length--,l.pushmod=!0;break}a=(o=a).next}for(var _,h,u=this.pairs.n2.shape.pairs,x=this.pairs,d=null,y=u.head;null!=y;){if(y.elt==x){null==d?(h=(_=u.head).next,u.head=h,null==u.head&&(u.pushmod=!0)):(h=(_=d.next).next,null==(d.next=h)&&(u.pushmod=!0));var z=_;z.elt=null,z.next=hi.zpp_pool,hi.zpp_pool=z,u.modified=!0,u.length--,u.pushmod=!0;break}y=(d=y).next}var c=this.pairs;c.n1=c.n2=null,c.sleeping=!1,c.next=Xt.zpp_pool,Xt.zpp_pool=c,this.pairs=e}this.dtree.clear(),this.stree.clear()},$t.prototype.treeStack=null,$t.prototype.shapesUnderPoint=function(n,t,e,i){var p;this.sync_broadphase(),null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t;var l=p,r=null==i?new zn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o=this.treeStack.pop_unsafe(),a=o.aabb;l.x>=a.minx&&l.x<=a.maxx&&l.y>=a.miny&&l.y<=a.maxy&&(null==o.child1?(null==e||0!=((a=o.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&a.collisionGroup))&&(0==o.shape.type?Ep.circleContains(o.shape.circle,l)&&r.push(o.shape.outer):Ep.polyContains(o.shape.polygon,l)&&r.push(o.shape.outer)):(null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var s=this.treeStack.pop_unsafe(),_=s.aabb;l.x>=_.minx&&l.x<=_.maxx&&l.y>=_.miny&&l.y<=_.maxy&&(null==s.child1?(null==e||0!=((_=s.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&_.collisionGroup))&&(0==s.shape.type?Ep.circleContains(s.shape.circle,l)&&r.push(s.shape.outer):Ep.polyContains(s.shape.polygon,l)&&r.push(s.shape.outer)):(null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)))}return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l,r},$t.prototype.bodiesUnderPoint=function(n,t,e,i){var p;this.sync_broadphase(),null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t;var l=p,r=null==i?new nn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o,a=this.treeStack.pop_unsafe(),s=a.aabb;l.x>=s.minx&&l.x<=s.maxx&&l.y>=s.miny&&l.y<=s.maxy&&(null==a.child1?(o=a.shape.body.outer,r.has(o)||(null==e||0!=((s=a.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&s.collisionGroup))&&(0==a.shape.type?Ep.circleContains(a.shape.circle,l)&&r.push(o):Ep.polyContains(a.shape.polygon,l)&&r.push(o))):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var _,h=this.treeStack.pop_unsafe(),u=h.aabb;l.x>=u.minx&&l.x<=u.maxx&&l.y>=u.miny&&l.y<=u.maxy&&(null==h.child1?(_=h.shape.body.outer,r.has(_)||(null==e||0!=((u=h.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&u.collisionGroup))&&(0==h.shape.type?Ep.circleContains(h.shape.circle,l)&&r.push(_):Ep.polyContains(h.shape.polygon,l)&&r.push(_))):(null!=h.child1&&this.treeStack.add(h.child1),null!=h.child2&&this.treeStack.add(h.child2)))}return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ip.zpp_pool,Ip.zpp_pool=l,r},$t.prototype.treeStack2=null,$t.prototype.shapesInAABB=function(n,t,e,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new zn:p;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o=this.treeStack.pop_unsafe(),a=o.aabb;if(a.minx>=l.minx&&a.miny>=l.miny&&a.maxx<=l.maxx&&a.maxy<=l.maxy)if(null==o.child1)(null==i||0!=((u=o.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&u.collisionGroup))&&r.push(o.shape.outer);else for(null==this.treeStack2&&(this.treeStack2=new Ee),this.treeStack2.add(o);null!=this.treeStack2.head;){var s,_=this.treeStack2.pop_unsafe();null==_.child1?(null==i||0!=((s=_.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&s.collisionGroup))&&r.push(_.shape.outer):(null!=_.child1&&this.treeStack2.add(_.child1),null!=_.child2&&this.treeStack2.add(_.child2))}else{var h,u=o.aabb;l.miny<=u.maxy&&u.miny<=l.maxy&&l.minx<=u.maxx&&u.minx<=l.maxx&&(null==o.child1?(null==i||0!=((u=o.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&u.collisionGroup))&&(t?e?Ep.containTest(this.aabbShape.zpp_inner,o.shape)&&r.push(o.shape.outer):((h=o.shape.aabb).minx>=l.minx&&h.miny>=l.miny&&h.maxx<=l.maxx&&h.maxy<=l.maxy||Ep.testCollide_safe(o.shape,this.aabbShape.zpp_inner))&&r.push(o.shape.outer):(!e||(h=o.shape.aabb).minx>=l.minx&&h.miny>=l.miny&&h.maxx<=l.maxx&&h.maxy<=l.maxy)&&r.push(o.shape.outer)):(null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)))}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var x=this.treeStack.pop_unsafe(),d=x.aabb;if(d.minx>=l.minx&&d.miny>=l.miny&&d.maxx<=l.maxx&&d.maxy<=l.maxy)if(null==x.child1)(null==i||0!=((v=x.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&v.collisionGroup))&&r.push(x.shape.outer);else for(null==this.treeStack2&&(this.treeStack2=new Ee),this.treeStack2.add(x);null!=this.treeStack2.head;){var y,z=this.treeStack2.pop_unsafe();null==z.child1?(null==i||0!=((y=z.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&y.collisionGroup))&&r.push(z.shape.outer):(null!=z.child1&&this.treeStack2.add(z.child1),null!=z.child2&&this.treeStack2.add(z.child2))}else{var c,v=x.aabb;l.miny<=v.maxy&&v.miny<=l.maxy&&l.minx<=v.maxx&&v.minx<=l.maxx&&(null==x.child1?(null==i||0!=((v=x.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&v.collisionGroup))&&(t?e?Ep.containTest(this.aabbShape.zpp_inner,x.shape)&&r.push(x.shape.outer):((c=x.shape.aabb).minx>=l.minx&&c.miny>=l.miny&&c.maxx<=l.maxx&&c.maxy<=l.maxy||Ep.testCollide_safe(x.shape,this.aabbShape.zpp_inner))&&r.push(x.shape.outer):(!e||(c=x.shape.aabb).minx>=l.minx&&c.miny>=l.miny&&c.maxx<=l.maxx&&c.maxy<=l.maxy)&&r.push(x.shape.outer)):(null!=x.child1&&this.treeStack.add(x.child1),null!=x.child2&&this.treeStack.add(x.child2)))}}return r},$t.prototype.failed=null,$t.prototype.bodiesInAABB=function(n,t,e,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new nn:p;if(null==this.failed&&(this.failed=new nn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o=this.treeStack.pop_unsafe(),a=o.aabb;if(a.minx>=l.minx&&a.miny>=l.miny&&a.maxx<=l.maxx&&a.maxy<=l.maxy)if(null==o.child1)(null==i||0!=((a=o.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&a.collisionGroup))&&(x=o.shape.body.outer,r.has(x)||r.push(x));else for(null==this.treeStack2&&(this.treeStack2=new Ee),this.treeStack2.add(o);null!=this.treeStack2.head;){var s,_=this.treeStack2.pop_unsafe();null==_.child1?(null==i||0!=((s=_.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&s.collisionGroup))&&(s=_.shape.body.outer,r.has(s)||r.push(s)):(null!=_.child1&&this.treeStack2.add(_.child1),null!=_.child2&&this.treeStack2.add(_.child2))}else{var h,u,x=o.aabb;l.miny<=x.maxy&&x.miny<=l.maxy&&l.minx<=x.maxx&&x.minx<=l.maxx&&(null==o.child1?(x=o.shape.body.outer,(null==i||0!=((h=o.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup))&&(t?e?this.failed.has(x)||(h=Ep.containTest(this.aabbShape.zpp_inner,o.shape),!r.has(x)&&h?r.push(x):h||(r.remove(x),this.failed.push(x))):!r.has(x)&&Ep.testCollide_safe(o.shape,this.aabbShape.zpp_inner)&&r.push(x):e?this.failed.has(x)||(u=(u=o.shape.aabb).minx>=l.minx&&u.miny>=l.miny&&u.maxx<=l.maxx&&u.maxy<=l.maxy,!r.has(x)&&u?r.push(x):u||(r.remove(x),this.failed.push(x))):!r.has(x)&&((u=o.shape.aabb).minx>=l.minx&&u.miny>=l.miny&&u.maxx<=l.maxx&&u.maxy<=l.maxy)&&r.push(x))):(null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)))}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var d=this.treeStack.pop_unsafe(),y=d.aabb;if(y.minx>=l.minx&&y.miny>=l.miny&&y.maxx<=l.maxx&&y.maxy<=l.maxy)if(null==d.child1)(null==i||0!=((y=d.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&y.collisionGroup))&&(f=d.shape.body.outer,r.has(f)||r.push(f));else for(null==this.treeStack2&&(this.treeStack2=new Ee),this.treeStack2.add(d);null!=this.treeStack2.head;){var z,c=this.treeStack2.pop_unsafe();null==c.child1?(null==i||0!=((z=c.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&z.collisionGroup))&&(z=c.shape.body.outer,r.has(z)||r.push(z)):(null!=c.child1&&this.treeStack2.add(c.child1),null!=c.child2&&this.treeStack2.add(c.child2))}else{var v,m,f=d.aabb;l.miny<=f.maxy&&f.miny<=l.maxy&&l.minx<=f.maxx&&f.minx<=l.maxx&&(null==d.child1?(f=d.shape.body.outer,(null==i||0!=((v=d.shape.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&v.collisionGroup))&&(t?e?this.failed.has(f)||(v=Ep.containTest(this.aabbShape.zpp_inner,d.shape),!r.has(f)&&v?r.push(f):v||(r.remove(f),this.failed.push(f))):!r.has(f)&&Ep.testCollide_safe(d.shape,this.aabbShape.zpp_inner)&&r.push(f):e?this.failed.has(f)||(m=(m=d.shape.aabb).minx>=l.minx&&m.miny>=l.miny&&m.maxx<=l.maxx&&m.maxy<=l.maxy,!r.has(f)&&m?r.push(f):m||(r.remove(f),this.failed.push(f))):!r.has(f)&&((m=d.shape.aabb).minx>=l.minx&&m.miny>=l.miny&&m.maxx<=l.maxx&&m.maxy<=l.maxy)&&r.push(f))):(null!=d.child1&&this.treeStack.add(d.child1),null!=d.child2&&this.treeStack.add(d.child2)))}}return this.failed.clear(),r},$t.prototype.shapesInCircle=function(n,t,e,i,p,l){this.sync_broadphase(),this.updateCircShape(n,t,e);var r=this.circShape.zpp_inner.aabb,o=null==l?new zn:l;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),s=a.aabb;r.miny<=s.maxy&&s.miny<=r.maxy&&r.minx<=s.maxx&&s.minx<=r.maxx&&(null==a.child1?(null==p||0!=((s=a.shape.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&s.collisionGroup))&&(i?Ep.containTest(this.circShape.zpp_inner,a.shape)&&o.push(a.shape.outer):Ep.testCollide_safe(a.shape,this.circShape.zpp_inner)&&o.push(a.shape.outer)):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var _=this.treeStack.pop_unsafe(),h=_.aabb;r.miny<=h.maxy&&h.miny<=r.maxy&&r.minx<=h.maxx&&h.minx<=r.maxx&&(null==_.child1?(null==p||0!=((h=_.shape.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&h.collisionGroup))&&(i?Ep.containTest(this.circShape.zpp_inner,_.shape)&&o.push(_.shape.outer):Ep.testCollide_safe(_.shape,this.circShape.zpp_inner)&&o.push(_.shape.outer)):(null!=_.child1&&this.treeStack.add(_.child1),null!=_.child2&&this.treeStack.add(_.child2)))}return o},$t.prototype.bodiesInCircle=function(n,t,e,i,p,l){this.sync_broadphase(),this.updateCircShape(n,t,e);var r=this.circShape.zpp_inner.aabb,o=null==l?new nn:l;if(null==this.failed&&(this.failed=new nn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a,s=this.treeStack.pop_unsafe(),_=s.aabb;r.miny<=_.maxy&&_.miny<=r.maxy&&r.minx<=_.maxx&&_.minx<=r.maxx&&(null==s.child1?(_=s.shape.body.outer,(null==p||0!=((a=s.shape.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&a.collisionGroup))&&(i?this.failed.has(_)||(a=Ep.containTest(this.circShape.zpp_inner,s.shape),!o.has(_)&&a?o.push(_):a||(o.remove(_),this.failed.push(_))):!o.has(_)&&Ep.testCollide_safe(s.shape,this.circShape.zpp_inner)&&o.push(_))):(null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h,u=this.treeStack.pop_unsafe(),x=u.aabb;r.miny<=x.maxy&&x.miny<=r.maxy&&r.minx<=x.maxx&&x.minx<=r.maxx&&(null==u.child1?(x=u.shape.body.outer,(null==p||0!=((h=u.shape.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&h.collisionGroup))&&(i?this.failed.has(x)||(h=Ep.containTest(this.circShape.zpp_inner,u.shape),!o.has(x)&&h?o.push(x):h||(o.remove(x),this.failed.push(x))):!o.has(x)&&Ep.testCollide_safe(u.shape,this.circShape.zpp_inner)&&o.push(x))):(null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)))}return this.failed.clear(),o},$t.prototype.shapesInShape=function(n,t,e,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new zn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var r=this.treeStack.pop_unsafe(),o=r.aabb;p.miny<=o.maxy&&o.miny<=p.maxy&&p.minx<=o.maxx&&o.minx<=p.maxx&&(null==r.child1?(null==e||0!=((o=r.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup))&&(t?Ep.containTest(n,r.shape)&&l.push(r.shape.outer):Ep.testCollide_safe(r.shape,n)&&l.push(r.shape.outer)):(null!=r.child1&&this.treeStack.add(r.child1),null!=r.child2&&this.treeStack.add(r.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),s=a.aabb;p.miny<=s.maxy&&s.miny<=p.maxy&&p.minx<=s.maxx&&s.minx<=p.maxx&&(null==a.child1?(null==e||0!=((s=a.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&s.collisionGroup))&&(t?Ep.containTest(n,a.shape)&&l.push(a.shape.outer):Ep.testCollide_safe(a.shape,n)&&l.push(a.shape.outer)):(null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)))}return l},$t.prototype.bodiesInShape=function(n,t,e,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new nn:i;if(null==this.failed&&(this.failed=new nn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var r,o=this.treeStack.pop_unsafe(),a=o.aabb;p.miny<=a.maxy&&a.miny<=p.maxy&&p.minx<=a.maxx&&a.minx<=p.maxx&&(null==o.child1?(a=o.shape.body.outer,(null==e||0!=((r=o.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&r.collisionGroup))&&(t?this.failed.has(a)||(r=Ep.containTest(n,o.shape),!l.has(a)&&r?l.push(a):r||(l.remove(a),this.failed.push(a))):!l.has(a)&&Ep.testCollide_safe(o.shape,n)&&l.push(a))):(null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)))}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new Ee),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var s,_=this.treeStack.pop_unsafe(),h=_.aabb;p.miny<=h.maxy&&h.miny<=p.maxy&&p.minx<=h.maxx&&h.minx<=p.maxx&&(null==_.child1?(h=_.shape.body.outer,(null==e||0!=((s=_.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&s.collisionGroup))&&(t?this.failed.has(h)||(s=Ep.containTest(n,_.shape),!l.has(h)&&s?l.push(h):s||(l.remove(h),this.failed.push(h))):!l.has(h)&&Ep.testCollide_safe(_.shape,n)&&l.push(h))):(null!=_.child1&&this.treeStack.add(_.child1),null!=_.child2&&this.treeStack.add(_.child2)))}return this.failed.clear(),l},$t.prototype.openlist=null,$t.prototype.rayCast=function(n,t,e){null==this.openlist&&(this.openlist=new Ee),this.sync_broadphase(),n.validate_dir();var i=n.maxdist;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb)){var p=n.aabbsect(this.dtree.root.aabb);if(0<=p&&p<i){this.dtree.root.rayt=p;for(var l=null,r=this.openlist.head;null!=r&&!(this.dtree.root.rayt<r.elt.rayt);)r=(l=r).next;var o=this.openlist;null==xi.zpp_pool?a=new xi:(a=xi.zpp_pool,xi.zpp_pool=a.next,a.next=null),a.elt=this.dtree.root;var a=a;null==l?(a.next=o.head,o.head=a):(a.next=l.next,l.next=a),o.pushmod=o.modified=!0,o.length++}}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb)){o=n.aabbsect(this.stree.root.aabb);if(0<=o&&o<i){this.stree.root.rayt=o;for(var s=null,_=this.openlist.head;null!=_&&!(this.stree.root.rayt<_.elt.rayt);)_=(s=_).next;o=this.openlist;null==xi.zpp_pool?h=new xi:(h=xi.zpp_pool,xi.zpp_pool=h.next,h.next=null),h.elt=this.stree.root;var h=h;null==s?(h.next=o.head,o.head=h):(h.next=s.next,s.next=h),o.pushmod=o.modified=!0,o.length++}}for(var u=null;null!=this.openlist.head;){var x=this.openlist.pop_unsafe();if(x.rayt>=i)break;if(null==x.child1){var d,y=x.shape;!(null==e||0!=((d=y.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&d.collisionGroup))||null!=(z=0==y.type?n.circlesect(y.circle,t,i):n.aabbtest(y.aabb)?n.polysect(y.polygon,t,i):null)&&(i=z.zpp_inner.toiDistance,null!=u&&u.zpp_inner.free(),u=z)}else{if(null!=x.child1&&n.aabbtest(x.child1.aabb)){var z=n.aabbsect(x.child1.aabb);if(0<=z&&z<i){x.child1.rayt=z;for(var c=null,v=this.openlist.head;null!=v&&!(x.child1.rayt<v.elt.rayt);)v=(c=v).next;var m,f=this.openlist;null==xi.zpp_pool?m=new xi:(m=xi.zpp_pool,xi.zpp_pool=m.next,m.next=null),m.elt=x.child1;var b=m;null==c?(b.next=f.head,f.head=b):(b.next=c.next,c.next=b),f.pushmod=f.modified=!0,f.length++}}if(null!=x.child2&&n.aabbtest(x.child2.aabb)){b=n.aabbsect(x.child2.aabb);if(0<=b&&b<i){x.child2.rayt=b;for(var g=null,w=this.openlist.head;null!=w&&!(x.child2.rayt<w.elt.rayt);)w=(g=w).next;var M,f=this.openlist;null==xi.zpp_pool?M=new xi:(M=xi.zpp_pool,xi.zpp_pool=M.next,M.next=null),M.elt=x.child2;b=M;null==g?(b.next=f.head,f.head=b):(b.next=g.next,g.next=b),f.pushmod=f.modified=!0,f.length++}}}}return this.openlist.clear(),u},$t.prototype.rayMultiCast=function(n,t,e,i){null==this.openlist&&(this.openlist=new Ee),this.sync_broadphase(),n.validate_dir();var p,l=n.maxdist>=1/0,r=null==i?new W:i;for(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb)&&(l||0<=(p=n.aabbsect(this.dtree.root.aabb))&&p<n.maxdist)&&this.openlist.add(this.dtree.root),null!=this.stree.root&&n.aabbtest(this.stree.root.aabb)&&(l||0<=(p=n.aabbsect(this.stree.root.aabb))&&p<n.maxdist)&&this.openlist.add(this.stree.root);null!=this.openlist.head;){var o,a,s,_=this.openlist.pop_unsafe();null==_.child1?(o=_.shape,(null==e||0!=((a=o.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&a.collisionGroup))&&(0==o.type?n.circlesect2(o.circle,t,r):n.aabbtest(o.aabb)&&n.polysect2(o.polygon,t,r))):(null!=_.child1&&n.aabbtest(_.child1.aabb)&&(l||0<=(s=n.aabbsect(_.child1.aabb))&&s<n.maxdist)&&this.openlist.add(_.child1),null!=_.child2&&n.aabbtest(_.child2.aabb)&&(l||0<=(s=n.aabbsect(_.child2.aabb))&&s<n.maxdist)&&this.openlist.add(_.child2))}return this.openlist.clear(),r},$t.prototype.__class__=$t;var ne=zpp_nape.space.ZPP_Island=function(){this.waket=0,this.sleep=!1,this.comps=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.comps=new Ie};ne.__name__=["zpp_nape","space","ZPP_Island"],ne.prototype.next=null,ne.prototype.elem=function(){return this},ne.prototype.begin=function(){return this.next},ne.prototype._inuse=null,ne.prototype.modified=null,ne.prototype.pushmod=null,ne.prototype.length=null,ne.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},ne.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},ne.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},ne.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},ne.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},ne.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},ne.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},ne.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},ne.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},ne.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},ne.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ne.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ne.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ne.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ne.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},ne.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},ne.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ne.prototype.clear=function(){},ne.prototype.inlined_clear=function(){},ne.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},ne.prototype.empty=function(){return null==this.next},ne.prototype.size=function(){return this.length},ne.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},ne.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},ne.prototype.front=function(){return this.next},ne.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},ne.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},ne.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n:null},ne.prototype.comps=null,ne.prototype.sleep=null,ne.prototype.waket=null,ne.prototype.free=function(){},ne.prototype.alloc=function(){this.waket=0},ne.prototype.__class__=ne;var te=zpp_nape.space.ZPP_Component=function(){this.woken=!1,this.waket=0,this.sleeping=!1,this.island=null,this.constraint=null,this.body=null,this.isBody=!1,this.rank=0,this.parent=null,this.next=null,this.sleeping=!1,this.island=null,(this.parent=this).rank=0,this.woken=!1};te.__name__=["zpp_nape","space","ZPP_Component"],te.prototype.next=null,te.prototype.parent=null,te.prototype.rank=null,te.prototype.isBody=null,te.prototype.body=null,te.prototype.constraint=null,te.prototype.island=null,te.prototype.sleeping=null,te.prototype.waket=null,te.prototype.woken=null,te.prototype.free=function(){this.body=null,this.constraint=null},te.prototype.alloc=function(){},te.prototype.reset=function(){this.sleeping=!1,this.island=null,(this.parent=this).rank=0},te.prototype.__class__=te;var np=zpp_nape.space.ZPP_CallbackSet=function(){this.lazydel=!1,this.freed=!1,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.int2=null,this.int1=null,this.di=0,this.id=0,this.arbiters=new fe};np.__name__=["zpp_nape","space","ZPP_CallbackSet"],np.get=function(n,t){var e;return null==np.zpp_pool?e=new np:(e=np.zpp_pool,np.zpp_pool=e.next,e.next=null),e.freed=!1,e.lazydel=!1,e.COLLISIONstate=1,e.COLLISIONstamp=0,e.SENSORstate=1,e.SENSORstamp=0,e.FLUIDstate=1,e.FLUIDstamp=0,n.id<t.id?(e.int1=n,e.int2=t):(e.int1=t,e.int2=n),e.id=e.int1.id,e.di=e.int2.id,e},np.prototype.id=null,np.prototype.di=null,np.prototype.int1=null,np.prototype.int2=null,np.prototype.arbiters=null,np.prototype.COLLISIONstate=null,np.prototype.COLLISIONstamp=null,np.prototype.SENSORstate=null,np.prototype.SENSORstamp=null,np.prototype.FLUIDstate=null,np.prototype.FLUIDstamp=null,np.prototype.next=null,np.prototype.elem=function(){return this},np.prototype.begin=function(){return this.next},np.prototype._inuse=null,np.prototype.modified=null,np.prototype.pushmod=null,np.prototype.length=null,np.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},np.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},np.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},np.prototype.addAll=function(n){for(var t=n.next;null!=t;)this.add(t),t=t.next},np.prototype.insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},np.prototype.inlined_insert=function(n,t){return t._inuse=!0,null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},np.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},np.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},np.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},np.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},np.prototype.remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},np.prototype.try_remove=function(n){for(var t=null,e=this.next,i=!1;null!=e;){if(e==n){this.erase(t),i=!0;break}e=(t=e).next}return i},np.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.next;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},np.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.next,l=!1;null!=p;){if(p==n){null==i?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},np.prototype.erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},np.prototype.inlined_erase=function(n){var t,e;return null==n?(e=(t=this.next).next,this.next=e,null==this.next&&(this.pushmod=!0)):(e=(t=n.next).next,null==(n.next=e)&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,e},np.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},np.prototype.clear=function(){},np.prototype.inlined_clear=function(){},np.prototype.reverse=function(){for(var n=this.next,t=null;null!=n;){var e=n.next;n.next=t,t=this.next=n,n=e}this.modified=!0,this.pushmod=!0},np.prototype.empty=function(){return null==this.next},np.prototype.size=function(){return this.length},np.prototype.has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},np.prototype.inlined_has=function(n){for(var t=!1,e=this.next;null!=e;){if(e==n){t=!0;break}e=e.next}return t},np.prototype.front=function(){return this.next},np.prototype.back=function(){for(var n=this.next,t=n;null!=t;)t=(n=t).next;return n},np.prototype.iterator_at=function(n){for(var t=this.next;0<n--&&null!=t;)t=t.next;return t},np.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n:null},np.prototype.freed=null,np.prototype.lazydel=null,np.prototype.free=function(){this.int1=this.int2=null,this.id=this.di=-1,this.freed=!0},np.prototype.alloc=function(){this.freed=!1,this.lazydel=!1,this.COLLISIONstate=1,this.COLLISIONstamp=0,this.SENSORstate=1,this.SENSORstamp=0,this.FLUIDstate=1,this.FLUIDstamp=0},np.prototype.add_arb=function(n){for(var t=!1,e=this.arbiters.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}if(t)return!1;var i=this.arbiters;null==tp.zpp_pool?p=new tp:(p=tp.zpp_pool,tp.zpp_pool=p.next,p.next=null),p.elt=n;var p=p;return p.next=i.head,i.head=p,i.modified=!0,i.length++,!0},np.prototype.try_remove_arb=function(n){for(var t,e,i=this.arbiters,p=null,l=i.head,r=!1;null!=l;){if(l.elt==n){null==p?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=p.next).next,null==(p.next=e)&&(i.pushmod=!0));var o=t;o.elt=null,o.next=tp.zpp_pool,tp.zpp_pool=o,i.modified=!0,i.length--,r=i.pushmod=!0;break}l=(p=l).next}return r},np.prototype.remove_arb=function(n){for(var t,e,i=this.arbiters,p=null,l=i.head;null!=l;){if(l.elt==n){null==p?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=p.next).next,null==(p.next=e)&&(i.pushmod=!0));var r=t;r.elt=null,r.next=tp.zpp_pool,tp.zpp_pool=r,i.modified=!0,i.length--,i.pushmod=!0;break}l=(p=l).next}},np.prototype.empty_arb=function(n){for(var t=!0,e=this.arbiters.head;null!=e;){if(0!=(e.elt.type&n)){t=!1;break}e=e.next}return t},np.prototype.really_empty=function(){return null==this.arbiters.head},np.prototype.sleeping=function(){for(var n=!0,t=this.arbiters.head;null!=t;){if(!t.elt.sleeping){n=!1;break}t=t.next}return n},np.prototype.__class__=np;var ee=zpp_nape.space.ZPP_CbSetManager=function(n){this.space=null,(this.cbsets=null)==op.zpp_pool?this.cbsets=new op:(this.cbsets=op.zpp_pool,op.zpp_pool=this.cbsets.next,this.cbsets.next=null),this.cbsets.lt=Ki.setlt,this.space=n};ee.__name__=["zpp_nape","space","ZPP_CbSetManager"],ee.prototype.cbsets=null,ee.prototype.space=null,ee.prototype.get=function(n){if(null==n.head)return null;var t;null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null);var e=t.cbTypes;t.cbTypes=n;var i=this.cbsets.find_weak(t),p=null!=i?i.data:(p=Ki.get(n),this.cbsets.insert(p),p.manager=this,p);t.cbTypes=e;var l=t;for(l.listeners.clear(),l.zip_listeners=!0,l.bodylisteners.clear(),l.zip_bodylisteners=!0,l.conlisteners.clear(),l.zip_conlisteners=!0;null!=l.cbTypes.head;)l.cbTypes.pop_unsafe().cbsets.remove(l);return l.next=Ki.zpp_pool,Ki.zpp_pool=l,p},ee.prototype.remove=function(n){for(this.cbsets.remove(n);null!=n.cbpairs.head;){var t=n.cbpairs.pop_unsafe();t.a!=t.b&&(n==t.a?t.b:t.a).cbpairs.remove(t),t.a=t.b=null,t.listeners.clear(),t.next=Wi.zpp_pool,Wi.zpp_pool=t}n.manager=null},ee.prototype.clear=function(){},ee.prototype.validate=function(){if(!this.cbsets.empty()){for(var n=this.cbsets.parent;null!=n.prev;)n=n.prev;for(;null!=n;)if(n.data.validate(),null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}},ee.prototype.pair=function(n,t){for(var e,i=null,p=(n.cbpairs.length<t.cbpairs.length?n:t).cbpairs.head;null!=p;){var l=p.elt;if(l.a==n&&l.b==t||l.a==t&&l.b==n){i=l;break}p=p.next}return null==i&&(null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.zip_listeners=!0,Ki.setlt(n,t)?(e.a=n,e.b=t):(e.a=t,e.b=n),i=e,n.cbpairs.add(i),t!=n&&t.cbpairs.add(i)),i.zip_listeners&&(i.zip_listeners=!1,i.__validate()),i},ee.prototype.valid_listener=function(n){return n.space==this.space},ee.prototype.__class__=ee;var ie=zpp_nape.space.ZPP_Space=function(n,t){this.prelisteners=null,this.precb=null,this.continuous=!1,this.toiEvents=null,this.pre_dt=0,this.convexShapeList=null,this.cbsets=null,this.callbackset_list=null,this.callbacks=null,this.wrap_listeners=null,this.listeners=null,this.islands=null,this.staticsleep=null,this.wrap_livecon=null,this.live_constraints=null,this.wrap_live=null,this.live=null,this.wrap_arbiters=null,this.s_arbiters=null,this.f_arbiters=null,this.c_arbiters_false=null,this.c_arbiters_true=null,this.sortcontacts=!1,this.time=0,this.midstep=!1,this.stamp=0,this.global_ang_drag=0,this.global_lin_drag=0,this.__static=null,this.bphase=null,this.kinematics=null,this.wrap_constraints=null,this.constraints=null,this.wrap_compounds=null,this.compounds=null,this.wrap_bodies=null,this.bodies=null,this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.userData=null,this.outer=null,this.toiEvents=new Fe,this.global_lin_drag=.015,this.global_ang_drag=.015,this.precb=new f,this.precb.zpp_inner=new lt,this.sortcontacts=!0,this.pre_dt=0,null==t||(null==Yi.Broadphase_DYNAMIC_AABB_TREE&&(Yi.internal=!0,Yi.Broadphase_DYNAMIC_AABB_TREE=new mn,Yi.internal=!1),t==Yi.Broadphase_DYNAMIC_AABB_TREE)?this.bphase=new $t(this):(null==Yi.Broadphase_SWEEP_AND_PRUNE&&(Yi.internal=!0,Yi.Broadphase_SWEEP_AND_PRUNE=new mn,Yi.internal=!1),t==Yi.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new le(this))),this.time=0,null!=n?(this.gravityx=n.x,this.gravityy=n.y):(this.gravityx=0,this.gravityy=0),this.bodies=new ve,this.wrap_bodies=wi.get(this.bodies),this.wrap_bodies.zpp_inner.adder=X(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=X(this,this.bodies_subber),this.compounds=new me,this.wrap_compounds=Ci.get(this.compounds),this.wrap_compounds.zpp_inner.adder=X(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=X(this,this.compounds_subber),this.kinematics=new ve,this.c_arbiters_true=new Ve,this.c_arbiters_false=new Ve,this.f_arbiters=new Te,this.s_arbiters=new Ne,this.islands=new ne,this.live=new ve,this.wrap_live=wi.get(this.live,!0),this.staticsleep=new ve,this.constraints=new kn,this.wrap_constraints=gi.get(this.constraints),this.wrap_constraints.zpp_inner.adder=X(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=X(this,this.constraints_subber),this.live_constraints=new kn,this.wrap_livecon=gi.get(this.live_constraints,!0),this.__static=Rt.__static(),(this.__static.zpp_inner.space=this).callbacks=new lt,this.midstep=!1,this.listeners=new Le,this.wrap_listeners=ki.get(this.listeners),this.wrap_listeners.zpp_inner.adder=X(this,this.listeners_adder),this.wrap_listeners.zpp_inner.subber=X(this,this.listeners_subber),this.callbackset_list=new np,this.mrca1=new On,this.mrca2=new On,this.prelisteners=new bn,this.cbsets=new ee(this)};ie.__name__=["zpp_nape","space","ZPP_Space"],ie.prototype.outer=null,ie.prototype.userData=null,ie.prototype.gravityx=null,ie.prototype.gravityy=null,ie.prototype.wrap_gravity=null,ie.prototype.getgravity=function(){var n,t,e=this.gravityx,i=this.gravityy;null==Vi.poolVec2?n=new Cn:(n=Vi.poolVec2,Vi.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner?(null==Ip.zpp_pool?t=new Ip:(t=Ip.zpp_pool,Ip.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n):(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.x==e&&(null!=(t=n.zpp_inner)._validate&&t._validate(),n.zpp_inner.y==i)||(n.zpp_inner.x=e,n.zpp_inner.y=i,null!=(i=n.zpp_inner)._invalidate&&i._invalidate(i))),n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=X(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=X(this,this.gravity_validate)},ie.prototype.gravity_invalidate=function(n){this.gravityx=n.x,this.gravityy=n.y;for(var t=new me,e=this.bodies.head;null!=e;){var i=e.elt;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1)),e=e.next}for(var p=this.compounds.head;null!=p;)t.add(p.elt),p=p.next;for(;null!=t.head;){for(var l=t.pop_unsafe(),r=l.bodies.head;null!=r;){var o=r.elt;o.world||(o.component.waket=this.stamp+(this.midstep?0:1),3==o.type&&(o.kinematicDelaySleep=!0),o.component.sleeping&&this.really_wake(o,!1)),r=r.next}for(var a=l.compounds.head;null!=a;)t.add(a.elt),a=a.next}},ie.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},ie.prototype.bodies=null,ie.prototype.wrap_bodies=null,ie.prototype.compounds=null,ie.prototype.wrap_compounds=null,ie.prototype.constraints=null,ie.prototype.wrap_constraints=null,ie.prototype.kinematics=null,ie.prototype.bphase=null,ie.prototype.__static=null,ie.prototype.global_lin_drag=null,ie.prototype.global_ang_drag=null,ie.prototype.stamp=null,ie.prototype.midstep=null,ie.prototype.time=null,ie.prototype.sortcontacts=null,ie.prototype.c_arbiters_true=null,ie.prototype.c_arbiters_false=null,ie.prototype.f_arbiters=null,ie.prototype.s_arbiters=null,ie.prototype.wrap_arbiters=null,ie.prototype.live=null,ie.prototype.wrap_live=null,ie.prototype.live_constraints=null,ie.prototype.wrap_livecon=null,ie.prototype.staticsleep=null,ie.prototype.islands=null,ie.prototype.listeners=null,ie.prototype.wrap_listeners=null,ie.prototype.callbacks=null,ie.prototype.callbackset_list=null,ie.prototype.cbsets=null,ie.prototype.clear=function(){for(;null!=this.listeners.head;)this.remListener(this.listeners.pop_unsafe());for(;null!=this.callbackset_list.next;){var n=this.callbackset_list.pop_unsafe();n.arbiters.clear(),n.int1=n.int2=null,n.id=n.di=-1,n.freed=!0,n.next=np.zpp_pool,np.zpp_pool=n}for(;null!=this.c_arbiters_true.head;){var t=this.c_arbiters_true.pop_unsafe();if(!t.cleared){for(var e,i,p=t.b1.arbiters,l=null,r=p.head;null!=r;){if(r.elt==t){null==l?(i=(e=p.head).next,p.head=i,null==p.head&&(p.pushmod=!0)):(i=(e=l.next).next,null==(l.next=i)&&(p.pushmod=!0));var o=e;o.elt=null,o.next=tp.zpp_pool,tp.zpp_pool=o,p.modified=!0,p.length--,p.pushmod=!0;break}r=(l=r).next}for(var a,s,_=t.b2.arbiters,h=null,u=_.head;null!=u;){if(u.elt==t){null==h?(s=(a=_.head).next,_.head=s,null==_.head&&(_.pushmod=!0)):(s=(a=h.next).next,null==(h.next=s)&&(_.pushmod=!0));var x=a;x.elt=null,x.next=tp.zpp_pool,tp.zpp_pool=x,_.modified=!0,_.length--,_.pushmod=!0;break}u=(h=u).next}null!=t.pair&&(t.pair.arb=null,t.pair=null)}for(t.b1=t.b2=null,t.active=!1,t.intchange=!1;null!=t.contacts.next;){var d=t.contacts,y=d.next;d.pop(),y.arbiter=null,y.next=$i.zpp_pool,$i.zpp_pool=y;d=t.innards,y=d.next;d.next=y.next,y._inuse=!1,null==d.next&&(d.pushmod=!0),d.modified=!0,d.length--}t.userdef_dyn_fric=!1,t.userdef_stat_fric=!1,t.userdef_restitution=!1,t.userdef_rfric=!1,t.__ref_edge1=t.__ref_edge2=null,t.next=Hi.zpp_pool,(Hi.zpp_pool=t).pre_dt=-1}for(;null!=this.c_arbiters_false.head;){var z=this.c_arbiters_false.pop_unsafe();if(!z.cleared){for(var c,v,m=z.b1.arbiters,f=null,b=m.head;null!=b;){if(b.elt==z){null==f?(v=(c=m.head).next,m.head=v,null==m.head&&(m.pushmod=!0)):(v=(c=f.next).next,null==(f.next=v)&&(m.pushmod=!0));var g=c;g.elt=null,g.next=tp.zpp_pool,tp.zpp_pool=g,m.modified=!0,m.length--,m.pushmod=!0;break}b=(f=b).next}for(var w,M,C=z.b2.arbiters,k=null,O=C.head;null!=O;){if(O.elt==z){null==k?(M=(w=C.head).next,C.head=M,null==C.head&&(C.pushmod=!0)):(M=(w=k.next).next,null==(k.next=M)&&(C.pushmod=!0));var P=w;P.elt=null,P.next=tp.zpp_pool,tp.zpp_pool=P,C.modified=!0,C.length--,C.pushmod=!0;break}O=(k=O).next}null!=z.pair&&(z.pair.arb=null,z.pair=null)}for(z.b1=z.b2=null,z.active=!1,z.intchange=!1;null!=z.contacts.next;){var S=z.contacts,A=S.next;S.pop(),A.arbiter=null,A.next=$i.zpp_pool,$i.zpp_pool=A;S=z.innards,A=S.next;S.next=A.next,A._inuse=!1,null==S.next&&(S.pushmod=!0),S.modified=!0,S.length--}z.userdef_dyn_fric=!1,z.userdef_stat_fric=!1,z.userdef_restitution=!1,z.userdef_rfric=!1,z.__ref_edge1=z.__ref_edge2=null,z.next=Hi.zpp_pool,(Hi.zpp_pool=z).pre_dt=-1}for(;null!=this.s_arbiters.head;){var j=this.s_arbiters.pop_unsafe();if(!j.cleared){for(var E,I,T=j.b1.arbiters,N=null,L=T.head;null!=L;){if(L.elt==j){null==N?(I=(E=T.head).next,T.head=I,null==T.head&&(T.pushmod=!0)):(I=(E=N.next).next,null==(N.next=I)&&(T.pushmod=!0));var V=E;V.elt=null,V.next=tp.zpp_pool,tp.zpp_pool=V,T.modified=!0,T.length--,T.pushmod=!0;break}L=(N=L).next}for(var D,F,R=j.b2.arbiters,Z=null,B=R.head;null!=B;){if(B.elt==j){null==Z?(F=(D=R.head).next,R.head=F,null==R.head&&(R.pushmod=!0)):(F=(D=Z.next).next,null==(Z.next=F)&&(R.pushmod=!0));var G=D;G.elt=null,G.next=tp.zpp_pool,tp.zpp_pool=G,R.modified=!0,R.length--,R.pushmod=!0;break}B=(Z=B).next}null!=j.pair&&(j.pair.arb=null,j.pair=null)}j.b1=j.b2=null,j.active=!1,j.intchange=!1,j.next=Ji.zpp_pool,Ji.zpp_pool=j}for(;null!=this.f_arbiters.head;){var q=this.f_arbiters.pop_unsafe();if(!q.cleared){for(var U,K,W=q.b1.arbiters,Y=null,J=W.head;null!=J;){if(J.elt==q){null==Y?(K=(U=W.head).next,W.head=K,null==W.head&&(W.pushmod=!0)):(K=(U=Y.next).next,null==(Y.next=K)&&(W.pushmod=!0));var X=U;X.elt=null,X.next=tp.zpp_pool,tp.zpp_pool=X,W.modified=!0,W.length--,W.pushmod=!0;break}J=(Y=J).next}for(var H,$,Q=q.b2.arbiters,nn=null,tn=Q.head;null!=tn;){if(tn.elt==q){null==nn?($=(H=Q.head).next,Q.head=$,null==Q.head&&(Q.pushmod=!0)):($=(H=nn.next).next,null==(nn.next=$)&&(Q.pushmod=!0));var en=H;en.elt=null,en.next=tp.zpp_pool,tp.zpp_pool=en,Q.modified=!0,Q.length--,Q.pushmod=!0;break}tn=(nn=tn).next}null!=q.pair&&(q.pair.arb=null,q.pair=null)}q.b1=q.b2=null,q.active=!1,q.intchange=!1,q.next=Xi.zpp_pool,(Xi.zpp_pool=q).pre_dt=-1}for(this.bphase.clear();null!=this.bodies.head;){var pn=this.bodies.pop_unsafe();if(null!=pn.component){var ln=pn.component.island;if(null!=ln){for(;null!=ln.comps.head;){var rn=ln.comps.pop_unsafe();rn.sleeping=!1,rn.island=null,(rn.parent=rn).rank=0}ln.next=ne.zpp_pool,ne.zpp_pool=ln}}pn.removedFromSpace(),pn.space=null}for(;null!=this.constraints.head;){var on=this.constraints.pop_unsafe();if(null!=on.component){var an=on.component.island;if(null!=an){for(;null!=an.comps.head;){var sn=an.comps.pop_unsafe();sn.sleeping=!1,sn.island=null,(sn.parent=sn).rank=0}an.next=ne.zpp_pool,ne.zpp_pool=an}}on.removedFromSpace(),on.space=null}this.kinematics.clear();for(var _n=new me;null!=this.compounds.head;)_n.add(this.compounds.pop_unsafe());for(;null!=_n.head;){var hn=_n.pop_unsafe();hn.removedFromSpace(),hn.space=null;for(var un=hn.bodies.head;null!=un;){var xn=un.elt;if(null!=xn.component){var dn=xn.component.island;if(null!=dn){for(;null!=dn.comps.head;){var yn=dn.comps.pop_unsafe();yn.sleeping=!1,yn.island=null,(yn.parent=yn).rank=0}dn.next=ne.zpp_pool,ne.zpp_pool=dn}}xn.removedFromSpace(),xn.space=null,un=un.next}for(var zn=hn.constraints.head;null!=zn;){var cn=zn.elt;if(null!=cn.component){var vn=cn.component.island;if(null!=vn){for(;null!=vn.comps.head;){var mn=vn.comps.pop_unsafe();mn.sleeping=!1,mn.island=null,(mn.parent=mn).rank=0}vn.next=ne.zpp_pool,ne.zpp_pool=vn}}cn.removedFromSpace(),cn.space=null,zn=zn.next}for(var fn=hn.compounds.head;null!=fn;)_n.add(fn.elt),fn=fn.next}this.staticsleep.clear(),this.live.clear(),this.live_constraints.clear(),this.stamp=0,this.time=0,this.mrca1.clear(),this.mrca2.clear(),this.prelisteners.clear(),this.cbsets.clear()},ie.prototype.bodies_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(n),this.addBody(n.zpp_inner),!0)},ie.prototype.bodies_subber=function(n){this.remBody(n.zpp_inner)},ie.prototype.compounds_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),this.addCompound(n.zpp_inner),!0)},ie.prototype.compounds_subber=function(n){this.remCompound(n.zpp_inner)},ie.prototype.constraints_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(n),this.addConstraint(n.zpp_inner),!0)},ie.prototype.constraints_subber=function(n){this.remConstraint(n.zpp_inner)},ie.prototype.listeners_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(n),this.addListener(n.zpp_inner),!0)},ie.prototype.listeners_subber=function(n){this.remListener(n.zpp_inner)},ie.prototype.revoke_listener=function(n){},ie.prototype.unrevoke_listener=function(n){},ie.prototype.addListener=function(n){n.space=this,n.addedToSpace()},ie.prototype.remListener=function(n){n.removedFromSpace(),n.space=null},ie.prototype.add_callbackset=function(n){var t=n.int1.cbsets;null==qe.zpp_pool?e=new qe:(e=qe.zpp_pool,qe.zpp_pool=e.next,e.next=null),e.elt=n;var e=e;e.next=t.head,t.head=e,t.modified=!0,t.length++;t=n.int2.cbsets;null==qe.zpp_pool?i=new qe:(i=qe.zpp_pool,qe.zpp_pool=i.next,i.next=null),i.elt=n;var i=i;i.next=t.head,t.head=i,t.modified=!0,t.length++;t=this.callbackset_list;n._inuse=!0,n.next=t.next,t.next=n,t.modified=!0,t.length++},ie.prototype.remove_callbackset=function(n){n.lazydel=!0;for(var t,e,i=n.int1.cbsets,p=null,l=i.head;null!=l;){if(l.elt==n){null==p?(e=(t=i.head).next,i.head=e,null==i.head&&(i.pushmod=!0)):(e=(t=p.next).next,null==(p.next=e)&&(i.pushmod=!0));var r=t;r.elt=null,r.next=qe.zpp_pool,qe.zpp_pool=r,i.modified=!0,i.length--,i.pushmod=!0;break}l=(p=l).next}for(var o,a,s=n.int2.cbsets,_=null,h=s.head;null!=h;){if(h.elt==n){null==_?(a=(o=s.head).next,s.head=a,null==s.head&&(s.pushmod=!0)):(a=(o=_.next).next,null==(_.next=a)&&(s.pushmod=!0));var u=o;u.elt=null,u.next=qe.zpp_pool,qe.zpp_pool=u,s.modified=!0,s.length--,s.pushmod=!0;break}h=(_=h).next}},ie.prototype.transmitType=function(n,t){n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!1)),2==n.type?this.live.remove(n):3==n.type?(this.kinematics.remove(n),this.staticsleep.remove(n)):1==n.type&&this.staticsleep.remove(n),n.type=t,3==n.type&&this.kinematics.add(n),1==n.type&&this.static_validation(n),n.component.sleeping=!0,n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0))},ie.prototype.added_shape=function(n,t){null==t&&(t=!1),t||((t=n.body).world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!1))),this.bphase.insert(n),n.addedToSpace()},ie.prototype.removed_shape=function(n,t){null==t&&(t=!1);var e=n.body;t||e.wake();for(var i=null,p=e.arbiters.head;null!=p;){var l,r=p.elt;if(r.ws1!=n&&r.ws2!=n)p=(i=p).next;else{if(0!=r.present){this.MRCA_chains(r.ws1,r.ws2);for(var o=this.mrca1.head;null!=o;){for(var a=o.elt,s=this.mrca2.head;null!=s;){var _=s.elt,h=a.cbSet,u=_.cbSet;h.validate(),u.validate();for(var x,d=null,y=(h.cbpairs.length<u.cbpairs.length?h:u).cbpairs.head;null!=y;){var z=y.elt;if(z.a==h&&z.b==u||z.a==u&&z.b==h){d=z;break}y=y.next}if(null==d&&(null==Wi.zpp_pool?x=new Wi:(x=Wi.zpp_pool,Wi.zpp_pool=x.next,x.next=null),x.zip_listeners=!0,Ki.setlt(h,u)?(x.a=h,x.b=u):(x.a=u,x.b=h),d=x,h.cbpairs.add(d),u!=h&&u.cbpairs.add(d)),d.zip_listeners&&(d.zip_listeners=!1,d.__validate()),null!=d.listeners.head){var c=Qi.get(a,_);c.remove_arb(r),r.present--;for(var v,m=null,f=(h.cbpairs.length<u.cbpairs.length?h:u).cbpairs.head;null!=f;){var b=f.elt;if(b.a==h&&b.b==u||b.a==u&&b.b==h){m=b;break}f=f.next}null==m&&(null==Wi.zpp_pool?v=new Wi:(v=Wi.zpp_pool,Wi.zpp_pool=v.next,v.next=null),v.zip_listeners=!0,Ki.setlt(h,u)?(v.a=h,v.b=u):(v.a=u,v.b=h),m=v,h.cbpairs.add(m),u!=h&&u.cbpairs.add(m)),m.zip_listeners&&(m.zip_listeners=!1,m.__validate());for(var g=m.listeners.head;null!=g;){var w,M,C,k,O,P=g.elt;1==P.event&&0!=(P.itype&r.type)&&c.empty_arb(P.itype)&&((w=this.push_callback(P)).event=1,M=c.int1,C=c.int2,O=P.options1,k=M.cbTypes,!(!O.nonemptyintersection(k,O.includes)||O.nonemptyintersection(k,O.excludes))&&(O=P.options2,P=C.cbTypes,!!O.nonemptyintersection(P,O.includes)&&!O.nonemptyintersection(P,O.excludes))?(w.int1=M,w.int2=C):(w.int1=C,w.int2=M),w.set=c),g=g.next}null==c.arbiters.head&&this.remove_callbackset(c),s=s.next}else s=s.next}o=o.next}}if(r.b1!=e&&2==r.b1.type&&((l=r.b1).world||(l.component.waket=this.stamp+(this.midstep?0:1),3==l.type&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!1))),r.b2!=e&&2==r.b2.type&&((l=r.b2).world||(l.component.waket=this.stamp+(this.midstep?0:1),3==l.type&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!1))),r.cleared=!0,null==e||r.b2==e)for(var S,A,j=r.b1.arbiters,E=null,I=j.head;null!=I;){if(I.elt==r){null==E?(A=(S=j.head).next,j.head=A,null==j.head&&(j.pushmod=!0)):(A=(S=E.next).next,null==(E.next=A)&&(j.pushmod=!0));var T=S;T.elt=null,T.next=tp.zpp_pool,tp.zpp_pool=T,j.modified=!0,j.length--,j.pushmod=!0;break}I=(E=I).next}if(null==e||r.b1==e)for(var N,L,V=r.b2.arbiters,D=null,F=V.head;null!=F;){if(F.elt==r){null==D?(L=(N=V.head).next,V.head=L,null==V.head&&(V.pushmod=!0)):(L=(N=D.next).next,null==(D.next=L)&&(V.pushmod=!0));var R=N;R.elt=null,R.next=tp.zpp_pool,tp.zpp_pool=R,V.modified=!0,V.length--,V.pushmod=!0;break}F=(D=F).next}null!=r.pair&&(r.pair.arb=null,r.pair=null),r.active=!1,this.f_arbiters.modified=!0,p=e.arbiters.erase(i)}}this.bphase.remove(n),n.removedFromSpace()},ie.prototype.addConstraint=function(n){n.space=this,n.addedToSpace(),n.active&&(n.component.sleeping=!0,this.wake_constraint(n,!0))},ie.prototype.remConstraint=function(n){n.active&&(this.wake_constraint(n,!0),this.live_constraints.remove(n)),n.removedFromSpace(),n.space=null},ie.prototype.addCompound=function(n){n.space=this,n.addedToSpace();for(var t=n.bodies.head;null!=t;)this.addBody(t.elt),t=t.next;for(var e=n.constraints.head;null!=e;)this.addConstraint(e.elt),e=e.next;for(var i=n.compounds.head;null!=i;)this.addCompound(i.elt),i=i.next},ie.prototype.remCompound=function(n){for(var t=n.bodies.head;null!=t;)this.remBody(t.elt),t=t.next;for(var e=n.constraints.head;null!=e;)this.remConstraint(e.elt),e=e.next;for(var i=n.compounds.head;null!=i;)this.remCompound(i.elt),i=i.next;n.removedFromSpace(),n.space=null},ie.prototype.addBody=function(n,t){null==t&&(t=-1),n.space=this,n.addedToSpace(),n.component.sleeping=!0,n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0));for(var e=n.shapes.head;null!=e;){var i=e.elt;this.bphase.insert(i),i.addedToSpace(),e=e.next}1==n.type?this.static_validation(n):2!=n.type&&3!=t&&this.kinematics.add(n)},ie.prototype.remBody=function(n,t){null==t&&(t=-1),1==n.type?(n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.staticsleep.remove(n)):2==n.type?(n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.live.remove(n)):(3!=t&&this.kinematics.remove(n),n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.staticsleep.remove(n));for(var e=n.shapes.head;null!=e;)this.removed_shape(e.elt,!0),e=e.next;n.removedFromSpace(),n.space=null},ie.prototype.shapesUnderPoint=function(n,t,e,i){return this.bphase.shapesUnderPoint(n,t,e,i)},ie.prototype.bodiesUnderPoint=function(n,t,e,i){return this.bphase.bodiesUnderPoint(n,t,e,i)},ie.prototype.shapesInAABB=function(n,t,e,i,p){return this.bphase.shapesInAABB(n.zpp_inner,t,e,i,p)},ie.prototype.bodiesInAABB=function(n,t,e,i,p){return this.bphase.bodiesInAABB(n.zpp_inner,t,e,i,p)},ie.prototype.shapesInCircle=function(n,t,e,i,p){var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,l=n.zpp_inner;return null!=l._validate&&l._validate(),this.bphase.shapesInCircle(r,n.zpp_inner.y,t,e,i,p)},ie.prototype.bodiesInCircle=function(n,t,e,i,p){var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,l=n.zpp_inner;return null!=l._validate&&l._validate(),this.bphase.bodiesInCircle(r,n.zpp_inner.y,t,e,i,p)},ie.prototype.shapesInShape=function(n,t,e,i){return this.bphase.shapesInShape(n,t,e,i)},ie.prototype.bodiesInShape=function(n,t,e,i){return this.bphase.bodiesInShape(n,t,e,i)},ie.prototype.rayCast=function(n,t,e){return this.bphase.rayCast(n.zpp_inner,t,null==e?null:e.zpp_inner)},ie.prototype.rayMultiCast=function(n,t,e,i){return this.bphase.rayMultiCast(n.zpp_inner,t,null==e?null:e.zpp_inner,i)},ie.prototype.convexShapeList=null,ie.prototype.convexCast=function(n,t,e,i){var p;if(null==It.zpp_pool?p=new It:(p=It.zpp_pool,It.zpp_pool=p.next,p.next=null),p.failed=!1,p.s1=p.s2=null,p.arbiter=null,0==n.type){var l=n.circle;if(l.zip_worldCOM&&null!=l.body){if(l.zip_worldCOM=!1,l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var r=l.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=r.lverts.next.next.x,r.localCOMy+=r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0;var o=r.localCOMy=0,a=r.lverts.next,s=a,_=a=a.next;for(a=a.next;null!=a;){var h=a;o+=_.x*(h.y-s.y);var u=h.y*_.x-h.x*_.y;r.localCOMx+=(_.x+h.x)*u,r.localCOMy+=(_.y+h.y)*u,s=_,_=h,a=a.next}var x=a=r.lverts.next;o+=_.x*(x.y-s.y);var d=x.y*_.x-x.x*_.y;r.localCOMx+=(_.x+x.x)*d,r.localCOMy+=(_.y+x.y)*d,s=_;var y=a=a.next;o+=x.x*(y.y-s.y);d=y.y*x.x-y.x*x.y;r.localCOMx+=(x.x+y.x)*d,r.localCOMy+=(x.y+y.y)*d;d=o=1/(3*o);r.localCOMx*=d,r.localCOMy*=d}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}d=l.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),l.worldCOMx=l.body.posx+(l.body.axisy*l.localCOMx-l.body.axisx*l.localCOMy),l.worldCOMy=l.body.posy+(l.localCOMx*l.body.axisx+l.localCOMy*l.body.axisy)}}else{var z=n.polygon;if(z.zip_gaxi&&null!=z.body){z.zip_gaxi=!1,z.validate_laxi();var c=z.body;if(c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var v=z.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var m=z.lverts.next,f=z.gverts.next;null!=f;){var b=f,g=m,m=m.next;b.x=z.body.posx+(z.body.axisy*g.x-z.body.axisx*g.y),b.y=z.body.posy+(g.x*z.body.axisx+g.y*z.body.axisy),f=f.next}}for(var w=z.edges.head,M=C=z.gverts.next,C=C.next;null!=C;){var k=C,O=w.elt,w=w.next;O.gp0=M,O.gp1=k,O.gnormx=z.body.axisy*O.lnormx-z.body.axisx*O.lnormy,O.gnormy=O.lnormx*z.body.axisx+O.lnormy*z.body.axisy,O.gprojection=z.body.posx*O.gnormx+z.body.posy*O.gnormy+O.lprojection,null!=O.wrap_gnorm&&(O.wrap_gnorm.zpp_inner.x=O.gnormx,O.wrap_gnorm.zpp_inner.y=O.gnormy),O.tp0=O.gp0.y*O.gnormx-O.gp0.x*O.gnormy,O.tp1=O.gp1.y*O.gnormx-O.gp1.x*O.gnormy,M=k,C=C.next}var P=w.elt;P.gp0=M,P.gp1=z.gverts.next,P.gnormx=z.body.axisy*P.lnormx-z.body.axisx*P.lnormy,P.gnormy=P.lnormx*z.body.axisx+P.lnormy*z.body.axisy,P.gprojection=z.body.posx*P.gnormx+z.body.posy*P.gnormy+P.lprojection,null!=P.wrap_gnorm&&(P.wrap_gnorm.zpp_inner.x=P.gnormx,P.wrap_gnorm.zpp_inner.y=P.gnormy),P.tp0=P.gp0.y*P.gnormx-P.gp0.x*P.gnormy,P.tp1=P.gp1.y*P.gnormx-P.gp1.x*P.gnormy}}var S=n.body,c=S.posx,v=S.posy;S.sweepTime=0,S.sweep_angvel=S.angvel;P=t-S.sweepTime;0!=P&&(S.sweepTime=t,S.posx+=S.velx*P,S.posy+=S.vely*P,0!=S.angvel&&(A=S.sweep_angvel*P,S.rot+=A,1e-4<A*A?(S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot)):(j=1-(E=A*A)*E/8,E=((P=1-.5*E)*S.axisx+A*S.axisy)*j,S.axisy=(P*S.axisy-A*S.axisx)*j,S.axisx=E)));var A=S.posx,j=S.posy;n.validate_sweepRadius();var E=n.sweepRadius;null==Lt.zpp_pool?en=new Lt:(en=Lt.zpp_pool,Lt.zpp_pool=en.next,en.next=null),en.minx=(c<A?c:A)-E,en.maxx=(A<c?c:A)+E,en.miny=(v<j?v:j)-E,en.maxy=(j<v?v:j)+E;j=this.convexShapeList=this.bphase.shapesInAABB(en,!1,!1,null==e?null:e.zpp_inner,this.convexShapeList),E=en;null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E.wrap_min=E.wrap_max=null,E._invalidate=null,E._validate=null,E.next=Lt.zpp_pool,Lt.zpp_pool=E;var I=0,T=0,I=0,T=0,N=0,L=0,N=0,L=0,V=null,D=t+1;j.zpp_inner.valmod();for(var F=pt.get(j);;){F.zpp_inner.zpp_inner.valmod();var R=F.zpp_inner;R.zpp_inner.valmod(),R.zpp_inner.zip_length&&(R.zpp_inner.zip_length=!1,R.zpp_inner.user_length=R.zpp_inner.inner.length);var Z=R.zpp_inner.user_length;if(F.zpp_critical=!0,!(F.zpp_i<Z||(F.zpp_next=pt.zpp_pool,(pt.zpp_pool=F).zpp_inner=null,!1)))break;F.zpp_critical=!1;var B=F.zpp_inner.at(F.zpp_i++);if(B!=n.outer&&(null!=B.zpp_inner.body?B.zpp_inner.body.outer:null)!=S.outer){if(p.s1=n,p.s2=B.zpp_inner,i){B.zpp_inner.validate_sweepRadius(),(null!=B.zpp_inner.body?B.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=B.zpp_inner.body?B.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=B.zpp_inner.body?B.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,Tt.dynamicSweep(p,t,0,0,!0);var G=(null!=B.zpp_inner.body?B.zpp_inner.body.outer:null).zpp_inner,q=0-G.sweepTime;0!=q&&(G.sweepTime=0,G.posx+=G.velx*q,G.posy+=G.vely*q,0!=G.angvel&&(R=G.sweep_angvel*q,G.rot+=R,1e-4<R*R?(G.axisx=Math.sin(G.rot),G.axisy=Math.cos(G.rot)):(Z=1-(K=R*R)*K/8,K=((q=1-.5*K)*G.axisx+R*G.axisy)*Z,G.axisy=(q*G.axisy-R*G.axisx)*Z,G.axisx=K)));var U=(null!=B.zpp_inner.body?B.zpp_inner.body.outer:null).zpp_inner,G=B.zpp_inner;if(0==G.type)G.worldCOMx=U.posx+(U.axisy*G.localCOMx-U.axisx*G.localCOMy),G.worldCOMy=U.posy+(G.localCOMx*U.axisx+G.localCOMy*U.axisy);else{for(var K=G.polygon,W=K.lverts.next,Y=K.gverts.next;null!=Y;){var J=Y,X=W,W=W.next;J.x=U.posx+(U.axisy*X.x-U.axisx*X.y),J.y=U.posy+(X.x*U.axisx+X.y*U.axisy),Y=Y.next}for(var H=K.edges.head,$=Q=K.gverts.next,Q=Q.next;null!=Q;){var nn=Q,tn=H.elt,H=H.next;tn.gnormx=U.axisy*tn.lnormx-U.axisx*tn.lnormy,tn.gnormy=tn.lnormx*U.axisx+tn.lnormy*U.axisy,tn.gprojection=U.posx*tn.gnormx+U.posy*tn.gnormy+tn.lprojection,tn.tp0=$.y*tn.gnormx-$.x*tn.gnormy,tn.tp1=nn.y*tn.gnormx-nn.x*tn.gnormy,$=nn,Q=Q.next}G=K.gverts.next,K=H.elt;K.gnormx=U.axisy*K.lnormx-U.axisx*K.lnormy,K.gnormy=K.lnormx*U.axisx+K.lnormy*U.axisy,K.gprojection=U.posx*K.gnormx+U.posy*K.gnormy+K.lprojection,K.tp0=$.y*K.gnormx-$.x*K.gnormy,K.tp1=G.y*K.gnormx-G.x*K.gnormy}}else Tt.staticSweep(p,t,0,0);p.toi*=t,0<p.toi&&p.toi<D&&(D=p.toi,I=p.axis.x,T=p.axis.y,N=p.c2.x,L=p.c2.y,V=B)}}j.clear();e=p;e.next=It.zpp_pool,It.zpp_pool=e;var en=0-S.sweepTime;if(0!=en&&(S.sweepTime=0,S.posx+=S.velx*en,S.posy+=S.vely*en,0!=S.angvel&&(E=S.sweep_angvel*en,S.rot+=E,1e-4<E*E?(S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot)):(e=1-(j=E*E)*j/8,j=((en=1-.5*j)*S.axisx+E*S.axisy)*e,S.axisy=(en*S.axisy-E*S.axisx)*e,S.axisx=j))),0==n.type)n.worldCOMx=S.posx+(S.axisy*n.localCOMx-S.axisx*n.localCOMy),n.worldCOMy=S.posy+(n.localCOMx*S.axisx+n.localCOMy*S.axisy);else{for(var pn=n.polygon,ln=pn.lverts.next,rn=pn.gverts.next;null!=rn;){var on=rn,an=ln,ln=ln.next;on.x=S.posx+(S.axisy*an.x-S.axisx*an.y),on.y=S.posy+(an.x*S.axisx+an.y*S.axisy),rn=rn.next}for(var sn=pn.edges.head,_n=hn=pn.gverts.next,hn=hn.next;null!=hn;){var un=hn,xn=sn.elt,sn=sn.next;xn.gnormx=S.axisy*xn.lnormx-S.axisx*xn.lnormy,xn.gnormy=xn.lnormx*S.axisx+xn.lnormy*S.axisy,xn.gprojection=S.posx*xn.gnormx+S.posy*xn.gnormy+xn.lprojection,xn.tp0=_n.y*xn.gnormx-_n.x*xn.gnormy,xn.tp1=un.y*xn.gnormx-un.x*xn.gnormy,_n=un,hn=hn.next}var dn=pn.gverts.next,pn=sn.elt;pn.gnormx=S.axisy*pn.lnormx-S.axisx*pn.lnormy,pn.gnormy=pn.lnormx*S.axisx+pn.lnormy*S.axisy,pn.gprojection=S.posx*pn.gnormx+S.posy*pn.gnormy+pn.lprojection,pn.tp0=_n.y*pn.gnormx-_n.x*pn.gnormy,pn.tp1=dn.y*pn.gnormx-dn.x*pn.gnormy}if(D<=t){var yn,dn=-I,pn=-T;null==Vi.poolVec2?mn=new Cn:(mn=Vi.poolVec2,Vi.poolVec2=mn.zpp_pool,mn.zpp_pool=null),null==mn.zpp_inner?(null==Ip.zpp_pool?yn=new Ip:(yn=Ip.zpp_pool,Ip.zpp_pool=yn.next,yn.next=null),yn.weak=!1,yn._immutable=!1,yn.x=dn,yn.y=pn,mn.zpp_inner=yn,mn.zpp_inner.outer=mn):(null!=(yn=mn.zpp_inner)._validate&&yn._validate(),mn.zpp_inner.x==dn&&(null!=(yn=mn.zpp_inner)._validate&&yn._validate(),mn.zpp_inner.y==pn)||(mn.zpp_inner.x=dn,mn.zpp_inner.y=pn,null!=(pn=mn.zpp_inner)._invalidate&&pn._invalidate(pn))),mn.zpp_inner.weak=!1;var zn,cn,vn,mn=mn;return null==Vi.poolVec2?zn=new Cn:(zn=Vi.poolVec2,Vi.poolVec2=zn.zpp_pool,zn.zpp_pool=null),null==zn.zpp_inner?(null==Ip.zpp_pool?cn=new Ip:(cn=Ip.zpp_pool,Ip.zpp_pool=cn.next,cn.next=null),cn.weak=!1,cn._immutable=!1,cn.x=N,cn.y=L,zn.zpp_inner=cn,zn.zpp_inner.outer=zn):(null!=(cn=zn.zpp_inner)._validate&&cn._validate(),zn.zpp_inner.x==N&&(null!=(vn=zn.zpp_inner)._validate&&vn._validate(),zn.zpp_inner.y==L)||(zn.zpp_inner.x=N,zn.zpp_inner.y=L,null!=(vn=zn.zpp_inner)._invalidate&&vn._invalidate(vn))),zn.zpp_inner.weak=!1,dt.getConvex(mn,zn,D,V)}return null},ie.prototype.prepareCast=function(n){if(0==n.type){var t=n.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var e=t.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,p=e.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;e.localCOMx+=(r.x+o.x)*a,e.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=e.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*_,e.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);_=h.y*s.x-h.x*s.y;e.localCOMx+=(s.x+h.x)*_,e.localCOMy+=(s.y+h.y)*_;_=i=1/(3*i);e.localCOMx*=_,e.localCOMy*=_}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}_=t.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}}else{var u=n.polygon;if(u.zip_gaxi&&null!=u.body){u.zip_gaxi=!1,u.validate_laxi();n=u.body;if(n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)),u.zip_gverts&&null!=u.body){u.zip_gverts=!1,u.validate_lverts();var x=u.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot));for(var d=u.lverts.next,y=u.gverts.next;null!=y;){var z=y,c=d,d=d.next;z.x=u.body.posx+(u.body.axisy*c.x-u.body.axisx*c.y),z.y=u.body.posy+(c.x*u.body.axisx+c.y*u.body.axisy),y=y.next}}for(var v=u.edges.head,m=f=u.gverts.next,f=f.next;null!=f;){var b=f,g=v.elt,v=v.next;g.gp0=m,g.gp1=b,g.gnormx=u.body.axisy*g.lnormx-u.body.axisx*g.lnormy,g.gnormy=g.lnormx*u.body.axisx+g.lnormy*u.body.axisy,g.gprojection=u.body.posx*g.gnormx+u.body.posy*g.gnormy+g.lprojection,null!=g.wrap_gnorm&&(g.wrap_gnorm.zpp_inner.x=g.gnormx,g.wrap_gnorm.zpp_inner.y=g.gnormy),g.tp0=g.gp0.y*g.gnormx-g.gp0.x*g.gnormy,g.tp1=g.gp1.y*g.gnormx-g.gp1.x*g.gnormy,m=b,f=f.next}x=v.elt;x.gp0=m,x.gp1=u.gverts.next,x.gnormx=u.body.axisy*x.lnormx-u.body.axisx*x.lnormy,x.gnormy=x.lnormx*u.body.axisx+x.lnormy*u.body.axisy,x.gprojection=u.body.posx*x.gnormx+u.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}}},ie.prototype.convexMultiCast=function(n,t,e,i,p){var l;if(null==It.zpp_pool?l=new It:(l=It.zpp_pool,It.zpp_pool=l.next,l.next=null),l.failed=!1,l.s1=l.s2=null,l.arbiter=null,0==n.type){var r=n.circle;if(r.zip_worldCOM&&null!=r.body){if(r.zip_worldCOM=!1,r.zip_localCOM){if(r.zip_localCOM=!1,1==r.type){var o=r.polygon;if(null==o.lverts.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y;else if(null==o.lverts.next.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y,o.localCOMx+=o.lverts.next.next.x,o.localCOMy+=o.lverts.next.next.y,o.localCOMx*=.5,o.localCOMy*=.5;else{o.localCOMx=0;var a=o.localCOMy=0,s=o.lverts.next,_=s,h=s=s.next;for(s=s.next;null!=s;){var u=s;a+=h.x*(u.y-_.y);var x=u.y*h.x-u.x*h.y;o.localCOMx+=(h.x+u.x)*x,o.localCOMy+=(h.y+u.y)*x,_=h,h=u,s=s.next}var d=s=o.lverts.next;a+=h.x*(d.y-_.y);var y=d.y*h.x-d.x*h.y;o.localCOMx+=(h.x+d.x)*y,o.localCOMy+=(h.y+d.y)*y,_=h;var z=s=s.next;a+=d.x*(z.y-_.y);y=z.y*d.x-z.x*d.y;o.localCOMx+=(d.x+z.x)*y,o.localCOMy+=(d.y+z.y)*y;y=a=1/(3*a);o.localCOMx*=y,o.localCOMy*=y}}null!=r.wrap_localCOM&&(r.wrap_localCOM.zpp_inner.x=r.localCOMx,r.wrap_localCOM.zpp_inner.y=r.localCOMy)}y=r.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),r.worldCOMx=r.body.posx+(r.body.axisy*r.localCOMx-r.body.axisx*r.localCOMy),r.worldCOMy=r.body.posy+(r.localCOMx*r.body.axisx+r.localCOMy*r.body.axisy)}}else{var c=n.polygon;if(c.zip_gaxi&&null!=c.body){c.zip_gaxi=!1,c.validate_laxi();var v=c.body;if(v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var m=c.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var f=c.lverts.next,b=c.gverts.next;null!=b;){var g=b,w=f,f=f.next;g.x=c.body.posx+(c.body.axisy*w.x-c.body.axisx*w.y),g.y=c.body.posy+(w.x*c.body.axisx+w.y*c.body.axisy),b=b.next}}for(var M=c.edges.head,C=k=c.gverts.next,k=k.next;null!=k;){var O=k,P=M.elt,M=M.next;P.gp0=C,P.gp1=O,P.gnormx=c.body.axisy*P.lnormx-c.body.axisx*P.lnormy,P.gnormy=P.lnormx*c.body.axisx+P.lnormy*c.body.axisy,P.gprojection=c.body.posx*P.gnormx+c.body.posy*P.gnormy+P.lprojection,null!=P.wrap_gnorm&&(P.wrap_gnorm.zpp_inner.x=P.gnormx,P.wrap_gnorm.zpp_inner.y=P.gnormy),P.tp0=P.gp0.y*P.gnormx-P.gp0.x*P.gnormy,P.tp1=P.gp1.y*P.gnormx-P.gp1.x*P.gnormy,C=O,k=k.next}var S=M.elt;S.gp0=C,S.gp1=c.gverts.next,S.gnormx=c.body.axisy*S.lnormx-c.body.axisx*S.lnormy,S.gnormy=S.lnormx*c.body.axisx+S.lnormy*c.body.axisy,S.gprojection=c.body.posx*S.gnormx+c.body.posy*S.gnormy+S.lprojection,null!=S.wrap_gnorm&&(S.wrap_gnorm.zpp_inner.x=S.gnormx,S.wrap_gnorm.zpp_inner.y=S.gnormy),S.tp0=S.gp0.y*S.gnormx-S.gp0.x*S.gnormy,S.tp1=S.gp1.y*S.gnormx-S.gp1.x*S.gnormy}}var A=n.body,v=A.posx,m=A.posy;A.sweepTime=0,A.sweep_angvel=A.angvel;S=t-A.sweepTime;0!=S&&(A.sweepTime=t,A.posx+=A.velx*S,A.posy+=A.vely*S,0!=A.angvel&&(j=A.sweep_angvel*S,A.rot+=j,1e-4<j*j?(A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot)):(E=1-(I=j*j)*I/8,I=((S=1-.5*I)*A.axisx+j*A.axisy)*E,A.axisy=(S*A.axisy-j*A.axisx)*E,A.axisx=I)));var j=A.posx,E=A.posy;n.validate_sweepRadius();var I=n.sweepRadius;null==Lt.zpp_pool?T=new Lt:(T=Lt.zpp_pool,Lt.zpp_pool=T.next,T.next=null),T.minx=(v<j?v:j)-I,T.maxx=(j<v?v:j)+I,T.miny=(m<E?m:E)-I,T.maxy=(E<m?m:E)+I;var e=this.convexShapeList=this.bphase.shapesInAABB(T,!1,!1,null==e?null:e.zpp_inner,this.convexShapeList),T=T;null!=T.outer&&(T.outer.zpp_inner=null,T.outer=null),T.wrap_min=T.wrap_max=null,T._invalidate=null,T._validate=null,T.next=Lt.zpp_pool,Lt.zpp_pool=T;var N=null==p?new Mn:p;e.zpp_inner.valmod();for(var L=pt.get(e);;){L.zpp_inner.zpp_inner.valmod();var V=L.zpp_inner;V.zpp_inner.valmod(),V.zpp_inner.zip_length&&(V.zpp_inner.zip_length=!1,V.zpp_inner.user_length=V.zpp_inner.inner.length);var D=V.zpp_inner.user_length;if(L.zpp_critical=!0,!(L.zpp_i<D||(L.zpp_next=pt.zpp_pool,(pt.zpp_pool=L).zpp_inner=null,!1)))break;L.zpp_critical=!1;var F=L.zpp_inner.at(L.zpp_i++);if(F!=n.outer&&(null!=F.zpp_inner.body?F.zpp_inner.body.outer:null)!=A.outer){if(l.s1=n,l.s2=F.zpp_inner,i){F.zpp_inner.validate_sweepRadius(),(null!=F.zpp_inner.body?F.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=F.zpp_inner.body?F.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=F.zpp_inner.body?F.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,Tt.dynamicSweep(l,t,0,0,!0);var R=(null!=F.zpp_inner.body?F.zpp_inner.body.outer:null).zpp_inner,Z=0-R.sweepTime;0!=Z&&(R.sweepTime=0,R.posx+=R.velx*Z,R.posy+=R.vely*Z,0!=R.angvel&&(V=R.sweep_angvel*Z,R.rot+=V,1e-4<V*V?(R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot)):(D=1-(G=V*V)*G/8,G=((Z=1-.5*G)*R.axisx+V*R.axisy)*D,R.axisy=(Z*R.axisy-V*R.axisx)*D,R.axisx=G)));var B=(null!=F.zpp_inner.body?F.zpp_inner.body.outer:null).zpp_inner,G=F.zpp_inner;if(0==G.type)G.worldCOMx=B.posx+(B.axisy*G.localCOMx-B.axisx*G.localCOMy),G.worldCOMy=B.posy+(G.localCOMx*B.axisx+G.localCOMy*B.axisy);else{for(var q=G.polygon,U=q.lverts.next,K=q.gverts.next;null!=K;){var W=K,Y=U,U=U.next;W.x=B.posx+(B.axisy*Y.x-B.axisx*Y.y),W.y=B.posy+(Y.x*B.axisx+Y.y*B.axisy),K=K.next}for(var J=q.edges.head,X=H=q.gverts.next,H=H.next;null!=H;){var $=H,Q=J.elt,J=J.next;Q.gnormx=B.axisy*Q.lnormx-B.axisx*Q.lnormy,Q.gnormy=Q.lnormx*B.axisx+Q.lnormy*B.axisy,Q.gprojection=B.posx*Q.gnormx+B.posy*Q.gnormy+Q.lprojection,Q.tp0=X.y*Q.gnormx-X.x*Q.gnormy,Q.tp1=$.y*Q.gnormx-$.x*Q.gnormy,X=$,H=H.next}var nn=q.gverts.next,tn=J.elt;tn.gnormx=B.axisy*tn.lnormx-B.axisx*tn.lnormy,tn.gnormy=tn.lnormx*B.axisx+tn.lnormy*B.axisy,tn.gprojection=B.posx*tn.gnormx+B.posy*tn.gnormy+tn.lprojection,tn.tp0=X.y*tn.gnormx-X.x*tn.gnormy,tn.tp1=nn.y*tn.gnormx-nn.x*tn.gnormy}}else Tt.staticSweep(l,t,0,0);if(l.toi*=t,0<l.toi){var en,pn,q=-l.axis.x,nn=-l.axis.y;null==Vi.poolVec2?en=new Cn:(en=Vi.poolVec2,Vi.poolVec2=en.zpp_pool,en.zpp_pool=null),null==en.zpp_inner?(null==Ip.zpp_pool?pn=new Ip:(pn=Ip.zpp_pool,Ip.zpp_pool=pn.next,pn.next=null),pn.weak=!1,pn._immutable=!1,pn.x=q,pn.y=nn,en.zpp_inner=pn,en.zpp_inner.outer=en):(null!=(tn=en.zpp_inner)._validate&&tn._validate(),en.zpp_inner.x==q&&(null!=(an=en.zpp_inner)._validate&&an._validate(),en.zpp_inner.y==nn)||(en.zpp_inner.x=q,en.zpp_inner.y=nn,null!=(on=en.zpp_inner)._invalidate&&on._invalidate(on))),en.zpp_inner.weak=!1;var ln,rn,on,an=en,q=l.c2.x,nn=l.c2.y;null==Vi.poolVec2?ln=new Cn:(ln=Vi.poolVec2,Vi.poolVec2=ln.zpp_pool,ln.zpp_pool=null),null==ln.zpp_inner?(null==Ip.zpp_pool?rn=new Ip:(rn=Ip.zpp_pool,Ip.zpp_pool=rn.next,rn.next=null),rn.weak=!1,rn._immutable=!1,rn.x=q,rn.y=nn,ln.zpp_inner=rn,ln.zpp_inner.outer=ln):(null!=(on=ln.zpp_inner)._validate&&on._validate(),ln.zpp_inner.x==q&&(null!=(on=ln.zpp_inner)._validate&&on._validate(),ln.zpp_inner.y==nn)||(ln.zpp_inner.x=q,ln.zpp_inner.y=nn,null!=(nn=ln.zpp_inner)._invalidate&&nn._invalidate(nn))),ln.zpp_inner.weak=!1;for(var sn=dt.getConvex(an,ln,l.toi,F),_n=null,hn=N.zpp_inner.inner.head;null!=hn&&!(sn.zpp_inner.toiDistance<hn.elt.zpp_inner.toiDistance);)hn=(_n=hn).next;var un,an=N.zpp_inner.inner;null==vi.zpp_pool?un=new vi:(un=vi.zpp_pool,vi.zpp_pool=un.next,un.next=null),un.elt=sn;F=un;null==_n?(F.next=an.head,an.head=F):(F.next=_n.next,_n.next=F),an.pushmod=an.modified=!0,an.length++}}}e.clear();p=l;p.next=It.zpp_pool,It.zpp_pool=p;e=0-A.sweepTime;if(0!=e&&(A.sweepTime=0,A.posx+=A.velx*e,A.posy+=A.vely*e,0!=A.angvel&&(p=A.sweep_angvel*e,A.rot+=p,1e-4<p*p?(A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot)):(xn=1-(wn=p*p)*wn/8,wn=((e=1-.5*wn)*A.axisx+p*A.axisy)*xn,A.axisy=(e*A.axisy-p*A.axisx)*xn,A.axisx=wn))),0==n.type)n.worldCOMx=A.posx+(A.axisy*n.localCOMx-A.axisx*n.localCOMy),n.worldCOMy=A.posy+(n.localCOMx*A.axisx+n.localCOMy*A.axisy);else{for(var xn=n.polygon,dn=xn.lverts.next,yn=xn.gverts.next;null!=yn;){var zn=yn,cn=dn,dn=dn.next;zn.x=A.posx+(A.axisy*cn.x-A.axisx*cn.y),zn.y=A.posy+(cn.x*A.axisx+cn.y*A.axisy),yn=yn.next}for(var vn=xn.edges.head,mn=fn=xn.gverts.next,fn=fn.next;null!=fn;){var bn=fn,gn=vn.elt,vn=vn.next;gn.gnormx=A.axisy*gn.lnormx-A.axisx*gn.lnormy,gn.gnormy=gn.lnormx*A.axisx+gn.lnormy*A.axisy,gn.gprojection=A.posx*gn.gnormx+A.posy*gn.gnormy+gn.lprojection,gn.tp0=mn.y*gn.gnormx-mn.x*gn.gnormy,gn.tp1=bn.y*gn.gnormx-bn.x*gn.gnormy,mn=bn,fn=fn.next}var wn=xn.gverts.next,xn=vn.elt;xn.gnormx=A.axisy*xn.lnormx-A.axisx*xn.lnormy,xn.gnormy=xn.lnormx*A.axisx+xn.lnormy*A.axisy,xn.gprojection=A.posx*xn.gnormx+A.posy*xn.gnormy+xn.lprojection,xn.tp0=mn.y*xn.gnormx-mn.x*xn.gnormy,xn.tp1=wn.y*xn.gnormx-wn.x*xn.gnormy}return N},ie.prototype.push_callback=function(n){var t;return null==lt.zpp_pool?t=new lt:(t=lt.zpp_pool,lt.zpp_pool=t.next,t.next=null),this.callbacks.push(t),t.listener=n,t},ie.prototype.pre_dt=null,ie.prototype.step=function(n,t,e){if(this.time+=n,this.pre_dt=n,this.midstep=!0,this.stamp++,this.validation(),this.bphase.broadphase(this,!0),this.prestep(n),this.sortcontacts){var i=this.c_arbiters_false;if(null!=i.head&&null!=i.head.next){for(var p,l,r,o=i.head,a=null,s=null,_=null,h=null,u=1;;){for(p=0,s=o,a=o=null;null!=s;){for(++p,_=s,l=0,r=u;null!=_&&l<u;)++l,_=_.next;for(;0<l||0<r&&null!=_;)0!=l&&(0==r||null==_||!s.elt.active||!_.elt.active||s.elt.oc1.dist<_.elt.oc1.dist)?(s=(h=s).next,--l):(_=(h=_).next,--r),null!=a?a.next=h:o=h,a=h;s=_}if(a.next=null,u<<=1,!(1<p))break}i.head=o,i.modified=!0,i.pushmod=!0}}this.updateVel(n),this.warmStart(),this.iterateVel(t);for(var x=this.kinematics.head;null!=x;){var d=x.elt;d.pre_posx=d.posx,d.pre_posy=d.posy,d.pre_rot=d.rot,x=x.next}for(var y=this.live.head;null!=y;){var z=y.elt;z.pre_posx=z.posx,z.pre_posy=z.posy,z.pre_rot=z.rot,y=y.next}this.updatePos(n),this.continuous=!0,this.continuousCollisions(n),this.continuous=!1,this.iteratePos(e);for(var c=this.kinematics.head;null!=c;){var v=c.elt,m=!(v.posx==v.pre_posx&&v.posy==v.pre_posy),f=v.pre_rot!=v.rot;if(m){for(var b=v.shapes.head;null!=b;){var g=b.elt;1==g.type&&(g.polygon.invalidate_gverts(),g.polygon.invalidate_gaxi()),g.invalidate_worldCOM(),b=b.next}v.zip_worldCOM=!0}if(f){v.zip_axis=!0;for(var w=v.shapes.head;null!=w;){var M=w.elt;1==M.type&&(M.polygon.invalidate_gverts(),M.polygon.invalidate_gaxi()),M.invalidate_worldCOM(),w=w.next}v.zip_worldCOM=!0}c=c.next}for(var C=this.live.head;null!=C;){var k=C.elt,O=!(k.posx==k.pre_posx&&k.posy==k.pre_posy),P=k.pre_rot!=k.rot;if(O){for(var S=k.shapes.head;null!=S;){var A=S.elt;1==A.type&&(A.polygon.invalidate_gverts(),A.polygon.invalidate_gaxi()),A.invalidate_worldCOM(),S=S.next}k.zip_worldCOM=!0}if(P){k.zip_axis=!0;for(var j=k.shapes.head;null!=j;){var E=j.elt;1==E.type&&(E.polygon.invalidate_gverts(),E.polygon.invalidate_gaxi()),E.invalidate_worldCOM(),j=j.next}k.zip_worldCOM=!0}C=C.next}for(var I=null,T=this.staticsleep.head;null!=T;){var N,L,V,D=T.elt;3!=D.type||0==D.velx&&0==D.vely&&0==D.angvel?D.kinematicDelaySleep?(D.kinematicDelaySleep=!1,T=T.next):(D.component.sleeping=!0,N=this.staticsleep,null==I?(V=(L=N.head).next,N.head=V,null==N.head&&(N.pushmod=!0)):(V=(L=I.next).next,null==(I.next=V)&&(N.pushmod=!0)),(D=L).elt=null,D.next=Ke.zpp_pool,Ke.zpp_pool=D,N.modified=!0,N.length--,N.pushmod=!0,T=V):T=(I=T).next}this.doForests(n),this.sleepArbiters(),this.midstep=!1;for(var F=null,R=this.callbackset_list.next;null!=R;){var Z=R;if(null!=Z.arbiters.head){for(var B=!0,G=Z.arbiters.head;null!=G;){if(!G.elt.sleeping){B=!1;break}G=G.next}for(var q,U=B,K=Z.int1.cbSet,W=Z.int2.cbSet,Y=null,J=(K.cbpairs.length<W.cbpairs.length?K:W).cbpairs.head;null!=J;){var X=J.elt;if(X.a==K&&X.b==W||X.a==W&&X.b==K){Y=X;break}J=J.next}null==Y&&(null==Wi.zpp_pool?q=new Wi:(q=Wi.zpp_pool,Wi.zpp_pool=q.next,q.next=null),q.zip_listeners=!0,Ki.setlt(K,W)?(q.a=K,q.b=W):(q.a=W,q.b=K),Y=q,K.cbpairs.add(Y),W!=K&&W.cbpairs.add(Y)),Y.zip_listeners&&(Y.zip_listeners=!1,Y.__validate());for(var H=Y.listeners.head;null!=H;){var $,Q,nn,tn,en,pn=H.elt;6==pn.event&&(U&&!pn.allowSleepingCallbacks||Z.empty_arb(pn.itype)||(($=this.push_callback(pn)).event=6,Q=Z.int1,nn=Z.int2,en=pn.options1,tn=Q.cbTypes,!(!en.nonemptyintersection(tn,en.includes)||en.nonemptyintersection(tn,en.excludes))&&(en=pn.options2,pn=nn.cbTypes,!!en.nonemptyintersection(pn,en.includes)&&!en.nonemptyintersection(pn,en.excludes))?($.int1=Q,$.int2=nn):($.int1=nn,$.int2=Q),$.set=Z)),H=H.next}R=(F=R).next}else{var ln,rn,on=this.callbackset_list;null==F?(rn=(ln=on.next).next,on.next=rn,null==on.next&&(on.pushmod=!0)):(rn=(ln=F.next).next,null==(F.next=rn)&&(on.pushmod=!0)),ln._inuse=!1,on.modified=!0,on.length--,on.pushmod=!0,R=rn,Z.int1=Z.int2=null,Z.id=Z.di=-1,Z.freed=!0,Z.next=np.zpp_pool,np.zpp_pool=Z}}for(;!this.callbacks.empty();){var an=this.callbacks.pop();0==an.listener.type?an.listener.body.handler(an.wrapper_body()):1==an.listener.type?an.listener.constraint.handler(an.wrapper_con()):2==an.listener.type&&an.listener.interaction.handleri(an.wrapper_int()),an.int1=an.int2=null,an.body=null,an.constraint=null,(an.listener=null)!=an.wrap_arbiters&&(an.wrap_arbiters.zpp_inner.inner=null),an.set=null,an.next=lt.zpp_pool,lt.zpp_pool=an}},ie.prototype.toiEvents=null,ie.prototype.continuousCollisions=function(n){var t=2*Math.PI/n;this.bphase.broadphase(this,!1);for(var e=0;e<1&&null!=this.toiEvents.head;){for(var i=null,p=2,l=!1,r=null,o=null,a=this.toiEvents.head;null!=a;){var s=a.elt,_=s.s1.body,h=s.s2.body;if(_.sweepFrozen&&h.sweepFrozen){if(0==s.toi||!Ep.testCollide_safe(s.s1,s.s2)){a=this.toiEvents.erase(o),s.next=It.zpp_pool,It.zpp_pool=s;continue}s.toi=0}if(s.frozen1!=_.sweepFrozen||s.frozen2!=h.sweepFrozen){if(s.kinematic){a=this.toiEvents.erase(o),s.next=It.zpp_pool,It.zpp_pool=s;continue}if(s.frozen1=_.sweepFrozen,s.frozen2=h.sweepFrozen,s.frozen1&&(h=s.s1,s.s1=s.s2,s.s2=h,s.frozen1=!1,s.frozen2=!0),Tt.staticSweep(s,n,0,jp.collisionSlopCCD),s.toi<0){a=this.toiEvents.erase(o),s.next=It.zpp_pool,It.zpp_pool=s;continue}}0<=s.toi&&(s.toi<p||!l&&s.kinematic)&&(p=(i=s).toi,l=s.kinematic,r=o),a=(o=a).next}if(null==i)break;this.toiEvents.erase(r),e=i.toi;var u=i.s1.body,x=i.s2.body;if(!u.sweepFrozen){var d,y=e*n,z=y-u.sweepTime;0!=z&&(u.sweepTime=y,u.posx+=u.velx*z,u.posy+=u.vely*z,0!=u.angvel&&(d=u.sweep_angvel*z,u.rot+=d,1e-4<d*d?(u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)):(y=1-(c=d*d)*c/8,c=((z=1-.5*c)*u.axisx+d*u.axisy)*y,u.axisy=(z*u.axisy-d*u.axisx)*y,u.axisx=c)));var c=i.s1;if(0==c.type)c.worldCOMx=u.posx+(u.axisy*c.localCOMx-u.axisx*c.localCOMy),c.worldCOMy=u.posy+(c.localCOMx*u.axisx+c.localCOMy*u.axisy);else{for(var v=c.polygon,m=v.lverts.next,f=v.gverts.next;null!=f;){var b=f,g=m,m=m.next;b.x=u.posx+(u.axisy*g.x-u.axisx*g.y),b.y=u.posy+(g.x*u.axisx+g.y*u.axisy),f=f.next}for(var w=v.edges.head,M=C=v.gverts.next,C=C.next;null!=C;){var k=C,O=w.elt,w=w.next;O.gnormx=u.axisy*O.lnormx-u.axisx*O.lnormy,O.gnormy=O.lnormx*u.axisx+O.lnormy*u.axisy,O.gprojection=u.posx*O.gnormx+u.posy*O.gnormy+O.lprojection,O.tp0=M.y*O.gnormx-M.x*O.gnormy,O.tp1=k.y*O.gnormx-k.x*O.gnormy,M=k,C=C.next}var P=v.gverts.next,v=w.elt;v.gnormx=u.axisy*v.lnormx-u.axisx*v.lnormy,v.gnormy=v.lnormx*u.axisx+v.lnormy*u.axisy,v.gprojection=u.posx*v.gnormx+u.posy*v.gnormy+v.lprojection,v.tp0=M.y*v.gnormx-M.x*v.gnormy,v.tp1=P.y*v.gnormx-P.x*v.gnormy}}if(!x.sweepFrozen){P=e*n,v=P-x.sweepTime;0!=v&&(x.sweepTime=P,x.posx+=x.velx*v,x.posy+=x.vely*v,0!=x.angvel&&(S=x.sweep_angvel*v,x.rot+=S,1e-4<S*S?(x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)):(rn=1-(G=S*S)*G/8,G=((v=1-.5*G)*x.axisx+S*x.axisy)*rn,x.axisy=(v*x.axisy-S*x.axisx)*rn,x.axisx=G)));var S=i.s2;if(0==S.type)S.worldCOMx=x.posx+(x.axisy*S.localCOMx-x.axisx*S.localCOMy),S.worldCOMy=x.posy+(S.localCOMx*x.axisx+S.localCOMy*x.axisy);else{for(var A=S.polygon,j=A.lverts.next,E=A.gverts.next;null!=E;){var I=E,T=j,j=j.next;I.x=x.posx+(x.axisy*T.x-x.axisx*T.y),I.y=x.posy+(T.x*x.axisx+T.y*x.axisy),E=E.next}for(var N=A.edges.head,L=V=A.gverts.next,V=V.next;null!=V;){var D=V,F=N.elt,N=N.next;F.gnormx=x.axisy*F.lnormx-x.axisx*F.lnormy,F.gnormy=F.lnormx*x.axisx+F.lnormy*x.axisy,F.gprojection=x.posx*F.gnormx+x.posy*F.gnormy+F.lprojection,F.tp0=L.y*F.gnormx-L.x*F.gnormy,F.tp1=D.y*F.gnormx-D.x*F.gnormy,L=D,V=V.next}var R=A.gverts.next,Z=N.elt;Z.gnormx=x.axisy*Z.lnormx-x.axisx*Z.lnormy,Z.gnormy=Z.lnormx*x.axisx+Z.lnormy*x.axisy,Z.gprojection=x.posx*Z.gnormx+x.posy*Z.gnormy+Z.lprojection,Z.tp0=L.y*Z.gnormx-L.x*Z.gnormy,Z.tp1=R.y*Z.gnormx-R.x*Z.gnormy}}var B,G,q,U,K,W,Y,J,X,H,$,Q,nn,tn,en,pn,ln,rn=this.narrowPhase(i.s1,i.s2,!0,i.arbiter,!0);null==rn?null!=i.arbiter&&null!=i.arbiter.pair&&(i.arbiter.pair.arb=null,i.arbiter.pair=null):this.presteparb(rn,n,!0)||rn.type==Qt.COL&&rn.active&&0!=(1&rn.immState)&&(S=(G=rn.colarb).nx*G.c1.jnAcc-G.ny*G.c1.jtAcc,A=G.ny*G.c1.jnAcc+G.nx*G.c1.jtAcc,R=G.b1.imass,G.b1.velx-=S*R,G.b1.vely-=A*R,G.b1.angvel-=G.b1.iinertia*(A*G.c1.r1x-S*G.c1.r1y),Z=G.b2.imass,G.b2.velx+=S*Z,G.b2.vely+=A*Z,G.b2.angvel+=G.b2.iinertia*(A*G.c1.r2x-S*G.c1.r2y),G.hc2&&(B=G.nx*G.c2.jnAcc-G.ny*G.c2.jtAcc,U=G.ny*G.c2.jnAcc+G.nx*G.c2.jtAcc,nn=G.b1.imass,G.b1.velx-=B*nn,G.b1.vely-=U*nn,G.b1.angvel-=G.b1.iinertia*(U*G.c2.r1x-B*G.c2.r1y),q=G.b2.imass,G.b2.velx+=B*q,G.b2.vely+=U*q,G.b2.angvel+=G.b2.iinertia*(U*G.c2.r2x-B*G.c2.r2y)),G.b2.angvel+=G.jrAcc*G.b2.iinertia,G.b1.angvel-=G.jrAcc*G.b1.iinertia,Z=(R=rn.colarb).k1x+R.b2.velx-R.c1.r2y*R.b2.angvel-(R.b1.velx-R.c1.r1y*R.b1.angvel),S=((A=R.k1y+R.b2.vely+R.c1.r2x*R.b2.angvel-(R.b1.vely+R.c1.r1x*R.b1.angvel))*R.nx-Z*R.ny+R.surfacex)*R.c1.tMass,(nn=R.c1.friction*R.c1.jnAcc)<(U=(q=R.c1.jtAcc)-S)?U=nn:U<-nn&&(U=-nn),S=U-q,R.c1.jtAcc=U,B=-R.ny*S,G=R.nx*S,R.b2.velx+=B*R.b2.imass,R.b2.vely+=G*R.b2.imass,R.b1.velx-=B*R.b1.imass,R.b1.vely-=G*R.b1.imass,R.b2.angvel+=R.rt1b*S*R.b2.iinertia,R.b1.angvel-=R.rt1a*S*R.b1.iinertia,R.hc2?(en=R.k2x+R.b2.velx-R.c2.r2y*R.b2.angvel-(R.b1.velx-R.c2.r1y*R.b1.angvel),S=((W=R.k2y+R.b2.vely+R.c2.r2x*R.b2.angvel-(R.b1.vely+R.c2.r1x*R.b1.angvel))*R.nx-en*R.ny+R.surfacex)*R.c2.tMass,(nn=R.c2.friction*R.c2.jnAcc)<(U=(q=R.c2.jtAcc)-S)?U=nn:U<-nn&&(U=-nn),S=U-q,R.c2.jtAcc=U,B=-R.ny*S,G=R.nx*S,R.b2.velx+=B*R.b2.imass,R.b2.vely+=G*R.b2.imass,R.b1.velx-=B*R.b1.imass,R.b1.vely-=G*R.b1.imass,R.b2.angvel+=R.rt2b*S*R.b2.iinertia,R.b1.angvel-=R.rt2a*S*R.b1.iinertia,Z=R.k1x+R.b2.velx-R.c1.r2y*R.b2.angvel-(R.b1.velx-R.c1.r1y*R.b1.angvel),A=R.k1y+R.b2.vely+R.c1.r2x*R.b2.angvel-(R.b1.vely+R.c1.r1x*R.b1.angvel),en=R.k2x+R.b2.velx-R.c2.r2y*R.b2.angvel-(R.b1.velx-R.c2.r1y*R.b1.angvel),W=R.k2y+R.b2.vely+R.c2.r2x*R.b2.angvel-(R.b1.vely+R.c2.r1x*R.b1.angvel),Y=R.c1.jnAcc,tn=R.c2.jnAcc,ln=Z*R.nx+A*R.ny+R.surfacey+R.c1.bounce-(R.Ka*Y+R.Kb*tn),pn=en*R.nx+W*R.ny+R.surfacey+R.c2.bounce-(R.Kb*Y+R.Kc*tn),en=-(R.kMassa*ln+R.kMassb*pn),W=-(R.kMassb*ln+R.kMassc*pn),0<=en&&0<=W?(ln=en-Y,pn=W-tn,R.c1.jnAcc=en,R.c2.jnAcc=W):0<=(en=-R.c1.nMass*ln)&&0<=R.Kb*en+pn?(ln=en-Y,pn=-tn,R.c1.jnAcc=en,R.c2.jnAcc=0):0<=(W=-R.c2.nMass*pn)&&0<=R.Kb*W+ln?(ln=-Y,pn=W-tn,R.c1.jnAcc=0,R.c2.jnAcc=W):0<=ln&&0<=pn?(ln=-Y,pn=-tn,R.c1.jnAcc=R.c2.jnAcc=0):pn=ln=0,S=ln+pn,B=R.nx*S,G=R.ny*S,R.b2.velx+=B*R.b2.imass,R.b2.vely+=G*R.b2.imass,R.b1.velx-=B*R.b1.imass,R.b1.vely-=G*R.b1.imass,R.b2.angvel+=(R.rn1b*ln+R.rn2b*pn)*R.b2.iinertia,R.b1.angvel-=(R.rn1a*ln+R.rn2a*pn)*R.b1.iinertia):(0!=R.radius&&(S=(R.b2.angvel-R.b1.angvel)*R.rMass,nn=R.rfric*R.c1.jnAcc,q=R.jrAcc,R.jrAcc-=S,R.jrAcc>nn?R.jrAcc=nn:R.jrAcc<-nn&&(R.jrAcc=-nn),S=R.jrAcc-q,R.b2.angvel+=S*R.b2.iinertia,R.b1.angvel-=S*R.b1.iinertia),Z=R.k1x+R.b2.velx-R.c1.r2y*R.b2.angvel-(R.b1.velx-R.c1.r1y*R.b1.angvel),A=R.k1y+R.b2.vely+R.c1.r2x*R.b2.angvel-(R.b1.vely+R.c1.r1x*R.b1.angvel),S=(R.c1.bounce+(R.nx*Z+R.ny*A)+R.surfacey)*R.c1.nMass,(U=(q=R.c1.jnAcc)-S)<0&&(U=0),S=U-q,R.c1.jnAcc=U,B=R.nx*S,G=R.ny*S,R.b2.velx+=B*R.b2.imass,R.b2.vely+=G*R.b2.imass,R.b1.velx-=B*R.b1.imass,R.b1.vely-=G*R.b1.imass,R.b2.angvel+=R.rn1b*S*R.b2.iinertia,R.b1.angvel-=R.rn1a*S*R.b1.iinertia),W=(en=rn.colarb).k1x+en.b2.velx-en.c1.r2y*en.b2.angvel-(en.b1.velx-en.c1.r1y*en.b1.angvel),tn=((Y=en.k1y+en.b2.vely+en.c1.r2x*en.b2.angvel-(en.b1.vely+en.c1.r1x*en.b1.angvel))*en.nx-W*en.ny+en.surfacex)*en.c1.tMass,(ln=en.c1.friction*en.c1.jnAcc)<(nn=(pn=en.c1.jtAcc)-tn)?nn=ln:nn<-ln&&(nn=-ln),tn=nn-pn,en.c1.jtAcc=nn,Z=-en.ny*tn,A=en.nx*tn,en.b2.velx+=Z*en.b2.imass,en.b2.vely+=A*en.b2.imass,en.b1.velx-=Z*en.b1.imass,en.b1.vely-=A*en.b1.imass,en.b2.angvel+=en.rt1b*tn*en.b2.iinertia,en.b1.angvel-=en.rt1a*tn*en.b1.iinertia,en.hc2?(q=en.k2x+en.b2.velx-en.c2.r2y*en.b2.angvel-(en.b1.velx-en.c2.r1y*en.b1.angvel),tn=((U=en.k2y+en.b2.vely+en.c2.r2x*en.b2.angvel-(en.b1.vely+en.c2.r1x*en.b1.angvel))*en.nx-q*en.ny+en.surfacex)*en.c2.tMass,(ln=en.c2.friction*en.c2.jnAcc)<(nn=(pn=en.c2.jtAcc)-tn)?nn=ln:nn<-ln&&(nn=-ln),tn=nn-pn,en.c2.jtAcc=nn,Z=-en.ny*tn,A=en.nx*tn,en.b2.velx+=Z*en.b2.imass,en.b2.vely+=A*en.b2.imass,en.b1.velx-=Z*en.b1.imass,en.b1.vely-=A*en.b1.imass,en.b2.angvel+=en.rt2b*tn*en.b2.iinertia,en.b1.angvel-=en.rt2a*tn*en.b1.iinertia,W=en.k1x+en.b2.velx-en.c1.r2y*en.b2.angvel-(en.b1.velx-en.c1.r1y*en.b1.angvel),Y=en.k1y+en.b2.vely+en.c1.r2x*en.b2.angvel-(en.b1.vely+en.c1.r1x*en.b1.angvel),q=en.k2x+en.b2.velx-en.c2.r2y*en.b2.angvel-(en.b1.velx-en.c2.r1y*en.b1.angvel),U=en.k2y+en.b2.vely+en.c2.r2x*en.b2.angvel-(en.b1.vely+en.c2.r1x*en.b1.angvel),B=en.c1.jnAcc,G=en.c2.jnAcc,S=W*en.nx+Y*en.ny+en.surfacey+en.c1.bounce-(en.Ka*B+en.Kb*G),R=q*en.nx+U*en.ny+en.surfacey+en.c2.bounce-(en.Kb*B+en.Kc*G),q=-(en.kMassa*S+en.kMassb*R),U=-(en.kMassb*S+en.kMassc*R),0<=q&&0<=U?(S=q-B,R=U-G,en.c1.jnAcc=q,en.c2.jnAcc=U):0<=(q=-en.c1.nMass*S)&&0<=en.Kb*q+R?(S=q-B,R=-G,en.c1.jnAcc=q,en.c2.jnAcc=0):0<=(U=-en.c2.nMass*R)&&0<=en.Kb*U+S?(S=-B,R=U-G,en.c1.jnAcc=0,en.c2.jnAcc=U):0<=S&&0<=R?(S=-B,R=-G,en.c1.jnAcc=en.c2.jnAcc=0):R=S=0,tn=S+R,Z=en.nx*tn,A=en.ny*tn,en.b2.velx+=Z*en.b2.imass,en.b2.vely+=A*en.b2.imass,en.b1.velx-=Z*en.b1.imass,en.b1.vely-=A*en.b1.imass,en.b2.angvel+=(en.rn1b*S+en.rn2b*R)*en.b2.iinertia,en.b1.angvel-=(en.rn1a*S+en.rn2a*R)*en.b1.iinertia):(0!=en.radius&&(tn=(en.b2.angvel-en.b1.angvel)*en.rMass,ln=en.rfric*en.c1.jnAcc,pn=en.jrAcc,en.jrAcc-=tn,en.jrAcc>ln?en.jrAcc=ln:en.jrAcc<-ln&&(en.jrAcc=-ln),tn=en.jrAcc-pn,en.b2.angvel+=tn*en.b2.iinertia,en.b1.angvel-=tn*en.b1.iinertia),W=en.k1x+en.b2.velx-en.c1.r2y*en.b2.angvel-(en.b1.velx-en.c1.r1y*en.b1.angvel),Y=en.k1y+en.b2.vely+en.c1.r2x*en.b2.angvel-(en.b1.vely+en.c1.r1x*en.b1.angvel),tn=(en.c1.bounce+(en.nx*W+en.ny*Y)+en.surfacey)*en.c1.nMass,(nn=(pn=en.c1.jnAcc)-tn)<0&&(nn=0),tn=nn-pn,en.c1.jnAcc=nn,Z=en.nx*tn,A=en.ny*tn,en.b2.velx+=Z*en.b2.imass,en.b2.vely+=A*en.b2.imass,en.b1.velx-=Z*en.b1.imass,en.b1.vely-=A*en.b1.imass,en.b2.angvel+=en.rn1b*tn*en.b2.iinertia,en.b1.angvel-=en.rn1a*tn*en.b1.iinertia),W=(ln=rn.colarb).k1x+ln.b2.velx-ln.c1.r2y*ln.b2.angvel-(ln.b1.velx-ln.c1.r1y*ln.b1.angvel),pn=((Y=ln.k1y+ln.b2.vely+ln.c1.r2x*ln.b2.angvel-(ln.b1.vely+ln.c1.r1x*ln.b1.angvel))*ln.nx-W*ln.ny+ln.surfacex)*ln.c1.tMass,(nn=ln.c1.friction*ln.c1.jnAcc)<(A=(Z=ln.c1.jtAcc)-pn)?A=nn:A<-nn&&(A=-nn),pn=A-Z,ln.c1.jtAcc=A,tn=-ln.ny*pn,en=ln.nx*pn,ln.b2.velx+=tn*ln.b2.imass,ln.b2.vely+=en*ln.b2.imass,ln.b1.velx-=tn*ln.b1.imass,ln.b1.vely-=en*ln.b1.imass,ln.b2.angvel+=ln.rt1b*pn*ln.b2.iinertia,ln.b1.angvel-=ln.rt1a*pn*ln.b1.iinertia,ln.hc2?(K=ln.k2x+ln.b2.velx-ln.c2.r2y*ln.b2.angvel-(ln.b1.velx-ln.c2.r1y*ln.b1.angvel),pn=((J=ln.k2y+ln.b2.vely+ln.c2.r2x*ln.b2.angvel-(ln.b1.vely+ln.c2.r1x*ln.b1.angvel))*ln.nx-K*ln.ny+ln.surfacex)*ln.c2.tMass,(nn=ln.c2.friction*ln.c2.jnAcc)<(A=(Z=ln.c2.jtAcc)-pn)?A=nn:A<-nn&&(A=-nn),pn=A-Z,ln.c2.jtAcc=A,tn=-ln.ny*pn,en=ln.nx*pn,ln.b2.velx+=tn*ln.b2.imass,ln.b2.vely+=en*ln.b2.imass,ln.b1.velx-=tn*ln.b1.imass,ln.b1.vely-=en*ln.b1.imass,ln.b2.angvel+=ln.rt2b*pn*ln.b2.iinertia,ln.b1.angvel-=ln.rt2a*pn*ln.b1.iinertia,W=ln.k1x+ln.b2.velx-ln.c1.r2y*ln.b2.angvel-(ln.b1.velx-ln.c1.r1y*ln.b1.angvel),Y=ln.k1y+ln.b2.vely+ln.c1.r2x*ln.b2.angvel-(ln.b1.vely+ln.c1.r1x*ln.b1.angvel),K=ln.k2x+ln.b2.velx-ln.c2.r2y*ln.b2.angvel-(ln.b1.velx-ln.c2.r1y*ln.b1.angvel),J=ln.k2y+ln.b2.vely+ln.c2.r2x*ln.b2.angvel-(ln.b1.vely+ln.c2.r1x*ln.b1.angvel),X=ln.c1.jnAcc,H=ln.c2.jnAcc,$=W*ln.nx+Y*ln.ny+ln.surfacey+ln.c1.bounce-(ln.Ka*X+ln.Kb*H),Q=K*ln.nx+J*ln.ny+ln.surfacey+ln.c2.bounce-(ln.Kb*X+ln.Kc*H),K=-(ln.kMassa*$+ln.kMassb*Q),J=-(ln.kMassb*$+ln.kMassc*Q),0<=K&&0<=J?($=K-X,Q=J-H,ln.c1.jnAcc=K,ln.c2.jnAcc=J):0<=(K=-ln.c1.nMass*$)&&0<=ln.Kb*K+Q?($=K-X,Q=-H,ln.c1.jnAcc=K,ln.c2.jnAcc=0):0<=(J=-ln.c2.nMass*Q)&&0<=ln.Kb*J+$?($=-X,Q=J-H,ln.c1.jnAcc=0,ln.c2.jnAcc=J):0<=$&&0<=Q?($=-X,Q=-H,ln.c1.jnAcc=ln.c2.jnAcc=0):Q=$=0,pn=$+Q,tn=ln.nx*pn,en=ln.ny*pn,ln.b2.velx+=tn*ln.b2.imass,ln.b2.vely+=en*ln.b2.imass,ln.b1.velx-=tn*ln.b1.imass,ln.b1.vely-=en*ln.b1.imass,ln.b2.angvel+=(ln.rn1b*$+ln.rn2b*Q)*ln.b2.iinertia,ln.b1.angvel-=(ln.rn1a*$+ln.rn2a*Q)*ln.b1.iinertia):(0!=ln.radius&&(pn=(ln.b2.angvel-ln.b1.angvel)*ln.rMass,nn=ln.rfric*ln.c1.jnAcc,Z=ln.jrAcc,ln.jrAcc-=pn,ln.jrAcc>nn?ln.jrAcc=nn:ln.jrAcc<-nn&&(ln.jrAcc=-nn),pn=ln.jrAcc-Z,ln.b2.angvel+=pn*ln.b2.iinertia,ln.b1.angvel-=pn*ln.b1.iinertia),W=ln.k1x+ln.b2.velx-ln.c1.r2y*ln.b2.angvel-(ln.b1.velx-ln.c1.r1y*ln.b1.angvel),Y=ln.k1y+ln.b2.vely+ln.c1.r2x*ln.b2.angvel-(ln.b1.vely+ln.c1.r1x*ln.b1.angvel),pn=(ln.c1.bounce+(ln.nx*W+ln.ny*Y)+ln.surfacey)*ln.c1.nMass,(A=(Z=ln.c1.jnAcc)-pn)<0&&(A=0),pn=A-Z,ln.c1.jnAcc=A,tn=ln.nx*pn,en=ln.ny*pn,ln.b2.velx+=tn*ln.b2.imass,ln.b2.vely+=en*ln.b2.imass,ln.b1.velx-=tn*ln.b1.imass,ln.b1.vely-=en*ln.b1.imass,ln.b2.angvel+=ln.rn1b*pn*ln.b2.iinertia,ln.b1.angvel-=ln.rn1a*pn*ln.b1.iinertia),J=(K=rn.colarb).k1x+K.b2.velx-K.c1.r2y*K.b2.angvel-(K.b1.velx-K.c1.r1y*K.b1.angvel),H=((X=K.k1y+K.b2.vely+K.c1.r2x*K.b2.angvel-(K.b1.vely+K.c1.r1x*K.b1.angvel))*K.nx-J*K.ny+K.surfacex)*K.c1.tMass,($=K.c1.friction*K.c1.jnAcc)<(nn=(Q=K.c1.jtAcc)-H)?nn=$:nn<-$&&(nn=-$),H=nn-Q,K.c1.jtAcc=nn,W=-K.ny*H,Y=K.nx*H,K.b2.velx+=W*K.b2.imass,K.b2.vely+=Y*K.b2.imass,K.b1.velx-=W*K.b1.imass,K.b1.vely-=Y*K.b1.imass,K.b2.angvel+=K.rt1b*H*K.b2.iinertia,K.b1.angvel-=K.rt1a*H*K.b1.iinertia,K.hc2?(Z=K.k2x+K.b2.velx-K.c2.r2y*K.b2.angvel-(K.b1.velx-K.c2.r1y*K.b1.angvel),H=((A=K.k2y+K.b2.vely+K.c2.r2x*K.b2.angvel-(K.b1.vely+K.c2.r1x*K.b1.angvel))*K.nx-Z*K.ny+K.surfacex)*K.c2.tMass,($=K.c2.friction*K.c2.jnAcc)<(nn=(Q=K.c2.jtAcc)-H)?nn=$:nn<-$&&(nn=-$),H=nn-Q,K.c2.jtAcc=nn,W=-K.ny*H,Y=K.nx*H,K.b2.velx+=W*K.b2.imass,K.b2.vely+=Y*K.b2.imass,K.b1.velx-=W*K.b1.imass,K.b1.vely-=Y*K.b1.imass,K.b2.angvel+=K.rt2b*H*K.b2.iinertia,K.b1.angvel-=K.rt2a*H*K.b1.iinertia,J=K.k1x+K.b2.velx-K.c1.r2y*K.b2.angvel-(K.b1.velx-K.c1.r1y*K.b1.angvel),X=K.k1y+K.b2.vely+K.c1.r2x*K.b2.angvel-(K.b1.vely+K.c1.r1x*K.b1.angvel),Z=K.k2x+K.b2.velx-K.c2.r2y*K.b2.angvel-(K.b1.velx-K.c2.r1y*K.b1.angvel),A=K.k2y+K.b2.vely+K.c2.r2x*K.b2.angvel-(K.b1.vely+K.c2.r1x*K.b1.angvel),tn=K.c1.jnAcc,en=K.c2.jnAcc,pn=J*K.nx+X*K.ny+K.surfacey+K.c1.bounce-(K.Ka*tn+K.Kb*en),ln=Z*K.nx+A*K.ny+K.surfacey+K.c2.bounce-(K.Kb*tn+K.Kc*en),Z=-(K.kMassa*pn+K.kMassb*ln),A=-(K.kMassb*pn+K.kMassc*ln),0<=Z&&0<=A?(pn=Z-tn,ln=A-en,K.c1.jnAcc=Z,K.c2.jnAcc=A):0<=(Z=-K.c1.nMass*pn)&&0<=K.Kb*Z+ln?(pn=Z-tn,ln=-en,K.c1.jnAcc=Z,K.c2.jnAcc=0):0<=(A=-K.c2.nMass*ln)&&0<=K.Kb*A+pn?(pn=-tn,ln=A-en,K.c1.jnAcc=0,K.c2.jnAcc=A):0<=pn&&0<=ln?(pn=-tn,ln=-en,K.c1.jnAcc=K.c2.jnAcc=0):ln=pn=0,H=pn+ln,W=K.nx*H,Y=K.ny*H,K.b2.velx+=W*K.b2.imass,K.b2.vely+=Y*K.b2.imass,K.b1.velx-=W*K.b1.imass,K.b1.vely-=Y*K.b1.imass,K.b2.angvel+=(K.rn1b*pn+K.rn2b*ln)*K.b2.iinertia,K.b1.angvel-=(K.rn1a*pn+K.rn2a*ln)*K.b1.iinertia):(0!=K.radius&&(H=(K.b2.angvel-K.b1.angvel)*K.rMass,$=K.rfric*K.c1.jnAcc,Q=K.jrAcc,K.jrAcc-=H,K.jrAcc>$?K.jrAcc=$:K.jrAcc<-$&&(K.jrAcc=-$),H=K.jrAcc-Q,K.b2.angvel+=H*K.b2.iinertia,K.b1.angvel-=H*K.b1.iinertia),J=K.k1x+K.b2.velx-K.c1.r2y*K.b2.angvel-(K.b1.velx-K.c1.r1y*K.b1.angvel),X=K.k1y+K.b2.vely+K.c1.r2x*K.b2.angvel-(K.b1.vely+K.c1.r1x*K.b1.angvel),H=(K.c1.bounce+(K.nx*J+K.ny*X)+K.surfacey)*K.c1.nMass,(nn=(Q=K.c1.jnAcc)-H)<0&&(nn=0),H=nn-Q,K.c1.jnAcc=nn,W=K.nx*H,Y=K.ny*H,K.b2.velx+=W*K.b2.imass,K.b2.vely+=Y*K.b2.imass,K.b1.velx-=W*K.b1.imass,K.b1.vely-=Y*K.b1.imass,K.b2.angvel+=K.rn1b*H*K.b2.iinertia,K.b1.angvel-=K.rn1a*H*K.b1.iinertia),u.sweep_angvel=u.angvel%t,x.sweep_angvel=x.angvel%t),null!=rn&&rn.active&&0!=(1&rn.immState)&&rn.type==Qt.COL&&(u.sweepFrozen||3==u.type||(u.sweepFrozen=!0,i.failed?u.angvel=u.sweep_angvel=0:i.slipped?u.angvel=u.sweep_angvel*=jp.angularCCDSlipScale:u.angvel=u.sweep_angvel),x.sweepFrozen||3==x.type||(x.sweepFrozen=!0,i.failed?x.angvel=x.sweep_angvel=0:i.slipped?x.angvel=x.sweep_angvel*=jp.angularCCDSlipScale:x.angvel=x.sweep_angvel));rn=i;rn.next=It.zpp_pool,It.zpp_pool=rn}for(;null!=this.toiEvents.head;){var on=this.toiEvents.pop_unsafe();on.next=It.zpp_pool,It.zpp_pool=on}for(var an=this.kinematics.head;null!=an;){var sn,_n,hn,un=an.elt,xn=n-un.sweepTime;0!=xn&&(un.sweepTime=n,un.posx+=un.velx*xn,un.posy+=un.vely*xn,0!=un.angvel&&(sn=un.sweep_angvel*xn,un.rot+=sn,1e-4<sn*sn?(un.axisx=Math.sin(un.rot),un.axisy=Math.cos(un.rot)):(_n=1-(hn=sn*sn)*hn/8,hn=((xn=1-.5*hn)*un.axisx+sn*un.axisy)*_n,un.axisy=(xn*un.axisy-sn*un.axisx)*_n,un.axisx=hn))),un.sweepTime=0,an=an.next}for(var dn=this.live.head;null!=dn;){var yn,zn,cn,vn,mn=dn.elt;mn.sweepFrozen||0!=(zn=n-mn.sweepTime)&&(mn.sweepTime=n,mn.posx+=mn.velx*zn,mn.posy+=mn.vely*zn,0!=mn.angvel&&(yn=mn.sweep_angvel*zn,mn.rot+=yn,1e-4<yn*yn?(mn.axisx=Math.sin(mn.rot),mn.axisy=Math.cos(mn.rot)):(cn=1-(vn=yn*yn)*vn/8,vn=((zn=1-.5*vn)*mn.axisx+yn*mn.axisy)*cn,mn.axisy=(zn*mn.axisy-yn*mn.axisx)*cn,mn.axisx=vn))),mn.sweepTime=0,dn=dn.next}},ie.prototype.continuousEvent=function(n,t,e,i,p){if(n.body.sweepFrozen&&t.body.sweepFrozen)return i;if(n.body.disableCCD||t.body.disableCCD)return i;if(null==i||null!=i.colarb){for(var l,r,o,a=n.body,s=t.body,_=!1,h=a.constraints.head;null!=h;){var u=h.elt;if(u.ignore&&u.pair_exists(a.id,s.id)){_=!0;break}h=h.next}if(_)l=!1;else{for(var x=n;null!=x&&null==x.group;)x=null!=x.ishape?x.ishape.body:(null!=x.icompound?x.icompound:x.ibody).compound;var d,y=null==x?null:x.group;if(null==y)d=!1;else{for(var z=t;null!=z&&null==z.group;)z=null!=z.ishape?z.ishape.body:(null!=z.icompound?z.icompound:z.ibody).compound;var c=null==z?null:z.group;if(null==c)d=!1;else{for(var v=!1;null!=y&&null!=c;){if(y==c){v=y.ignore;break}y.depth<c.depth?c=c.group:y=y.group}d=v}}l=!d}b=(l?!(!n.sensorEnabled&&!t.sensorEnabled)&&(o=n.filter,r=t.filter,0!=(o.sensorMask&r.sensorGroup)&&0!=(r.sensorMask&o.sensorGroup))?2:!!(!(!n.fluidEnabled&&!t.fluidEnabled)&&(r=n.filter,o=t.filter,0!=(r.fluidMask&o.fluidGroup)&&0!=(o.fluidMask&r.fluidGroup)))&&!(0==a.imass&&0==s.imass&&0==a.iinertia&&0==s.iinertia)?0:(f=n.filter,b=t.filter,0!=(f.collisionMask&b.collisionGroup)&&0!=(b.collisionMask&f.collisionGroup)&&!(0==a.imass&&0==s.imass&&0==a.iinertia&&0==s.iinertia)?1:-1):-1)<=0}else b=!0;if(b)return i;var m,f=n.body,b=t.body;return(e||f.bullet||b.bullet)&&(null==It.zpp_pool?m=new It:(m=It.zpp_pool,It.zpp_pool=m.next,m.next=null),m.failed=!1,m.s1=m.s2=null,m.arbiter=null,b=3==f.type||3==b.type,e&&!b?(2!=n.body.type?(m.s2=n,m.s1=t):(m.s1=n,m.s2=t),m.kinematic=!1,Tt.staticSweep(m,this.pre_dt,0,jp.collisionSlopCCD)):(m.s1=n,m.s2=t,m.kinematic=b,m.s1.body.sweepFrozen||m.s2.body.sweepFrozen?(m.s1.body.sweepFrozen&&(b=m.s1,m.s1=m.s2,m.s2=b,m.frozen1=!1,m.frozen2=!0),Tt.staticSweep(m,this.pre_dt,0,jp.collisionSlopCCD)):Tt.dynamicSweep(m,this.pre_dt,0,jp.collisionSlopCCD)),e&&m.toi<0||m.failed?((e=m).next=It.zpp_pool,It.zpp_pool=e):(this.toiEvents.add(m),m.frozen1=m.s1.body.sweepFrozen,m.frozen2=m.s2.body.sweepFrozen,m.arbiter=null!=i?i.colarb:null)),i},ie.prototype.bodyCbWake=function(n){if(2==n.type&&null!=n.cbSet)if(this.midstep)for(var t=n.cbSet.bodylisteners.head;null!=t;){var e=t.elt;2==e.event?((e=this.push_callback(e)).event=2,e.body=n,t=t.next):t=t.next}else n.component.woken=!0},ie.prototype.bodyCbSleep=function(n){if(2==n.type&&null!=n.cbSet)for(var t=n.cbSet.bodylisteners.head;null!=t;){var e=t.elt;3==e.event?((e=this.push_callback(e)).event=3,e.body=n,t=t.next):t=t.next}},ie.prototype.constraintCbWake=function(n){if(null!=n.cbSet)if(this.midstep)for(var t=n.cbSet.conlisteners.head;null!=t;){var e=t.elt;2==e.event?((e=this.push_callback(e)).event=2,e.constraint=n,t=t.next):t=t.next}else n.component.woken=!0},ie.prototype.constraintCbSleep=function(n){if(null!=n.cbSet)for(var t=n.cbSet.conlisteners.head;null!=t;){var e=t.elt;3==e.event?((e=this.push_callback(e)).event=3,e.constraint=n,t=t.next):t=t.next}},ie.prototype.constraintCbBreak=function(n){if(null!=n.cbSet)for(var t=n.cbSet.conlisteners.head;null!=t;){var e=t.elt;4==e.event?((e=this.push_callback(e)).event=4,e.constraint=n,t=t.next):t=t.next}},ie.prototype.nullListenerType=function(n,t){for(var e=new On,i=n.interactors.head;null!=i;)e.add(i.elt),i=i.next;if(n!=t)for(var p=t.interactors.head;null!=p;)e.add(p.elt),p=p.next;for(;null!=e.head;){var l=e.pop_unsafe();if(null!=l.icompound){for(var r=l.icompound,o=r.bodies.head;null!=o;)e.add(o.elt),o=o.next;for(var a=r.compounds.head;null!=a;)e.add(a.elt),a=a.next}else for(var r=null!=l.ibody?l.ibody:l.ishape.body,s=null!=l.ishape?l.ishape:null,_=r.arbiters.head;null!=_;){var h=_.elt;if(0!=h.present)if(null==s||h.ws1==s||h.ws2==s){this.MRCA_chains(h.ws1,h.ws2);for(var u=this.mrca1.head;null!=u;){var x=u.elt;if(x.cbSet==n||x.cbSet==t){for(var d=this.mrca2.head;null!=d;){var y=d.elt;if(x.cbSet==n&&y.cbSet!=t||x.cbSet==t&&y.cbSet!=n)d=d.next;else{var z=Qi.get(x,y);if(null!=z){for(;null!=z.arbiters.head;)z.arbiters.pop_unsafe().present--;this.remove_callbackset(z)}d=d.next}}u=u.next}else u=u.next}_=_.next}else _=_.next;else _=_.next}}},ie.prototype.nullInteractorType=function(n,t){if(null==t&&(t=n),null!=n.icompound){for(var e=n.icompound,i=e.bodies.head;null!=i;)this.nullInteractorType(i.elt,t),i=i.next;for(var p=e.compounds.head;null!=p;)this.nullInteractorType(p.elt,t),p=p.next}else for(var e=null!=n.ibody?n.ibody:n.ishape.body,l=null!=n.ishape?n.ishape:null,r=e.arbiters.head;null!=r;){var o=r.elt;if(0!=o.present)if(null==l||o.ws1==l||o.ws2==l){this.MRCA_chains(o.ws1,o.ws2);for(var a=this.mrca1.head;null!=a;){for(var s=a.elt,_=this.mrca2.head;null!=_;){var h=_.elt;s==t||h==t?(null!=(h=Qi.get(s,h))&&(o.present--,h.remove_arb(o),null==h.arbiters.head&&this.remove_callbackset(h)),_=_.next):_=_.next}a=a.next}r=r.next}else r=r.next;else r=r.next}},ie.prototype.freshListenerType=function(n,t){for(var e=new On,i=n.interactors.head;null!=i;)e.add(i.elt),i=i.next;if(n!=t)for(var p=t.interactors.head;null!=p;)e.add(p.elt),p=p.next;for(;null!=e.head;){var l=e.pop_unsafe();if(null!=l.icompound){for(var r=l.icompound,o=r.bodies.head;null!=o;)e.add(o.elt),o=o.next;for(var a=r.compounds.head;null!=a;)e.add(a.elt),a=a.next}else for(var r=null!=l.ibody?l.ibody:l.ishape.body,s=null!=l.ishape?l.ishape:null,_=r.arbiters.head;null!=_;){var h=_.elt;if(h.presentable)if(null==s||h.ws1==s||h.ws2==s){this.MRCA_chains(h.ws1,h.ws2);for(var u=this.mrca1.head;null!=u;){var x=u.elt;if(x.cbSet==n||x.cbSet==t){for(var d=this.mrca2.head;null!=d;){var y=d.elt;if(x.cbSet==n&&y.cbSet!=t||x.cbSet==t&&y.cbSet!=n)d=d.next;else{var z,c=Qi.get(x,y);null==c&&(c=np.get(x,y),this.add_callbackset(c)),z=!1;for(var v,m=c.arbiters.head;null!=m;){if(m.elt==h){z=!0;break}m=m.next}!z&&(y=c.arbiters,null==tp.zpp_pool?v=new tp:(v=tp.zpp_pool,tp.zpp_pool=v.next,v.next=null),v.elt=h,(c=v).next=y.head,y.head=c,y.modified=!0,y.length++,!0)&&h.present++,d=d.next}}u=u.next}else u=u.next}_=_.next}else _=_.next;else _=_.next}}},ie.prototype.freshInteractorType=function(n,t){if(null==t&&(t=n),null!=n.icompound){for(var e=n.icompound,i=e.bodies.head;null!=i;)this.freshInteractorType(i.elt,t),i=i.next;for(var p=e.compounds.head;null!=p;)this.freshInteractorType(p.elt,t),p=p.next}else for(var e=null!=n.ibody?n.ibody:n.ishape.body,l=null!=n.ishape?n.ishape:null,r=e.arbiters.head;null!=r;){var o=r.elt;if(o.presentable)if(null==l||o.ws1==l||o.ws2==l){this.MRCA_chains(o.ws1,o.ws2);for(var a=this.mrca1.head;null!=a;){for(var s=a.elt,_=this.mrca2.head;null!=_;){var h=_.elt;if(s==t||h==t){var u=s.cbSet,x=h.cbSet;u.validate(),x.validate();for(var d,y=null,z=(u.cbpairs.length<x.cbpairs.length?u:x).cbpairs.head;null!=z;){var c=z.elt;if(c.a==u&&c.b==x||c.a==x&&c.b==u){y=c;break}z=z.next}if(null==y&&(null==Wi.zpp_pool?d=new Wi:(d=Wi.zpp_pool,Wi.zpp_pool=d.next,d.next=null),d.zip_listeners=!0,Ki.setlt(u,x)?(d.a=u,d.b=x):(d.a=x,d.b=u),y=d,u.cbpairs.add(y),x!=u&&x.cbpairs.add(y)),y.zip_listeners&&(y.zip_listeners=!1,y.__validate()),null!=y.listeners.head){var v,m=Qi.get(s,h);null==m&&(m=np.get(s,h),this.add_callbackset(m)),v=!1;for(var f,b=m.arbiters.head;null!=b;){if(b.elt==o){v=!0;break}b=b.next}!v&&(h=m.arbiters,null==tp.zpp_pool?f=new tp:(f=tp.zpp_pool,tp.zpp_pool=f.next,f.next=null),f.elt=o,(m=f).next=h.head,h.head=m,h.modified=!0,h.length++,!0)&&o.present++}_=_.next}else _=_.next}a=a.next}r=r.next}else r=r.next;else r=r.next}},ie.prototype.wakeCompound=function(n){for(var t=n.bodies.head;null!=t;){var e=t.elt;e.world||(e.component.waket=this.stamp+(this.midstep?0:1),3==e.type&&(e.kinematicDelaySleep=!0),e.component.sleeping&&this.really_wake(e,!1)),t=t.next}for(var i=n.constraints.head;null!=i;)this.wake_constraint(i.elt),i=i.next;for(var p=n.compounds.head;null!=p;)this.wakeCompound(p.elt),p=p.next},ie.prototype.wakeIsland=function(n){for(;null!=n.comps.head;){var t=n.comps.pop_unsafe();if(t.waket=this.stamp+(this.midstep?0:1),t.isBody){var e=t.body;this.live.add(e);for(var i=e.arbiters.head;null!=i;){var p,l,r,o,a,s,_,h,u,x=i.elt;x.sleeping&&(x.sleeping=!1,x.up_stamp+=this.stamp-x.sleep_stamp,x.type==Qt.COL?(a=x.colarb).stat?(p=this.c_arbiters_true,null==rp.zpp_pool?l=new rp:(l=rp.zpp_pool,rp.zpp_pool=l.next,l.next=null),l.elt=a,(r=l).next=p.head,p.head=r,p.modified=!0,p.length++):(_=this.c_arbiters_false,null==rp.zpp_pool?o=new rp:(o=rp.zpp_pool,rp.zpp_pool=o.next,o.next=null),o.elt=a,(a=o).next=_.head,_.head=a,_.modified=!0,_.length++):x.type==Qt.FLUID?(h=this.f_arbiters,_=x.fluidarb,null==pp.zpp_pool?s=new pp:(s=pp.zpp_pool,pp.zpp_pool=s.next,s.next=null),s.elt=_,(_=s).next=h.head,h.head=_,h.modified=!0,h.length++):(h=this.s_arbiters,x=x.sensorarb,null==lp.zpp_pool?u=new lp:(u=lp.zpp_pool,lp.zpp_pool=u.next,u.next=null),u.elt=x,(x=u).next=h.head,h.head=x,h.modified=!0,h.length++)),i=i.next}if(this.bodyCbWake(e),t.sleeping=!1,t.island=null,(t.parent=t).rank=0,1!=e.type)for(var d=e.shapes.head;null!=d;){var y=d.elt;null!=y.node&&this.bphase.sync(y),d=d.next}}else{var z,c=t.constraint,v=this.live_constraints;null==We.zpp_pool?z=new We:(z=We.zpp_pool,We.zpp_pool=z.next,z.next=null),z.elt=c;e=z;e.next=v.head,v.head=e,v.modified=!0,v.length++,this.constraintCbWake(c),t.sleeping=!1,t.island=null,(t.parent=t).rank=0}}n.next=ne.zpp_pool,ne.zpp_pool=n},ie.prototype.non_inlined_wake=function(n,t){null==t&&(t=!1),n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,t))},ie.prototype.really_wake=function(n,t){if(null==t&&(t=!1),null==n.component.island){var e,i,p;n.component.sleeping=!1,3==n.type||1==n.type?(i=this.staticsleep,null==Ke.zpp_pool?e=new Ke:(e=Ke.zpp_pool,Ke.zpp_pool=e.next,e.next=null),e.elt=n,(e=e).next=i.head,i.head=e,i.modified=!0,i.length++):(i=this.live,null==Ke.zpp_pool?p=new Ke:(p=Ke.zpp_pool,Ke.zpp_pool=p.next,p.next=null),p.elt=n,(p=p).next=i.head,i.head=p,i.modified=!0,i.length++);for(var l=n.constraints.head;null!=l;){var r=l.elt;r.space==this&&this.wake_constraint(r),l=l.next}for(var o=n.arbiters.head;null!=o;){var a,s,_,h,u,x,d,y,z,c,v=o.elt;v.sleeping&&(v.sleeping=!1,v.up_stamp+=this.stamp+(this.midstep?0:1)-v.sleep_stamp,v.type==Qt.COL?(u=v.colarb).stat?(a=this.c_arbiters_true,null==rp.zpp_pool?s=new rp:(s=rp.zpp_pool,rp.zpp_pool=s.next,s.next=null),s.elt=u,(_=s).next=a.head,a.head=_,a.modified=!0,a.length++):(d=this.c_arbiters_false,null==rp.zpp_pool?h=new rp:(h=rp.zpp_pool,rp.zpp_pool=h.next,h.next=null),h.elt=u,(u=h).next=d.head,d.head=u,d.modified=!0,d.length++):v.type==Qt.FLUID?(z=this.f_arbiters,d=v.fluidarb,null==pp.zpp_pool?x=new pp:(x=pp.zpp_pool,pp.zpp_pool=x.next,x.next=null),x.elt=d,(d=x).next=z.head,z.head=d,z.modified=!0,z.length++):(c=this.s_arbiters,z=v.sensorarb,null==lp.zpp_pool?y=new lp:(y=lp.zpp_pool,lp.zpp_pool=y.next,y.next=null),y.elt=z,(z=y).next=c.head,c.head=z,c.modified=!0,c.length++)),v.type!=Qt.SENSOR&&!v.cleared&&v.up_stamp>=this.stamp&&0!=(1&v.immState)&&(2==v.b1.type&&v.b1.component.sleeping&&((c=v.b1).world||(c.component.waket=this.stamp+(this.midstep?0:1),3==c.type&&(c.kinematicDelaySleep=!0),c.component.sleeping&&this.really_wake(c,!1))),2==v.b2.type&&v.b2.component.sleeping&&((v=v.b2).world||(v.component.waket=this.stamp+(this.midstep?0:1),3==v.type&&(v.kinematicDelaySleep=!0),v.component.sleeping&&this.really_wake(v,!1)))),o=o.next}if(t||2!=n.type||this.bodyCbWake(n),!t&&!this.bphase.is_sweep&&1!=n.type)for(var m=n.shapes.head;null!=m;){var f=m.elt;null!=f.node&&this.bphase.sync(f),m=m.next}}else this.wakeIsland(n.component.island)},ie.prototype.wake_constraint=function(n,t){var e,i;return null==t&&(t=!1),!!n.active&&(n.component.waket=this.stamp+(this.midstep?0:1),!!n.component.sleeping&&(null==n.component.island?(n.component.sleeping=!1,e=this.live_constraints,null==We.zpp_pool?i=new We:(i=We.zpp_pool,We.zpp_pool=i.next,i.next=null),i.elt=n,(i=i).next=e.head,e.head=i,e.modified=!0,e.length++,n.wake_connected(),t||this.constraintCbWake(n)):this.wakeIsland(n.component.island),!0))},ie.prototype.doForests=function(n){for(var t=this.c_arbiters_false.head;null!=t;){var e,i,p=t.elt;if(!p.cleared&&p.up_stamp==this.stamp&&0!=(1&p.immState)&&2==p.b1.type&&2==p.b2.type){if(p.b1.component==p.b1.component.parent)e=p.b1.component;else{for(var l=p.b1.component,r=null;l!=l.parent;){var o=l.parent;l.parent=r,r=l,l=o}for(;null!=r;){var a=r.parent;r.parent=l,r=a}e=l}if(p.b2.component==p.b2.component.parent)i=p.b2.component;else{for(var s=p.b2.component,_=null;s!=s.parent;){var h=s.parent;s.parent=_,_=s,s=h}for(;null!=_;){var u=_.parent;_.parent=s,_=u}i=s}e!=i&&(e.rank<i.rank?e.parent=i:e.rank>i.rank?i.parent=e:(i.parent=e).rank++)}t=t.next}for(var x=this.f_arbiters.head;null!=x;){var d,y,z=x.elt;if(!z.cleared&&z.up_stamp==this.stamp&&0!=(1&z.immState)&&2==z.b1.type&&2==z.b2.type){if(z.b1.component==z.b1.component.parent)d=z.b1.component;else{for(var c=z.b1.component,v=null;c!=c.parent;){var m=c.parent;c.parent=v,v=c,c=m}for(;null!=v;){var f=v.parent;v.parent=c,v=f}d=c}if(z.b2.component==z.b2.component.parent)y=z.b2.component;else{for(var b=z.b2.component,g=null;b!=b.parent;){var w=b.parent;b.parent=g,g=b,b=w}for(;null!=g;){var M=g.parent;g.parent=b,g=M}y=b}d!=y&&(d.rank<y.rank?d.parent=y:d.rank>y.rank?y.parent=d:(y.parent=d).rank++)}x=x.next}for(var C=this.live_constraints.head;null!=C;)C.elt.forest(),C=C.next;for(;null!=this.live.head;){var k=this.live,O=k.head.elt;k.pop();var P,k=O.component;if(k==k.parent)P=k;else{for(var S=k,A=null;S!=S.parent;){var j=S.parent;S.parent=A,A=S,S=j}for(;null!=A;){var E=A.parent;A.parent=S,A=E}P=S}null==P.island&&(null==ne.zpp_pool?P.island=new ne:(P.island=ne.zpp_pool,ne.zpp_pool=P.island.next,P.island.next=null),P.island.waket=0,N=this.islands,(T=P.island)._inuse=!0,T.next=N.next,N.next=T,N.modified=!0,N.length++,P.island.sleep=!0),k.island=P.island;var I,T=k.island.comps;null==di.zpp_pool?I=new di:(I=di.zpp_pool,di.zpp_pool=I.next,I.next=null),I.elt=k;var N=I;N.next=T.head,T.head=N,T.modified=!0,T.length++;O=O.atRest(n);k.island.sleep=k.island.sleep&&O,k.waket>k.island.waket&&(k.island.waket=k.waket)}for(;null!=this.live_constraints.head;){var L=this.live_constraints,V=L.head.elt;L.pop();var D,F=V.component;if(F==F.parent)D=F;else{for(var R=F,Z=null;R!=R.parent;){var B=R.parent;R.parent=Z,Z=R,R=B}for(;null!=Z;){var G=Z.parent;Z.parent=R,Z=G}D=R}F.island=D.island;var q,L=F.island.comps;null==di.zpp_pool?q=new di:(q=di.zpp_pool,di.zpp_pool=q.next,q.next=null),q.elt=F;V=q;V.next=L.head,L.head=V,L.modified=!0,L.length++,F.waket>F.island.waket&&(F.island.waket=F.waket)}for(;null!=this.islands.next;){var U=this.islands,K=U.next;if(U.pop(),K.sleep)for(var W=K.comps.head;null!=W;){var Y=W.elt;if(Y.isBody){var J=Y.body;J.velx=0,J.vely=0,J.angvel=0,Y.sleeping=!0;for(var X=J.shapes.head;null!=X;)this.bphase.sync(X.elt),X=X.next;this.bodyCbSleep(J)}else this.constraintCbSleep(Y.constraint),Y.sleeping=!0;W=W.next}else{for(;null!=K.comps.head;){var H,$,Q,nn,tn=K.comps,en=tn.head.elt;tn.pop(),en.waket=K.waket,en.isBody?(nn=this.live,$=en.body,null==Ke.zpp_pool?H=new Ke:(H=Ke.zpp_pool,Ke.zpp_pool=H.next,H.next=null),H.elt=$,($=H).next=nn.head,nn.head=$,nn.modified=!0,nn.length++):($=this.live_constraints,nn=en.constraint,null==We.zpp_pool?Q=new We:(Q=We.zpp_pool,We.zpp_pool=Q.next,Q.next=null),Q.elt=nn,(nn=Q).next=$.head,$.head=nn,$.modified=!0,$.length++),en.sleeping=!1,en.island=null,(en.parent=en).rank=0}K.next=ne.zpp_pool,ne.zpp_pool=K}}},ie.prototype.sleepArbiters=function(){var n=null,t=this.c_arbiters_true,e=t.head,i=null!=this.c_arbiters_false;for(i&&null==e&&(i=!1,e=this.c_arbiters_false.head,t=this.c_arbiters_false,n=null);null!=e;){var p,l,r=e.elt;r.b1.component.sleeping&&r.b2.component.sleeping?(r.sleep_stamp=this.stamp,r.sleeping=!0,null==n?(l=(p=t.head).next,t.head=l,null==t.head&&(t.pushmod=!0)):(l=(p=n.next).next,null==(n.next=l)&&(t.pushmod=!0)),(r=p).elt=null,r.next=rp.zpp_pool,rp.zpp_pool=r,t.modified=!0,t.length--,t.pushmod=!0,e=l,i&&null==e&&(i=!1,e=this.c_arbiters_false.head,t=this.c_arbiters_false,n=null)):(e=(n=e).next,i&&null==e&&(i=!1,e=this.c_arbiters_false.head,t=this.c_arbiters_false,n=null))}for(var o=null,a=this.f_arbiters,s=a.head;null!=s;){var _,h,u=s.elt;u.b1.component.sleeping&&u.b2.component.sleeping?(u.sleep_stamp=this.stamp,u.sleeping=!0,null==o?(h=(_=a.head).next,a.head=h,null==a.head&&(a.pushmod=!0)):(h=(_=o.next).next,null==(o.next=h)&&(a.pushmod=!0)),(u=_).elt=null,u.next=pp.zpp_pool,pp.zpp_pool=u,a.modified=!0,a.length--,a.pushmod=!0,s=h):s=(o=s).next}for(var x=null,d=this.s_arbiters,y=d.head;null!=y;){var z,c,v=y.elt;v.b1.component.sleeping&&v.b2.component.sleeping?(v.sleep_stamp=this.stamp,v.sleeping=!0,null==x?(c=(z=d.head).next,d.head=c,null==d.head&&(d.pushmod=!0)):(c=(z=x.next).next,null==(x.next=c)&&(d.pushmod=!0)),(v=z).elt=null,v.next=lp.zpp_pool,lp.zpp_pool=v,d.modified=!0,d.length--,d.pushmod=!0,y=c):y=(x=y).next}},ie.prototype.static_validation=function(n){if(null!=n.shapes.head&&n.zip_aabb){n.zip_aabb=!1,n.aabb.minx=1/0,n.aabb.miny=1/0,n.aabb.maxx=-1/0,n.aabb.maxy=-1/0;for(var t=n.shapes.head;null!=t;){var e=t.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var i=e.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var p=i.polygon;if(null==p.lverts.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;else if(null==p.lverts.next.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y,p.localCOMx+=p.lverts.next.next.x,p.localCOMy+=p.lverts.next.next.y,p.localCOMx*=.5,p.localCOMy*=.5;else{p.localCOMx=0;var l=p.localCOMy=0,r=p.lverts.next,o=r,a=r=r.next;for(r=r.next;null!=r;){var s=r;l+=a.x*(s.y-o.y);var _=s.y*a.x-s.x*a.y;p.localCOMx+=(a.x+s.x)*_,p.localCOMy+=(a.y+s.y)*_,o=a,a=s,r=r.next}var h=r=p.lverts.next;l+=a.x*(h.y-o.y);var u=h.y*a.x-h.x*a.y;p.localCOMx+=(a.x+h.x)*u,p.localCOMy+=(a.y+h.y)*u,o=a;var x=r=r.next;l+=h.x*(x.y-o.y);u=x.y*h.x-x.x*h.y;p.localCOMx+=(h.x+x.x)*u,p.localCOMy+=(h.y+x.y)*u;x=l=1/(3*l);p.localCOMx*=x,p.localCOMy*=x}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}u=i.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}x=i.radius,u=i.radius;i.aabb.minx=i.worldCOMx-x,i.aabb.miny=i.worldCOMy-u,i.aabb.maxx=i.worldCOMx+x,i.aabb.maxy=i.worldCOMy+u}else{var d=e.polygon;if(d.zip_gverts&&null!=d.body){d.zip_gverts=!1,d.validate_lverts();var y=d.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var z=d.lverts.next,c=d.gverts.next;null!=c;){var v=c,m=z,z=z.next;v.x=d.body.posx+(d.body.axisy*m.x-d.body.axisx*m.y),v.y=d.body.posy+(m.x*d.body.axisx+m.y*d.body.axisy),c=c.next}}y=d.gverts.next;d.aabb.minx=y.x,d.aabb.miny=y.y,d.aabb.maxx=y.x,d.aabb.maxy=y.y;for(var f=d.gverts.next.next;null!=f;){var b=f;b.x<d.aabb.minx&&(d.aabb.minx=b.x),b.x>d.aabb.maxx&&(d.aabb.maxx=b.x),b.y<d.aabb.miny&&(d.aabb.miny=b.y),b.y>d.aabb.maxy&&(d.aabb.maxy=b.y),f=f.next}}y=n.aabb,e=e.aabb;e.minx<y.minx&&(y.minx=e.minx),e.maxx>y.maxx&&(y.maxx=e.maxx),e.miny<y.miny&&(y.miny=e.miny),e.maxy>y.maxy&&(y.maxy=e.maxy),t=t.next}}n.validate_mass(),n.validate_inertia();for(var g=n.shapes.head;null!=g;){var w=g.elt;if(1==w.type){var M=w.polygon;M.zip_sanitation&&(M.zip_sanitation=!1,M.splice_collinear_real());var C=w.polygon;if(C.zip_gaxi&&null!=C.body){C.zip_gaxi=!1,C.validate_laxi();w=C.body;if(w.zip_axis&&(w.zip_axis=!1,w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot)),C.zip_gverts&&null!=C.body){C.zip_gverts=!1,C.validate_lverts();var k=C.body;k.zip_axis&&(k.zip_axis=!1,k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot));for(var O=C.lverts.next,P=C.gverts.next;null!=P;){var S=P,A=O,O=O.next;S.x=C.body.posx+(C.body.axisy*A.x-C.body.axisx*A.y),S.y=C.body.posy+(A.x*C.body.axisx+A.y*C.body.axisy),P=P.next}}for(var j=C.edges.head,E=I=C.gverts.next,I=I.next;null!=I;){var T=I,N=j.elt,j=j.next;N.gp0=E,N.gp1=T,N.gnormx=C.body.axisy*N.lnormx-C.body.axisx*N.lnormy,N.gnormy=N.lnormx*C.body.axisx+N.lnormy*C.body.axisy,N.gprojection=C.body.posx*N.gnormx+C.body.posy*N.gnormy+N.lprojection,null!=N.wrap_gnorm&&(N.wrap_gnorm.zpp_inner.x=N.gnormx,N.wrap_gnorm.zpp_inner.y=N.gnormy),N.tp0=N.gp0.y*N.gnormx-N.gp0.x*N.gnormy,N.tp1=N.gp1.y*N.gnormx-N.gp1.x*N.gnormy,E=T,I=I.next}k=j.elt;k.gp0=E,k.gp1=C.gverts.next,k.gnormx=C.body.axisy*k.lnormx-C.body.axisx*k.lnormy,k.gnormy=k.lnormx*C.body.axisx+k.lnormy*C.body.axisy,k.gprojection=C.body.posx*k.gnormx+C.body.posy*k.gnormy+k.lprojection,null!=k.wrap_gnorm&&(k.wrap_gnorm.zpp_inner.x=k.gnormx,k.wrap_gnorm.zpp_inner.y=k.gnormy),k.tp0=k.gp0.y*k.gnormx-k.gp0.x*k.gnormy,k.tp1=k.gp1.y*k.gnormx-k.gp1.x*k.gnormy}}g=g.next}n.sweepFrozen=!0},ie.prototype.validation=function(){var n=this.cbsets;if(!n.cbsets.empty()){for(var t=n.cbsets.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(t.data.validate(),null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}for(var e=this.live.head;null!=e;){var i=e.elt;i.sweepRadius=0;for(var p=i.shapes.head;null!=p;){var l=p.elt;if(1==l.type){var r=l.polygon;r.zip_sanitation&&(r.zip_sanitation=!1,r.splice_collinear_real());var o=l.polygon;if(o.zip_gaxi&&null!=o.body){o.zip_gaxi=!1,o.validate_laxi();r=o.body;if(r.zip_axis&&(r.zip_axis=!1,r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot)),o.zip_gverts&&null!=o.body){o.zip_gverts=!1,o.validate_lverts();var a=o.body;a.zip_axis&&(a.zip_axis=!1,a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot));for(var s=o.lverts.next,_=o.gverts.next;null!=_;){var h=_,u=s,s=s.next;h.x=o.body.posx+(o.body.axisy*u.x-o.body.axisx*u.y),h.y=o.body.posy+(u.x*o.body.axisx+u.y*o.body.axisy),_=_.next}}for(var x=o.edges.head,d=y=o.gverts.next,y=y.next;null!=y;){var z=y,c=x.elt,x=x.next;c.gp0=d,c.gp1=z,c.gnormx=o.body.axisy*c.lnormx-o.body.axisx*c.lnormy,c.gnormy=c.lnormx*o.body.axisx+c.lnormy*o.body.axisy,c.gprojection=o.body.posx*c.gnormx+o.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy,d=z,y=y.next}a=x.elt;a.gp0=d,a.gp1=o.gverts.next,a.gnormx=o.body.axisy*a.lnormx-o.body.axisx*a.lnormy,a.gnormy=a.lnormx*o.body.axisx+a.lnormy*o.body.axisy,a.gprojection=o.body.posx*a.gnormx+o.body.posy*a.gnormy+a.lprojection,null!=a.wrap_gnorm&&(a.wrap_gnorm.zpp_inner.x=a.gnormx,a.wrap_gnorm.zpp_inner.y=a.gnormy),a.tp0=a.gp0.y*a.gnormx-a.gp0.x*a.gnormy,a.tp1=a.gp1.y*a.gnormx-a.gp1.x*a.gnormy}}l.validate_sweepRadius(),l.sweepRadius>i.sweepRadius&&(i.sweepRadius=l.sweepRadius),p=p.next}if(i.validate_mass(),i.validate_inertia(),null!=i.shapes.head){if(i.zip_aabb){i.zip_aabb=!1,i.aabb.minx=1/0,i.aabb.miny=1/0,i.aabb.maxx=-1/0,i.aabb.maxy=-1/0;for(var v=i.shapes.head;null!=v;){var m=v.elt;if(m.zip_aabb&&null!=m.body)if(m.zip_aabb=!1,0==m.type){var f=m.circle;if(f.zip_worldCOM&&null!=f.body){if(f.zip_worldCOM=!1,f.zip_localCOM){if(f.zip_localCOM=!1,1==f.type){var b=f.polygon;if(null==b.lverts.next.next)b.localCOMx=b.lverts.next.x,b.localCOMy=b.lverts.next.y;else if(null==b.lverts.next.next.next)b.localCOMx=b.lverts.next.x,b.localCOMy=b.lverts.next.y,b.localCOMx+=b.lverts.next.next.x,b.localCOMy+=b.lverts.next.next.y,b.localCOMx*=.5,b.localCOMy*=.5;else{b.localCOMx=0;var g=b.localCOMy=0,w=b.lverts.next,M=w,C=w=w.next;for(w=w.next;null!=w;){var k=w;g+=C.x*(k.y-M.y);var O=k.y*C.x-k.x*C.y;b.localCOMx+=(C.x+k.x)*O,b.localCOMy+=(C.y+k.y)*O,M=C,C=k,w=w.next}var P=w=b.lverts.next;g+=C.x*(P.y-M.y);var S=P.y*C.x-P.x*C.y;b.localCOMx+=(C.x+P.x)*S,b.localCOMy+=(C.y+P.y)*S,M=C;var A=w=w.next;g+=P.x*(A.y-M.y);S=A.y*P.x-A.x*P.y;b.localCOMx+=(P.x+A.x)*S,b.localCOMy+=(P.y+A.y)*S;A=g=1/(3*g);b.localCOMx*=A,b.localCOMy*=A}}null!=f.wrap_localCOM&&(f.wrap_localCOM.zpp_inner.x=f.localCOMx,f.wrap_localCOM.zpp_inner.y=f.localCOMy)}S=f.body;S.zip_axis&&(S.zip_axis=!1,S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot)),f.worldCOMx=f.body.posx+(f.body.axisy*f.localCOMx-f.body.axisx*f.localCOMy),f.worldCOMy=f.body.posy+(f.localCOMx*f.body.axisx+f.localCOMy*f.body.axisy)}A=f.radius,S=f.radius;f.aabb.minx=f.worldCOMx-A,f.aabb.miny=f.worldCOMy-S,f.aabb.maxx=f.worldCOMx+A,f.aabb.maxy=f.worldCOMy+S}else{var j=m.polygon;if(j.zip_gverts&&null!=j.body){j.zip_gverts=!1,j.validate_lverts();var E=j.body;E.zip_axis&&(E.zip_axis=!1,E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot));for(var I=j.lverts.next,T=j.gverts.next;null!=T;){var N=T,L=I,I=I.next;N.x=j.body.posx+(j.body.axisy*L.x-j.body.axisx*L.y),N.y=j.body.posy+(L.x*j.body.axisx+L.y*j.body.axisy),T=T.next}}E=j.gverts.next;j.aabb.minx=E.x,j.aabb.miny=E.y,j.aabb.maxx=E.x,j.aabb.maxy=E.y;for(var V=j.gverts.next.next;null!=V;){var D=V;D.x<j.aabb.minx&&(j.aabb.minx=D.x),D.x>j.aabb.maxx&&(j.aabb.maxx=D.x),D.y<j.aabb.miny&&(j.aabb.miny=D.y),D.y>j.aabb.maxy&&(j.aabb.maxy=D.y),V=V.next}}E=i.aabb,m=m.aabb;m.minx<E.minx&&(E.minx=m.minx),m.maxx>E.maxx&&(E.maxx=m.maxx),m.miny<E.miny&&(E.miny=m.miny),m.maxy>E.maxy&&(E.maxy=m.maxy),v=v.next}}i.validate_worldCOM()}if(i.validate_gravMass(),i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),i.component.woken&&null!=i.cbSet)for(var F=i.cbSet.bodylisteners.head;null!=F;){var R=F.elt;2==R.event?((R=this.push_callback(R)).event=2,R.body=i,F=F.next):F=F.next}i.component.woken=!1;for(var Z=i.shapes.head;null!=Z;)this.bphase.sync(Z.elt),Z=Z.next;e=e.next}for(var B=this.kinematics.head;null!=B;){var G=B.elt;G.sweepRadius=0;for(var q=G.shapes.head;null!=q;){var U=q.elt;if(1==U.type){var K=U.polygon;K.zip_sanitation&&(K.zip_sanitation=!1,K.splice_collinear_real());var W=U.polygon;if(W.zip_gaxi&&null!=W.body){W.zip_gaxi=!1,W.validate_laxi();K=W.body;if(K.zip_axis&&(K.zip_axis=!1,K.axisx=Math.sin(K.rot),K.axisy=Math.cos(K.rot)),W.zip_gverts&&null!=W.body){W.zip_gverts=!1,W.validate_lverts();var Y=W.body;Y.zip_axis&&(Y.zip_axis=!1,Y.axisx=Math.sin(Y.rot),Y.axisy=Math.cos(Y.rot));for(var J=W.lverts.next,X=W.gverts.next;null!=X;){var H=X,$=J,J=J.next;H.x=W.body.posx+(W.body.axisy*$.x-W.body.axisx*$.y),H.y=W.body.posy+($.x*W.body.axisx+$.y*W.body.axisy),X=X.next}}for(var Q=W.edges.head,nn=tn=W.gverts.next,tn=tn.next;null!=tn;){var en=tn,pn=Q.elt,Q=Q.next;pn.gp0=nn,pn.gp1=en,pn.gnormx=W.body.axisy*pn.lnormx-W.body.axisx*pn.lnormy,pn.gnormy=pn.lnormx*W.body.axisx+pn.lnormy*W.body.axisy,pn.gprojection=W.body.posx*pn.gnormx+W.body.posy*pn.gnormy+pn.lprojection,null!=pn.wrap_gnorm&&(pn.wrap_gnorm.zpp_inner.x=pn.gnormx,pn.wrap_gnorm.zpp_inner.y=pn.gnormy),pn.tp0=pn.gp0.y*pn.gnormx-pn.gp0.x*pn.gnormy,pn.tp1=pn.gp1.y*pn.gnormx-pn.gp1.x*pn.gnormy,nn=en,tn=tn.next}Y=Q.elt;Y.gp0=nn,Y.gp1=W.gverts.next,Y.gnormx=W.body.axisy*Y.lnormx-W.body.axisx*Y.lnormy,Y.gnormy=Y.lnormx*W.body.axisx+Y.lnormy*W.body.axisy,Y.gprojection=W.body.posx*Y.gnormx+W.body.posy*Y.gnormy+Y.lprojection,null!=Y.wrap_gnorm&&(Y.wrap_gnorm.zpp_inner.x=Y.gnormx,Y.wrap_gnorm.zpp_inner.y=Y.gnormy),Y.tp0=Y.gp0.y*Y.gnormx-Y.gp0.x*Y.gnormy,Y.tp1=Y.gp1.y*Y.gnormx-Y.gp1.x*Y.gnormy}}U.validate_sweepRadius(),U.sweepRadius>G.sweepRadius&&(G.sweepRadius=U.sweepRadius),q=q.next}if(G.validate_mass(),G.validate_inertia(),null!=G.shapes.head){if(G.zip_aabb){G.zip_aabb=!1,G.aabb.minx=1/0,G.aabb.miny=1/0,G.aabb.maxx=-1/0,G.aabb.maxy=-1/0;for(var ln=G.shapes.head;null!=ln;){var rn=ln.elt;if(rn.zip_aabb&&null!=rn.body)if(rn.zip_aabb=!1,0==rn.type){var on=rn.circle;if(on.zip_worldCOM&&null!=on.body){if(on.zip_worldCOM=!1,on.zip_localCOM){if(on.zip_localCOM=!1,1==on.type){var an=on.polygon;if(null==an.lverts.next.next)an.localCOMx=an.lverts.next.x,an.localCOMy=an.lverts.next.y;else if(null==an.lverts.next.next.next)an.localCOMx=an.lverts.next.x,an.localCOMy=an.lverts.next.y,an.localCOMx+=an.lverts.next.next.x,an.localCOMy+=an.lverts.next.next.y,an.localCOMx*=.5,an.localCOMy*=.5;else{an.localCOMx=0;var sn=an.localCOMy=0,_n=an.lverts.next,hn=_n,un=_n=_n.next;for(_n=_n.next;null!=_n;){var xn=_n;sn+=un.x*(xn.y-hn.y);var dn=xn.y*un.x-xn.x*un.y;an.localCOMx+=(un.x+xn.x)*dn,an.localCOMy+=(un.y+xn.y)*dn,hn=un,un=xn,_n=_n.next}var yn=_n=an.lverts.next;sn+=un.x*(yn.y-hn.y);var zn=yn.y*un.x-yn.x*un.y;an.localCOMx+=(un.x+yn.x)*zn,an.localCOMy+=(un.y+yn.y)*zn,hn=un;var cn=_n=_n.next;sn+=yn.x*(cn.y-hn.y);zn=cn.y*yn.x-cn.x*yn.y;an.localCOMx+=(yn.x+cn.x)*zn,an.localCOMy+=(yn.y+cn.y)*zn;cn=sn=1/(3*sn);an.localCOMx*=cn,an.localCOMy*=cn}}null!=on.wrap_localCOM&&(on.wrap_localCOM.zpp_inner.x=on.localCOMx,on.wrap_localCOM.zpp_inner.y=on.localCOMy)}zn=on.body;zn.zip_axis&&(zn.zip_axis=!1,zn.axisx=Math.sin(zn.rot),zn.axisy=Math.cos(zn.rot)),on.worldCOMx=on.body.posx+(on.body.axisy*on.localCOMx-on.body.axisx*on.localCOMy),on.worldCOMy=on.body.posy+(on.localCOMx*on.body.axisx+on.localCOMy*on.body.axisy)}cn=on.radius,zn=on.radius;on.aabb.minx=on.worldCOMx-cn,on.aabb.miny=on.worldCOMy-zn,on.aabb.maxx=on.worldCOMx+cn,on.aabb.maxy=on.worldCOMy+zn}else{var vn=rn.polygon;if(vn.zip_gverts&&null!=vn.body){vn.zip_gverts=!1,vn.validate_lverts();var mn=vn.body;mn.zip_axis&&(mn.zip_axis=!1,mn.axisx=Math.sin(mn.rot),mn.axisy=Math.cos(mn.rot));for(var fn=vn.lverts.next,bn=vn.gverts.next;null!=bn;){var gn=bn,wn=fn,fn=fn.next;gn.x=vn.body.posx+(vn.body.axisy*wn.x-vn.body.axisx*wn.y),gn.y=vn.body.posy+(wn.x*vn.body.axisx+wn.y*vn.body.axisy),bn=bn.next}}mn=vn.gverts.next;vn.aabb.minx=mn.x,vn.aabb.miny=mn.y,vn.aabb.maxx=mn.x,vn.aabb.maxy=mn.y;for(var Mn=vn.gverts.next.next;null!=Mn;){var Cn=Mn;Cn.x<vn.aabb.minx&&(vn.aabb.minx=Cn.x),Cn.x>vn.aabb.maxx&&(vn.aabb.maxx=Cn.x),Cn.y<vn.aabb.miny&&(vn.aabb.miny=Cn.y),Cn.y>vn.aabb.maxy&&(vn.aabb.maxy=Cn.y),Mn=Mn.next}}mn=G.aabb,rn=rn.aabb;rn.minx<mn.minx&&(mn.minx=rn.minx),rn.maxx>mn.maxx&&(mn.maxx=rn.maxx),rn.miny<mn.miny&&(mn.miny=rn.miny),rn.maxy>mn.maxy&&(mn.maxy=rn.maxy),ln=ln.next}}G.validate_worldCOM()}G.validate_gravMass(),G.zip_axis&&(G.zip_axis=!1,G.axisx=Math.sin(G.rot),G.axisy=Math.cos(G.rot));for(var kn=G.shapes.head;null!=kn;)this.bphase.sync(kn.elt),kn=kn.next;B=B.next}for(var On=this.live_constraints.head;null!=On;){var Pn=On.elt;if(Pn.active){if(Pn.component.woken&&null!=Pn.cbSet)for(var Sn=Pn.cbSet.conlisteners.head;null!=Sn;){var An=Sn.elt;2==An.event?((An=this.push_callback(An)).event=2,An.constraint=Pn,Sn=Sn.next):Sn=Sn.next}Pn.component.woken=!1}On=On.next}},ie.prototype.updateVel=function(n){for(var t=1-n*this.global_lin_drag,e=1-n*this.global_ang_drag,i=this.live.head;null!=i;){var p,l,r=i.elt;0!=r.smass&&(l=n*r.imass,r.velx=t*r.velx+(r.forcex+this.gravityx*r.gravMass)*l,r.vely=t*r.vely+(r.forcey+this.gravityy*r.gravMass)*l),0!=r.sinertia&&(l=p=0,p=r.worldCOMx-r.posx,l=r.worldCOMy-r.posy,r.angvel=e*r.angvel+(r.torque+(this.gravityy*p-this.gravityx*l)*r.gravMass)*n*r.iinertia),i=i.next}},ie.prototype.updatePos=function(n){for(var t=2*Math.PI/n,e=this.live.head;null!=e;){var i=e.elt;i.pre_posx=i.posx,i.pre_posy=i.posy,i.pre_rot=i.rot,i.sweepTime=0,i.sweep_angvel=i.angvel%t;var p,l=n-i.sweepTime;if(0!=l&&(i.sweepTime=n,i.posx+=i.velx*l,i.posy+=i.vely*l,0!=i.angvel&&(p=i.sweep_angvel*l,i.rot+=p,1e-4<p*p?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(r=1-(o=p*p)*o/8,o=((l=1-.5*o)*i.axisx+p*i.axisy)*r,i.axisy=(l*i.axisy-p*i.axisx)*r,i.axisx=o))),i.disableCCD)i.sweepFrozen=!0,i.bullet=!1;else{var r=jp.staticCCDLinearThreshold*i.sweepRadius,o=jp.staticCCDAngularThreshold;if((i.velx*i.velx+i.vely*i.vely)*n*n>r*r||i.angvel*i.angvel*n*n>o*o||3==i.type){var a=i.sweep_angvel;a<0&&(a=-a);for(var s=1/a,_=i.shapes.head;null!=_;){var h=_.elt,u=h.aabb,x=u.minx,d=u.miny,y=u.maxx,z=u.maxy,c=a*n*h.sweepCoef*.008333333333333333|0;8<c&&(c=8);var v,m,f=a*n/c,b=n-i.sweepTime;if(0!=b&&(i.sweepTime=n,i.posx+=i.velx*b,i.posy+=i.vely*b,0!=i.angvel&&(v=i.sweep_angvel*b,i.rot+=v,1e-4<v*v?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(m=1-(C=v*v)*C/8,C=((b=1-.5*C)*i.axisx+v*i.axisy)*m,i.axisy=(b*i.axisy-v*i.axisx)*m,i.axisx=C))),0==h.type){var g=h.circle;g.worldCOMx=g.body.posx+(g.body.axisy*g.localCOMx-g.body.axisx*g.localCOMy),g.worldCOMy=g.body.posy+(g.localCOMx*g.body.axisx+g.localCOMy*g.body.axisy),g.aabb.minx=g.worldCOMx-g.radius,g.aabb.miny=g.worldCOMy-g.radius,g.aabb.maxx=g.worldCOMx+g.radius,g.aabb.maxy=g.worldCOMy+g.radius}else{var w=h.polygon,M=w.lverts.next,C=w.gverts.next,g=M;M=M.next,C.x=w.body.posx+(w.body.axisy*g.x-w.body.axisx*g.y),C.y=w.body.posy+(g.x*w.body.axisx+g.y*w.body.axisy),w.aabb.minx=C.x,w.aabb.miny=C.y,w.aabb.maxx=C.x,w.aabb.maxy=C.y;for(var k=w.gverts.next.next;null!=k;){var O=k,P=M,M=M.next;O.x=w.body.posx+(w.body.axisy*P.x-w.body.axisx*P.y),O.y=w.body.posy+(P.x*w.body.axisx+P.y*w.body.axisy),O.x<w.aabb.minx&&(w.aabb.minx=O.x),O.x>w.aabb.maxx&&(w.aabb.maxx=O.x),O.y<w.aabb.miny&&(w.aabb.miny=O.y),O.y>w.aabb.maxy&&(w.aabb.maxy=O.y),k=k.next}}x<u.minx?u.minx=x:x=u.minx,d<u.miny?u.miny=d:d=u.miny,y>u.maxx?u.maxx=y:y=u.maxx,z>u.maxy?u.maxy=z:z=u.maxy;for(var S=1,A=c;S<A;){var j,E=f*S++*s,I=E-i.sweepTime;if(0!=I&&(i.sweepTime=E,i.posx+=i.velx*I,i.posy+=i.vely*I,0!=i.angvel&&(j=i.sweep_angvel*I,i.rot+=j,1e-4<j*j?(i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)):(E=1-(V=j*j)*V/8,V=((I=1-.5*V)*i.axisx+j*i.axisy)*E,i.axisy=(I*i.axisy-j*i.axisx)*E,i.axisx=V))),0==h.type){var T=h.circle;T.worldCOMx=T.body.posx+(T.body.axisy*T.localCOMx-T.body.axisx*T.localCOMy),T.worldCOMy=T.body.posy+(T.localCOMx*T.body.axisx+T.localCOMy*T.body.axisy),T.aabb.minx=T.worldCOMx-T.radius,T.aabb.miny=T.worldCOMy-T.radius,T.aabb.maxx=T.worldCOMx+T.radius,T.aabb.maxy=T.worldCOMy+T.radius}else{var N=h.polygon,L=N.lverts.next,V=N.gverts.next,T=L;L=L.next,V.x=N.body.posx+(N.body.axisy*T.x-N.body.axisx*T.y),V.y=N.body.posy+(T.x*N.body.axisx+T.y*N.body.axisy),N.aabb.minx=V.x,N.aabb.miny=V.y,N.aabb.maxx=V.x,N.aabb.maxy=V.y;for(var D=N.gverts.next.next;null!=D;){var F=D,R=L,L=L.next;F.x=N.body.posx+(N.body.axisy*R.x-N.body.axisx*R.y),F.y=N.body.posy+(R.x*N.body.axisx+R.y*N.body.axisy),F.x<N.aabb.minx&&(N.aabb.minx=F.x),F.x>N.aabb.maxx&&(N.aabb.maxx=F.x),F.y<N.aabb.miny&&(N.aabb.miny=F.y),F.y>N.aabb.maxy&&(N.aabb.maxy=F.y),D=D.next}}x<u.minx?u.minx=x:x=u.minx,d<u.miny?u.miny=d:d=u.miny,y>u.maxx?u.maxx=y:y=u.maxx,z>u.maxy?u.maxy=z:z=u.maxy}this.bphase.sync(h),_=_.next}i.sweepFrozen=!1,2==i.type&&i.bulletEnabled&&(r=jp.bulletCCDLinearThreshold*i.sweepRadius,o=jp.bulletCCDAngularThreshold,((i.velx*i.velx+i.vely*i.vely)*n*n>r*r||i.angvel*i.angvel*n*n>o*o)&&(i.bullet=!0))}else i.sweepFrozen=!0,i.bullet=!1}e=e.next}for(var Z=this.kinematics.head;null!=Z;){var B=Z.elt;B.pre_posx=B.posx,B.pre_posy=B.posy,B.pre_rot=B.rot,B.sweepTime=0,B.sweep_angvel=B.angvel%t;var G,q=n-B.sweepTime;if(0!=q&&(B.sweepTime=n,B.posx+=B.velx*q,B.posy+=B.vely*q,0!=B.angvel&&(G=B.sweep_angvel*q,B.rot+=G,1e-4<G*G?(B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot)):(U=1-(K=G*G)*K/8,K=((q=1-.5*K)*B.axisx+G*B.axisy)*U,B.axisy=(q*B.axisy-G*B.axisx)*U,B.axisx=K))),B.disableCCD)B.sweepFrozen=!0,B.bullet=!1;else{var U=jp.staticCCDLinearThreshold*B.sweepRadius,K=jp.staticCCDAngularThreshold;if((B.velx*B.velx+B.vely*B.vely)*n*n>U*U||B.angvel*B.angvel*n*n>K*K||3==B.type){var W=B.sweep_angvel;W<0&&(W=-W);for(var Y=1/W,J=B.shapes.head;null!=J;){var X=J.elt,H=X.aabb,$=H.minx,Q=H.miny,nn=H.maxx,tn=H.maxy,en=W*n*X.sweepCoef*.008333333333333333|0;8<en&&(en=8);var pn,ln,rn=W*n/en,on=n-B.sweepTime;if(0!=on&&(B.sweepTime=n,B.posx+=B.velx*on,B.posy+=B.vely*on,0!=B.angvel&&(pn=B.sweep_angvel*on,B.rot+=pn,1e-4<pn*pn?(B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot)):(ln=1-(hn=pn*pn)*hn/8,hn=((on=1-.5*hn)*B.axisx+pn*B.axisy)*ln,B.axisy=(on*B.axisy-pn*B.axisx)*ln,B.axisx=hn))),0==X.type){var an=X.circle;an.worldCOMx=an.body.posx+(an.body.axisy*an.localCOMx-an.body.axisx*an.localCOMy),an.worldCOMy=an.body.posy+(an.localCOMx*an.body.axisx+an.localCOMy*an.body.axisy),an.aabb.minx=an.worldCOMx-an.radius,an.aabb.miny=an.worldCOMy-an.radius,an.aabb.maxx=an.worldCOMx+an.radius,an.aabb.maxy=an.worldCOMy+an.radius}else{var sn=X.polygon,_n=sn.lverts.next,hn=sn.gverts.next,an=_n;_n=_n.next,hn.x=sn.body.posx+(sn.body.axisy*an.x-sn.body.axisx*an.y),hn.y=sn.body.posy+(an.x*sn.body.axisx+an.y*sn.body.axisy),sn.aabb.minx=hn.x,sn.aabb.miny=hn.y,sn.aabb.maxx=hn.x,sn.aabb.maxy=hn.y;for(var un=sn.gverts.next.next;null!=un;){var xn=un,dn=_n,_n=_n.next;xn.x=sn.body.posx+(sn.body.axisy*dn.x-sn.body.axisx*dn.y),xn.y=sn.body.posy+(dn.x*sn.body.axisx+dn.y*sn.body.axisy),xn.x<sn.aabb.minx&&(sn.aabb.minx=xn.x),xn.x>sn.aabb.maxx&&(sn.aabb.maxx=xn.x),xn.y<sn.aabb.miny&&(sn.aabb.miny=xn.y),xn.y>sn.aabb.maxy&&(sn.aabb.maxy=xn.y),un=un.next}}$<H.minx?H.minx=$:$=H.minx,Q<H.miny?H.miny=Q:Q=H.miny,nn>H.maxx?H.maxx=nn:nn=H.maxx,tn>H.maxy?H.maxy=tn:tn=H.maxy;for(var yn=1,zn=en;yn<zn;){var cn,vn=rn*yn++*Y,mn=vn-B.sweepTime;if(0!=mn&&(B.sweepTime=vn,B.posx+=B.velx*mn,B.posy+=B.vely*mn,0!=B.angvel&&(cn=B.sweep_angvel*mn,B.rot+=cn,1e-4<cn*cn?(B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot)):(vn=1-(wn=cn*cn)*wn/8,wn=((mn=1-.5*wn)*B.axisx+cn*B.axisy)*vn,B.axisy=(mn*B.axisy-cn*B.axisx)*vn,B.axisx=wn))),0==X.type){var fn=X.circle;fn.worldCOMx=fn.body.posx+(fn.body.axisy*fn.localCOMx-fn.body.axisx*fn.localCOMy),fn.worldCOMy=fn.body.posy+(fn.localCOMx*fn.body.axisx+fn.localCOMy*fn.body.axisy),fn.aabb.minx=fn.worldCOMx-fn.radius,fn.aabb.miny=fn.worldCOMy-fn.radius,fn.aabb.maxx=fn.worldCOMx+fn.radius,fn.aabb.maxy=fn.worldCOMy+fn.radius}else{var bn=X.polygon,gn=bn.lverts.next,wn=bn.gverts.next,fn=gn;gn=gn.next,wn.x=bn.body.posx+(bn.body.axisy*fn.x-bn.body.axisx*fn.y),wn.y=bn.body.posy+(fn.x*bn.body.axisx+fn.y*bn.body.axisy),bn.aabb.minx=wn.x,bn.aabb.miny=wn.y,bn.aabb.maxx=wn.x,bn.aabb.maxy=wn.y;for(var Mn=bn.gverts.next.next;null!=Mn;){var Cn=Mn,kn=gn,gn=gn.next;Cn.x=bn.body.posx+(bn.body.axisy*kn.x-bn.body.axisx*kn.y),Cn.y=bn.body.posy+(kn.x*bn.body.axisx+kn.y*bn.body.axisy),Cn.x<bn.aabb.minx&&(bn.aabb.minx=Cn.x),Cn.x>bn.aabb.maxx&&(bn.aabb.maxx=Cn.x),Cn.y<bn.aabb.miny&&(bn.aabb.miny=Cn.y),Cn.y>bn.aabb.maxy&&(bn.aabb.maxy=Cn.y),Mn=Mn.next}}$<H.minx?H.minx=$:$=H.minx,Q<H.miny?H.miny=Q:Q=H.miny,nn>H.maxx?H.maxx=nn:nn=H.maxx,tn>H.maxy?H.maxy=tn:tn=H.maxy}this.bphase.sync(X),J=J.next}B.sweepFrozen=!1,2==B.type&&B.bulletEnabled&&(U=jp.bulletCCDLinearThreshold*B.sweepRadius,K=jp.bulletCCDAngularThreshold,((B.velx*B.velx+B.vely*B.vely)*n*n>U*U||B.angvel*B.angvel*n*n>K*K)&&(B.bullet=!0))}else B.sweepFrozen=!0,B.bullet=!1}Z=Z.next}},ie.prototype.continuous=null,ie.prototype.presteparb=function(n,t,e){null==e&&(e=!1);if(!n.cleared&&n.b1.component.sleeping&&n.b2.component.sleeping)return n.sleep_stamp=this.stamp,n.sleeping=!0;if(!n.cleared||0!=n.present||n.intchange){var e=!e&&n.up_stamp==this.stamp-1&&!n.cleared&&!n.intchange,i=n.fresh&&!n.cleared&&!n.intchange;if(e&&(n.endGenerated=this.stamp),i||e||n.cleared||n.intchange){for(var p=n.ws1,l=n.ws2,r=this.mrca1;null!=r.head;){var o=r.head;r.head=o.next,o.elt=null,o.next=ip.zpp_pool,ip.zpp_pool=o,null==r.head&&(r.pushmod=!0),r.modified=!0,r.length--}r.pushmod=!0;for(var a,s,_,h,u,x=this.mrca2;null!=x.head;){var d=x.head;x.head=d.next,d.elt=null,d.next=ip.zpp_pool,ip.zpp_pool=d,null==x.head&&(x.pushmod=!0),x.modified=!0,x.length--}x.pushmod=!0,null!=p.cbSet&&(s=this.mrca1,null==ip.zpp_pool?a=new ip:(a=ip.zpp_pool,ip.zpp_pool=a.next,a.next=null),a.elt=p,(a=a).next=s.head,s.head=a,s.modified=!0,s.length++),null!=p.body.cbSet&&(h=this.mrca1,s=p.body,null==ip.zpp_pool?_=new ip:(_=ip.zpp_pool,ip.zpp_pool=_.next,_.next=null),_.elt=s,(_=_).next=h.head,h.head=_,h.modified=!0,h.length++),null!=l.cbSet&&(h=this.mrca2,null==ip.zpp_pool?u=new ip:(u=ip.zpp_pool,ip.zpp_pool=u.next,u.next=null),u.elt=l,(u=u).next=h.head,h.head=u,h.modified=!0,h.length++),null!=l.body.cbSet&&(ft=this.mrca2,mt=l.body,null==ip.zpp_pool?Kn=new ip:(Kn=ip.zpp_pool,ip.zpp_pool=Kn.next,Kn.next=null),Kn.elt=mt,(mt=Kn).next=ft.head,ft.head=mt,ft.modified=!0,ft.length++);for(var y,z,c,v,m=p.body.compound,f=l.body.compound;m!=f;)(null==m?0:m.depth)<(null==f?0:f.depth)?(null!=f.cbSet&&(v=this.mrca2,null==ip.zpp_pool?y=new ip:(y=ip.zpp_pool,ip.zpp_pool=y.next,y.next=null),y.elt=f,(z=y).next=v.head,v.head=z,v.modified=!0,v.length++),f=f.compound):(null!=m.cbSet&&(z=this.mrca1,null==ip.zpp_pool?c=new ip:(c=ip.zpp_pool,ip.zpp_pool=c.next,c.next=null),c.elt=m,(v=c).next=z.head,z.head=v,z.modified=!0,z.length++),m=m.compound);for(var b=this.mrca1.head;null!=b;){for(var g=b.elt,w=this.mrca2.head;null!=w;){for(var M,C=w.elt,k=g.cbSet,O=C.cbSet,P=null,S=(k.cbpairs.length<O.cbpairs.length?k:O).cbpairs.head;null!=S;){var A=S.elt;if(A.a==k&&A.b==O||A.a==O&&A.b==k){P=A;break}S=S.next}if(null==P&&(null==Wi.zpp_pool?M=new Wi:(M=Wi.zpp_pool,Wi.zpp_pool=M.next,M.next=null),M.zip_listeners=!0,Ki.setlt(k,O)?(M.a=k,M.b=O):(M.a=O,M.b=k),P=M,k.cbpairs.add(P),O!=k&&O.cbpairs.add(P)),P.zip_listeners&&(P.zip_listeners=!1,P.__validate()),null!=P.listeners.head){var j=Qi.get(g,C);if(i||n.intchange){null==j&&(j=np.get(g,C),this.add_callbackset(j));for(var E,I=null,T=(k.cbpairs.length<O.cbpairs.length?k:O).cbpairs.head;null!=T;){var N=T.elt;if(N.a==k&&N.b==O||N.a==O&&N.b==k){I=N;break}T=T.next}null==I&&(null==Wi.zpp_pool?E=new Wi:(E=Wi.zpp_pool,Wi.zpp_pool=E.next,E.next=null),E.zip_listeners=!0,Ki.setlt(k,O)?(E.a=k,E.b=O):(E.a=O,E.b=k),I=E,k.cbpairs.add(I),O!=k&&O.cbpairs.add(I)),I.zip_listeners&&(I.zip_listeners=!1,I.__validate());for(var L,V=I.listeners.head;null!=V;){var D,F,R,Z,B,G=V.elt;0==G.event&&0!=(G.itype&n.type)&&j.empty_arb(G.itype)&&((D=this.push_callback(G)).event=0,F=j.int1,R=j.int2,B=G.options1,Z=F.cbTypes,!(!B.nonemptyintersection(Z,B.includes)||B.nonemptyintersection(Z,B.excludes))&&(B=G.options2,G=R.cbTypes,!!B.nonemptyintersection(G,B.includes)&&!B.nonemptyintersection(G,B.excludes))?(D.int1=F,D.int2=R):(D.int1=R,D.int2=F),D.set=j),V=V.next}L=!1;for(var q,U,K=j.arbiters.head;null!=K;){if(K.elt==n){L=!0;break}K=K.next}!L&&(q=j.arbiters,null==tp.zpp_pool?U=new tp:(U=tp.zpp_pool,tp.zpp_pool=U.next,U.next=null),U.elt=n,(C=U).next=q.head,q.head=C,q.modified=!0,q.length++,!0)&&n.present++}else{n.present--,j.remove_arb(n);for(var W,Y=null,J=(k.cbpairs.length<O.cbpairs.length?k:O).cbpairs.head;null!=J;){var X=J.elt;if(X.a==k&&X.b==O||X.a==O&&X.b==k){Y=X;break}J=J.next}null==Y&&(null==Wi.zpp_pool?W=new Wi:(W=Wi.zpp_pool,Wi.zpp_pool=W.next,W.next=null),W.zip_listeners=!0,Ki.setlt(k,O)?(W.a=k,W.b=O):(W.a=O,W.b=k),Y=W,k.cbpairs.add(Y),O!=k&&O.cbpairs.add(Y)),Y.zip_listeners&&(Y.zip_listeners=!1,Y.__validate());for(var H=Y.listeners.head;null!=H;){var $,Q,nn,tn,en,pn=H.elt;1==pn.event&&0!=(pn.itype&n.type)&&j.empty_arb(pn.itype)&&(($=this.push_callback(pn)).event=1,Q=j.int1,nn=j.int2,en=pn.options1,tn=Q.cbTypes,!(!en.nonemptyintersection(tn,en.includes)||en.nonemptyintersection(tn,en.excludes))&&(en=pn.options2,pn=nn.cbTypes,!!en.nonemptyintersection(pn,en.includes)&&!en.nonemptyintersection(pn,en.excludes))?($.int1=Q,$.int2=nn):($.int1=nn,$.int2=Q),$.set=j),H=H.next}null==j.arbiters.head&&this.remove_callbackset(j)}w=w.next}else w=w.next}b=b.next}}n.fresh=!1,n.intchange=!1}if(n.cleared||n.up_stamp+(n.type==Qt.COL?jp.arbiterExpirationDelay:0)<this.stamp){if(n.type==Qt.SENSOR){var ln=n.sensorarb;if(!ln.cleared){for(var rn,on,an=ln.b1.arbiters,sn=null,_n=an.head;null!=_n;){if(_n.elt==ln){null==sn?(on=(rn=an.head).next,an.head=on,null==an.head&&(an.pushmod=!0)):(on=(rn=sn.next).next,null==(sn.next=on)&&(an.pushmod=!0));var hn=rn;hn.elt=null,hn.next=tp.zpp_pool,tp.zpp_pool=hn,an.modified=!0,an.length--,an.pushmod=!0;break}_n=(sn=_n).next}for(var un,xn,dn=ln.b2.arbiters,yn=null,zn=dn.head;null!=zn;){if(zn.elt==ln){null==yn?(xn=(un=dn.head).next,dn.head=xn,null==dn.head&&(dn.pushmod=!0)):(xn=(un=yn.next).next,null==(yn.next=xn)&&(dn.pushmod=!0));var cn=un;cn.elt=null,cn.next=tp.zpp_pool,tp.zpp_pool=cn,dn.modified=!0,dn.length--,dn.pushmod=!0;break}zn=(yn=zn).next}null!=ln.pair&&(ln.pair.arb=null,ln.pair=null)}ln.b1=ln.b2=null,ln.active=!1,ln.intchange=!1,ln.next=Ji.zpp_pool,Ji.zpp_pool=ln}else if(n.type==Qt.FLUID){var vn=n.fluidarb;if(!vn.cleared){for(var mn,fn,bn=vn.b1.arbiters,gn=null,wn=bn.head;null!=wn;){if(wn.elt==vn){null==gn?(fn=(mn=bn.head).next,bn.head=fn,null==bn.head&&(bn.pushmod=!0)):(fn=(mn=gn.next).next,null==(gn.next=fn)&&(bn.pushmod=!0));var Mn=mn;Mn.elt=null,Mn.next=tp.zpp_pool,tp.zpp_pool=Mn,bn.modified=!0,bn.length--,bn.pushmod=!0;break}wn=(gn=wn).next}for(var Cn,kn,On=vn.b2.arbiters,Pn=null,Sn=On.head;null!=Sn;){if(Sn.elt==vn){null==Pn?(kn=(Cn=On.head).next,On.head=kn,null==On.head&&(On.pushmod=!0)):(kn=(Cn=Pn.next).next,null==(Pn.next=kn)&&(On.pushmod=!0));var An=Cn;An.elt=null,An.next=tp.zpp_pool,tp.zpp_pool=An,On.modified=!0,On.length--,On.pushmod=!0;break}Sn=(Pn=Sn).next}null!=vn.pair&&(vn.pair.arb=null,vn.pair=null)}vn.b1=vn.b2=null,vn.active=!1,vn.intchange=!1,vn.next=Xi.zpp_pool,(Xi.zpp_pool=vn).pre_dt=-1}else{var jn=n.colarb;if(!jn.cleared){for(var En,In,Tn=jn.b1.arbiters,Nn=null,Ln=Tn.head;null!=Ln;){if(Ln.elt==jn){null==Nn?(In=(En=Tn.head).next,Tn.head=In,null==Tn.head&&(Tn.pushmod=!0)):(In=(En=Nn.next).next,null==(Nn.next=In)&&(Tn.pushmod=!0));var Vn=En;Vn.elt=null,Vn.next=tp.zpp_pool,tp.zpp_pool=Vn,Tn.modified=!0,Tn.length--,Tn.pushmod=!0;break}Ln=(Nn=Ln).next}for(var Dn,Fn,Rn=jn.b2.arbiters,Zn=null,Bn=Rn.head;null!=Bn;){if(Bn.elt==jn){null==Zn?(Fn=(Dn=Rn.head).next,Rn.head=Fn,null==Rn.head&&(Rn.pushmod=!0)):(Fn=(Dn=Zn.next).next,null==(Zn.next=Fn)&&(Rn.pushmod=!0));var Gn=Dn;Gn.elt=null,Gn.next=tp.zpp_pool,tp.zpp_pool=Gn,Rn.modified=!0,Rn.length--,Rn.pushmod=!0;break}Bn=(Zn=Bn).next}null!=jn.pair&&(jn.pair.arb=null,jn.pair=null)}for(jn.b1=jn.b2=null,jn.active=!1,jn.intchange=!1;null!=jn.contacts.next;){var qn=jn.contacts,Un=qn.next;qn.pop(),Un.arbiter=null,Un.next=$i.zpp_pool,$i.zpp_pool=Un;qn=jn.innards,Un=qn.next;qn.next=Un.next,Un._inuse=!1,null==qn.next&&(qn.pushmod=!0),qn.modified=!0,qn.length--}jn.userdef_dyn_fric=!1,jn.userdef_stat_fric=!1,jn.userdef_restitution=!1,jn.userdef_rfric=!1,jn.__ref_edge1=jn.__ref_edge2=null,jn.next=Hi.zpp_pool,(Hi.zpp_pool=jn).pre_dt=-1}return!0}var Kn=n.active;if(n.active=n.presentable=n.up_stamp==this.stamp,0!=(1&n.immState)){if(n.active&&n.type!=Qt.SENSOR)if(null!=n.colarb){var Wn=n.colarb;Wn.invalidated&&(Wn.invalidated=!1,Wn.userdef_restitution||(Wn.s1.material.elasticity<=-1/0||Wn.s2.material.elasticity<=-1/0?Wn.restitution=0:Wn.s1.material.elasticity>=1/0||Wn.s2.material.elasticity>=1/0?Wn.restitution=1:Wn.restitution=(Wn.s1.material.elasticity+Wn.s2.material.elasticity)/2,Wn.restitution<0&&(Wn.restitution=0),1<Wn.restitution&&(Wn.restitution=1)),Wn.userdef_dyn_fric||(Wn.dyn_fric=Math.sqrt(Wn.s1.material.dynamicFriction*Wn.s2.material.dynamicFriction)),Wn.userdef_stat_fric||(Wn.stat_fric=Math.sqrt(Wn.s1.material.staticFriction*Wn.s2.material.staticFriction)),Wn.userdef_rfric||(Wn.rfric=Math.sqrt(Wn.s1.material.rollingFriction*Wn.s2.material.rollingFriction))),-1==Wn.pre_dt&&(Wn.pre_dt=t);var Yn=t/Wn.pre_dt;Wn.pre_dt=t;var Jn=Wn.b1.smass+Wn.b2.smass,Xn=!(Wn.hc2=!1);Wn.biasCoef=2!=Wn.b1.type||2!=Wn.b2.type?Wn.continuous?jp.contactContinuousStaticBiasCoef:jp.contactStaticBiasCoef:Wn.continuous?jp.contactContinuousBiasCoef:jp.contactBiasCoef,Wn.continuous=!1;for(var Hn=null,$n=null,Qn=Wn.innards.next,nt=Wn.contacts.next;null!=nt;){var tt,et,it,pt,lt,rt,ot,at,st,_t=nt;_t.stamp+jp.arbiterExpirationDelay<Wn.stamp?(ot=Wn.contacts,null==Hn?(et=(tt=ot.next).next,ot.next=et,null==ot.next&&(ot.pushmod=!0)):(et=(tt=Hn.next).next,null==(Hn.next=et)&&(ot.pushmod=!0)),tt._inuse=!1,ot.modified=!0,ot.length--,ot.pushmod=!0,nt=et,at=Wn.innards,null==$n?(pt=(it=at.next).next,at.next=pt,null==at.next&&(at.pushmod=!0)):(pt=(it=$n.next).next,null==($n.next=pt)&&(at.pushmod=!0)),it._inuse=!1,at.modified=!0,at.length--,at.pushmod=!0,Qn=pt,_t.arbiter=null,_t.next=$i.zpp_pool,$i.zpp_pool=_t):(lt=_t.inner,rt=_t.active,_t.active=_t.stamp==Wn.stamp,_t.active&&(Xn?(Xn=!1,Wn.c1=lt,Wn.oc1=_t):(Wn.hc2=!0,Wn.c2=lt,Wn.oc2=_t),lt.r2x=_t.px-Wn.b2.posx,lt.r2y=_t.py-Wn.b2.posy,lt.r1x=_t.px-Wn.b1.posx,lt.r1y=_t.py-Wn.b1.posy,st=lt.r2x*Wn.nx+lt.r2y*Wn.ny,ot=Jn+Wn.b2.sinertia*(st*st),at=lt.r1x*Wn.nx+lt.r1y*Wn.ny,ot+=Wn.b1.sinertia*(at*at),lt.tMass=ot<jp.epsilon*jp.epsilon?0:1/ot,st=Wn.ny*lt.r2x-Wn.nx*lt.r2y,at=Jn+Wn.b2.sinertia*(st*st),ot=Wn.ny*lt.r1x-Wn.nx*lt.r1y,at+=Wn.b1.sinertia*(ot*ot),lt.nMass=at<jp.epsilon*jp.epsilon?0:1/at,ot=st=0,at=Wn.b2.angvel+Wn.b2.kinangvel,st=Wn.b2.velx+Wn.b2.kinvelx-lt.r2y*at,ot=Wn.b2.vely+Wn.b2.kinvely+lt.r2x*at,at=Wn.b1.angvel+Wn.b1.kinangvel,st-=Wn.b1.velx+Wn.b1.kinvelx-lt.r1y*at,ot-=Wn.b1.vely+Wn.b1.kinvely+lt.r1x*at,at=Wn.nx*st+Wn.ny*ot,_t.elasticity=Wn.restitution,lt.bounce=at*_t.elasticity,lt.bounce>-jp.elasticThreshold&&(lt.bounce=0),at=ot*Wn.nx-st*Wn.ny,st=jp.staticFrictionThreshold,lt.friction=st*st<at*at?Wn.dyn_fric:Wn.stat_fric,lt.jnAcc*=Yn,lt.jtAcc*=Yn),rt!=_t.active&&(Wn.contacts.modified=!0),Hn=nt,Qn=($n=Qn).next,nt=nt.next)}Wn.hc2?(Wn.hpc2=!0,Wn.oc1.posOnly?(bt=Wn.c1,Wn.c1=Wn.c2,Wn.c2=bt,gt=Wn.oc1,Wn.oc1=Wn.oc2,Wn.oc2=gt,Wn.hc2=!1):Wn.oc2.posOnly&&(Wn.hc2=!1),Wn.oc1.posOnly&&(Xn=!0)):Wn.hpc2=!1,Wn.jrAcc*=Yn,Xn||(Wn.rn1a=Wn.ny*Wn.c1.r1x-Wn.nx*Wn.c1.r1y,Wn.rt1a=Wn.c1.r1x*Wn.nx+Wn.c1.r1y*Wn.ny,Wn.rn1b=Wn.ny*Wn.c1.r2x-Wn.nx*Wn.c1.r2y,Wn.rt1b=Wn.c1.r2x*Wn.nx+Wn.c1.r2y*Wn.ny,Wn.k1x=Wn.b2.kinvelx-Wn.c1.r2y*Wn.b2.kinangvel-(Wn.b1.kinvelx-Wn.c1.r1y*Wn.b1.kinangvel),Wn.k1y=Wn.b2.kinvely+Wn.c1.r2x*Wn.b2.kinangvel-(Wn.b1.kinvely+Wn.c1.r1x*Wn.b1.kinangvel)),Wn.hc2&&(Wn.rn2a=Wn.ny*Wn.c2.r1x-Wn.nx*Wn.c2.r1y,Wn.rt2a=Wn.c2.r1x*Wn.nx+Wn.c2.r1y*Wn.ny,Wn.rn2b=Wn.ny*Wn.c2.r2x-Wn.nx*Wn.c2.r2y,Wn.rt2b=Wn.c2.r2x*Wn.nx+Wn.c2.r2y*Wn.ny,Wn.k2x=Wn.b2.kinvelx-Wn.c2.r2y*Wn.b2.kinangvel-(Wn.b1.kinvelx-Wn.c2.r1y*Wn.b1.kinangvel),Wn.k2y=Wn.b2.kinvely+Wn.c2.r2x*Wn.b2.kinangvel-(Wn.b1.kinvely+Wn.c2.r1x*Wn.b1.kinangvel),Wn.kMassa=Jn+Wn.b1.sinertia*Wn.rn1a*Wn.rn1a+Wn.b2.sinertia*Wn.rn1b*Wn.rn1b,Wn.kMassb=Jn+Wn.b1.sinertia*Wn.rn1a*Wn.rn2a+Wn.b2.sinertia*Wn.rn1b*Wn.rn2b,Wn.kMassc=Jn+Wn.b1.sinertia*Wn.rn2a*Wn.rn2a+Wn.b2.sinertia*Wn.rn2b*Wn.rn2b,Wn.kMassa*Wn.kMassa+2*Wn.kMassb*Wn.kMassb+Wn.kMassc*Wn.kMassc<jp.illConditionedThreshold*(Wn.kMassa*Wn.kMassc-Wn.kMassb*Wn.kMassb)?(Wn.Ka=Wn.kMassa,Wn.Kb=Wn.kMassb,Wn.Kc=Wn.kMassc,(yt=Wn.kMassa*Wn.kMassc-Wn.kMassb*Wn.kMassb)!=yt?Wn.kMassa=Wn.kMassb=Wn.kMassc=0:0==yt?(0!=Wn.kMassa?Wn.kMassa=1/Wn.kMassa:Wn.kMassa=0,0!=Wn.kMassc?Wn.kMassc=1/Wn.kMassc:Wn.kMassc=0,Wn.kMassb=0):(yt=1/yt,xt=Wn.kMassc*yt,Wn.kMassc=Wn.kMassa*yt,Wn.kMassa=xt,Wn.kMassb*=-yt)):(Wn.hc2=!1,Wn.oc2.dist<Wn.oc1.dist&&(zt=Wn.c1,Wn.c1=Wn.c2,Wn.c2=zt),Wn.oc2.active=!1,Wn.contacts.modified=!0)),Wn.surfacex=Wn.b2.svelx,Wn.surfacey=Wn.b2.svely,Wn.surfacex+=Wn.b1.svelx,Wn.surfacey+=Wn.b1.svely,Wn.surfacex=-Wn.surfacex,Wn.surfacey=-Wn.surfacey,Wn.rMass=Wn.b1.sinertia+Wn.b2.sinertia,0!=Wn.rMass&&(Wn.rMass=1/Wn.rMass),Xn&&(n.active=!1)}else{var ht=n.fluidarb;-1==ht.pre_dt&&(ht.pre_dt=t);var ut=t/ht.pre_dt;ht.pre_dt=t,ht.r1x=ht.centroidx-ht.b1.posx,ht.r1y=ht.centroidy-ht.b1.posy,ht.r2x=ht.centroidx-ht.b2.posx,ht.r2y=ht.centroidy-ht.b2.posy;var xt,dt,yt,zt,ct,vt,mt=0,ft=0,ft=ht.ws1.fluidEnabled&&null!=ht.ws1.fluidProperties.wrap_gravity?(mt=ht.ws1.fluidProperties.gravityx,ht.ws1.fluidProperties.gravityy):(mt=this.gravityx,this.gravityy),p=0,l=0,l=ht.ws2.fluidEnabled&&null!=ht.ws2.fluidProperties.wrap_gravity?(p=ht.ws2.fluidProperties.gravityx,ht.ws2.fluidProperties.gravityy):(p=this.gravityx,this.gravityy),bt=0,gt=0;if(ht.ws1.fluidEnabled&&ht.ws2.fluidEnabled?(xt=ht.overlap*ht.ws1.fluidProperties.density,(yt=ht.overlap*ht.ws2.fluidProperties.density)<xt?(bt-=mt*(ct=xt+yt),gt-=ft*ct):xt<yt?(bt+=p*(dt=xt+yt),gt+=l*dt):(ct=zt=0,zt=mt+p,ct=ft+l,zt*=.5,ct*=.5,ht.ws1.worldCOMx*zt+ht.ws1.worldCOMy*ct>ht.ws2.worldCOMx*zt+ht.ws2.worldCOMy*ct?(bt-=zt*(dt=xt+yt),gt-=ct*dt):(bt+=zt*(yt=xt+yt),gt+=ct*yt))):ht.ws1.fluidEnabled?(bt-=mt*(mt=ht.overlap*ht.ws1.fluidProperties.density),gt-=ft*mt):ht.ws2.fluidEnabled&&(bt+=p*(vt=ht.overlap*ht.ws2.fluidProperties.density),gt+=l*vt),bt*=t,gt*=t,ht.buoyx=bt,ht.buoyy=gt,2==ht.b1.type&&(vt=ht.b1.imass,ht.b1.velx-=bt*vt,ht.b1.vely-=gt*vt,ht.b1.angvel-=(gt*ht.r1x-bt*ht.r1y)*ht.b1.iinertia),2==ht.b2.type&&(wt=ht.b2.imass,ht.b2.velx+=bt*wt,ht.b2.vely+=gt*wt,ht.b2.angvel+=(gt*ht.r2x-bt*ht.r2y)*ht.b2.iinertia),ht.ws1.fluidEnabled&&0!=ht.ws1.fluidProperties.viscosity||ht.ws2.fluidEnabled&&0!=ht.ws2.fluidProperties.viscosity){ht.nodrag=!1;var wt=0;ht.ws1.fluidEnabled&&(ht.ws2.validate_angDrag(),wt=ht.ws1.fluidProperties.viscosity*ht.ws2.angDrag*ht.overlap/ht.ws2.area),ht.ws2.fluidEnabled&&(ht.ws1.validate_angDrag(),wt+=ht.ws2.fluidProperties.viscosity*ht.ws1.angDrag*ht.overlap/ht.ws1.area),0!=wt?(St=ht.b1.sinertia+ht.b2.sinertia,ht.wMass=0!=St?1/St:0,wt*=4e-4,Ct=2*Math.PI*wt,ht.agamma=1/(t*Ct*(2+Ct*t)),Pt=1/(1+ht.agamma),ht.agamma*=Pt,ht.wMass*=Pt):(ht.wMass=0,ht.agamma=0);gt=ht.b2.velx+ht.b2.kinvelx-ht.r2y*(ht.b2.angvel+ht.b2.kinangvel)-(ht.b1.velx+ht.b1.kinvelx-ht.r1y*(ht.b2.angvel+ht.b2.kinangvel)),bt=ht.b2.vely+ht.b2.kinvely+ht.r2x*(ht.b2.angvel+ht.b2.kinangvel)-(ht.b1.vely+ht.b1.kinvely+ht.r1x*(ht.b1.angvel+ht.b1.kinangvel));gt*gt+bt*bt<jp.epsilon*jp.epsilon||(gt*=Mt=1/Math.sqrt(gt*gt+bt*bt),bt*=Mt,ht.nx=gt,ht.ny=bt);var Mt,Ct,kt,Ot,Pt,St=0;if(ht.ws1.fluidEnabled){var At=-ht.ws1.fluidProperties.viscosity*ht.overlap/ht.ws2.area;if(0==ht.ws2.type)St=0-At*ht.ws2.circle.radius*jp.fluidLinearDrag/(2*ht.ws2.circle.radius*Math.PI);else{for(var jt=0,Et=0,It=ht.ws2.polygon.edges.head;null!=It;){var Tt=It.elt;jt+=Tt.length;Tt=At*Tt.length*(Tt.gnormx*ht.nx+Tt.gnormy*ht.ny);0<Tt&&(Tt*=-jp.fluidVacuumDrag),Et-=.5*Tt*jp.fluidLinearDrag,It=It.next}St=Et/jt}}if(ht.ws2.fluidEnabled){var Nt=-ht.ws2.fluidProperties.viscosity*ht.overlap/ht.ws1.area;if(0==ht.ws1.type)St-=Nt*ht.ws1.circle.radius*jp.fluidLinearDrag/(2*ht.ws1.circle.radius*Math.PI);else{for(var Lt=0,Vt=0,Dt=ht.ws1.polygon.edges.head;null!=Dt;){var Ft=Dt.elt;Lt+=Ft.length;Ft=Nt*Ft.length*(Ft.gnormx*ht.nx+Ft.gnormy*ht.ny);0<Ft&&(Ft*=-jp.fluidVacuumDrag),Vt-=.5*Ft*jp.fluidLinearDrag,Dt=Dt.next}St+=Vt/Lt}}0!=St?(Pt=Ct=wt=0,Pt=wt=Mt=ht.b1.smass+ht.b2.smass,(Ct=0)!=ht.b1.sinertia&&(gt=ht.r1x*ht.b1.sinertia,wt=Mt+(bt=ht.r1y*ht.b1.sinertia)*ht.r1y,Ct+=-bt*ht.r1x,Pt=Mt+gt*ht.r1x),0!=ht.b2.sinertia&&(Ot=ht.r2x*ht.b2.sinertia,wt+=(kt=ht.r2y*ht.b2.sinertia)*ht.r2y,Ct+=-kt*ht.r2x,Pt+=Ot*ht.r2x),(kt=wt*Pt-Ct*Ct)!=kt?wt=Ct=Pt=0:0==kt?(wt=0!=wt?1/wt:0,Pt=0!=Pt?1/Pt:0,Ct=0):(Ot=Pt*(kt=1/kt),Pt=wt*kt,wt=Ot,Ct*=-kt),ht.vMassa=wt,ht.vMassb=Ct,ht.vMassc=Pt,St=2*Math.PI*St,ht.lgamma=1/(t*St*(2+St*t)),t=1/(1+ht.lgamma),ht.lgamma*=t,ht.vMassa*=t,ht.vMassb*=t,ht.vMassc*=t):(ht.vMassa=0,ht.vMassb=0,ht.vMassc=0,ht.lgamma=0)}else ht.nodrag=!0,ht.dampx=0,ht.dampy=0,ht.adamp=0;ht.dampx*=ut,ht.dampy*=ut,ht.adamp*=ut}}else if(null!=n.colarb){var Rt=n.colarb,Zt=!0,Bt=null,Gt=null,qt=Rt.innards.next;Rt.hc2=!1;for(var Ut=Rt.contacts.next;null!=Ut;){var Kt,Wt,Yt,Jt,Xt,Ht,$t=Ut;$t.stamp+jp.arbiterExpirationDelay<Rt.stamp?(Xt=Rt.contacts,null==Bt?(Wt=(Kt=Xt.next).next,Xt.next=Wt,null==Xt.next&&(Xt.pushmod=!0)):(Wt=(Kt=Bt.next).next,null==(Bt.next=Wt)&&(Xt.pushmod=!0)),Kt._inuse=!1,Xt.modified=!0,Xt.length--,Xt.pushmod=!0,Ut=Wt,Ht=Rt.innards,null==Gt?(Jt=(Yt=Ht.next).next,Ht.next=Jt,null==Ht.next&&(Ht.pushmod=!0)):(Jt=(Yt=Gt.next).next,null==(Gt.next=Jt)&&(Ht.pushmod=!0)),Yt._inuse=!1,Ht.modified=!0,Ht.length--,Ht.pushmod=!0,qt=Jt,$t.arbiter=null,$t.next=$i.zpp_pool,$i.zpp_pool=$t):(Xt=$t.inner,Ht=$t.active,$t.active=$t.stamp==Rt.stamp,$t.active&&(Zt?(Zt=!1,Rt.c1=Xt,Rt.oc1=$t):(Rt.hc2=!0,Rt.c2=Xt,Rt.oc2=$t)),Ht!=$t.active&&(Rt.contacts.modified=!0),Bt=Ut,qt=(Gt=qt).next,Ut=Ut.next)}Rt.hc2?(Rt.hpc2=!0,Rt.oc1.posOnly?(ut=Rt.c1,Rt.c1=Rt.c2,Rt.c2=ut,ut=Rt.oc1,Rt.oc1=Rt.oc2,Rt.oc2=ut,Rt.hc2=!1):Rt.oc2.posOnly&&(Rt.hc2=!1),Rt.oc1.posOnly&&(Zt=!0)):Rt.hpc2=!1,Zt&&(n.active=!1)}return Kn!=n.active&&(n.b1.arbiters.modified=!0,n.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0),!1},ie.prototype.prestep=function(n){for(var t=null,e=this.live_constraints.head;null!=e;){var i=e.elt;i.preStep(n)?(e=this.live_constraints.erase(t),i.broken(),this.constraintCbBreak(i),i.removeOnBreak?(i.component.sleeping=!0,this.midstep=!1,(null!=i.compound?i.compound:this).wrap_constraints.remove(i.outer),this.midstep=!0):i.active=!1,i.clearcache()):e=(t=e).next}var p,l,r,o=null,a=this.c_arbiters_true,s=a.head,_=null!=this.c_arbiters_false;for(_&&null==s&&(_=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null);null!=s;)this.presteparb(s.elt,n)?(null==o?(l=(p=a.head).next,a.head=l,null==a.head&&(a.pushmod=!0)):(l=(p=o.next).next,null==(o.next=l)&&(a.pushmod=!0)),(r=p).elt=null,r.next=rp.zpp_pool,rp.zpp_pool=r,a.modified=!0,a.length--,a.pushmod=!0,s=l,_&&null==s&&(_=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null)):(s=(o=s).next,_&&null==s&&(_=!1,s=this.c_arbiters_false.head,a=this.c_arbiters_false,o=null));for(var h,u,x,d=null,y=this.f_arbiters,z=y.head;null!=z;)this.presteparb(z.elt,n)?(null==d?(u=(h=y.head).next,y.head=u,null==y.head&&(y.pushmod=!0)):(u=(h=d.next).next,null==(d.next=u)&&(y.pushmod=!0)),(x=h).elt=null,x.next=pp.zpp_pool,pp.zpp_pool=x,y.modified=!0,y.length--,y.pushmod=!0,z=u):z=(d=z).next;for(var c,v,m,f=null,b=this.s_arbiters,g=b.head;null!=g;)this.presteparb(g.elt,n)?(null==f?(v=(c=b.head).next,b.head=v,null==b.head&&(b.pushmod=!0)):(v=(c=f.next).next,null==(f.next=v)&&(b.pushmod=!0)),(m=c).elt=null,m.next=lp.zpp_pool,lp.zpp_pool=m,b.modified=!0,b.length--,b.pushmod=!0,g=v):g=(f=g).next},ie.prototype.warmStart=function(){for(var n=this.f_arbiters.head;null!=n;){var t,e=n.elt;e.active&&0!=(1&e.immState)&&(t=e.b1.imass,e.b1.velx-=e.dampx*t,e.b1.vely-=e.dampy*t,t=e.b2.imass,e.b2.velx+=e.dampx*t,e.b2.vely+=e.dampy*t,e.b1.angvel-=e.b1.iinertia*(e.dampy*e.r1x-e.dampx*e.r1y),e.b2.angvel+=e.b2.iinertia*(e.dampy*e.r2x-e.dampx*e.r2y),e.b1.angvel-=e.adamp*e.b1.iinertia,e.b2.angvel+=e.adamp*e.b2.iinertia),n=n.next}var i=this.c_arbiters_false.head,p=!0;for(null==i&&(i=this.c_arbiters_true.head,p=!1);null!=i;){var l,r,o,a=i.elt;a.active&&0!=(1&a.immState)&&(o=a.nx*a.c1.jnAcc-a.ny*a.c1.jtAcc,r=a.ny*a.c1.jnAcc+a.nx*a.c1.jtAcc,l=a.b1.imass,a.b1.velx-=o*l,a.b1.vely-=r*l,a.b1.angvel-=a.b1.iinertia*(r*a.c1.r1x-o*a.c1.r1y),l=a.b2.imass,a.b2.velx+=o*l,a.b2.vely+=r*l,a.b2.angvel+=a.b2.iinertia*(r*a.c1.r2x-o*a.c1.r2y),a.hc2&&(l=a.nx*a.c2.jnAcc-a.ny*a.c2.jtAcc,r=a.ny*a.c2.jnAcc+a.nx*a.c2.jtAcc,o=a.b1.imass,a.b1.velx-=l*o,a.b1.vely-=r*o,a.b1.angvel-=a.b1.iinertia*(r*a.c2.r1x-l*a.c2.r1y),o=a.b2.imass,a.b2.velx+=l*o,a.b2.vely+=r*o,a.b2.angvel+=a.b2.iinertia*(r*a.c2.r2x-l*a.c2.r2y)),a.b2.angvel+=a.jrAcc*a.b2.iinertia,a.b1.angvel-=a.jrAcc*a.b1.iinertia),i=i.next,p&&null==i&&(i=this.c_arbiters_true.head,p=!1)}for(var s=this.live_constraints.head;null!=s;)s.elt.warmStart(),s=s.next},ie.prototype.iterateVel=function(n){for(var t=0;t<n;){++t;for(var e=this.f_arbiters.head;null!=e;){var i,p,l,r,o,a=e.elt;a.active&&0!=(1&a.immState)&&(a.nodrag||(i=a.b1.angvel+a.b1.kinangvel,o=a.b2.angvel+a.b2.kinangvel,l=a.b1.velx+a.b1.kinvelx-a.r1y*i-(a.b2.velx+a.b2.kinvelx-a.r2y*o),p=a.b1.vely+a.b1.kinvely+a.r1x*i-(a.b2.vely+a.b2.kinvely+a.r2x*o),r=a.vMassa*l+a.vMassb*p,p=a.vMassb*l+a.vMassc*p,l=r,r=a.lgamma,l-=a.dampx*r,p-=a.dampy*r,a.dampx+=l,a.dampy+=p,r=a.b1.imass,a.b1.velx-=l*r,a.b1.vely-=p*r,r=a.b2.imass,a.b2.velx+=l*r,a.b2.vely+=p*r,a.b1.angvel-=a.b1.iinertia*(p*a.r1x-l*a.r1y),a.b2.angvel+=a.b2.iinertia*(p*a.r2x-l*a.r2y),o=(i-o)*a.wMass-a.adamp*a.agamma,a.adamp+=o,a.b1.angvel-=o*a.b1.iinertia,a.b2.angvel+=o*a.b2.iinertia)),e=e.next}for(var s=null,_=this.live_constraints.head;null!=_;){var h=_.elt;h.applyImpulseVel()?(_=this.live_constraints.erase(s),h.broken(),this.constraintCbBreak(h),h.removeOnBreak?(h.component.sleeping=!0,this.midstep=!1,(null!=h.compound?h.compound:this).wrap_constraints.remove(h.outer),this.midstep=!0):h.active=!1,h.clearcache()):_=(s=_).next}var u=this.c_arbiters_false.head,x=!0;for(null==u&&(u=this.c_arbiters_true.head,x=!1);null!=u;){var d,y,z,c,v,m,f,b,g,w,M,C,k,O,P=u.elt;P.active&&0!=(1&P.immState)&&(z=P.k1x+P.b2.velx-P.c1.r2y*P.b2.angvel-(P.b1.velx-P.c1.r1y*P.b1.angvel),v=((c=P.k1y+P.b2.vely+P.c1.r2x*P.b2.angvel-(P.b1.vely+P.c1.r1x*P.b1.angvel))*P.nx-z*P.ny+P.surfacex)*P.c1.tMass,(m=P.c1.friction*P.c1.jnAcc)<(b=(f=P.c1.jtAcc)-v)?b=m:b<-m&&(b=-m),v=b-f,P.c1.jtAcc=b,d=-P.ny*v,y=P.nx*v,P.b2.velx+=d*P.b2.imass,P.b2.vely+=y*P.b2.imass,P.b1.velx-=d*P.b1.imass,P.b1.vely-=y*P.b1.imass,P.b2.angvel+=P.rt1b*v*P.b2.iinertia,P.b1.angvel-=P.rt1a*v*P.b1.iinertia,P.hc2?(k=P.k2x+P.b2.velx-P.c2.r2y*P.b2.angvel-(P.b1.velx-P.c2.r1y*P.b1.angvel),v=((O=P.k2y+P.b2.vely+P.c2.r2x*P.b2.angvel-(P.b1.vely+P.c2.r1x*P.b1.angvel))*P.nx-k*P.ny+P.surfacex)*P.c2.tMass,(m=P.c2.friction*P.c2.jnAcc)<(b=(f=P.c2.jtAcc)-v)?b=m:b<-m&&(b=-m),v=b-f,P.c2.jtAcc=b,d=-P.ny*v,y=P.nx*v,P.b2.velx+=d*P.b2.imass,P.b2.vely+=y*P.b2.imass,P.b1.velx-=d*P.b1.imass,P.b1.vely-=y*P.b1.imass,P.b2.angvel+=P.rt2b*v*P.b2.iinertia,P.b1.angvel-=P.rt2a*v*P.b1.iinertia,z=P.k1x+P.b2.velx-P.c1.r2y*P.b2.angvel-(P.b1.velx-P.c1.r1y*P.b1.angvel),c=P.k1y+P.b2.vely+P.c1.r2x*P.b2.angvel-(P.b1.vely+P.c1.r1x*P.b1.angvel),k=P.k2x+P.b2.velx-P.c2.r2y*P.b2.angvel-(P.b1.velx-P.c2.r1y*P.b1.angvel),O=P.k2y+P.b2.vely+P.c2.r2x*P.b2.angvel-(P.b1.vely+P.c2.r1x*P.b1.angvel),g=P.c1.jnAcc,w=P.c2.jnAcc,M=z*P.nx+c*P.ny+P.surfacey+P.c1.bounce-(P.Ka*g+P.Kb*w),C=k*P.nx+O*P.ny+P.surfacey+P.c2.bounce-(P.Kb*g+P.Kc*w),k=-(P.kMassa*M+P.kMassb*C),O=-(P.kMassb*M+P.kMassc*C),0<=k&&0<=O?(M=k-g,C=O-w,P.c1.jnAcc=k,P.c2.jnAcc=O):0<=(k=-P.c1.nMass*M)&&0<=P.Kb*k+C?(M=k-g,C=-w,P.c1.jnAcc=k,P.c2.jnAcc=0):0<=(O=-P.c2.nMass*C)&&0<=P.Kb*O+M?(M=-g,C=O-w,P.c1.jnAcc=0,P.c2.jnAcc=O):0<=M&&0<=C?(M=-g,C=-w,P.c1.jnAcc=P.c2.jnAcc=0):C=M=0,v=M+C,d=P.nx*v,y=P.ny*v,P.b2.velx+=d*P.b2.imass,P.b2.vely+=y*P.b2.imass,P.b1.velx-=d*P.b1.imass,P.b1.vely-=y*P.b1.imass,P.b2.angvel+=(P.rn1b*M+P.rn2b*C)*P.b2.iinertia,P.b1.angvel-=(P.rn1a*M+P.rn2a*C)*P.b1.iinertia):(0!=P.radius&&(v=(P.b2.angvel-P.b1.angvel)*P.rMass,m=P.rfric*P.c1.jnAcc,f=P.jrAcc,P.jrAcc-=v,P.jrAcc>m?P.jrAcc=m:P.jrAcc<-m&&(P.jrAcc=-m),v=P.jrAcc-f,P.b2.angvel+=v*P.b2.iinertia,P.b1.angvel-=v*P.b1.iinertia),z=P.k1x+P.b2.velx-P.c1.r2y*P.b2.angvel-(P.b1.velx-P.c1.r1y*P.b1.angvel),c=P.k1y+P.b2.vely+P.c1.r2x*P.b2.angvel-(P.b1.vely+P.c1.r1x*P.b1.angvel),v=(P.c1.bounce+(P.nx*z+P.ny*c)+P.surfacey)*P.c1.nMass,(b=(f=P.c1.jnAcc)-v)<0&&(b=0),v=b-f,P.c1.jnAcc=b,d=P.nx*v,y=P.ny*v,P.b2.velx+=d*P.b2.imass,P.b2.vely+=y*P.b2.imass,P.b1.velx-=d*P.b1.imass,P.b1.vely-=y*P.b1.imass,P.b2.angvel+=P.rn1b*v*P.b2.iinertia,P.b1.angvel-=P.rn1a*v*P.b1.iinertia)),u=u.next,x&&null==u&&(u=this.c_arbiters_true.head,x=!1)}}},ie.prototype.iteratePos=function(n){for(var t=0;t<n;){++t;for(var e=null,i=this.live_constraints.head;null!=i;){var p=i.elt;!p.__velocity&&p.stiff&&p.applyImpulsePos()?(i=this.live_constraints.erase(e),p.broken(),this.constraintCbBreak(p),p.removeOnBreak?(p.component.sleeping=!0,this.midstep=!1,(null!=p.compound?p.compound:this).wrap_constraints.remove(p.outer),this.midstep=!0):p.active=!1,p.clearcache()):i=(e=i).next}var l=this.c_arbiters_false.head,r=!0;for(null==l&&(l=this.c_arbiters_true.head,r=!1);null!=l;){var o=l.elt;if(o.active&&0!=(1&o.immState))if(2==o.ptype){var a=o.c1,s=0,_=0;s=o.b2.axisy*a.lr2x-o.b2.axisx*a.lr2y,_=a.lr2x*o.b2.axisx+a.lr2y*o.b2.axisy,s+=o.b2.posx,_+=o.b2.posy;var h=0,u=0;h=o.b1.axisy*a.lr1x-o.b1.axisx*a.lr1y,u=a.lr1x*o.b1.axisx+a.lr1y*o.b1.axisy;var x=0,d=0,x=s-(h+=o.b1.posx),d=_-(u+=o.b1.posy),y=Math.sqrt(x*x+d*d),z=o.radius-jp.collisionSlop,a=y-z;x*o.nx+d*o.ny<0&&(x=-x,d=-d,a-=o.radius),a<0&&(y<jp.epsilon?0!=o.b1.smass?o.b1.posx+=10*jp.epsilon:o.b2.posx+=10*jp.epsilon:(x*=a=1/y,g=.5*(u+_),z=y-z,u=(d*=a)*(h=(a=.5*(h+s))-o.b1.posx)-x*(u=g-o.b1.posy),g=d*(s=a-o.b2.posx)-x*(_=g-o.b2.posy),0!=(_=o.b2.smass+g*g*o.b2.sinertia+o.b1.smass+u*u*o.b1.sinertia)&&(f=k=0,k=x*(w=-o.biasCoef*z/_),f=d*w,_=o.b1.imass,o.b1.posx-=k*_,o.b1.posy-=f*_,b=o.b1,d=-u*o.b1.iinertia*w,b.rot+=d,1e-4<d*d?(b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)):(_=1-(P=d*d)*P/8,P=((u=1-.5*P)*b.axisx+d*b.axisy)*_,b.axisy=(u*b.axisy-d*b.axisx)*_,b.axisx=P),b=o.b2.imass,o.b2.posx+=k*b,o.b2.posy+=f*b,P=o.b2,k=g*o.b2.iinertia*w,P.rot+=k,1e-4<k*k?(P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot)):(O=1-(M=k*k)*M/8,S=((C=1-.5*M)*P.axisx+k*P.axisy)*O,P.axisy=(C*P.axisy-k*P.axisx)*O,P.axisx=S))))}else{var c,v=0,m=0,f=0,b=0,g=0,w=0;0==o.ptype?(v=o.b1.axisy*o.lnormx-o.b1.axisx*o.lnormy,m=o.lnormx*o.b1.axisx+o.lnormy*o.b1.axisy,c=o.lproj+(v*o.b1.posx+m*o.b1.posy),f=o.b2.axisy*o.c1.lr1x-o.b2.axisx*o.c1.lr1y,b=o.c1.lr1x*o.b2.axisx+o.c1.lr1y*o.b2.axisy,f+=o.b2.posx,b+=o.b2.posy,o.hpc2&&(g=o.b2.axisy*o.c2.lr1x-o.b2.axisx*o.c2.lr1y,w=o.c2.lr1x*o.b2.axisx+o.c2.lr1y*o.b2.axisy,g+=o.b2.posx,w+=o.b2.posy)):(v=o.b2.axisy*o.lnormx-o.b2.axisx*o.lnormy,m=o.lnormx*o.b2.axisx+o.lnormy*o.b2.axisy,c=o.lproj+(v*o.b2.posx+m*o.b2.posy),f=o.b1.axisy*o.c1.lr1x-o.b1.axisx*o.c1.lr1y,b=o.c1.lr1x*o.b1.axisx+o.c1.lr1y*o.b1.axisy,f+=o.b1.posx,b+=o.b1.posy,o.hpc2&&(g=o.b1.axisy*o.c2.lr1x-o.b1.axisx*o.c2.lr1y,w=o.c2.lr1x*o.b1.axisx+o.c2.lr1y*o.b1.axisy,g+=o.b1.posx,w+=o.b1.posy));var M=f*v+b*m-c-o.radius;M+=jp.collisionSlop;var C=0;if(o.hpc2&&(C=g*v+w*m-c-o.radius,C+=jp.collisionSlop),M<0||C<0){o.rev&&(v=-v,m=-m);var k=0,O=0,k=f-o.b1.posx,O=b-o.b1.posy,P=0,S=0,P=f-o.b2.posx,S=b-o.b2.posy;if(o.hpc2){var A=m*k-v*O,j=m*P-v*S,E=m*(g-o.b1.posx)-v*(w-o.b1.posy),I=m*(g-o.b2.posx)-v*(w-o.b2.posy),T=o.b1.smass+o.b2.smass;o.kMassa=T+o.b1.sinertia*A*A+o.b2.sinertia*j*j,o.kMassb=T+o.b1.sinertia*A*E+o.b2.sinertia*j*I,o.kMassc=T+o.b1.sinertia*E*E+o.b2.sinertia*I*I;for(var N=o.kMassa,L=o.kMassb,V=o.kMassc,D=M*o.biasCoef,F=C*o.biasCoef;;){var R=0,Z=0;R=-(R=D),Z=-(Z=F);var B=o.kMassa*o.kMassc-o.kMassb*o.kMassb;if(B!=B?R=Z=0:0==B?(0!=o.kMassa?R/=o.kMassa:R=0,0!=o.kMassc?Z/=o.kMassc:Z=0):(q=(B=1/B)*(o.kMassc*R-o.kMassb*Z),Z=B*(o.kMassa*Z-o.kMassb*R),R=q),0<=R&&0<=Z){var G=(R+Z)*o.b1.imass;o.b1.posx-=v*G,o.b1.posy-=m*G;var B=o.b1,q=-o.b1.iinertia*(A*R+E*Z);B.rot+=q,1e-4<q*q?(B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot)):(K=1-(U=q*q)*U/8,U=((G=1-.5*U)*B.axisx+q*B.axisy)*K,B.axisy=(G*B.axisy-q*B.axisx)*K,B.axisx=U);q=(R+Z)*o.b2.imass;o.b2.posx+=v*q,o.b2.posy+=m*q;var U,K=o.b2,B=o.b2.iinertia*(j*R+I*Z);K.rot+=B,1e-4<B*B?(K.axisx=Math.sin(K.rot),K.axisy=Math.cos(K.rot)):(U=1-(Y=B*B)*Y/8,Y=((q=1-.5*Y)*K.axisx+B*K.axisy)*U,K.axisy=(q*K.axisy-B*K.axisx)*U,K.axisx=Y);break}if((Z=0)<=(R=-D/N)&&0<=L*R+F){K=(R+Z)*o.b1.imass;o.b1.posx-=v*K,o.b1.posy-=m*K;var W=o.b1,Y=-o.b1.iinertia*(A*R+E*Z);W.rot+=Y,1e-4<Y*Y?(W.axisx=Math.sin(W.rot),W.axisy=Math.cos(W.rot)):(J=1-(X=Y*Y)*X/8,X=((K=1-.5*X)*W.axisx+Y*W.axisy)*J,W.axisy=(K*W.axisy-Y*W.axisx)*J,W.axisx=X);var J=(R+Z)*o.b2.imass;o.b2.posx+=v*J,o.b2.posy+=m*J;var W=o.b2,X=o.b2.iinertia*(j*R+I*Z);W.rot+=X,1e-4<X*X?(W.axisx=Math.sin(W.rot),W.axisy=Math.cos(W.rot)):(H=1-($=X*X)*$/8,$=((J=1-.5*$)*W.axisx+X*W.axisy)*H,W.axisy=(J*W.axisy-X*W.axisx)*H,W.axisx=$);break}if((R=0)<=(Z=-F/V)&&0<=L*Z+D){var H=(R+Z)*o.b1.imass;o.b1.posx-=v*H,o.b1.posy-=m*H;var W=o.b1,$=-o.b1.iinertia*(A*R+E*Z);W.rot+=$,1e-4<$*$?(W.axisx=Math.sin(W.rot),W.axisy=Math.cos(W.rot)):(Q=1-(nn=$*$)*nn/8,nn=((H=1-.5*nn)*W.axisx+$*W.axisy)*Q,W.axisy=(H*W.axisy-$*W.axisx)*Q,W.axisx=nn);var Q=(R+Z)*o.b2.imass;o.b2.posx+=v*Q,o.b2.posy+=m*Q;var W=o.b2,nn=o.b2.iinertia*(j*R+I*Z);W.rot+=nn,1e-4<nn*nn?(W.axisx=Math.sin(W.rot),W.axisy=Math.cos(W.rot)):(R=1-(Q=nn*nn)*Q/8,Q=((Z=1-.5*Q)*W.axisx+nn*W.axisy)*R,W.axisy=(Z*W.axisy-nn*W.axisx)*R,W.axisx=Q);break}break}}else{var tn,w=m*k-v*O,T=m*P-v*S,C=o.b2.smass+T*T*o.b2.sinertia+o.b1.smass+w*w*o.b1.sinertia;0!=C&&(O=k=0,k=v*(P=-o.biasCoef*M/C),O=m*P,S=o.b1.imass,o.b1.posx-=k*S,o.b1.posy-=O*S,M=o.b1,C=-w*o.b1.iinertia*P,M.rot+=C,1e-4<C*C?(M.axisx=Math.sin(M.rot),M.axisy=Math.cos(M.rot)):(S=1-(tn=C*C)*tn/8,tn=((w=1-.5*tn)*M.axisx+C*M.axisy)*S,M.axisy=(w*M.axisy-C*M.axisx)*S,M.axisx=tn),tn=o.b2.imass,o.b2.posx+=k*tn,o.b2.posy+=O*tn,k=o.b2,O=T*o.b2.iinertia*P,k.rot+=O,1e-4<O*O?(k.axisx=Math.sin(k.rot),k.axisy=Math.cos(k.rot)):(T=1-(tn=O*O)*tn/8,tn=((P=1-.5*tn)*k.axisx+O*k.axisy)*T,k.axisy=(P*k.axisy-O*k.axisx)*T,k.axisx=tn))}}}l=l.next,r&&null==l&&(l=this.c_arbiters_true.head,r=!1)}}},ie.prototype.group_ignore=function(n,t){for(var e=n;null!=e&&null==e.group;)e=null!=e.ishape?e.ishape.body:(null!=e.icompound?e.icompound:e.ibody).compound;var i=null==e?null:e.group;if(null==i)return!1;for(var p=t;null!=p&&null==p.group;)p=null!=p.ishape?p.ishape.body:(null!=p.icompound?p.icompound:p.ibody).compound;var l=null==p?null:p.group;if(null==l)return!1;for(var r=!1;null!=i&&null!=l;){if(i==l){r=i.ignore;break}i.depth<l.depth?l=l.group:i=i.group}return r},ie.prototype.interactionType=function(n,t,e,i){for(var p,l,r,o=!1,a=e.constraints.head;null!=a;){var s=a.elt;if(s.ignore&&s.pair_exists(e.id,i.id)){o=!0;break}a=a.next}if(o)p=!1;else{for(var _=n;null!=_&&null==_.group;)_=null!=_.ishape?_.ishape.body:(null!=_.icompound?_.icompound:_.ibody).compound;var h,u=null==_?null:_.group;if(null==u)h=!1;else{for(var x=t;null!=x&&null==x.group;)x=null!=x.ishape?x.ishape.body:(null!=x.icompound?x.icompound:x.ibody).compound;var d=null==x?null:x.group;if(null==d)h=!1;else{for(var y=!1;null!=u&&null!=d;){if(u==d){y=u.ignore;break}u.depth<d.depth?d=d.group:u=u.group}h=y}}p=!h}if(p){if(!(!n.sensorEnabled&&!t.sensorEnabled)&&(r=n.filter,l=t.filter,0!=(r.sensorMask&l.sensorGroup)&&0!=(l.sensorMask&r.sensorGroup)))return 2;if(!!(!(!n.fluidEnabled&&!t.fluidEnabled)&&(l=n.filter,r=t.filter,0!=(l.fluidMask&r.fluidGroup)&&0!=(r.fluidMask&l.fluidGroup)))&&!(0==e.imass&&0==i.imass&&0==e.iinertia&&0==i.iinertia))return 0;var n=n.filter,t=t.filter,n=0!=(n.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&n.collisionGroup)&&!(0==e.imass&&0==i.imass&&0==e.iinertia&&0==i.iinertia);return n?1:-1}return-1},ie.prototype.precb=null,ie.prototype.prelisteners=null,ie.prototype.narrowPhase=function(n,t,e,i,p){for(var l,r,o,a=null,s=n.body,_=t.body,h=!1,u=s.constraints.head;null!=u;){var x=u.elt;if(x.ignore&&x.pair_exists(s.id,_.id)){h=!0;break}u=u.next}if(h)l=!1;else{for(var d=n;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:(null!=d.icompound?d.icompound:d.ibody).compound;var y,z=null==d?null:d.group;if(null==z)y=!1;else{for(var c=t;null!=c&&null==c.group;)c=null!=c.ishape?c.ishape.body:(null!=c.icompound?c.icompound:c.ibody).compound;var v=null==c?null:c.group;if(null==v)y=!1;else{for(var m=!1;null!=z&&null!=v;){if(z==v){m=z.ignore;break}z.depth<v.depth?v=v.group:z=z.group}y=m}}l=!y}if(-1!=(it=l?!(!n.sensorEnabled&&!t.sensorEnabled)&&(it=n.filter,l=t.filter,0!=(it.sensorMask&l.sensorGroup)&&0!=(l.sensorMask&it.sensorGroup))?2:!!(!(!n.fluidEnabled&&!t.fluidEnabled)&&(I=n.filter,g=t.filter,0!=(I.fluidMask&g.fluidGroup)&&0!=(g.fluidMask&I.fluidGroup)))&&!(0==s.imass&&0==_.imass&&0==s.iinertia&&0==_.iinertia)?0:(O=n.filter,T=t.filter,0!=(O.collisionMask&T.collisionGroup)&&0!=(T.collisionMask&O.collisionGroup)&&!(0==s.imass&&0==_.imass&&0==s.iinertia&&0==_.iinertia)?1:-1):-1)){n.type>t.type?(r=t,o=n):n.type!=t.type||n.id<t.id?(r=n,o=t):(o=n,r=t);var f,b,g=r==t;if(0==it){if(null==i){for(var w=null,M=(s.arbiters.length<_.arbiters.length?s:_).arbiters.head;null!=M;){var C=M.elt;if(C.id==r.id&&C.di==o.id){w=C;break}M=M.next}f=w}else f=i;var k,O,P,S,A,j,E,I=null==f,T=!1;if(I)null==Xi.zpp_pool?k=new Xi:(k=Xi.zpp_pool,Xi.zpp_pool=k.next,k.next=null);else if(null==f.fluidarb){f.cleared=!0;for(var N,L,V=f.b1.arbiters,D=null,F=V.head;null!=F;){if(F.elt==f){null==D?(L=(N=V.head).next,V.head=L,null==V.head&&(V.pushmod=!0)):(L=(N=D.next).next,null==(D.next=L)&&(V.pushmod=!0));var R=N;R.elt=null,R.next=tp.zpp_pool,tp.zpp_pool=R,V.modified=!0,V.length--,V.pushmod=!0;break}F=(D=F).next}for(var Z,B,G=f.b2.arbiters,q=null,U=G.head;null!=U;){if(U.elt==f){null==q?(B=(Z=G.head).next,G.head=B,null==G.head&&(G.pushmod=!0)):(B=(Z=q.next).next,null==(q.next=B)&&(G.pushmod=!0));var K=Z;K.elt=null,K.next=tp.zpp_pool,tp.zpp_pool=K,G.modified=!0,G.length--,G.pushmod=!0;break}U=(q=U).next}null!=f.pair&&(f.pair.arb=null,f.pair=null),f.active=!1,this.f_arbiters.modified=!0,null==Xi.zpp_pool?k=new Xi:(k=Xi.zpp_pool,Xi.zpp_pool=k.next,k.next=null),T=I=k.intchange=!0}else k=f.fluidarb;if(I||k.stamp!=this.stamp||p)if(k.stamp=this.stamp,Ep.flowCollide(r,o,k)){if(I?(O=r.id,Y=o.id,k.b1=n.body,k.ws1=n,k.b2=t.body,k.ws2=t,k.id=O,k.di=Y,Y=k.b1.arbiters,null==tp.zpp_pool?P=new tp:(P=tp.zpp_pool,tp.zpp_pool=P.next,P.next=null),P.elt=k,(P=P).next=Y.head,Y.head=P,Y.modified=!0,Y.length++,Y=k.b2.arbiters,null==tp.zpp_pool?S=new tp:(S=tp.zpp_pool,tp.zpp_pool=S.next,S.next=null),S.elt=k,(S=S).next=Y.head,Y.head=S,Y.modified=!0,Y.length++,k.active=!0,k.present=0,k.cleared=!1,k.sleeping=!1,k.fresh=!1,k.presentable=!1,k.nx=0,k.ny=1,k.dampx=0,k.dampy=0,k.adamp=0,Y=this.f_arbiters,null==pp.zpp_pool?A=new pp:(A=pp.zpp_pool,pp.zpp_pool=A.next,A.next=null),A.elt=k,(A=A).next=Y.head,Y.head=A,Y.modified=!0,Y.length++,k.fresh=!T):k.fresh=k.up_stamp<this.stamp-1||k.endGenerated==this.stamp&&p,k.up_stamp=k.stamp,k.fresh||0==(4&k.immState)){for(var W=!(k.immState=1),Y=k.ws1.id>k.ws2.id?k.ws2:k.ws1,T=k.ws1.id>k.ws2.id?k.ws1:k.ws2,J=this.mrca1;null!=J.head;){var X=J.head;J.head=X.next,X.elt=null,X.next=ip.zpp_pool,ip.zpp_pool=X,null==J.head&&(J.pushmod=!0),J.modified=!0,J.length--}J.pushmod=!0;for(var H,$,Q,nn,tn,en,pn=this.mrca2;null!=pn.head;){var ln=pn.head;pn.head=ln.next,ln.elt=null,ln.next=ip.zpp_pool,ip.zpp_pool=ln,null==pn.head&&(pn.pushmod=!0),pn.modified=!0,pn.length--}pn.pushmod=!0,null!=Y.cbSet&&($=this.mrca1,null==ip.zpp_pool?H=new ip:(H=ip.zpp_pool,ip.zpp_pool=H.next,H.next=null),H.elt=Y,(H=H).next=$.head,$.head=H,$.modified=!0,$.length++),null!=Y.body.cbSet&&(H=this.mrca1,$=Y.body,null==ip.zpp_pool?Q=new ip:(Q=ip.zpp_pool,ip.zpp_pool=Q.next,Q.next=null),Q.elt=$,(Q=Q).next=H.head,H.head=Q,H.modified=!0,H.length++),null!=T.cbSet&&(tn=this.mrca2,null==ip.zpp_pool?nn=new ip:(nn=ip.zpp_pool,ip.zpp_pool=nn.next,nn.next=null),nn.elt=T,(nn=nn).next=tn.head,tn.head=nn,tn.modified=!0,tn.length++),null!=T.body.cbSet&&(nn=this.mrca2,tn=T.body,null==ip.zpp_pool?en=new ip:(en=ip.zpp_pool,ip.zpp_pool=en.next,en.next=null),en.elt=tn,(en=en).next=nn.head,nn.head=en,nn.modified=!0,nn.length++);for(var rn,on,an,sn,_n=Y.body.compound,hn=T.body.compound;_n!=hn;)(null==_n?0:_n.depth)<(null==hn?0:hn.depth)?(null!=hn.cbSet&&(sn=this.mrca2,null==ip.zpp_pool?rn=new ip:(rn=ip.zpp_pool,ip.zpp_pool=rn.next,rn.next=null),rn.elt=hn,(on=rn).next=sn.head,sn.head=on,sn.modified=!0,sn.length++),hn=hn.compound):(null!=_n.cbSet&&(on=this.mrca1,null==ip.zpp_pool?an=new ip:(an=ip.zpp_pool,ip.zpp_pool=an.next,an.next=null),an.elt=_n,(sn=an).next=on.head,on.head=sn,on.modified=!0,on.length++),_n=_n.compound);for(var un,xn=this.mrca1.head;null!=xn;){for(var dn=xn.elt,yn=this.mrca2.head;null!=yn;){for(var zn,cn=yn.elt,vn=dn.cbSet,mn=cn.cbSet,fn=null,bn=(vn.cbpairs.length<mn.cbpairs.length?vn:mn).cbpairs.head;null!=bn;){var gn=bn.elt;if(gn.a==vn&&gn.b==mn||gn.a==mn&&gn.b==vn){fn=gn;break}bn=bn.next}if(null==fn&&(null==Wi.zpp_pool?zn=new Wi:(zn=Wi.zpp_pool,Wi.zpp_pool=zn.next,zn.next=null),zn.zip_listeners=!0,Ki.setlt(vn,mn)?(zn.a=vn,zn.b=mn):(zn.a=mn,zn.b=vn),fn=zn,vn.cbpairs.add(fn),mn!=vn&&mn.cbpairs.add(fn)),fn.zip_listeners&&(fn.zip_listeners=!1,fn.__validate()),null!=fn.listeners.head){for(var wn=null,Mn=null,Cn=this.prelisteners;null!=Cn.head;){var kn=Cn.head;Cn.head=kn.next,kn.elt=null,kn.next=ep.zpp_pool,ep.zpp_pool=kn,null==Cn.head&&(Cn.pushmod=!0),Cn.modified=!0,Cn.length--}Cn.pushmod=!0;for(var On,Pn=null,Sn=null,An=(vn.cbpairs.length<mn.cbpairs.length?vn:mn).cbpairs.head;null!=An;){var jn=An.elt;if(jn.a==vn&&jn.b==mn||jn.a==mn&&jn.b==vn){Sn=jn;break}An=An.next}null==Sn&&(null==Wi.zpp_pool?On=new Wi:(On=Wi.zpp_pool,Wi.zpp_pool=On.next,On.next=null),On.zip_listeners=!0,Ki.setlt(vn,mn)?(On.a=vn,On.b=mn):(On.a=mn,On.b=vn),Sn=On,vn.cbpairs.add(Sn),mn!=vn&&mn.cbpairs.add(Sn)),Sn.zip_listeners&&(Sn.zip_listeners=!1,Sn.__validate());for(var En=Sn.listeners.head;null!=En;){var In,Tn,Nn,Ln=En.elt;5==Ln.event&&0!=(4&Ln.itype)&&(In=this.prelisteners,null==ep.zpp_pool?Tn=new ep:(Tn=ep.zpp_pool,ep.zpp_pool=Tn.next,Tn.next=null),Tn.elt=Ln,Nn=Tn,null==Pn?(Nn.next=In.head,In.head=Nn):(Nn.next=Pn.next,Pn.next=Nn),In.pushmod=In.modified=!0,In.length++,Pn=Nn,W=!!W||!Ln.pure),En=En.next}if(null!=this.prelisteners.head){if(null==(wn=Qi.get(dn,cn))&&(Mn=np.get(dn,cn),this.add_callbackset(Mn)),null==wn||(wn.FLUIDstamp!=this.stamp||p)&&0==(4&wn.FLUIDstate)){if(null!=Mn&&(wn=Mn),null!=wn)for(var Vn=this.prelisteners.head;null!=Vn;)7==Vn.elt.itype&&(wn.COLLISIONstamp=this.stamp,wn.SENSORstamp=this.stamp),wn.FLUIDstamp=this.stamp,Vn=Vn.next;Mn=k.active;k.active=!0,this.precb.zpp_inner.pre_arbiter=k,this.precb.zpp_inner.set=wn;for(var Dn=this.prelisteners.head;null!=Dn;){var Fn=Dn.elt;this.precb.zpp_inner.listener=Fn;var Rn=this.precb.zpp_inner,Zn=wn.int1,Bn=wn.int2,Gn=Fn.options1,qn=Zn.cbTypes;!(!Gn.nonemptyintersection(qn,Gn.includes)||Gn.nonemptyintersection(qn,Gn.excludes))&&(qn=Fn.options2,Gn=Bn.cbTypes,!!qn.nonemptyintersection(Gn,qn.includes)&&!qn.nonemptyintersection(Gn,qn.excludes))?(Rn.int1=Zn,Rn.int2=Bn):(Rn.int1=Bn,Rn.int2=Zn),this.precb.zpp_inner.pre_swapped=dn!=this.precb.zpp_inner.int1;Fn=Fn.handlerp(this.precb);null!=Fn&&(null==Yi.PreFlag_ACCEPT&&(Yi.internal=!0,Yi.PreFlag_ACCEPT=new Ui,Yi.internal=!1),Fn=Fn==Yi.PreFlag_ACCEPT?5:(null==Yi.PreFlag_ACCEPT_ONCE&&(Yi.internal=!0,Yi.PreFlag_ACCEPT_ONCE=new Ui,Yi.internal=!1),Fn==Yi.PreFlag_ACCEPT_ONCE?1:(null==Yi.PreFlag_IGNORE&&(Yi.internal=!0,Yi.PreFlag_IGNORE=new Ui,Yi.internal=!1),Fn==Yi.PreFlag_IGNORE?6:2)),k.immState=Fn),Dn=Dn.next}if(k.active=Mn,null!=wn)for(var Un=this.prelisteners.head;null!=Un;)7==Un.elt.itype&&(wn.COLLISIONstate=k.immState,wn.SENSORstate=k.immState),wn.FLUIDstate=k.immState,Un=Un.next}else null==wn?0==(4&k.immState)&&(k.immState=1):k.immState=wn.FLUIDstate;yn=yn.next}else yn=yn.next}else yn=yn.next}xn=xn.next}W&&0==(4&k.immState)&&(2==k.b1.type&&((T=k.b1).world||(T.component.waket=this.stamp+(this.midstep?0:1),3==T.type&&(T.kinematicDelaySleep=!0),T.component.sleeping&&this.really_wake(T,!1))),2==k.b1.type&&((un=k.b2).world||(un.component.waket=this.stamp+(this.midstep?0:1),3==un.type&&(un.kinematicDelaySleep=!0),un.component.sleeping&&this.really_wake(un,!1))))}0!=(1&k.immState)&&(2==k.b1.type&&k.b1.component.sleeping&&((un=k.b1).world||(un.component.waket=this.stamp+(this.midstep?0:1),3==un.type&&(un.kinematicDelaySleep=!0),un.component.sleeping&&this.really_wake(un,!1))),2==k.b2.type&&k.b2.component.sleeping&&((j=k.b2).world||(j.component.waket=this.stamp+(this.midstep?0:1),3==j.type&&(j.kinematicDelaySleep=!0),j.component.sleeping&&this.really_wake(j,!1)))),k.sleeping&&(k.sleeping=!1,j=this.f_arbiters,null==pp.zpp_pool?E=new pp:(E=pp.zpp_pool,pp.zpp_pool=E.next,E.next=null),E.elt=k,(E=E).next=j.head,j.head=E,j.modified=!0,j.length++),a=k}else a=I?((Wn=k).next=Xi.zpp_pool,Xi.zpp_pool=Wn,null):k;else a=k}else if(1==it){var Kn,Wn=e?this.c_arbiters_true:this.c_arbiters_false;if(null==i){for(var Yn=null,Jn=(s.arbiters.length<_.arbiters.length?s:_).arbiters.head;null!=Jn;){var Xn=Jn.elt;if(Xn.id==r.id&&Xn.di==o.id){Yn=Xn;break}Jn=Jn.next}Kn=Yn}else Kn=i;var Hn,$n,Qn,nt,tt,et=null==Kn,it=!1;if(et)null==Hi.zpp_pool?Hn=new Hi:(Hn=Hi.zpp_pool,Hi.zpp_pool=Hn.next,Hn.next=null),Hn.stat=e;else if(null==Kn.colarb){Kn.cleared=!0;for(var pt,lt,rt=Kn.b1.arbiters,ot=null,at=rt.head;null!=at;){if(at.elt==Kn){null==ot?(lt=(pt=rt.head).next,rt.head=lt,null==rt.head&&(rt.pushmod=!0)):(lt=(pt=ot.next).next,null==(ot.next=lt)&&(rt.pushmod=!0));var st=pt;st.elt=null,st.next=tp.zpp_pool,tp.zpp_pool=st,rt.modified=!0,rt.length--,rt.pushmod=!0;break}at=(ot=at).next}for(var _t,ht,ut=Kn.b2.arbiters,xt=null,dt=ut.head;null!=dt;){if(dt.elt==Kn){null==xt?(ht=(_t=ut.head).next,ut.head=ht,null==ut.head&&(ut.pushmod=!0)):(ht=(_t=xt.next).next,null==(xt.next=ht)&&(ut.pushmod=!0));var yt=_t;yt.elt=null,yt.next=tp.zpp_pool,tp.zpp_pool=yt,ut.modified=!0,ut.length--,ut.pushmod=!0;break}dt=(xt=dt).next}null!=Kn.pair&&(Kn.pair.arb=null,Kn.pair=null),Kn.active=!1,this.f_arbiters.modified=!0,null==Hi.zpp_pool?Hn=new Hi:(Hn=Hi.zpp_pool,Hi.zpp_pool=Hn.next,Hn.next=null),Hn.intchange=!0,Hn.stat=e,it=et=!0}else g=r!=(Hn=Kn.colarb).s1,Hn.stat!=e&&(Hn.stat=e,Hn.sleeping||((e?this.c_arbiters_false:this.c_arbiters_true).remove(Hn),Wn.add(Hn)));if(et||Hn.stamp!=this.stamp||p)if(Hn.stamp=this.stamp,Ep.contactCollide(r,o,Hn,g)){if(et?(e=r.id,g=o.id,Hn.b1=n.body,Hn.ws1=n,Hn.b2=t.body,Hn.ws2=t,Hn.id=e,Hn.di=g,g=Hn.b1.arbiters,null==tp.zpp_pool?$n=new tp:($n=tp.zpp_pool,tp.zpp_pool=$n.next,$n.next=null),$n.elt=Hn,($n=$n).next=g.head,g.head=$n,g.modified=!0,g.length++,g=Hn.b2.arbiters,null==tp.zpp_pool?Qn=new tp:(Qn=tp.zpp_pool,tp.zpp_pool=Qn.next,Qn.next=null),Qn.elt=Hn,(Qn=Qn).next=g.head,g.head=Qn,g.modified=!0,g.length++,Hn.active=!0,Hn.present=0,Hn.cleared=!1,Hn.sleeping=!1,Hn.fresh=!1,Hn.presentable=!1,Hn.s1=n,Hn.s2=t,Hn.userdef_restitution||(Hn.s1.material.elasticity<=-1/0||Hn.s2.material.elasticity<=-1/0?Hn.restitution=0:Hn.s1.material.elasticity>=1/0||Hn.s2.material.elasticity>=1/0?Hn.restitution=1:Hn.restitution=(Hn.s1.material.elasticity+Hn.s2.material.elasticity)/2,Hn.restitution<0&&(Hn.restitution=0),1<Hn.restitution&&(Hn.restitution=1)),Hn.userdef_dyn_fric||(Hn.dyn_fric=Math.sqrt(Hn.s1.material.dynamicFriction*Hn.s2.material.dynamicFriction)),Hn.userdef_stat_fric||(Hn.stat_fric=Math.sqrt(Hn.s1.material.staticFriction*Hn.s2.material.staticFriction)),Hn.userdef_rfric||(Hn.rfric=Math.sqrt(Hn.s1.material.rollingFriction*Hn.s2.material.rollingFriction)),null==rp.zpp_pool?ct=new rp:(ct=rp.zpp_pool,rp.zpp_pool=ct.next,ct.next=null),ct.elt=Hn,(ct=ct).next=Wn.head,Wn.head=ct,Wn.modified=!0,Wn.length++,Hn.fresh=!it):Hn.fresh=Hn.up_stamp<this.stamp-1||Hn.endGenerated==this.stamp&&p,Hn.up_stamp=Hn.stamp,Hn.fresh||0==(4&Hn.immState)){for(var zt=!(Hn.immState=1),ct=Hn.ws1.id>Hn.ws2.id?Hn.ws2:Hn.ws1,it=Hn.ws1.id>Hn.ws2.id?Hn.ws1:Hn.ws2,vt=this.mrca1;null!=vt.head;){var mt=vt.head;vt.head=mt.next,mt.elt=null,mt.next=ip.zpp_pool,ip.zpp_pool=mt,null==vt.head&&(vt.pushmod=!0),vt.modified=!0,vt.length--}vt.pushmod=!0;for(var ft,bt,gt,wt,Mt,Ct,kt=this.mrca2;null!=kt.head;){var Ot=kt.head;kt.head=Ot.next,Ot.elt=null,Ot.next=ip.zpp_pool,ip.zpp_pool=Ot,null==kt.head&&(kt.pushmod=!0),kt.modified=!0,kt.length--}kt.pushmod=!0,null!=ct.cbSet&&(bt=this.mrca1,null==ip.zpp_pool?ft=new ip:(ft=ip.zpp_pool,ip.zpp_pool=ft.next,ft.next=null),ft.elt=ct,(ft=ft).next=bt.head,bt.head=ft,bt.modified=!0,bt.length++),null!=ct.body.cbSet&&(ft=this.mrca1,bt=ct.body,null==ip.zpp_pool?gt=new ip:(gt=ip.zpp_pool,ip.zpp_pool=gt.next,gt.next=null),gt.elt=bt,(gt=gt).next=ft.head,ft.head=gt,ft.modified=!0,ft.length++),null!=it.cbSet&&(Mt=this.mrca2,null==ip.zpp_pool?wt=new ip:(wt=ip.zpp_pool,ip.zpp_pool=wt.next,wt.next=null),wt.elt=it,(wt=wt).next=Mt.head,Mt.head=wt,Mt.modified=!0,Mt.length++),null!=it.body.cbSet&&(wt=this.mrca2,Mt=it.body,null==ip.zpp_pool?Ct=new ip:(Ct=ip.zpp_pool,ip.zpp_pool=Ct.next,Ct.next=null),Ct.elt=Mt,(Ct=Ct).next=wt.head,wt.head=Ct,wt.modified=!0,wt.length++);for(var Pt,St,At,jt,Et=ct.body.compound,It=it.body.compound;Et!=It;)(null==Et?0:Et.depth)<(null==It?0:It.depth)?(null!=It.cbSet&&(jt=this.mrca2,null==ip.zpp_pool?Pt=new ip:(Pt=ip.zpp_pool,ip.zpp_pool=Pt.next,Pt.next=null),Pt.elt=It,(St=Pt).next=jt.head,jt.head=St,jt.modified=!0,jt.length++),It=It.compound):(null!=Et.cbSet&&(St=this.mrca1,null==ip.zpp_pool?At=new ip:(At=ip.zpp_pool,ip.zpp_pool=At.next,At.next=null),At.elt=Et,(jt=At).next=St.head,St.head=jt,St.modified=!0,St.length++),Et=Et.compound);for(var Tt,Nt=this.mrca1.head;null!=Nt;){for(var Lt=Nt.elt,Vt=this.mrca2.head;null!=Vt;){for(var Dt,Ft=Vt.elt,Rt=Lt.cbSet,Zt=Ft.cbSet,Bt=null,Gt=(Rt.cbpairs.length<Zt.cbpairs.length?Rt:Zt).cbpairs.head;null!=Gt;){var qt=Gt.elt;if(qt.a==Rt&&qt.b==Zt||qt.a==Zt&&qt.b==Rt){Bt=qt;break}Gt=Gt.next}if(null==Bt&&(null==Wi.zpp_pool?Dt=new Wi:(Dt=Wi.zpp_pool,Wi.zpp_pool=Dt.next,Dt.next=null),Dt.zip_listeners=!0,Ki.setlt(Rt,Zt)?(Dt.a=Rt,Dt.b=Zt):(Dt.a=Zt,Dt.b=Rt),Bt=Dt,Rt.cbpairs.add(Bt),Zt!=Rt&&Zt.cbpairs.add(Bt)),Bt.zip_listeners&&(Bt.zip_listeners=!1,Bt.__validate()),null!=Bt.listeners.head){for(var Ut=null,Kt=null,Wt=this.prelisteners;null!=Wt.head;){var Yt=Wt.head;Wt.head=Yt.next,Yt.elt=null,Yt.next=ep.zpp_pool,ep.zpp_pool=Yt,null==Wt.head&&(Wt.pushmod=!0),Wt.modified=!0,Wt.length--}Wt.pushmod=!0;for(var Jt,Xt=null,Ht=null,$t=(Rt.cbpairs.length<Zt.cbpairs.length?Rt:Zt).cbpairs.head;null!=$t;){var Qt=$t.elt;if(Qt.a==Rt&&Qt.b==Zt||Qt.a==Zt&&Qt.b==Rt){Ht=Qt;break}$t=$t.next}null==Ht&&(null==Wi.zpp_pool?Jt=new Wi:(Jt=Wi.zpp_pool,Wi.zpp_pool=Jt.next,Jt.next=null),Jt.zip_listeners=!0,Ki.setlt(Rt,Zt)?(Jt.a=Rt,Jt.b=Zt):(Jt.a=Zt,Jt.b=Rt),Ht=Jt,Rt.cbpairs.add(Ht),Zt!=Rt&&Zt.cbpairs.add(Ht)),Ht.zip_listeners&&(Ht.zip_listeners=!1,Ht.__validate());for(var ne=Ht.listeners.head;null!=ne;){var te,ee,ie,pe=ne.elt;5==pe.event&&0!=(1&pe.itype)&&(te=this.prelisteners,null==ep.zpp_pool?ee=new ep:(ee=ep.zpp_pool,ep.zpp_pool=ee.next,ee.next=null),ee.elt=pe,ie=ee,null==Xt?(ie.next=te.head,te.head=ie):(ie.next=Xt.next,Xt.next=ie),te.pushmod=te.modified=!0,te.length++,Xt=ie,zt=!!zt||!pe.pure),ne=ne.next}if(null!=this.prelisteners.head){if(null==(Ut=Qi.get(Lt,Ft))&&(Kt=np.get(Lt,Ft),this.add_callbackset(Kt)),null==Ut||(Ut.COLLISIONstamp!=this.stamp||p)&&0==(4&Ut.COLLISIONstate)){if(null!=Kt&&(Ut=Kt),null!=Ut)for(var le=this.prelisteners.head;null!=le;)7==le.elt.itype?(Ut.COLLISIONstamp=this.stamp,Ut.SENSORstamp=this.stamp,Ut.FLUIDstamp=this.stamp):Ut.COLLISIONstamp=this.stamp,le=le.next;var Ft=Hn.active,re=Hn.active=!0,oe=null,ae=null,se=Hn.innards.next;Hn.hc2=!1;for(var _e=Hn.contacts.next;null!=_e;){var he,ue,xe,de,ye,ze,ce=_e;ce.stamp+jp.arbiterExpirationDelay<Hn.stamp?(ye=Hn.contacts,null==oe?(ue=(he=ye.next).next,ye.next=ue,null==ye.next&&(ye.pushmod=!0)):(ue=(he=oe.next).next,null==(oe.next=ue)&&(ye.pushmod=!0)),he._inuse=!1,ye.modified=!0,ye.length--,ye.pushmod=!0,_e=ue,ze=Hn.innards,null==ae?(de=(xe=ze.next).next,ze.next=de,null==ze.next&&(ze.pushmod=!0)):(de=(xe=ae.next).next,null==(ae.next=de)&&(ze.pushmod=!0)),xe._inuse=!1,ze.modified=!0,ze.length--,ze.pushmod=!0,se=de,ce.arbiter=null,ce.next=$i.zpp_pool,$i.zpp_pool=ce):(ye=ce.inner,ze=ce.active,ce.active=ce.stamp==Hn.stamp,ce.active&&(re?(re=!1,Hn.c1=ye,Hn.oc1=ce):(Hn.hc2=!0,Hn.c2=ye,Hn.oc2=ce)),ze!=ce.active&&(Hn.contacts.modified=!0),oe=_e,se=(ae=se).next,_e=_e.next)}Hn.hc2?(Hn.hpc2=!0,Hn.oc1.posOnly?(Kt=Hn.c1,Hn.c1=Hn.c2,Hn.c2=Kt,Kt=Hn.oc1,Hn.oc1=Hn.oc2,Hn.oc2=Kt,Hn.hc2=!1):Hn.oc2.posOnly&&(Hn.hc2=!1)):Hn.hpc2=!1,this.precb.zpp_inner.pre_arbiter=Hn,this.precb.zpp_inner.set=Ut;for(var ve=this.prelisteners.head;null!=ve;){var me=ve.elt;this.precb.zpp_inner.listener=me;var fe=this.precb.zpp_inner,be=Ut.int1,ge=Ut.int2,we=me.options1,Me=be.cbTypes;!(!we.nonemptyintersection(Me,we.includes)||we.nonemptyintersection(Me,we.excludes))&&(Me=me.options2,we=ge.cbTypes,!!Me.nonemptyintersection(we,Me.includes)&&!Me.nonemptyintersection(we,Me.excludes))?(fe.int1=be,fe.int2=ge):(fe.int1=ge,fe.int2=be),this.precb.zpp_inner.pre_swapped=Lt!=this.precb.zpp_inner.int1;me=me.handlerp(this.precb);null!=me&&(null==Yi.PreFlag_ACCEPT&&(Yi.internal=!0,Yi.PreFlag_ACCEPT=new Ui,Yi.internal=!1),me=me==Yi.PreFlag_ACCEPT?5:(null==Yi.PreFlag_ACCEPT_ONCE&&(Yi.internal=!0,Yi.PreFlag_ACCEPT_ONCE=new Ui,Yi.internal=!1),me==Yi.PreFlag_ACCEPT_ONCE?1:(null==Yi.PreFlag_IGNORE&&(Yi.internal=!0,Yi.PreFlag_IGNORE=new Ui,Yi.internal=!1),me==Yi.PreFlag_IGNORE?6:2)),Hn.immState=me),ve=ve.next}if(Hn.active=Ft,null!=Ut)for(var Ce=this.prelisteners.head;null!=Ce;)7==Ce.elt.itype?(Ut.COLLISIONstate=Hn.immState,Ut.SENSORstate=Hn.immState,Ut.FLUIDstate=Hn.immState):Ut.COLLISIONstate=Hn.immState,Ce=Ce.next}else null==Ut?0==(4&Hn.immState)&&(Hn.immState=1):Hn.immState=Ut.COLLISIONstate;Vt=Vt.next}else Vt=Vt.next}else Vt=Vt.next}Nt=Nt.next}zt&&0==(4&Hn.immState)&&(2==Hn.b1.type&&((Tt=Hn.b1).world||(Tt.component.waket=this.stamp+(this.midstep?0:1),3==Tt.type&&(Tt.kinematicDelaySleep=!0),Tt.component.sleeping&&this.really_wake(Tt,!1))),2==Hn.b1.type&&((Tt=Hn.b2).world||(Tt.component.waket=this.stamp+(this.midstep?0:1),3==Tt.type&&(Tt.kinematicDelaySleep=!0),Tt.component.sleeping&&this.really_wake(Tt,!1))))}0!=(1&Hn.immState)&&(2==Hn.b1.type&&Hn.b1.component.sleeping&&((nt=Hn.b1).world||(nt.component.waket=this.stamp+(this.midstep?0:1),3==nt.type&&(nt.kinematicDelaySleep=!0),nt.component.sleeping&&this.really_wake(nt,!1))),2==Hn.b2.type&&Hn.b2.component.sleeping&&((nt=Hn.b2).world||(nt.component.waket=this.stamp+(this.midstep?0:1),3==nt.type&&(nt.kinematicDelaySleep=!0),nt.component.sleeping&&this.really_wake(nt,!1)))),Hn.sleeping&&(Hn.sleeping=!1,null==rp.zpp_pool?tt=new rp:(tt=rp.zpp_pool,rp.zpp_pool=tt.next,tt.next=null),tt.elt=Hn,(tt=tt).next=Wn.head,Wn.head=tt,Wn.modified=!0,Wn.length++),a=Hn}else a=et?((Te=Hn).userdef_dyn_fric=!1,Te.userdef_stat_fric=!1,Te.userdef_restitution=!1,Te.userdef_rfric=!1,Te.__ref_edge1=Te.__ref_edge2=null,Te.next=Hi.zpp_pool,Hi.zpp_pool=Te,null):Hn;else a=Hn}else{if(null==i){for(var ke=null,Oe=(s.arbiters.length<_.arbiters.length?s:_).arbiters.head;null!=Oe;){var Pe=Oe.elt;if(Pe.id==r.id&&Pe.di==o.id){ke=Pe;break}Oe=Oe.next}b=ke}else b=i;var Se,Ae,je,Ee,Ie,et=null==b,Te=!1;if(et)null==Ji.zpp_pool?Se=new Ji:(Se=Ji.zpp_pool,Ji.zpp_pool=Se.next,Se.next=null);else if(null==b.sensorarb){b.cleared=!0;for(var Ne,Le,Ve=b.b1.arbiters,De=null,Fe=Ve.head;null!=Fe;){if(Fe.elt==b){null==De?(Le=(Ne=Ve.head).next,Ve.head=Le,null==Ve.head&&(Ve.pushmod=!0)):(Le=(Ne=De.next).next,null==(De.next=Le)&&(Ve.pushmod=!0));var Re=Ne;Re.elt=null,Re.next=tp.zpp_pool,tp.zpp_pool=Re,Ve.modified=!0,Ve.length--,Ve.pushmod=!0;break}Fe=(De=Fe).next}for(var Ze,Be,Ge=b.b2.arbiters,qe=null,Ue=Ge.head;null!=Ue;){if(Ue.elt==b){null==qe?(Be=(Ze=Ge.head).next,Ge.head=Be,null==Ge.head&&(Ge.pushmod=!0)):(Be=(Ze=qe.next).next,null==(qe.next=Be)&&(Ge.pushmod=!0));var Ke=Ze;Ke.elt=null,Ke.next=tp.zpp_pool,tp.zpp_pool=Ke,Ge.modified=!0,Ge.length--,Ge.pushmod=!0;break}Ue=(qe=Ue).next}null!=b.pair&&(b.pair.arb=null,b.pair=null),b.active=!1,this.f_arbiters.modified=!0,null==Ji.zpp_pool?Se=new Ji:(Se=Ji.zpp_pool,Ji.zpp_pool=Se.next,Se.next=null),Te=et=Se.intchange=!0}else Se=b.sensorarb;if(et||Se.stamp!=this.stamp||p)if(Se.stamp=this.stamp,Ep.testCollide(r,o)){if(et?(i=r.id,Ye=o.id,Se.b1=n.body,Se.ws1=n,Se.b2=t.body,Se.ws2=t,Se.id=i,Se.di=Ye,Ye=Se.b1.arbiters,null==tp.zpp_pool?Ae=new tp:(Ae=tp.zpp_pool,tp.zpp_pool=Ae.next,Ae.next=null),Ae.elt=Se,(Ae=Ae).next=Ye.head,Ye.head=Ae,Ye.modified=!0,Ye.length++,Ye=Se.b2.arbiters,null==tp.zpp_pool?je=new tp:(je=tp.zpp_pool,tp.zpp_pool=je.next,je.next=null),je.elt=Se,(je=je).next=Ye.head,Ye.head=je,Ye.modified=!0,Ye.length++,Se.active=!0,Se.present=0,Se.cleared=!1,Se.sleeping=!1,Se.fresh=!1,Se.presentable=!1,Ye=this.s_arbiters,null==lp.zpp_pool?Ee=new lp:(Ee=lp.zpp_pool,lp.zpp_pool=Ee.next,Ee.next=null),Ee.elt=Se,(Ee=Ee).next=Ye.head,Ye.head=Ee,Ye.modified=!0,Ye.length++,Se.fresh=!Te):Se.fresh=Se.up_stamp<this.stamp-1||Se.endGenerated==this.stamp&&p,Se.up_stamp=Se.stamp,Se.fresh||0==(4&Se.immState)){for(var We=!(Se.immState=1),Ye=Se.ws1.id>Se.ws2.id?Se.ws2:Se.ws1,Te=Se.ws1.id>Se.ws2.id?Se.ws1:Se.ws2,Je=this.mrca1;null!=Je.head;){var Xe=Je.head;Je.head=Xe.next,Xe.elt=null,Xe.next=ip.zpp_pool,ip.zpp_pool=Xe,null==Je.head&&(Je.pushmod=!0),Je.modified=!0,Je.length--}Je.pushmod=!0;for(var He,$e,Qe,ni,ti,ei,ii=this.mrca2;null!=ii.head;){var pi=ii.head;ii.head=pi.next,pi.elt=null,pi.next=ip.zpp_pool,ip.zpp_pool=pi,null==ii.head&&(ii.pushmod=!0),ii.modified=!0,ii.length--}ii.pushmod=!0,null!=Ye.cbSet&&($e=this.mrca1,null==ip.zpp_pool?He=new ip:(He=ip.zpp_pool,ip.zpp_pool=He.next,He.next=null),He.elt=Ye,(He=He).next=$e.head,$e.head=He,$e.modified=!0,$e.length++),null!=Ye.body.cbSet&&(He=this.mrca1,$e=Ye.body,null==ip.zpp_pool?Qe=new ip:(Qe=ip.zpp_pool,ip.zpp_pool=Qe.next,Qe.next=null),Qe.elt=$e,(Qe=Qe).next=He.head,He.head=Qe,He.modified=!0,He.length++),null!=Te.cbSet&&(ti=this.mrca2,null==ip.zpp_pool?ni=new ip:(ni=ip.zpp_pool,ip.zpp_pool=ni.next,ni.next=null),ni.elt=Te,(ni=ni).next=ti.head,ti.head=ni,ti.modified=!0,ti.length++),null!=Te.body.cbSet&&(ni=this.mrca2,ti=Te.body,null==ip.zpp_pool?ei=new ip:(ei=ip.zpp_pool,ip.zpp_pool=ei.next,ei.next=null),ei.elt=ti,(ei=ei).next=ni.head,ni.head=ei,ni.modified=!0,ni.length++);for(var li,ri,oi,ai,si=Ye.body.compound,_i=Te.body.compound;si!=_i;)(null==si?0:si.depth)<(null==_i?0:_i.depth)?(null!=_i.cbSet&&(ai=this.mrca2,null==ip.zpp_pool?li=new ip:(li=ip.zpp_pool,ip.zpp_pool=li.next,li.next=null),li.elt=_i,(ri=li).next=ai.head,ai.head=ri,ai.modified=!0,ai.length++),_i=_i.compound):(null!=si.cbSet&&(ri=this.mrca1,null==ip.zpp_pool?oi=new ip:(oi=ip.zpp_pool,ip.zpp_pool=oi.next,oi.next=null),oi.elt=si,(ai=oi).next=ri.head,ri.head=ai,ri.modified=!0,ri.length++),si=si.compound);for(var hi,ui=this.mrca1.head;null!=ui;){for(var xi=ui.elt,di=this.mrca2.head;null!=di;){for(var yi,zi=di.elt,ci=xi.cbSet,vi=zi.cbSet,mi=null,fi=(ci.cbpairs.length<vi.cbpairs.length?ci:vi).cbpairs.head;null!=fi;){var bi=fi.elt;if(bi.a==ci&&bi.b==vi||bi.a==vi&&bi.b==ci){mi=bi;break}fi=fi.next}if(null==mi&&(null==Wi.zpp_pool?yi=new Wi:(yi=Wi.zpp_pool,Wi.zpp_pool=yi.next,yi.next=null),yi.zip_listeners=!0,Ki.setlt(ci,vi)?(yi.a=ci,yi.b=vi):(yi.a=vi,yi.b=ci),mi=yi,ci.cbpairs.add(mi),vi!=ci&&vi.cbpairs.add(mi)),mi.zip_listeners&&(mi.zip_listeners=!1,mi.__validate()),null!=mi.listeners.head){for(var gi=null,wi=null,Mi=this.prelisteners;null!=Mi.head;){var Ci=Mi.head;Mi.head=Ci.next,Ci.elt=null,Ci.next=ep.zpp_pool,ep.zpp_pool=Ci,null==Mi.head&&(Mi.pushmod=!0),Mi.modified=!0,Mi.length--}Mi.pushmod=!0;for(var ki,Oi=null,Pi=null,Si=(ci.cbpairs.length<vi.cbpairs.length?ci:vi).cbpairs.head;null!=Si;){var Ai=Si.elt;if(Ai.a==ci&&Ai.b==vi||Ai.a==vi&&Ai.b==ci){Pi=Ai;break}Si=Si.next}null==Pi&&(null==Wi.zpp_pool?ki=new Wi:(ki=Wi.zpp_pool,Wi.zpp_pool=ki.next,ki.next=null),ki.zip_listeners=!0,Ki.setlt(ci,vi)?(ki.a=ci,ki.b=vi):(ki.a=vi,ki.b=ci),Pi=ki,ci.cbpairs.add(Pi),vi!=ci&&vi.cbpairs.add(Pi)),Pi.zip_listeners&&(Pi.zip_listeners=!1,Pi.__validate());for(var ji=Pi.listeners.head;null!=ji;){var Ei,Ii,Ti,Ni=ji.elt;5==Ni.event&&0!=(2&Ni.itype)&&(Ei=this.prelisteners,null==ep.zpp_pool?Ii=new ep:(Ii=ep.zpp_pool,ep.zpp_pool=Ii.next,Ii.next=null),Ii.elt=Ni,Ti=Ii,null==Oi?(Ti.next=Ei.head,Ei.head=Ti):(Ti.next=Oi.next,Oi.next=Ti),Ei.pushmod=Ei.modified=!0,Ei.length++,Oi=Ti,We=!!We||!Ni.pure),ji=ji.next}if(null!=this.prelisteners.head){if(null==(gi=Qi.get(xi,zi))&&(wi=np.get(xi,zi),this.add_callbackset(wi)),null==gi||(gi.SENSORstamp!=this.stamp||p)&&0==(4&gi.SENSORstate)){if(null!=wi&&(gi=wi),null!=gi)for(var Li=this.prelisteners.head;null!=Li;)7==Li.elt.itype?(gi.COLLISIONstamp=this.stamp,gi.SENSORstamp=this.stamp,gi.FLUIDstamp=this.stamp):gi.SENSORstamp=this.stamp,Li=Li.next;wi=Se.active;Se.active=!0,this.precb.zpp_inner.pre_arbiter=Se,this.precb.zpp_inner.set=gi;for(var Vi=this.prelisteners.head;null!=Vi;){var Di=Vi.elt;this.precb.zpp_inner.listener=Di;var Fi=this.precb.zpp_inner,Ri=gi.int1,Zi=gi.int2,Bi=Di.options1,Gi=Ri.cbTypes;!(!Bi.nonemptyintersection(Gi,Bi.includes)||Bi.nonemptyintersection(Gi,Bi.excludes))&&(Gi=Di.options2,Bi=Zi.cbTypes,!!Gi.nonemptyintersection(Bi,Gi.includes)&&!Gi.nonemptyintersection(Bi,Gi.excludes))?(Fi.int1=Ri,Fi.int2=Zi):(Fi.int1=Zi,Fi.int2=Ri),this.precb.zpp_inner.pre_swapped=xi!=this.precb.zpp_inner.int1;Di=Di.handlerp(this.precb);null!=Di&&(null==Yi.PreFlag_ACCEPT&&(Yi.internal=!0,Yi.PreFlag_ACCEPT=new Ui,Yi.internal=!1),Di=Di==Yi.PreFlag_ACCEPT?5:(null==Yi.PreFlag_ACCEPT_ONCE&&(Yi.internal=!0,Yi.PreFlag_ACCEPT_ONCE=new Ui,Yi.internal=!1),Di==Yi.PreFlag_ACCEPT_ONCE?1:(null==Yi.PreFlag_IGNORE&&(Yi.internal=!0,Yi.PreFlag_IGNORE=new Ui,Yi.internal=!1),Di==Yi.PreFlag_IGNORE?6:2)),Se.immState=Di),Vi=Vi.next}if(Se.active=wi,null!=gi)for(var qi=this.prelisteners.head;null!=qi;)7==qi.elt.itype?(gi.COLLISIONstate=Se.immState,gi.SENSORstate=Se.immState,gi.FLUIDstate=Se.immState):gi.SENSORstate=Se.immState,qi=qi.next}else null==gi?0==(4&Se.immState)&&(Se.immState=1):Se.immState=gi.SENSORstate;di=di.next}else di=di.next}else di=di.next}ui=ui.next}We&&0==(4&Se.immState)&&(1!=Se.b1.type&&((Te=Se.b1).world||(Te.component.waket=this.stamp+(this.midstep?0:1),3==Te.type&&(Te.kinematicDelaySleep=!0),Te.component.sleeping&&this.really_wake(Te,!1))),1!=Se.b2.type&&((hi=Se.b2).world||(hi.component.waket=this.stamp+(this.midstep?0:1),3==hi.type&&(hi.kinematicDelaySleep=!0),hi.component.sleeping&&this.really_wake(hi,!1))))}Se.sleeping&&(Se.sleeping=!1,hi=this.s_arbiters,null==lp.zpp_pool?Ie=new lp:(Ie=lp.zpp_pool,lp.zpp_pool=Ie.next,Ie.next=null),Ie.elt=Se,(Ie=Ie).next=hi.head,hi.head=Ie,hi.modified=!0,hi.length++),a=Se}else a=et?((et=Se).next=Ji.zpp_pool,Ji.zpp_pool=et,null):Se;else a=Se}}return a},ie.prototype.mrca1=null,ie.prototype.mrca2=null,ie.prototype.MRCA_chains=function(n,t){for(var e=this.mrca1;null!=e.head;){var i=e.head;e.head=i.next,i.elt=null,i.next=ip.zpp_pool,ip.zpp_pool=i,null==e.head&&(e.pushmod=!0),e.modified=!0,e.length--}e.pushmod=!0;for(var p,l,r,o,a,s,_=this.mrca2;null!=_.head;){var h=_.head;_.head=h.next,h.elt=null,h.next=ip.zpp_pool,ip.zpp_pool=h,null==_.head&&(_.pushmod=!0),_.modified=!0,_.length--}_.pushmod=!0,null!=n.cbSet&&(l=this.mrca1,null==ip.zpp_pool?p=new ip:(p=ip.zpp_pool,ip.zpp_pool=p.next,p.next=null),p.elt=n,(p=p).next=l.head,l.head=p,l.modified=!0,l.length++),null!=n.body.cbSet&&(p=this.mrca1,l=n.body,null==ip.zpp_pool?r=new ip:(r=ip.zpp_pool,ip.zpp_pool=r.next,r.next=null),r.elt=l,(r=r).next=p.head,p.head=r,p.modified=!0,p.length++),null!=t.cbSet&&(a=this.mrca2,null==ip.zpp_pool?o=new ip:(o=ip.zpp_pool,ip.zpp_pool=o.next,o.next=null),o.elt=t,(o=o).next=a.head,a.head=o,a.modified=!0,a.length++),null!=t.body.cbSet&&(o=this.mrca2,a=t.body,null==ip.zpp_pool?s=new ip:(s=ip.zpp_pool,ip.zpp_pool=s.next,s.next=null),s.elt=a,(s=s).next=o.head,o.head=s,o.modified=!0,o.length++);for(var u,x,d,y,z=n.body.compound,c=t.body.compound;z!=c;)(null==z?0:z.depth)<(null==c?0:c.depth)?(null!=c.cbSet&&(y=this.mrca2,null==ip.zpp_pool?u=new ip:(u=ip.zpp_pool,ip.zpp_pool=u.next,u.next=null),u.elt=c,(x=u).next=y.head,y.head=x,y.modified=!0,y.length++),c=c.compound):(null!=z.cbSet&&(x=this.mrca1,null==ip.zpp_pool?d=new ip:(d=ip.zpp_pool,ip.zpp_pool=d.next,d.next=null),d.elt=z,(y=d).next=x.head,x.head=y,x.modified=!0,x.length++),z=z.compound)},ie.prototype.inlined_MRCA_chains=function(n,t){for(var e=this.mrca1;null!=e.head;){var i=e.head;e.head=i.next,i.elt=null,i.next=ip.zpp_pool,ip.zpp_pool=i,null==e.head&&(e.pushmod=!0),e.modified=!0,e.length--}e.pushmod=!0;for(var p,l,r,o,a,s,_=this.mrca2;null!=_.head;){var h=_.head;_.head=h.next,h.elt=null,h.next=ip.zpp_pool,ip.zpp_pool=h,null==_.head&&(_.pushmod=!0),_.modified=!0,_.length--}_.pushmod=!0,null!=n.cbSet&&(l=this.mrca1,null==ip.zpp_pool?p=new ip:(p=ip.zpp_pool,ip.zpp_pool=p.next,p.next=null),p.elt=n,(p=p).next=l.head,l.head=p,l.modified=!0,l.length++),null!=n.body.cbSet&&(p=this.mrca1,l=n.body,null==ip.zpp_pool?r=new ip:(r=ip.zpp_pool,ip.zpp_pool=r.next,r.next=null),r.elt=l,(r=r).next=p.head,p.head=r,p.modified=!0,p.length++),null!=t.cbSet&&(a=this.mrca2,null==ip.zpp_pool?o=new ip:(o=ip.zpp_pool,ip.zpp_pool=o.next,o.next=null),o.elt=t,(o=o).next=a.head,a.head=o,a.modified=!0,a.length++),null!=t.body.cbSet&&(o=this.mrca2,a=t.body,null==ip.zpp_pool?s=new ip:(s=ip.zpp_pool,ip.zpp_pool=s.next,s.next=null),s.elt=a,(s=s).next=o.head,o.head=s,o.modified=!0,o.length++);for(var u,x,d,y,z=n.body.compound,c=t.body.compound;z!=c;)(null==z?0:z.depth)<(null==c?0:c.depth)?(null!=c.cbSet&&(y=this.mrca2,null==ip.zpp_pool?u=new ip:(u=ip.zpp_pool,ip.zpp_pool=u.next,u.next=null),u.elt=c,(x=u).next=y.head,y.head=x,y.modified=!0,y.length++),c=c.compound):(null!=z.cbSet&&(x=this.mrca1,null==ip.zpp_pool?d=new ip:(d=ip.zpp_pool,ip.zpp_pool=d.next,d.next=null),d.elt=z,(y=d).next=x.head,x.head=y,x.modified=!0,x.length++),z=z.compound)},ie.prototype.__class__=ie;var pe=zpp_nape.space.ZPP_SweepData=function(){this.aabb=null,this.shape=null,this.prev=null,this.next=null};pe.__name__=["zpp_nape","space","ZPP_SweepData"],pe.prototype.next=null,pe.prototype.prev=null,pe.prototype.shape=null,pe.prototype.aabb=null,pe.prototype.free=function(){this.prev=null,this.shape=null,this.aabb=null},pe.prototype.alloc=function(){},pe.prototype.gt=function(n){return this.aabb.minx>n.aabb.minx},pe.prototype.__class__=pe;var le=zpp_nape.space.ZPP_SweepPhase=function(n){this.failed=null,this.list=null,Yt.call(this),this.space=n,this.is_sweep=!0,this.sweep=this};le.__name__=["zpp_nape","space","ZPP_SweepPhase"],le.__super__=Yt,le.prototype=Object.create(Yt.prototype),le.prototype.list=null,le.prototype.__insert=function(n){var t;null==pe.zpp_pool?t=new pe:(t=pe.zpp_pool,pe.zpp_pool=t.next,t.next=null),(n.sweep=t).shape=n,t.aabb=n.aabb,t.next=this.list,null!=this.list&&(this.list.prev=t),this.list=t},le.prototype.__remove=function(n){var t=n.sweep;null==t.prev?this.list=t.next:t.prev.next=t.next,null!=t.next&&(t.next.prev=t.prev),n.sweep=null,t.prev=null,t.shape=null,t.aabb=null,t.next=pe.zpp_pool,pe.zpp_pool=t},le.prototype.__sync=function(n){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var t=n.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var e=t.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0;var i=e.localCOMy=0,p=e.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;e.localCOMx+=(r.x+o.x)*a,e.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=e.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*_,e.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);_=h.y*s.x-h.x*s.y;e.localCOMx+=(s.x+h.x)*_,e.localCOMy+=(s.y+h.y)*_;h=i=1/(3*i);e.localCOMx*=h,e.localCOMy*=h}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}_=t.body;_.zip_axis&&(_.zip_axis=!1,_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}h=t.radius,_=t.radius;t.aabb.minx=t.worldCOMx-h,t.aabb.miny=t.worldCOMy-_,t.aabb.maxx=t.worldCOMx+h,t.aabb.maxy=t.worldCOMy+_}else{var u=n.polygon;if(u.zip_gverts&&null!=u.body){u.zip_gverts=!1,u.validate_lverts();var x=u.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot));for(var d=u.lverts.next,y=u.gverts.next;null!=y;){var z=y,c=d,d=d.next;z.x=u.body.posx+(u.body.axisy*c.x-u.body.axisx*c.y),z.y=u.body.posy+(c.x*u.body.axisx+c.y*u.body.axisy),y=y.next}}x=u.gverts.next;u.aabb.minx=x.x,u.aabb.miny=x.y,u.aabb.maxx=x.x,u.aabb.maxy=x.y;for(var v=u.gverts.next.next;null!=v;){var m=v;m.x<u.aabb.minx&&(u.aabb.minx=m.x),m.x>u.aabb.maxx&&(u.aabb.maxx=m.x),m.y<u.aabb.miny&&(u.aabb.miny=m.y),m.y>u.aabb.maxy&&(u.aabb.maxy=m.y),v=v.next}}},le.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.list)for(var n=this.list.next;null!=n;){var t=n.next,e=n.prev;if(n.aabb.minx>e.aabb.minx)n=t;else{for(;null!=e.prev&&e.prev.aabb.minx>n.aabb.minx;)e=e.prev;var i=n.prev;i.next=n.next,null!=n.next&&(n.next.prev=i),null==e.prev?(n.prev=null,((this.list=n).next=e).prev=n):(n.prev=e.prev,((e.prev=n).prev.next=n).next=e),n=t}}},le.prototype.sync_broadphase_fast=function(){for(var n=this.list.next;null!=n;){var t=n.next,e=n.prev;if(n.aabb.minx>e.aabb.minx)n=t;else{for(;null!=e.prev&&e.prev.aabb.minx>n.aabb.minx;)e=e.prev;var i=n.prev;i.next=n.next,null!=n.next&&(n.next.prev=i),null==e.prev?(n.prev=null,((this.list=n).next=e).prev=n):(n.prev=e.prev,((e.prev=n).prev.next=n).next=e),n=t}}},le.prototype.broadphase=function(n,t){if(null!=this.list){for(var e=this.list.next;null!=e;){var i=e.next,p=e.prev;if(e.aabb.minx>p.aabb.minx)e=i;else{for(;null!=p.prev&&p.prev.aabb.minx>e.aabb.minx;)p=p.prev;var l=e.prev;l.next=e.next,null!=e.next&&(e.next.prev=l),null==p.prev?(e.prev=null,((this.list=e).next=p).prev=e):(e.prev=p.prev,((p.prev=e).prev.next=e).next=p),e=i}}for(var r=this.list;null!=r;){for(var o=r.next,a=r.shape,s=a.body,_=r.aabb.maxx;null!=o&&!(o.aabb.minx>_);){var h,u,x=o.shape,d=x.body;o=(d!=s&&(1==s.type&&1==d.type||s.component.sleeping&&d.component.sleeping||(h=a.aabb,(u=x.aabb).miny>h.maxy||h.miny>u.maxy||(t?n.narrowPhase(a,x,2!=s.type||2!=d.type,null,!1):n.continuousEvent(a,x,2!=s.type||2!=d.type,null,!1)))),o.next)}r=r.next}}},le.prototype.clear=function(){for(;null!=this.list;)this.list.shape.removedFromSpace(),this.__remove(this.list.shape)},le.prototype.shapesUnderPoint=function(n,t,e,i){var p;this.sync_broadphase(),null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t;for(var l,r,o=p,a=null==i?new zn:i,s=this.list;null!=s&&s.aabb.minx>n;)s=s.next;for(;null!=s&&s.aabb.minx<=n;)s.aabb.maxx>=n&&s.aabb.miny<=t&&s.aabb.maxy>=t&&(l=s.shape,(null==e||0!=((r=l.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&r.collisionGroup))&&(0==l.type?Ep.circleContains(l.circle,o)&&a.push(l.outer):Ep.polyContains(l.polygon,o)&&a.push(l.outer))),s=s.next;return null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ip.zpp_pool,Ip.zpp_pool=o,a},le.prototype.bodiesUnderPoint=function(n,t,e,i){var p;this.sync_broadphase(),null==Ip.zpp_pool?p=new Ip:(p=Ip.zpp_pool,Ip.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=t;for(var l,r,o,a=p,s=null==i?new nn:i,_=this.list;null!=_&&_.aabb.minx>n;)_=_.next;for(;null!=_&&_.aabb.minx<=n;)_.aabb.maxx>=n&&_.aabb.miny<=t&&_.aabb.maxy>=t&&(r=(l=_.shape).body.outer,s.has(r)||(null==e||0!=((o=l.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup))&&(0==l.type?Ep.circleContains(l.circle,a)&&s.push(r):Ep.polyContains(l.polygon,a)&&s.push(r))),_=_.next;return null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ip.zpp_pool,Ip.zpp_pool=a,s},le.prototype.shapesInAABB=function(n,t,e,i,p){this.sync_broadphase(),this.updateAABBShape(n);for(var l=this.aabbShape.zpp_inner.aabb,r=null==p?new zn:p,o=this.list;null!=o&&o.aabb.maxx<l.minx;)o=o.next;for(;null!=o&&o.aabb.minx<=l.maxx;){var a,s,_=o.shape;(null==i||0!=((a=_.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&a.collisionGroup))&&(t?e?Ep.containTest(this.aabbShape.zpp_inner,_)&&r.push(_.outer):(a=o.aabb).minx>=l.minx&&a.miny>=l.miny&&a.maxx<=l.maxx&&a.maxy<=l.maxy?r.push(_.outer):(a=o.aabb,l.miny<=a.maxy&&a.miny<=l.maxy&&l.minx<=a.maxx&&a.minx<=l.maxx&&Ep.testCollide_safe(_,this.aabbShape.zpp_inner)&&r.push(_.outer)):(e?(s=o.aabb).minx>=l.minx&&s.miny>=l.miny&&s.maxx<=l.maxx&&s.maxy<=l.maxy:(s=o.aabb,l.miny<=s.maxy&&s.miny<=l.maxy&&l.minx<=s.maxx&&s.minx<=l.maxx))&&r.push(_.outer)),o=o.next}return r},le.prototype.failed=null,le.prototype.bodiesInAABB=function(n,t,e,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new nn:p;null==this.failed&&(this.failed=new nn);for(var o=this.list;null!=o&&o.aabb.maxx<l.minx;)o=o.next;for(;null!=o&&o.aabb.minx<=l.maxx;){var a,s=o.shape,_=s.body.outer,h=o.aabb;l.miny<=h.maxy&&h.miny<=l.maxy&&l.minx<=h.maxx&&h.minx<=l.maxx&&(null==i||0!=((h=s.filter).collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup))&&(t?e?this.failed.has(_)||(a=Ep.containTest(this.aabbShape.zpp_inner,s),!r.has(_)&&a?r.push(_):a||(r.remove(_),this.failed.push(_))):!r.has(_)&&Ep.testCollide_safe(s,this.aabbShape.zpp_inner)&&r.push(_):e?this.failed.has(_)||(a=(a=s.aabb).minx>=l.minx&&a.miny>=l.miny&&a.maxx<=l.maxx&&a.maxy<=l.maxy,!r.has(_)&&a?r.push(_):a||(r.remove(_),this.failed.push(_))):!r.has(_)&&((s=s.aabb).minx>=l.minx&&s.miny>=l.miny&&s.maxx<=l.maxx&&s.maxy<=l.maxy)&&r.push(_)),o=o.next}return this.failed.clear(),r},le.prototype.shapesInCircle=function(n,t,e,i,p,l){this.sync_broadphase(),this.updateCircShape(n,t,e);for(var r=this.circShape.zpp_inner.aabb,o=null==l?new zn:l,a=this.list;null!=a&&a.aabb.maxx<r.minx;)a=a.next;for(;null!=a&&a.aabb.minx<=r.maxx;){var s,_=a.aabb;r.miny<=_.maxy&&_.miny<=r.maxy&&r.minx<=_.maxx&&_.minx<=r.maxx&&(s=a.shape,(null==p||0!=((_=s.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&_.collisionGroup))&&(i?Ep.containTest(this.circShape.zpp_inner,s)&&o.push(s.outer):Ep.testCollide_safe(s,this.circShape.zpp_inner)&&o.push(s.outer))),a=a.next}return o},le.prototype.bodiesInCircle=function(n,t,e,i,p,l){this.sync_broadphase(),this.updateCircShape(n,t,e);var r=this.circShape.zpp_inner.aabb,o=null==l?new nn:l;null==this.failed&&(this.failed=new nn);for(var a=this.list;null!=a&&a.aabb.maxx<r.minx;)a=a.next;for(;null!=a&&a.aabb.minx<=r.maxx;){var s,_,h=a.aabb;r.miny<=h.maxy&&h.miny<=r.maxy&&r.minx<=h.maxx&&h.minx<=r.maxx&&(h=(s=a.shape).body.outer,(null==p||0!=((_=s.filter).collisionMask&p.collisionGroup)&&0!=(p.collisionMask&_.collisionGroup))&&(i?this.failed.has(h)||(_=Ep.containTest(this.circShape.zpp_inner,s),!o.has(h)&&_?o.push(h):_||(o.remove(h),this.failed.push(h))):!o.has(h)&&Ep.testCollide_safe(s,this.circShape.zpp_inner)&&o.push(h))),a=a.next}return this.failed.clear(),o},le.prototype.shapesInShape=function(n,t,e,i){this.sync_broadphase(),this.validateShape(n);for(var p=n.aabb,l=null==i?new zn:i,r=this.list;null!=r&&r.aabb.maxx<p.minx;)r=r.next;for(;null!=r&&r.aabb.minx<=p.maxx;){var o,a=r.aabb;p.miny<=a.maxy&&a.miny<=p.maxy&&p.minx<=a.maxx&&a.minx<=p.maxx&&(o=r.shape,(null==e||0!=((a=o.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&a.collisionGroup))&&(t?Ep.containTest(n,o)&&l.push(o.outer):Ep.testCollide_safe(o,n)&&l.push(o.outer))),r=r.next}return l},le.prototype.bodiesInShape=function(n,t,e,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new nn:i;null==this.failed&&(this.failed=new nn);for(var r=this.list;null!=r&&r.aabb.maxx<p.minx;)r=r.next;for(;null!=r&&r.aabb.minx<=p.maxx;){var o,a,s=r.aabb;p.miny<=s.maxy&&s.miny<=p.maxy&&p.minx<=s.maxx&&s.minx<=p.maxx&&(s=(o=r.shape).body.outer,(null==e||0!=((a=o.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&a.collisionGroup))&&(t?this.failed.has(s)||(a=Ep.containTest(n,o),!l.has(s)&&a?l.push(s):a||(l.remove(s),this.failed.push(s))):!l.has(s)&&Ep.testCollide_safe(n,o)&&l.push(s))),r=r.next}return this.failed.clear(),l},le.prototype.rayCast=function(n,t,e){this.sync_broadphase(),n.validate_dir();var i=n.rayAABB(),p=n.maxdist,l=null;if(0==n.dirx)for(var r=this.list;null!=r&&r.aabb.minx<=i.minx;){var o,a=r.aabb;!(i.miny<=a.maxy&&a.miny<=i.maxy&&i.minx<=a.maxx&&a.minx<=i.maxx&&(null==e||0!=((o=r.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup)))||0<=(o=n.aabbsect(r.aabb))&&o<p&&(null!=(o=0==r.shape.type?n.circlesect(r.shape.circle,t,p):n.polysect(r.shape.polygon,t,p))&&(p=o.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=o)),r=r.next}else if(n.dirx<0){for(var s=this.list,_=null;null!=s&&s.aabb.minx<=i.maxx;)s=(_=s).next;for(s=_;null!=s;){var h,u=s.aabb;!(i.miny<=u.maxy&&u.miny<=i.maxy&&i.minx<=u.maxx&&u.minx<=i.maxx&&(null==e||0!=((h=s.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&h.collisionGroup)))||0<=(h=n.aabbsect(s.aabb))&&h<p&&(null!=(h=0==s.shape.type?n.circlesect(s.shape.circle,t,p):n.polysect(s.shape.polygon,t,p))&&(p=h.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=h)),s=s.prev}}else for(var x=this.list;null!=x&&x.aabb.minx<=i.maxx&&x.aabb.minx<n.originx+n.dirx*p;){var d,y=x.aabb;!(i.miny<=y.maxy&&y.miny<=i.maxy&&i.minx<=y.maxx&&y.minx<=i.maxx&&(null==e||0!=((d=x.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&d.collisionGroup)))||0<=(d=n.aabbsect(x.aabb))&&d<p&&(null!=(d=0==x.shape.type?n.circlesect(x.shape.circle,t,p):n.polysect(x.shape.polygon,t,p))&&(p=d.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=d)),x=x.next}return null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i.wrap_min=i.wrap_max=null,i._invalidate=null,i._validate=null,i.next=Lt.zpp_pool,Lt.zpp_pool=i,l},le.prototype.rayMultiCast=function(n,t,e,i){this.sync_broadphase(),n.validate_dir();var p=n.rayAABB(),l=null==i?new W:i;if(0==n.dirx)for(var r=this.list;null!=r&&r.aabb.minx<=p.minx;){var o=r.aabb;p.miny<=o.maxy&&o.miny<=p.maxy&&p.minx<=o.maxx&&o.minx<=p.maxx&&(null==e||0!=((o=r.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&o.collisionGroup))&&0<=n.aabbsect(r.aabb)&&(0==r.shape.type?n.circlesect2(r.shape.circle,t,l):n.polysect2(r.shape.polygon,t,l)),r=r.next}else if(n.dirx<0){for(var a=this.list,s=null;null!=a&&a.aabb.minx<=p.maxx;)a=(s=a).next;for(a=s;null!=a;){var _=a.aabb;p.miny<=_.maxy&&_.miny<=p.maxy&&p.minx<=_.maxx&&_.minx<=p.maxx&&(null==e||0!=((_=a.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&_.collisionGroup))&&0<=n.aabbsect(a.aabb)&&(0==a.shape.type?n.circlesect2(a.shape.circle,t,l):n.polysect2(a.shape.polygon,t,l)),a=a.prev}}else for(var h=this.list;null!=h&&h.aabb.minx<=p.maxx;){var u=h.aabb;p.miny<=u.maxy&&u.miny<=p.maxy&&p.minx<=u.maxx&&u.minx<=p.maxx&&(null==e||0!=((u=h.shape.filter).collisionMask&e.collisionGroup)&&0!=(e.collisionMask&u.collisionGroup))&&0<=n.aabbsect(h.aabb)&&(0==h.shape.type?n.circlesect2(h.shape.circle,t,l):n.polysect2(h.shape.polygon,t,l)),h=h.next}return null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=Lt.zpp_pool,Lt.zpp_pool=p,l},le.prototype.__class__=le;var re=zpp_nape.util.ZNPArray2_Float=function(n,t){this.width=0,this.list=null,this.width=n,this.list=[]};re.__name__=["zpp_nape","util","ZNPArray2_Float"],re.prototype.list=null,re.prototype.width=null,re.prototype.resize=function(n,t,e){for(var i=0,p=(this.width=n)*t;i<p;)this.list[i++]=e},re.prototype.get=function(n,t){return this.list[t*this.width+n]},re.prototype.set=function(n,t,e){return this.list[t*this.width+n]=e},re.prototype.__class__=re;var oe=zpp_nape.util.ZNPArray2_ZPP_GeomVert=function(n,t){this.width=0,this.list=null,this.width=n,this.list=[]};oe.__name__=["zpp_nape","util","ZNPArray2_ZPP_GeomVert"],oe.prototype.list=null,oe.prototype.width=null,oe.prototype.resize=function(n,t,e){for(var i=0,p=(this.width=n)*t;i<p;)this.list[i++]=e},oe.prototype.get=function(n,t){return this.list[t*this.width+n]},oe.prototype.set=function(n,t,e){return this.list[t*this.width+n]=e},oe.prototype.__class__=oe;var ae=zpp_nape.util.ZNPArray2_ZPP_MarchPair=function(n,t){this.width=0,this.list=null,this.width=n,this.list=[]};ae.__name__=["zpp_nape","util","ZNPArray2_ZPP_MarchPair"],ae.prototype.list=null,ae.prototype.width=null,ae.prototype.resize=function(n,t,e){for(var i=0,p=(this.width=n)*t;i<p;)this.list[i++]=e},ae.prototype.get=function(n,t){return this.list[t*this.width+n]},ae.prototype.set=function(n,t,e){return this.list[t*this.width+n]=e},ae.prototype.__class__=ae;var se=zpp_nape.util.Hashable2_Boolfalse=function(){this.di=0,this.id=0,this.hnext=null,this.next=null,this.value=!1};se.__name__=["zpp_nape","util","Hashable2_Boolfalse"],se.get=function(n,t,e){null==se.zpp_pool?i=new se:(i=se.zpp_pool,se.zpp_pool=i.next,i.next=null),i.id=n,i.di=t;var i=i;return i.value=e,i},se.getpersist=function(n,t){var e;return null==se.zpp_pool?e=new se:(e=se.zpp_pool,se.zpp_pool=e.next,e.next=null),e.id=n,e.di=t,e},se.ordered_get=function(n,t,e){if(n<=t){null==se.zpp_pool?i=new se:(i=se.zpp_pool,se.zpp_pool=i.next,i.next=null),i.id=n,i.di=t;var i=i;return i.value=e,i}null==se.zpp_pool?p=new se:(p=se.zpp_pool,se.zpp_pool=p.next,p.next=null),p.id=t,p.di=n;var p=p;return p.value=e,p},se.ordered_get_persist=function(n,t){var e,i;return n<=t?(null==se.zpp_pool?e=new se:(e=se.zpp_pool,se.zpp_pool=e.next,e.next=null),e.id=n,e.di=t,e):(null==se.zpp_pool?i=new se:(i=se.zpp_pool,se.zpp_pool=i.next,i.next=null),i.id=t,i.di=n,i)},se.prototype.value=null,se.prototype.next=null,se.prototype.hnext=null,se.prototype.id=null,se.prototype.di=null,se.prototype.free=function(){},se.prototype.alloc=function(){},se.prototype.__class__=se;var _e=zpp_nape.util.FastHash2_Hashable2_Boolfalse=function(){this.cnt=0,this.table=null,this.cnt=0,this.table=[];for(var n=0;n<1048576;)++n,this.table.push(null)};_e.__name__=["zpp_nape","util","FastHash2_Hashable2_Boolfalse"],_e.prototype.table=null,_e.prototype.cnt=null,_e.prototype.empty=function(){return 0==this.cnt},_e.prototype.clear=function(){for(var n=0,t=this.table.length;n<t;){var e=n++,i=this.table[e];if(null!=i){for(;null!=i;){var p=i.hnext;i.hnext=null,i=p}this.table[e]=null}}},_e.prototype.get=function(n,t){var e=this.table[106039*n+t&1048575];if(null==e)return null;if(e.id==n&&e.di==t)return e;for(;null!=(e=e.hnext)&&(e.id!=n||e.di!=t););return e},_e.prototype.ordered_get=function(n,t){var e;t<n&&(e=n,n=t,t=e);var i=this.table[106039*n+t&1048575];if(null==i)return null;if(i.id==n&&i.di==t)return i;for(;null!=(i=i.hnext)&&(i.id!=n||i.di!=t););return i},_e.prototype.has=function(n,t){var e=this.table[106039*n+t&1048575];if(null==e)return!1;if(e.id==n&&e.di==t)return!0;for(;null!=(e=e.hnext)&&(e.id!=n||e.di!=t););return null!=e},_e.prototype.maybeAdd=function(n){var t=106039*n.id+n.di&1048575,e=this.table[t];null==e?(this.table[t]=n).hnext=null:(n.hnext=e.hnext,e.hnext=n),this.cnt++},_e.prototype.add=function(n){var t=106039*n.id+n.di&1048575,e=this.table[t];null==e?(this.table[t]=n).hnext=null:(n.hnext=e.hnext,e.hnext=n),this.cnt++},_e.prototype.remove=function(n){var t,e=106039*n.id+n.di&1048575,i=this.table[e];if(i==n)this.table[e]=i.hnext;else if(null!=i){for(;null!=(i=(t=i).hnext)&&i!=n;);t.hnext=i.hnext}n.hnext=null,this.cnt--},_e.prototype.hash=function(n,t){return 106039*n+t&1048575},_e.prototype.__class__=_e;var he=zpp_nape.util.ZNPList_ZPP_CallbackSet=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};he.__name__=["zpp_nape","util","ZNPList_ZPP_CallbackSet"],he.prototype.head=null,he.prototype.begin=function(){return this.head},he.prototype.modified=null,he.prototype.pushmod=null,he.prototype.length=null,he.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},he.prototype.add=function(n){null==qe.zpp_pool?t=new qe:(t=qe.zpp_pool,qe.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},he.prototype.inlined_add=function(n){null==qe.zpp_pool?t=new qe:(t=qe.zpp_pool,qe.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},he.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},he.prototype.insert=function(n,t){null==qe.zpp_pool?e=new qe:(e=qe.zpp_pool,qe.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},he.prototype.inlined_insert=function(n,t){null==qe.zpp_pool?e=new qe:(e=qe.zpp_pool,qe.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},he.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=qe.zpp_pool,qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},he.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=qe.zpp_pool,qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},he.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},he.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},he.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=qe.zpp_pool,qe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},he.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},he.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=qe.zpp_pool,qe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},he.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=qe.zpp_pool,qe.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},he.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=qe.zpp_pool,qe.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},he.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=qe.zpp_pool,qe.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},he.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},he.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=qe.zpp_pool,qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},he.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=qe.zpp_pool,qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},he.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},he.prototype.empty=function(){return null==this.head},he.prototype.size=function(){return this.length},he.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},he.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},he.prototype.front=function(){return this.head.elt},he.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},he.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},he.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},he.prototype.__class__=he;var ue=zpp_nape.util.ZNPList_ZPP_Shape=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ue.__name__=["zpp_nape","util","ZNPList_ZPP_Shape"],ue.prototype.head=null,ue.prototype.begin=function(){return this.head},ue.prototype.modified=null,ue.prototype.pushmod=null,ue.prototype.length=null,ue.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ue.prototype.add=function(n){null==Ue.zpp_pool?t=new Ue:(t=Ue.zpp_pool,Ue.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ue.prototype.inlined_add=function(n){null==Ue.zpp_pool?t=new Ue:(t=Ue.zpp_pool,Ue.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ue.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ue.prototype.insert=function(n,t){null==Ue.zpp_pool?e=new Ue:(e=Ue.zpp_pool,Ue.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ue.prototype.inlined_insert=function(n,t){null==Ue.zpp_pool?e=new Ue:(e=Ue.zpp_pool,Ue.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ue.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ue.zpp_pool,Ue.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ue.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ue.zpp_pool,Ue.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ue.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ue.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ue.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ue.zpp_pool,Ue.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ue.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ue.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ue.zpp_pool,Ue.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ue.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ue.zpp_pool,Ue.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ue.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Ue.zpp_pool,Ue.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ue.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Ue.zpp_pool,Ue.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ue.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ue.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ue.zpp_pool,Ue.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ue.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ue.zpp_pool,Ue.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ue.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ue.prototype.empty=function(){return null==this.head},ue.prototype.size=function(){return this.length},ue.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ue.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ue.prototype.front=function(){return this.head.elt},ue.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ue.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ue.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},ue.prototype.__class__=ue;var ve=zpp_nape.util.ZNPList_ZPP_Body=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ve.__name__=["zpp_nape","util","ZNPList_ZPP_Body"],ve.prototype.head=null,ve.prototype.begin=function(){return this.head},ve.prototype.modified=null,ve.prototype.pushmod=null,ve.prototype.length=null,ve.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ve.prototype.add=function(n){null==Ke.zpp_pool?t=new Ke:(t=Ke.zpp_pool,Ke.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ve.prototype.inlined_add=function(n){null==Ke.zpp_pool?t=new Ke:(t=Ke.zpp_pool,Ke.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ve.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ve.prototype.insert=function(n,t){null==Ke.zpp_pool?e=new Ke:(e=Ke.zpp_pool,Ke.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ve.prototype.inlined_insert=function(n,t){null==Ke.zpp_pool?e=new Ke:(e=Ke.zpp_pool,Ke.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ve.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ke.zpp_pool,Ke.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ve.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ke.zpp_pool,Ke.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ve.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ve.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ve.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ke.zpp_pool,Ke.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ve.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ve.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ke.zpp_pool,Ke.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ve.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ke.zpp_pool,Ke.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ve.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Ke.zpp_pool,Ke.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ve.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Ke.zpp_pool,Ke.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ve.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ve.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ke.zpp_pool,Ke.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ve.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ke.zpp_pool,Ke.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ve.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ve.prototype.empty=function(){return null==this.head},ve.prototype.size=function(){return this.length},ve.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ve.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ve.prototype.front=function(){return this.head.elt},ve.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ve.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ve.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},ve.prototype.__class__=ve;var me=zpp_nape.util.ZNPList_ZPP_Compound=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};me.__name__=["zpp_nape","util","ZNPList_ZPP_Compound"],me.prototype.head=null,me.prototype.begin=function(){return this.head},me.prototype.modified=null,me.prototype.pushmod=null,me.prototype.length=null,me.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},me.prototype.add=function(n){null==Ye.zpp_pool?t=new Ye:(t=Ye.zpp_pool,Ye.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},me.prototype.inlined_add=function(n){null==Ye.zpp_pool?t=new Ye:(t=Ye.zpp_pool,Ye.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},me.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},me.prototype.insert=function(n,t){null==Ye.zpp_pool?e=new Ye:(e=Ye.zpp_pool,Ye.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},me.prototype.inlined_insert=function(n,t){null==Ye.zpp_pool?e=new Ye:(e=Ye.zpp_pool,Ye.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},me.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},me.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},me.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},me.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},me.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ye.zpp_pool,Ye.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},me.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},me.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Ye.zpp_pool,Ye.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},me.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Ye.zpp_pool,Ye.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},me.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Ye.zpp_pool,Ye.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},me.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Ye.zpp_pool,Ye.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},me.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},me.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},me.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ye.zpp_pool,Ye.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},me.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},me.prototype.empty=function(){return null==this.head},me.prototype.size=function(){return this.length},me.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},me.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},me.prototype.front=function(){return this.head.elt},me.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},me.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},me.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},me.prototype.__class__=me;var fe=zpp_nape.util.ZNPList_ZPP_Arbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};fe.__name__=["zpp_nape","util","ZNPList_ZPP_Arbiter"],fe.prototype.head=null,fe.prototype.begin=function(){return this.head},fe.prototype.modified=null,fe.prototype.pushmod=null,fe.prototype.length=null,fe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},fe.prototype.add=function(n){null==tp.zpp_pool?t=new tp:(t=tp.zpp_pool,tp.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},fe.prototype.inlined_add=function(n){null==tp.zpp_pool?t=new tp:(t=tp.zpp_pool,tp.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},fe.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},fe.prototype.insert=function(n,t){null==tp.zpp_pool?e=new tp:(e=tp.zpp_pool,tp.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},fe.prototype.inlined_insert=function(n,t){null==tp.zpp_pool?e=new tp:(e=tp.zpp_pool,tp.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},fe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=tp.zpp_pool,tp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},fe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=tp.zpp_pool,tp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},fe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},fe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},fe.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=tp.zpp_pool,tp.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},fe.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},fe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=tp.zpp_pool,tp.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},fe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=tp.zpp_pool,tp.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},fe.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=tp.zpp_pool,tp.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},fe.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=tp.zpp_pool,tp.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},fe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},fe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=tp.zpp_pool,tp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},fe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=tp.zpp_pool,tp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},fe.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},fe.prototype.empty=function(){return null==this.head},fe.prototype.size=function(){return this.length},fe.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},fe.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},fe.prototype.front=function(){return this.head.elt},fe.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},fe.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},fe.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},fe.prototype.__class__=fe;var be=zpp_nape.util.ZNPList_ZPP_CbSetPair=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};be.__name__=["zpp_nape","util","ZNPList_ZPP_CbSetPair"],be.prototype.head=null,be.prototype.begin=function(){return this.head},be.prototype.modified=null,be.prototype.pushmod=null,be.prototype.length=null,be.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},be.prototype.add=function(n){null==He.zpp_pool?t=new He:(t=He.zpp_pool,He.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},be.prototype.inlined_add=function(n){null==He.zpp_pool?t=new He:(t=He.zpp_pool,He.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},be.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},be.prototype.insert=function(n,t){null==He.zpp_pool?e=new He:(e=He.zpp_pool,He.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},be.prototype.inlined_insert=function(n,t){null==He.zpp_pool?e=new He:(e=He.zpp_pool,He.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},be.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=He.zpp_pool,He.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},be.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=He.zpp_pool,He.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},be.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},be.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},be.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=He.zpp_pool,He.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},be.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},be.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=He.zpp_pool,He.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},be.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=He.zpp_pool,He.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},be.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=He.zpp_pool,He.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},be.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=He.zpp_pool,He.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},be.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},be.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=He.zpp_pool,He.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},be.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=He.zpp_pool,He.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},be.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},be.prototype.empty=function(){return null==this.head},be.prototype.size=function(){return this.length},be.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},be.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},be.prototype.front=function(){return this.head.elt},be.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},be.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},be.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},be.prototype.__class__=be;var ge=zpp_nape.util.ZNPList_ZPP_CutInt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ge.__name__=["zpp_nape","util","ZNPList_ZPP_CutInt"],ge.prototype.head=null,ge.prototype.begin=function(){return this.head},ge.prototype.modified=null,ge.prototype.pushmod=null,ge.prototype.length=null,ge.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ge.prototype.add=function(n){null==Qe.zpp_pool?t=new Qe:(t=Qe.zpp_pool,Qe.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ge.prototype.inlined_add=function(n){null==Qe.zpp_pool?t=new Qe:(t=Qe.zpp_pool,Qe.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ge.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ge.prototype.insert=function(n,t){null==Qe.zpp_pool?e=new Qe:(e=Qe.zpp_pool,Qe.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ge.prototype.inlined_insert=function(n,t){null==Qe.zpp_pool?e=new Qe:(e=Qe.zpp_pool,Qe.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ge.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Qe.zpp_pool,Qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ge.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Qe.zpp_pool,Qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ge.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ge.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ge.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Qe.zpp_pool,Qe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ge.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ge.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=Qe.zpp_pool,Qe.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ge.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=Qe.zpp_pool,Qe.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ge.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Qe.zpp_pool,Qe.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ge.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=Qe.zpp_pool,Qe.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ge.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ge.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Qe.zpp_pool,Qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ge.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Qe.zpp_pool,Qe.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ge.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ge.prototype.empty=function(){return null==this.head},ge.prototype.size=function(){return this.length},ge.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ge.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ge.prototype.front=function(){return this.head.elt},ge.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ge.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ge.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},ge.prototype.__class__=ge;var we=zpp_nape.util.ZNPList_ZPP_CutVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};we.__name__=["zpp_nape","util","ZNPList_ZPP_CutVert"],we.prototype.head=null,we.prototype.begin=function(){return this.head},we.prototype.modified=null,we.prototype.pushmod=null,we.prototype.length=null,we.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},we.prototype.add=function(n){null==ni.zpp_pool?t=new ni:(t=ni.zpp_pool,ni.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},we.prototype.inlined_add=function(n){null==ni.zpp_pool?t=new ni:(t=ni.zpp_pool,ni.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},we.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},we.prototype.insert=function(n,t){null==ni.zpp_pool?e=new ni:(e=ni.zpp_pool,ni.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},we.prototype.inlined_insert=function(n,t){null==ni.zpp_pool?e=new ni:(e=ni.zpp_pool,ni.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},we.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ni.zpp_pool,ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},we.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ni.zpp_pool,ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},we.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},we.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},we.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ni.zpp_pool,ni.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},we.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},we.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ni.zpp_pool,ni.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},we.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ni.zpp_pool,ni.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},we.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ni.zpp_pool,ni.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},we.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ni.zpp_pool,ni.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},we.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},we.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ni.zpp_pool,ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},we.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ni.zpp_pool,ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},we.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},we.prototype.empty=function(){return null==this.head},we.prototype.size=function(){return this.length},we.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},we.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},we.prototype.front=function(){return this.head.elt},we.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},we.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},we.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},we.prototype.__class__=we;var Me=zpp_nape.util.ZNPList_ZPP_PartitionVertex=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Me.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionVertex"],Me.prototype.head=null,Me.prototype.begin=function(){return this.head},Me.prototype.modified=null,Me.prototype.pushmod=null,Me.prototype.length=null,Me.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Me.prototype.add=function(n){null==ti.zpp_pool?t=new ti:(t=ti.zpp_pool,ti.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Me.prototype.inlined_add=function(n){null==ti.zpp_pool?t=new ti:(t=ti.zpp_pool,ti.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Me.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Me.prototype.insert=function(n,t){null==ti.zpp_pool?e=new ti:(e=ti.zpp_pool,ti.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Me.prototype.inlined_insert=function(n,t){null==ti.zpp_pool?e=new ti:(e=ti.zpp_pool,ti.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Me.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ti.zpp_pool,ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Me.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ti.zpp_pool,ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Me.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Me.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Me.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ti.zpp_pool,ti.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Me.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Me.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ti.zpp_pool,ti.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Me.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ti.zpp_pool,ti.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Me.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ti.zpp_pool,ti.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Me.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ti.zpp_pool,ti.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Me.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Me.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ti.zpp_pool,ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Me.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ti.zpp_pool,ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Me.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Me.prototype.empty=function(){return null==this.head},Me.prototype.size=function(){return this.length},Me.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Me.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Me.prototype.front=function(){return this.head.elt},Me.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Me.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Me.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Me.prototype.__class__=Me;var Ce=zpp_nape.util.ZNPList_ZPP_SimplifyP=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ce.__name__=["zpp_nape","util","ZNPList_ZPP_SimplifyP"],Ce.prototype.head=null,Ce.prototype.begin=function(){return this.head},Ce.prototype.modified=null,Ce.prototype.pushmod=null,Ce.prototype.length=null,Ce.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ce.prototype.add=function(n){null==ei.zpp_pool?t=new ei:(t=ei.zpp_pool,ei.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ce.prototype.inlined_add=function(n){null==ei.zpp_pool?t=new ei:(t=ei.zpp_pool,ei.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ce.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ce.prototype.insert=function(n,t){null==ei.zpp_pool?e=new ei:(e=ei.zpp_pool,ei.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ce.prototype.inlined_insert=function(n,t){null==ei.zpp_pool?e=new ei:(e=ei.zpp_pool,ei.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ce.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ei.zpp_pool,ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ce.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ei.zpp_pool,ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ce.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ce.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ce.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ei.zpp_pool,ei.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ce.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ce.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ei.zpp_pool,ei.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ce.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ei.zpp_pool,ei.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ce.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ei.zpp_pool,ei.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ce.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ei.zpp_pool,ei.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ce.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ce.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ei.zpp_pool,ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ce.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ei.zpp_pool,ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ce.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ce.prototype.empty=function(){return null==this.head},Ce.prototype.size=function(){return this.length},Ce.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ce.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ce.prototype.front=function(){return this.head.elt},Ce.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ce.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ce.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Ce.prototype.__class__=Ce;var ke=zpp_nape.util.ZNPList_ZPP_PartitionedPoly=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ke.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionedPoly"],ke.prototype.head=null,ke.prototype.begin=function(){return this.head},ke.prototype.modified=null,ke.prototype.pushmod=null,ke.prototype.length=null,ke.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ke.prototype.add=function(n){null==ri.zpp_pool?t=new ri:(t=ri.zpp_pool,ri.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ke.prototype.inlined_add=function(n){null==ri.zpp_pool?t=new ri:(t=ri.zpp_pool,ri.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ke.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},ke.prototype.insert=function(n,t){null==ri.zpp_pool?e=new ri:(e=ri.zpp_pool,ri.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ke.prototype.inlined_insert=function(n,t){null==ri.zpp_pool?e=new ri:(e=ri.zpp_pool,ri.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ke.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ri.zpp_pool,ri.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ke.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ri.zpp_pool,ri.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ke.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ke.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ke.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ri.zpp_pool,ri.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ke.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},ke.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ri.zpp_pool,ri.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},ke.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ri.zpp_pool,ri.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},ke.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ri.zpp_pool,ri.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ke.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ri.zpp_pool,ri.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},ke.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},ke.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ri.zpp_pool,ri.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ke.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ri.zpp_pool,ri.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ke.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},ke.prototype.empty=function(){return null==this.head},ke.prototype.size=function(){return this.length},ke.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ke.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},ke.prototype.front=function(){return this.head.elt},ke.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},ke.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},ke.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},ke.prototype.__class__=ke;var Oe=zpp_nape.util.ZNPList_ZPP_GeomVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Oe.__name__=["zpp_nape","util","ZNPList_ZPP_GeomVert"],Oe.prototype.head=null,Oe.prototype.begin=function(){return this.head},Oe.prototype.modified=null,Oe.prototype.pushmod=null,Oe.prototype.length=null,Oe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Oe.prototype.add=function(n){null==oi.zpp_pool?t=new oi:(t=oi.zpp_pool,oi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Oe.prototype.inlined_add=function(n){null==oi.zpp_pool?t=new oi:(t=oi.zpp_pool,oi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Oe.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Oe.prototype.insert=function(n,t){null==oi.zpp_pool?e=new oi:(e=oi.zpp_pool,oi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Oe.prototype.inlined_insert=function(n,t){null==oi.zpp_pool?e=new oi:(e=oi.zpp_pool,oi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Oe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=oi.zpp_pool,oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Oe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=oi.zpp_pool,oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Oe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Oe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Oe.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=oi.zpp_pool,oi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Oe.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Oe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=oi.zpp_pool,oi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Oe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=oi.zpp_pool,oi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Oe.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=oi.zpp_pool,oi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Oe.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=oi.zpp_pool,oi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Oe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Oe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=oi.zpp_pool,oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Oe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=oi.zpp_pool,oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Oe.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Oe.prototype.empty=function(){return null==this.head},Oe.prototype.size=function(){return this.length},Oe.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Oe.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Oe.prototype.front=function(){return this.head.elt},Oe.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Oe.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Oe.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Oe.prototype.__class__=Oe;var Pe=zpp_nape.util.ZNPList_ZPP_SimpleVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Pe.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleVert"],Pe.prototype.head=null,Pe.prototype.begin=function(){return this.head},Pe.prototype.modified=null,Pe.prototype.pushmod=null,Pe.prototype.length=null,Pe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Pe.prototype.add=function(n){null==ai.zpp_pool?t=new ai:(t=ai.zpp_pool,ai.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Pe.prototype.inlined_add=function(n){null==ai.zpp_pool?t=new ai:(t=ai.zpp_pool,ai.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Pe.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Pe.prototype.insert=function(n,t){null==ai.zpp_pool?e=new ai:(e=ai.zpp_pool,ai.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Pe.prototype.inlined_insert=function(n,t){null==ai.zpp_pool?e=new ai:(e=ai.zpp_pool,ai.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Pe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ai.zpp_pool,ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ai.zpp_pool,ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Pe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Pe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Pe.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ai.zpp_pool,ai.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Pe.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Pe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ai.zpp_pool,ai.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Pe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ai.zpp_pool,ai.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Pe.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ai.zpp_pool,ai.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Pe.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ai.zpp_pool,ai.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Pe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Pe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ai.zpp_pool,ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ai.zpp_pool,ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Pe.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Pe.prototype.empty=function(){return null==this.head},Pe.prototype.size=function(){return this.length},Pe.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Pe.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Pe.prototype.front=function(){return this.head.elt},Pe.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Pe.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Pe.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Pe.prototype.__class__=Pe;var Se=zpp_nape.util.ZNPList_ZPP_SimpleEvent=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Se.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleEvent"],Se.prototype.head=null,Se.prototype.begin=function(){return this.head},Se.prototype.modified=null,Se.prototype.pushmod=null,Se.prototype.length=null,Se.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Se.prototype.add=function(n){null==si.zpp_pool?t=new si:(t=si.zpp_pool,si.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Se.prototype.inlined_add=function(n){null==si.zpp_pool?t=new si:(t=si.zpp_pool,si.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Se.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Se.prototype.insert=function(n,t){null==si.zpp_pool?e=new si:(e=si.zpp_pool,si.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Se.prototype.inlined_insert=function(n,t){null==si.zpp_pool?e=new si:(e=si.zpp_pool,si.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Se.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=si.zpp_pool,si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Se.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=si.zpp_pool,si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Se.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Se.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Se.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=si.zpp_pool,si.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Se.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Se.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=si.zpp_pool,si.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Se.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=si.zpp_pool,si.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Se.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=si.zpp_pool,si.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Se.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=si.zpp_pool,si.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Se.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Se.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=si.zpp_pool,si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Se.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=si.zpp_pool,si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Se.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Se.prototype.empty=function(){return null==this.head},Se.prototype.size=function(){return this.length},Se.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Se.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Se.prototype.front=function(){return this.head.elt},Se.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Se.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Se.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Se.prototype.__class__=Se;var Ae=zpp_nape.util.ZNPList_ZPP_AABBPair=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ae.__name__=["zpp_nape","util","ZNPList_ZPP_AABBPair"],Ae.prototype.head=null,Ae.prototype.begin=function(){return this.head},Ae.prototype.modified=null,Ae.prototype.pushmod=null,Ae.prototype.length=null,Ae.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ae.prototype.add=function(n){null==hi.zpp_pool?t=new hi:(t=hi.zpp_pool,hi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ae.prototype.inlined_add=function(n){null==hi.zpp_pool?t=new hi:(t=hi.zpp_pool,hi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ae.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ae.prototype.insert=function(n,t){null==hi.zpp_pool?e=new hi:(e=hi.zpp_pool,hi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ae.prototype.inlined_insert=function(n,t){null==hi.zpp_pool?e=new hi:(e=hi.zpp_pool,hi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ae.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=hi.zpp_pool,hi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ae.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=hi.zpp_pool,hi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ae.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ae.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ae.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=hi.zpp_pool,hi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ae.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ae.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=hi.zpp_pool,hi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ae.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=hi.zpp_pool,hi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ae.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=hi.zpp_pool,hi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ae.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=hi.zpp_pool,hi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ae.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ae.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=hi.zpp_pool,hi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ae.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=hi.zpp_pool,hi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ae.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ae.prototype.empty=function(){return null==this.head},Ae.prototype.size=function(){return this.length},Ae.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ae.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ae.prototype.front=function(){return this.head.elt},Ae.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ae.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ae.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Ae.prototype.__class__=Ae;var je=zpp_nape.util.ZNPList_ZPP_Edge=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};je.__name__=["zpp_nape","util","ZNPList_ZPP_Edge"],je.prototype.head=null,je.prototype.begin=function(){return this.head},je.prototype.modified=null,je.prototype.pushmod=null,je.prototype.length=null,je.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},je.prototype.add=function(n){null==ui.zpp_pool?t=new ui:(t=ui.zpp_pool,ui.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},je.prototype.inlined_add=function(n){null==ui.zpp_pool?t=new ui:(t=ui.zpp_pool,ui.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},je.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},je.prototype.insert=function(n,t){null==ui.zpp_pool?e=new ui:(e=ui.zpp_pool,ui.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},je.prototype.inlined_insert=function(n,t){null==ui.zpp_pool?e=new ui:(e=ui.zpp_pool,ui.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},je.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ui.zpp_pool,ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},je.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ui.zpp_pool,ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},je.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},je.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},je.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ui.zpp_pool,ui.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},je.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},je.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ui.zpp_pool,ui.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},je.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ui.zpp_pool,ui.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},je.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ui.zpp_pool,ui.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},je.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ui.zpp_pool,ui.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},je.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},je.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ui.zpp_pool,ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},je.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ui.zpp_pool,ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},je.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},je.prototype.empty=function(){return null==this.head},je.prototype.size=function(){return this.length},je.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},je.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},je.prototype.front=function(){return this.head.elt},je.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},je.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},je.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},je.prototype.__class__=je;var Ee=zpp_nape.util.ZNPList_ZPP_AABBNode=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ee.__name__=["zpp_nape","util","ZNPList_ZPP_AABBNode"],Ee.prototype.head=null,Ee.prototype.begin=function(){return this.head},Ee.prototype.modified=null,Ee.prototype.pushmod=null,Ee.prototype.length=null,Ee.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ee.prototype.add=function(n){null==xi.zpp_pool?t=new xi:(t=xi.zpp_pool,xi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ee.prototype.inlined_add=function(n){null==xi.zpp_pool?t=new xi:(t=xi.zpp_pool,xi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ee.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ee.prototype.insert=function(n,t){null==xi.zpp_pool?e=new xi:(e=xi.zpp_pool,xi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ee.prototype.inlined_insert=function(n,t){null==xi.zpp_pool?e=new xi:(e=xi.zpp_pool,xi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ee.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=xi.zpp_pool,xi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ee.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=xi.zpp_pool,xi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ee.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ee.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ee.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=xi.zpp_pool,xi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ee.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ee.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=xi.zpp_pool,xi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ee.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=xi.zpp_pool,xi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ee.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=xi.zpp_pool,xi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ee.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=xi.zpp_pool,xi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ee.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ee.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=xi.zpp_pool,xi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ee.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=xi.zpp_pool,xi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ee.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ee.prototype.empty=function(){return null==this.head},Ee.prototype.size=function(){return this.length},Ee.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ee.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ee.prototype.front=function(){return this.head.elt},Ee.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ee.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ee.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Ee.prototype.__class__=Ee;var Ie=zpp_nape.util.ZNPList_ZPP_Component=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ie.__name__=["zpp_nape","util","ZNPList_ZPP_Component"],Ie.prototype.head=null,Ie.prototype.begin=function(){return this.head},Ie.prototype.modified=null,Ie.prototype.pushmod=null,Ie.prototype.length=null,Ie.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ie.prototype.add=function(n){null==di.zpp_pool?t=new di:(t=di.zpp_pool,di.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ie.prototype.inlined_add=function(n){null==di.zpp_pool?t=new di:(t=di.zpp_pool,di.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ie.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ie.prototype.insert=function(n,t){null==di.zpp_pool?e=new di:(e=di.zpp_pool,di.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ie.prototype.inlined_insert=function(n,t){null==di.zpp_pool?e=new di:(e=di.zpp_pool,di.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ie.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=di.zpp_pool,di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ie.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=di.zpp_pool,di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ie.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ie.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ie.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=di.zpp_pool,di.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ie.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ie.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=di.zpp_pool,di.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ie.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=di.zpp_pool,di.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ie.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=di.zpp_pool,di.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ie.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=di.zpp_pool,di.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ie.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ie.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=di.zpp_pool,di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ie.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=di.zpp_pool,di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ie.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ie.prototype.empty=function(){return null==this.head},Ie.prototype.size=function(){return this.length},Ie.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ie.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ie.prototype.front=function(){return this.head.elt},Ie.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ie.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ie.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Ie.prototype.__class__=Ie;var Te=zpp_nape.util.ZNPList_ZPP_FluidArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Te.__name__=["zpp_nape","util","ZNPList_ZPP_FluidArbiter"],Te.prototype.head=null,Te.prototype.begin=function(){return this.head},Te.prototype.modified=null,Te.prototype.pushmod=null,Te.prototype.length=null,Te.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Te.prototype.add=function(n){null==pp.zpp_pool?t=new pp:(t=pp.zpp_pool,pp.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Te.prototype.inlined_add=function(n){null==pp.zpp_pool?t=new pp:(t=pp.zpp_pool,pp.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Te.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Te.prototype.insert=function(n,t){null==pp.zpp_pool?e=new pp:(e=pp.zpp_pool,pp.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Te.prototype.inlined_insert=function(n,t){null==pp.zpp_pool?e=new pp:(e=pp.zpp_pool,pp.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Te.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=pp.zpp_pool,pp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Te.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=pp.zpp_pool,pp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Te.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Te.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Te.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=pp.zpp_pool,pp.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Te.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Te.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=pp.zpp_pool,pp.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Te.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=pp.zpp_pool,pp.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Te.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=pp.zpp_pool,pp.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Te.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=pp.zpp_pool,pp.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Te.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Te.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=pp.zpp_pool,pp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Te.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=pp.zpp_pool,pp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Te.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Te.prototype.empty=function(){return null==this.head},Te.prototype.size=function(){return this.length},Te.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Te.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Te.prototype.front=function(){return this.head.elt},Te.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Te.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Te.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Te.prototype.__class__=Te;var Ne=zpp_nape.util.ZNPList_ZPP_SensorArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ne.__name__=["zpp_nape","util","ZNPList_ZPP_SensorArbiter"],Ne.prototype.head=null,Ne.prototype.begin=function(){return this.head},Ne.prototype.modified=null,Ne.prototype.pushmod=null,Ne.prototype.length=null,Ne.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ne.prototype.add=function(n){null==lp.zpp_pool?t=new lp:(t=lp.zpp_pool,lp.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ne.prototype.inlined_add=function(n){null==lp.zpp_pool?t=new lp:(t=lp.zpp_pool,lp.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ne.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ne.prototype.insert=function(n,t){null==lp.zpp_pool?e=new lp:(e=lp.zpp_pool,lp.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ne.prototype.inlined_insert=function(n,t){null==lp.zpp_pool?e=new lp:(e=lp.zpp_pool,lp.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ne.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=lp.zpp_pool,lp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ne.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=lp.zpp_pool,lp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ne.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ne.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ne.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=lp.zpp_pool,lp.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ne.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ne.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=lp.zpp_pool,lp.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ne.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=lp.zpp_pool,lp.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ne.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=lp.zpp_pool,lp.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ne.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=lp.zpp_pool,lp.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ne.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ne.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=lp.zpp_pool,lp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ne.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=lp.zpp_pool,lp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ne.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ne.prototype.empty=function(){return null==this.head},Ne.prototype.size=function(){return this.length},Ne.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ne.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ne.prototype.front=function(){return this.head.elt},Ne.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ne.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ne.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Ne.prototype.__class__=Ne;var Le=zpp_nape.util.ZNPList_ZPP_Listener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Le.__name__=["zpp_nape","util","ZNPList_ZPP_Listener"],Le.prototype.head=null,Le.prototype.begin=function(){return this.head},Le.prototype.modified=null,Le.prototype.pushmod=null,Le.prototype.length=null,Le.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Le.prototype.add=function(n){null==yi.zpp_pool?t=new yi:(t=yi.zpp_pool,yi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Le.prototype.inlined_add=function(n){null==yi.zpp_pool?t=new yi:(t=yi.zpp_pool,yi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Le.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Le.prototype.insert=function(n,t){null==yi.zpp_pool?e=new yi:(e=yi.zpp_pool,yi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Le.prototype.inlined_insert=function(n,t){null==yi.zpp_pool?e=new yi:(e=yi.zpp_pool,yi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Le.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Le.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Le.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Le.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Le.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=yi.zpp_pool,yi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Le.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Le.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=yi.zpp_pool,yi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Le.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=yi.zpp_pool,yi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Le.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=yi.zpp_pool,yi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Le.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=yi.zpp_pool,yi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Le.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Le.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Le.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Le.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Le.prototype.empty=function(){return null==this.head},Le.prototype.size=function(){return this.length},Le.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Le.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Le.prototype.front=function(){return this.head.elt},Le.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Le.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Le.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Le.prototype.__class__=Le;var Ve=zpp_nape.util.ZNPList_ZPP_ColArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ve.__name__=["zpp_nape","util","ZNPList_ZPP_ColArbiter"],Ve.prototype.head=null,Ve.prototype.begin=function(){return this.head},Ve.prototype.modified=null,Ve.prototype.pushmod=null,Ve.prototype.length=null,Ve.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ve.prototype.add=function(n){null==rp.zpp_pool?t=new rp:(t=rp.zpp_pool,rp.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ve.prototype.inlined_add=function(n){null==rp.zpp_pool?t=new rp:(t=rp.zpp_pool,rp.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ve.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ve.prototype.insert=function(n,t){null==rp.zpp_pool?e=new rp:(e=rp.zpp_pool,rp.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ve.prototype.inlined_insert=function(n,t){null==rp.zpp_pool?e=new rp:(e=rp.zpp_pool,rp.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ve.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=rp.zpp_pool,rp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ve.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=rp.zpp_pool,rp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ve.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ve.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ve.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=rp.zpp_pool,rp.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ve.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ve.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=rp.zpp_pool,rp.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ve.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=rp.zpp_pool,rp.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ve.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=rp.zpp_pool,rp.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ve.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=rp.zpp_pool,rp.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ve.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ve.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=rp.zpp_pool,rp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ve.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=rp.zpp_pool,rp.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ve.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ve.prototype.empty=function(){return null==this.head},Ve.prototype.size=function(){return this.length},Ve.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ve.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ve.prototype.front=function(){return this.head.elt},Ve.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ve.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ve.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Ve.prototype.__class__=Ve;var De=zpp_nape.util.ZNPList_ZPP_InteractionGroup=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};De.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionGroup"],De.prototype.head=null,De.prototype.begin=function(){return this.head},De.prototype.modified=null,De.prototype.pushmod=null,De.prototype.length=null,De.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},De.prototype.add=function(n){null==zi.zpp_pool?t=new zi:(t=zi.zpp_pool,zi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},De.prototype.inlined_add=function(n){null==zi.zpp_pool?t=new zi:(t=zi.zpp_pool,zi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},De.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},De.prototype.insert=function(n,t){null==zi.zpp_pool?e=new zi:(e=zi.zpp_pool,zi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},De.prototype.inlined_insert=function(n,t){null==zi.zpp_pool?e=new zi:(e=zi.zpp_pool,zi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},De.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},De.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},De.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},De.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},De.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=zi.zpp_pool,zi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},De.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},De.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=zi.zpp_pool,zi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},De.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=zi.zpp_pool,zi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},De.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=zi.zpp_pool,zi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},De.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=zi.zpp_pool,zi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},De.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},De.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},De.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},De.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},De.prototype.empty=function(){return null==this.head},De.prototype.size=function(){return this.length},De.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},De.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},De.prototype.front=function(){return this.head.elt},De.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},De.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},De.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},De.prototype.__class__=De;var Fe=zpp_nape.util.ZNPList_ZPP_ToiEvent=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Fe.__name__=["zpp_nape","util","ZNPList_ZPP_ToiEvent"],Fe.prototype.head=null,Fe.prototype.begin=function(){return this.head},Fe.prototype.modified=null,Fe.prototype.pushmod=null,Fe.prototype.length=null,Fe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Fe.prototype.add=function(n){null==ci.zpp_pool?t=new ci:(t=ci.zpp_pool,ci.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Fe.prototype.inlined_add=function(n){null==ci.zpp_pool?t=new ci:(t=ci.zpp_pool,ci.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Fe.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Fe.prototype.insert=function(n,t){null==ci.zpp_pool?e=new ci:(e=ci.zpp_pool,ci.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Fe.prototype.inlined_insert=function(n,t){null==ci.zpp_pool?e=new ci:(e=ci.zpp_pool,ci.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Fe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ci.zpp_pool,ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Fe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ci.zpp_pool,ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Fe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Fe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Fe.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ci.zpp_pool,ci.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Fe.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Fe.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=ci.zpp_pool,ci.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Fe.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=ci.zpp_pool,ci.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Fe.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ci.zpp_pool,ci.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Fe.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=ci.zpp_pool,ci.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Fe.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Fe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ci.zpp_pool,ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Fe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ci.zpp_pool,ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Fe.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Fe.prototype.empty=function(){return null==this.head},Fe.prototype.size=function(){return this.length},Fe.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Fe.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Fe.prototype.front=function(){return this.head.elt},Fe.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Fe.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Fe.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Fe.prototype.__class__=Fe;var Re=zpp_nape.util.ZNPList_ConvexResult=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Re.__name__=["zpp_nape","util","ZNPList_ConvexResult"],Re.prototype.head=null,Re.prototype.begin=function(){return this.head},Re.prototype.modified=null,Re.prototype.pushmod=null,Re.prototype.length=null,Re.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Re.prototype.add=function(n){null==vi.zpp_pool?t=new vi:(t=vi.zpp_pool,vi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Re.prototype.inlined_add=function(n){null==vi.zpp_pool?t=new vi:(t=vi.zpp_pool,vi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Re.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Re.prototype.insert=function(n,t){null==vi.zpp_pool?e=new vi:(e=vi.zpp_pool,vi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Re.prototype.inlined_insert=function(n,t){null==vi.zpp_pool?e=new vi:(e=vi.zpp_pool,vi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Re.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Re.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Re.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Re.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Re.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=vi.zpp_pool,vi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Re.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Re.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=vi.zpp_pool,vi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Re.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=vi.zpp_pool,vi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Re.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=vi.zpp_pool,vi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Re.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=vi.zpp_pool,vi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Re.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Re.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Re.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Re.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Re.prototype.empty=function(){return null==this.head},Re.prototype.size=function(){return this.length},Re.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Re.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Re.prototype.front=function(){return this.head.elt},Re.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Re.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Re.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Re.prototype.__class__=Re;var Ze=zpp_nape.util.ZNPList_ZPP_GeomPoly=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ze.__name__=["zpp_nape","util","ZNPList_ZPP_GeomPoly"],Ze.prototype.head=null,Ze.prototype.begin=function(){return this.head},Ze.prototype.modified=null,Ze.prototype.pushmod=null,Ze.prototype.length=null,Ze.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ze.prototype.add=function(n){null==mi.zpp_pool?t=new mi:(t=mi.zpp_pool,mi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ze.prototype.inlined_add=function(n){null==mi.zpp_pool?t=new mi:(t=mi.zpp_pool,mi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ze.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Ze.prototype.insert=function(n,t){null==mi.zpp_pool?e=new mi:(e=mi.zpp_pool,mi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ze.prototype.inlined_insert=function(n,t){null==mi.zpp_pool?e=new mi:(e=mi.zpp_pool,mi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ze.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ze.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ze.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ze.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ze.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=mi.zpp_pool,mi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ze.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Ze.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=mi.zpp_pool,mi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Ze.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=mi.zpp_pool,mi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Ze.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=mi.zpp_pool,mi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ze.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=mi.zpp_pool,mi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Ze.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Ze.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ze.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ze.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Ze.prototype.empty=function(){return null==this.head},Ze.prototype.size=function(){return this.length},Ze.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ze.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Ze.prototype.front=function(){return this.head.elt},Ze.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Ze.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Ze.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Ze.prototype.__class__=Ze;var Be=zpp_nape.util.ZNPList_RayResult=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Be.__name__=["zpp_nape","util","ZNPList_RayResult"],Be.prototype.head=null,Be.prototype.begin=function(){return this.head},Be.prototype.modified=null,Be.prototype.pushmod=null,Be.prototype.length=null,Be.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Be.prototype.add=function(n){null==fi.zpp_pool?t=new fi:(t=fi.zpp_pool,fi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Be.prototype.inlined_add=function(n){null==fi.zpp_pool?t=new fi:(t=fi.zpp_pool,fi.zpp_pool=t.next,t.next=null),t.elt=n;var t=t;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Be.prototype.addAll=function(n){for(var t=n.head;null!=t;)this.add(t.elt),t=t.next},Be.prototype.insert=function(n,t){null==fi.zpp_pool?e=new fi:(e=fi.zpp_pool,fi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Be.prototype.inlined_insert=function(n,t){null==fi.zpp_pool?e=new fi:(e=fi.zpp_pool,fi.zpp_pool=e.next,e.next=null),e.elt=t;var e=e;return null==n?(e.next=this.head,this.head=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Be.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=fi.zpp_pool,fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Be.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=fi.zpp_pool,fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Be.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Be.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Be.prototype.remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=fi.zpp_pool,fi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Be.prototype.try_remove=function(n){for(var t=null,e=this.head,i=!1;null!=e;){if(e.elt==n){this.erase(t),i=!0;break}e=(t=e).next}return i},Be.prototype.inlined_remove=function(n){for(var t,e,i=null,p=this.head;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var l=t;l.elt=null,l.next=fi.zpp_pool,fi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}p=(i=p).next}},Be.prototype.inlined_try_remove=function(n){for(var t,e,i=null,p=this.head,l=!1;null!=p;){if(p.elt==n){null==i?(e=(t=this.head).next,this.head=e,null==this.head&&(this.pushmod=!0)):(e=(t=i.next).next,null==(i.next=e)&&(this.pushmod=!0));var r=t;r.elt=null,r.next=fi.zpp_pool,fi.zpp_pool=r,this.modified=!0,this.length--,l=this.pushmod=!0;break}p=(i=p).next}return l},Be.prototype.erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=fi.zpp_pool,fi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Be.prototype.inlined_erase=function(n){var t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,null==(n.next=t)&&(this.pushmod=!0));var e=e;return e.elt=null,e.next=fi.zpp_pool,fi.zpp_pool=e,this.modified=!0,this.length--,this.pushmod=!0,t},Be.prototype.splice=function(n,t){for(;0<t--&&null!=n.next;)this.erase(n);return n.next},Be.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=fi.zpp_pool,fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Be.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=fi.zpp_pool,fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Be.prototype.reverse=function(){for(var n=this.head,t=null;null!=n;){var e=n.next;n.next=t,t=this.head=n,n=e}this.modified=!0,this.pushmod=!0},Be.prototype.empty=function(){return null==this.head},Be.prototype.size=function(){return this.length},Be.prototype.has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Be.prototype.inlined_has=function(n){for(var t=!1,e=this.head;null!=e;){if(e.elt==n){t=!0;break}e=e.next}return t},Be.prototype.front=function(){return this.head.elt},Be.prototype.back=function(){for(var n=this.head,t=n;null!=t;)t=(n=t).next;return n.elt},Be.prototype.iterator_at=function(n){for(var t=this.head;0<n--&&null!=t;)t=t.next;return t},Be.prototype.at=function(n){n=this.iterator_at(n);return null!=n?n.elt:null},Be.prototype.__class__=Be;var Ge=zpp_nape.util.ZNPNode_ZPP_CbType=function(){this.elt=null,this.next=null};Ge.__name__=["zpp_nape","util","ZNPNode_ZPP_CbType"],Ge.prototype.next=null,Ge.prototype.alloc=function(){},Ge.prototype.free=function(){this.elt=null},Ge.prototype.elt=null,Ge.prototype.elem=function(){return this.elt},Ge.prototype.__class__=Ge;var qe=zpp_nape.util.ZNPNode_ZPP_CallbackSet=function(){this.elt=null,this.next=null};qe.__name__=["zpp_nape","util","ZNPNode_ZPP_CallbackSet"],qe.prototype.next=null,qe.prototype.alloc=function(){},qe.prototype.free=function(){this.elt=null},qe.prototype.elt=null,qe.prototype.elem=function(){return this.elt},qe.prototype.__class__=qe;var Ue=zpp_nape.util.ZNPNode_ZPP_Shape=function(){this.elt=null,this.next=null};Ue.__name__=["zpp_nape","util","ZNPNode_ZPP_Shape"],Ue.prototype.next=null,Ue.prototype.alloc=function(){},Ue.prototype.free=function(){this.elt=null},Ue.prototype.elt=null,Ue.prototype.elem=function(){return this.elt},Ue.prototype.__class__=Ue;var Ke=zpp_nape.util.ZNPNode_ZPP_Body=function(){this.elt=null,this.next=null};Ke.__name__=["zpp_nape","util","ZNPNode_ZPP_Body"],Ke.prototype.next=null,Ke.prototype.alloc=function(){},Ke.prototype.free=function(){this.elt=null},Ke.prototype.elt=null,Ke.prototype.elem=function(){return this.elt},Ke.prototype.__class__=Ke;var We=zpp_nape.util.ZNPNode_ZPP_Constraint=function(){this.elt=null,this.next=null};We.__name__=["zpp_nape","util","ZNPNode_ZPP_Constraint"],We.prototype.next=null,We.prototype.alloc=function(){},We.prototype.free=function(){this.elt=null},We.prototype.elt=null,We.prototype.elem=function(){return this.elt},We.prototype.__class__=We;var Ye=zpp_nape.util.ZNPNode_ZPP_Compound=function(){this.elt=null,this.next=null};Ye.__name__=["zpp_nape","util","ZNPNode_ZPP_Compound"],Ye.prototype.next=null,Ye.prototype.alloc=function(){},Ye.prototype.free=function(){this.elt=null},Ye.prototype.elt=null,Ye.prototype.elem=function(){return this.elt},Ye.prototype.__class__=Ye;var tp=zpp_nape.util.ZNPNode_ZPP_Arbiter=function(){this.elt=null,this.next=null};tp.__name__=["zpp_nape","util","ZNPNode_ZPP_Arbiter"],tp.prototype.next=null,tp.prototype.alloc=function(){},tp.prototype.free=function(){this.elt=null},tp.prototype.elt=null,tp.prototype.elem=function(){return this.elt},tp.prototype.__class__=tp;var ep=zpp_nape.util.ZNPNode_ZPP_InteractionListener=function(){this.elt=null,this.next=null};ep.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionListener"],ep.prototype.next=null,ep.prototype.alloc=function(){},ep.prototype.free=function(){this.elt=null},ep.prototype.elt=null,ep.prototype.elem=function(){return this.elt},ep.prototype.__class__=ep;var Je=zpp_nape.util.ZNPNode_ZPP_CbSet=function(){this.elt=null,this.next=null};Je.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSet"],Je.prototype.next=null,Je.prototype.alloc=function(){},Je.prototype.free=function(){this.elt=null},Je.prototype.elt=null,Je.prototype.elem=function(){return this.elt},Je.prototype.__class__=Je;var ip=zpp_nape.util.ZNPNode_ZPP_Interactor=function(){this.elt=null,this.next=null};ip.__name__=["zpp_nape","util","ZNPNode_ZPP_Interactor"],ip.prototype.next=null,ip.prototype.alloc=function(){},ip.prototype.free=function(){this.elt=null},ip.prototype.elt=null,ip.prototype.elem=function(){return this.elt},ip.prototype.__class__=ip;var Xe=zpp_nape.util.ZNPNode_ZPP_BodyListener=function(){this.elt=null,this.next=null};Xe.__name__=["zpp_nape","util","ZNPNode_ZPP_BodyListener"],Xe.prototype.next=null,Xe.prototype.alloc=function(){},Xe.prototype.free=function(){this.elt=null},Xe.prototype.elt=null,Xe.prototype.elem=function(){return this.elt},Xe.prototype.__class__=Xe;var He=zpp_nape.util.ZNPNode_ZPP_CbSetPair=function(){this.elt=null,this.next=null};He.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSetPair"],He.prototype.next=null,He.prototype.alloc=function(){},He.prototype.free=function(){this.elt=null},He.prototype.elt=null,He.prototype.elem=function(){return this.elt},He.prototype.__class__=He;var $e=zpp_nape.util.ZNPNode_ZPP_ConstraintListener=function(){this.elt=null,this.next=null};$e.__name__=["zpp_nape","util","ZNPNode_ZPP_ConstraintListener"],$e.prototype.next=null,$e.prototype.alloc=function(){},$e.prototype.free=function(){this.elt=null},$e.prototype.elt=null,$e.prototype.elem=function(){return this.elt},$e.prototype.__class__=$e;var Qe=zpp_nape.util.ZNPNode_ZPP_CutInt=function(){this.elt=null,this.next=null};Qe.__name__=["zpp_nape","util","ZNPNode_ZPP_CutInt"],Qe.prototype.next=null,Qe.prototype.alloc=function(){},Qe.prototype.free=function(){this.elt=null},Qe.prototype.elt=null,Qe.prototype.elem=function(){return this.elt},Qe.prototype.__class__=Qe;var ni=zpp_nape.util.ZNPNode_ZPP_CutVert=function(){this.elt=null,this.next=null};ni.__name__=["zpp_nape","util","ZNPNode_ZPP_CutVert"],ni.prototype.next=null,ni.prototype.alloc=function(){},ni.prototype.free=function(){this.elt=null},ni.prototype.elt=null,ni.prototype.elem=function(){return this.elt},ni.prototype.__class__=ni;var ti=zpp_nape.util.ZNPNode_ZPP_PartitionVertex=function(){this.elt=null,this.next=null};ti.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionVertex"],ti.prototype.next=null,ti.prototype.alloc=function(){},ti.prototype.free=function(){this.elt=null},ti.prototype.elt=null,ti.prototype.elem=function(){return this.elt},ti.prototype.__class__=ti;var ei=zpp_nape.util.ZNPNode_ZPP_SimplifyP=function(){this.elt=null,this.next=null};ei.__name__=["zpp_nape","util","ZNPNode_ZPP_SimplifyP"],ei.prototype.next=null,ei.prototype.alloc=function(){},ei.prototype.free=function(){this.elt=null},ei.prototype.elt=null,ei.prototype.elem=function(){return this.elt},ei.prototype.__class__=ei;var ri=zpp_nape.util.ZNPNode_ZPP_PartitionedPoly=function(){this.elt=null,this.next=null};ri.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionedPoly"],ri.prototype.next=null,ri.prototype.alloc=function(){},ri.prototype.free=function(){this.elt=null},ri.prototype.elt=null,ri.prototype.elem=function(){return this.elt},ri.prototype.__class__=ri;var oi=zpp_nape.util.ZNPNode_ZPP_GeomVert=function(){this.elt=null,this.next=null};oi.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomVert"],oi.prototype.next=null,oi.prototype.alloc=function(){},oi.prototype.free=function(){this.elt=null},oi.prototype.elt=null,oi.prototype.elem=function(){return this.elt},oi.prototype.__class__=oi;var ai=zpp_nape.util.ZNPNode_ZPP_SimpleVert=function(){this.elt=null,this.next=null};ai.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleVert"],ai.prototype.next=null,ai.prototype.alloc=function(){},ai.prototype.free=function(){this.elt=null},ai.prototype.elt=null,ai.prototype.elem=function(){return this.elt},ai.prototype.__class__=ai;var si=zpp_nape.util.ZNPNode_ZPP_SimpleEvent=function(){this.elt=null,this.next=null};si.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleEvent"],si.prototype.next=null,si.prototype.alloc=function(){},si.prototype.free=function(){this.elt=null},si.prototype.elt=null,si.prototype.elem=function(){return this.elt},si.prototype.__class__=si;var _i=zpp_nape.util.ZNPNode_ZPP_Vec2=function(){this.elt=null,this.next=null};_i.__name__=["zpp_nape","util","ZNPNode_ZPP_Vec2"],_i.prototype.next=null,_i.prototype.alloc=function(){},_i.prototype.free=function(){this.elt=null},_i.prototype.elt=null,_i.prototype.elem=function(){return this.elt},_i.prototype.__class__=_i;var hi=zpp_nape.util.ZNPNode_ZPP_AABBPair=function(){this.elt=null,this.next=null};hi.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBPair"],hi.prototype.next=null,hi.prototype.alloc=function(){},hi.prototype.free=function(){this.elt=null},hi.prototype.elt=null,hi.prototype.elem=function(){return this.elt},hi.prototype.__class__=hi;var ui=zpp_nape.util.ZNPNode_ZPP_Edge=function(){this.elt=null,this.next=null};ui.__name__=["zpp_nape","util","ZNPNode_ZPP_Edge"],ui.prototype.next=null,ui.prototype.alloc=function(){},ui.prototype.free=function(){this.elt=null},ui.prototype.elt=null,ui.prototype.elem=function(){return this.elt},ui.prototype.__class__=ui;var xi=zpp_nape.util.ZNPNode_ZPP_AABBNode=function(){this.elt=null,this.next=null};xi.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBNode"],xi.prototype.next=null,xi.prototype.alloc=function(){},xi.prototype.free=function(){this.elt=null},xi.prototype.elt=null,xi.prototype.elem=function(){return this.elt},xi.prototype.__class__=xi;var di=zpp_nape.util.ZNPNode_ZPP_Component=function(){this.elt=null,this.next=null};di.__name__=["zpp_nape","util","ZNPNode_ZPP_Component"],di.prototype.next=null,di.prototype.alloc=function(){},di.prototype.free=function(){this.elt=null},di.prototype.elt=null,di.prototype.elem=function(){return this.elt},di.prototype.__class__=di;var pp=zpp_nape.util.ZNPNode_ZPP_FluidArbiter=function(){this.elt=null,this.next=null};pp.__name__=["zpp_nape","util","ZNPNode_ZPP_FluidArbiter"],pp.prototype.next=null,pp.prototype.alloc=function(){},pp.prototype.free=function(){this.elt=null},pp.prototype.elt=null,pp.prototype.elem=function(){return this.elt},pp.prototype.__class__=pp;var lp=zpp_nape.util.ZNPNode_ZPP_SensorArbiter=function(){this.elt=null,this.next=null};lp.__name__=["zpp_nape","util","ZNPNode_ZPP_SensorArbiter"],lp.prototype.next=null,lp.prototype.alloc=function(){},lp.prototype.free=function(){this.elt=null},lp.prototype.elt=null,lp.prototype.elem=function(){return this.elt},lp.prototype.__class__=lp;var yi=zpp_nape.util.ZNPNode_ZPP_Listener=function(){this.elt=null,this.next=null};yi.__name__=["zpp_nape","util","ZNPNode_ZPP_Listener"],yi.prototype.next=null,yi.prototype.alloc=function(){},yi.prototype.free=function(){this.elt=null},yi.prototype.elt=null,yi.prototype.elem=function(){return this.elt},yi.prototype.__class__=yi;var rp=zpp_nape.util.ZNPNode_ZPP_ColArbiter=function(){this.elt=null,this.next=null};rp.__name__=["zpp_nape","util","ZNPNode_ZPP_ColArbiter"],rp.prototype.next=null,rp.prototype.alloc=function(){},rp.prototype.free=function(){this.elt=null},rp.prototype.elt=null,rp.prototype.elem=function(){return this.elt},rp.prototype.__class__=rp;var zi=zpp_nape.util.ZNPNode_ZPP_InteractionGroup=function(){this.elt=null,this.next=null};zi.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionGroup"],zi.prototype.next=null,zi.prototype.alloc=function(){},zi.prototype.free=function(){this.elt=null},zi.prototype.elt=null,zi.prototype.elem=function(){return this.elt},zi.prototype.__class__=zi;var ci=zpp_nape.util.ZNPNode_ZPP_ToiEvent=function(){this.elt=null,this.next=null};ci.__name__=["zpp_nape","util","ZNPNode_ZPP_ToiEvent"],ci.prototype.next=null,ci.prototype.alloc=function(){},ci.prototype.free=function(){this.elt=null},ci.prototype.elt=null,ci.prototype.elem=function(){return this.elt},ci.prototype.__class__=ci;var vi=zpp_nape.util.ZNPNode_ConvexResult=function(){this.elt=null,this.next=null};vi.__name__=["zpp_nape","util","ZNPNode_ConvexResult"],vi.prototype.next=null,vi.prototype.alloc=function(){},vi.prototype.free=function(){this.elt=null},vi.prototype.elt=null,vi.prototype.elem=function(){return this.elt},vi.prototype.__class__=vi;var mi=zpp_nape.util.ZNPNode_ZPP_GeomPoly=function(){this.elt=null,this.next=null};mi.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomPoly"],mi.prototype.next=null,mi.prototype.alloc=function(){},mi.prototype.free=function(){this.elt=null},mi.prototype.elt=null,mi.prototype.elem=function(){return this.elt},mi.prototype.__class__=mi;var fi=zpp_nape.util.ZNPNode_RayResult=function(){this.elt=null,this.next=null};fi.__name__=["zpp_nape","util","ZNPNode_RayResult"],fi.prototype.next=null,fi.prototype.alloc=function(){},fi.prototype.free=function(){this.elt=null},fi.prototype.elt=null,fi.prototype.elem=function(){return this.elt},fi.prototype.__class__=fi;var bi=zpp_nape.util.ZPP_MixVec2List=function(){this.at_index=0,this.at_ite=null,this.zip_length=!1,this._length=0,this.inner=null,Y.call(this),this.at_ite=null,this.at_index=0,this.zip_length=!0,this._length=0};bi.__name__=["zpp_nape","util","ZPP_MixVec2List"],bi.__super__=Y,bi.prototype=Object.create(Y.prototype),bi.get=function(n,t){null==t&&(t=!1);var e=new bi;return e.inner=n,e.zpp_inner.immutable=t,e},bi.prototype.inner=null,bi.prototype._length=null,bi.prototype.zip_length=null,bi.prototype.at_ite=null,bi.prototype.at_index=null,bi.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var n=this.inner.next;null!=n;)this._length++,n=n.next;this.zip_length=!1}return this._length},bi.prototype.zpp_vm=function(){this.zpp_inner.validate(),this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},bi.prototype.at=function(n){for(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),(n<this.at_index||null==this.at_ite)&&(this.at_index=0,this.at_ite=this.inner.next);this.at_index!=n;)this.at_index++,this.at_ite=this.at_ite.next;var t,e=this.at_ite;return null==e.outer&&(e.outer=new Cn,null!=(t=e.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,e.outer.zpp_inner=e),e.outer},bi.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?this.inner.add(n.zpp_inner):this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},bi.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var t=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return t&&(this.zpp_inner.reverse_flag?this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner):this.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),t},bi.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null==(i=this.inner.next).outer&&(i.outer=new Cn,null!=(n=i.outer.zpp_inner).outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ip.zpp_pool,Ip.zpp_pool=n,i.outer.zpp_inner=i),n=i.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.inner.pop()):(null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null),null==(i=(null==(e=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2))?this.inner:e).next).outer&&(i.outer=new Cn,null!=(t=i.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,i.outer.zpp_inner=i),t=i.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.inner.erase(e)),this.zpp_inner.invalidate(),null==i.outer&&(i.outer=new Cn,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,i.outer.zpp_inner=i),i.outer},bi.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n,t,e,i=null;return this.zpp_inner.reverse_flag?(null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null),null==(i=(null==(n=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2))?this.inner:n).next).outer&&(i.outer=new Cn,null!=(t=i.outer.zpp_inner).outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ip.zpp_pool,Ip.zpp_pool=t,i.outer.zpp_inner=i),t=i.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.inner.erase(n)):(null==(i=this.inner.next).outer&&(i.outer=new Cn,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,i.outer.zpp_inner=i),e=i.outer,null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.inner.pop()),this.zpp_inner.invalidate(),null==i.outer&&(i.outer=new Cn,null!=(e=i.outer.zpp_inner).outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ip.zpp_pool,Ip.zpp_pool=e,i.outer.zpp_inner=i),i.outer},bi.prototype.remove=function(n){var t;this.zpp_inner.modify_test(),this.zpp_vm(),t=!1;for(var e=this.inner.next;null!=e;){if(n.zpp_inner==e){t=!0;break}e=e.next}return t&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),t},bi.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},bi.prototype.__class__=bi;var gi=zpp_nape.util.ZPP_ConstraintList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new kn,this._invalidated=!0};gi.__name__=["zpp_nape","util","ZPP_ConstraintList"],gi.get=function(n,t){null==t&&(t=!1);var e=new w;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},gi.prototype.outer=null,gi.prototype.inner=null,gi.prototype.immutable=null,gi.prototype._invalidated=null,gi.prototype._invalidate=null,gi.prototype._validate=null,gi.prototype._modifiable=null,gi.prototype.adder=null,gi.prototype.post_adder=null,gi.prototype.subber=null,gi.prototype.dontremove=null,gi.prototype.reverse_flag=null,gi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},gi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},gi.prototype.modify_test=function(){},gi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},gi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},gi.prototype.at_index=null,gi.prototype.at_ite=null,gi.prototype.push_ite=null,gi.prototype.zip_length=null,gi.prototype.user_length=null,gi.prototype.__class__=gi;var wi=zpp_nape.util.ZPP_BodyList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ve,this._invalidated=!0};wi.__name__=["zpp_nape","util","ZPP_BodyList"],wi.get=function(n,t){null==t&&(t=!1);var e=new nn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},wi.prototype.outer=null,wi.prototype.inner=null,wi.prototype.immutable=null,wi.prototype._invalidated=null,wi.prototype._invalidate=null,wi.prototype._validate=null,wi.prototype._modifiable=null,wi.prototype.adder=null,wi.prototype.post_adder=null,wi.prototype.subber=null,wi.prototype.dontremove=null,wi.prototype.reverse_flag=null,wi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},wi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},wi.prototype.modify_test=function(){},wi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},wi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},wi.prototype.at_index=null,wi.prototype.at_ite=null,wi.prototype.push_ite=null,wi.prototype.zip_length=null,wi.prototype.user_length=null,wi.prototype.__class__=wi;var Mi=zpp_nape.util.ZPP_InteractorList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new On,this._invalidated=!0};Mi.__name__=["zpp_nape","util","ZPP_InteractorList"],Mi.get=function(n,t){null==t&&(t=!1);var e=new an;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Mi.prototype.outer=null,Mi.prototype.inner=null,Mi.prototype.immutable=null,Mi.prototype._invalidated=null,Mi.prototype._invalidate=null,Mi.prototype._validate=null,Mi.prototype._modifiable=null,Mi.prototype.adder=null,Mi.prototype.post_adder=null,Mi.prototype.subber=null,Mi.prototype.dontremove=null,Mi.prototype.reverse_flag=null,Mi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Mi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Mi.prototype.modify_test=function(){},Mi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Mi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Mi.prototype.at_index=null,Mi.prototype.at_ite=null,Mi.prototype.push_ite=null,Mi.prototype.zip_length=null,Mi.prototype.user_length=null,Mi.prototype.__class__=Mi;var Ci=zpp_nape.util.ZPP_CompoundList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new me,this._invalidated=!0};Ci.__name__=["zpp_nape","util","ZPP_CompoundList"],Ci.get=function(n,t){null==t&&(t=!1);var e=new pn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ci.prototype.outer=null,Ci.prototype.inner=null,Ci.prototype.immutable=null,Ci.prototype._invalidated=null,Ci.prototype._invalidate=null,Ci.prototype._validate=null,Ci.prototype._modifiable=null,Ci.prototype.adder=null,Ci.prototype.post_adder=null,Ci.prototype.subber=null,Ci.prototype.dontremove=null,Ci.prototype.reverse_flag=null,Ci.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ci.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ci.prototype.modify_test=function(){},Ci.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ci.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ci.prototype.at_index=null,Ci.prototype.at_ite=null,Ci.prototype.push_ite=null,Ci.prototype.zip_length=null,Ci.prototype.user_length=null,Ci.prototype.__class__=Ci;var ki=zpp_nape.util.ZPP_ListenerList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Le,this._invalidated=!0};ki.__name__=["zpp_nape","util","ZPP_ListenerList"],ki.get=function(n,t){null==t&&(t=!1);var e=new c;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},ki.prototype.outer=null,ki.prototype.inner=null,ki.prototype.immutable=null,ki.prototype._invalidated=null,ki.prototype._invalidate=null,ki.prototype._validate=null,ki.prototype._modifiable=null,ki.prototype.adder=null,ki.prototype.post_adder=null,ki.prototype.subber=null,ki.prototype.dontremove=null,ki.prototype.reverse_flag=null,ki.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},ki.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},ki.prototype.modify_test=function(){},ki.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},ki.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},ki.prototype.at_index=null,ki.prototype.at_ite=null,ki.prototype.push_ite=null,ki.prototype.zip_length=null,ki.prototype.user_length=null,ki.prototype.__class__=ki;var Oi=zpp_nape.util.ZPP_CbTypeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new In,this._invalidated=!0};Oi.__name__=["zpp_nape","util","ZPP_CbTypeList"],Oi.get=function(n,t){null==t&&(t=!1);var e=new u;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Oi.prototype.outer=null,Oi.prototype.inner=null,Oi.prototype.immutable=null,Oi.prototype._invalidated=null,Oi.prototype._invalidate=null,Oi.prototype._validate=null,Oi.prototype._modifiable=null,Oi.prototype.adder=null,Oi.prototype.post_adder=null,Oi.prototype.subber=null,Oi.prototype.dontremove=null,Oi.prototype.reverse_flag=null,Oi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Oi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Oi.prototype.modify_test=function(){},Oi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Oi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Oi.prototype.at_index=null,Oi.prototype.at_ite=null,Oi.prototype.push_ite=null,Oi.prototype.zip_length=null,Oi.prototype.user_length=null,Oi.prototype.__class__=Oi;var Pi=zpp_nape.util.ZPP_Vec2List=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ut,this._invalidated=!0};Pi.__name__=["zpp_nape","util","ZPP_Vec2List"],Pi.get=function(n,t){null==t&&(t=!1);var e=new Y;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Pi.prototype.outer=null,Pi.prototype.inner=null,Pi.prototype.immutable=null,Pi.prototype._invalidated=null,Pi.prototype._invalidate=null,Pi.prototype._validate=null,Pi.prototype._modifiable=null,Pi.prototype.adder=null,Pi.prototype.post_adder=null,Pi.prototype.subber=null,Pi.prototype.dontremove=null,Pi.prototype.reverse_flag=null,Pi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Pi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Pi.prototype.modify_test=function(){},Pi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Pi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Pi.prototype.at_index=null,Pi.prototype.at_ite=null,Pi.prototype.push_ite=null,Pi.prototype.zip_length=null,Pi.prototype.user_length=null,Pi.prototype.__class__=Pi;var Si=zpp_nape.util.ZPP_GeomPolyList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Ze,this._invalidated=!0};Si.__name__=["zpp_nape","util","ZPP_GeomPolyList"],Si.get=function(n,t){null==t&&(t=!1);var e=new de;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Si.prototype.outer=null,Si.prototype.inner=null,Si.prototype.immutable=null,Si.prototype._invalidated=null,Si.prototype._invalidate=null,Si.prototype._validate=null,Si.prototype._modifiable=null,Si.prototype.adder=null,Si.prototype.post_adder=null,Si.prototype.subber=null,Si.prototype.dontremove=null,Si.prototype.reverse_flag=null,Si.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Si.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Si.prototype.modify_test=function(){},Si.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Si.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Si.prototype.at_index=null,Si.prototype.at_ite=null,Si.prototype.push_ite=null,Si.prototype.zip_length=null,Si.prototype.user_length=null,Si.prototype.__class__=Si;var Ai=zpp_nape.util.ZPP_RayResultList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Be,this._invalidated=!0};Ai.__name__=["zpp_nape","util","ZPP_RayResultList"],Ai.get=function(n,t){null==t&&(t=!1);var e=new W;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ai.prototype.outer=null,Ai.prototype.inner=null,Ai.prototype.immutable=null,Ai.prototype._invalidated=null,Ai.prototype._invalidate=null,Ai.prototype._validate=null,Ai.prototype._modifiable=null,Ai.prototype.adder=null,Ai.prototype.post_adder=null,Ai.prototype.subber=null,Ai.prototype.dontremove=null,Ai.prototype.reverse_flag=null,Ai.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ai.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ai.prototype.modify_test=function(){},Ai.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ai.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ai.prototype.at_index=null,Ai.prototype.at_ite=null,Ai.prototype.push_ite=null,Ai.prototype.zip_length=null,Ai.prototype.user_length=null,Ai.prototype.__class__=Ai;var ji=zpp_nape.util.ZPP_ConvexResultList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Re,this._invalidated=!0};ji.__name__=["zpp_nape","util","ZPP_ConvexResultList"],ji.get=function(n,t){null==t&&(t=!1);var e=new Mn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},ji.prototype.outer=null,ji.prototype.inner=null,ji.prototype.immutable=null,ji.prototype._invalidated=null,ji.prototype._invalidate=null,ji.prototype._validate=null,ji.prototype._modifiable=null,ji.prototype.adder=null,ji.prototype.post_adder=null,ji.prototype.subber=null,ji.prototype.dontremove=null,ji.prototype.reverse_flag=null,ji.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},ji.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},ji.prototype.modify_test=function(){},ji.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},ji.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},ji.prototype.at_index=null,ji.prototype.at_ite=null,ji.prototype.push_ite=null,ji.prototype.zip_length=null,ji.prototype.user_length=null,ji.prototype.__class__=ji;var Ei=zpp_nape.util.ZPP_EdgeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new je,this._invalidated=!0};Ei.__name__=["zpp_nape","util","ZPP_EdgeList"],Ei.get=function(n,t){null==t&&(t=!1);var e=new dn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ei.prototype.outer=null,Ei.prototype.inner=null,Ei.prototype.immutable=null,Ei.prototype._invalidated=null,Ei.prototype._invalidate=null,Ei.prototype._validate=null,Ei.prototype._modifiable=null,Ei.prototype.adder=null,Ei.prototype.post_adder=null,Ei.prototype.subber=null,Ei.prototype.dontremove=null,Ei.prototype.reverse_flag=null,Ei.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ei.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ei.prototype.modify_test=function(){},Ei.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ei.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ei.prototype.at_index=null,Ei.prototype.at_ite=null,Ei.prototype.push_ite=null,Ei.prototype.zip_length=null,Ei.prototype.user_length=null,Ei.prototype.__class__=Ei;var Ii=zpp_nape.util.ZPP_ShapeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ue,this._invalidated=!0};Ii.__name__=["zpp_nape","util","ZPP_ShapeList"],Ii.get=function(n,t){null==t&&(t=!1);var e=new zn;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ii.prototype.outer=null,Ii.prototype.inner=null,Ii.prototype.immutable=null,Ii.prototype._invalidated=null,Ii.prototype._invalidate=null,Ii.prototype._validate=null,Ii.prototype._modifiable=null,Ii.prototype.adder=null,Ii.prototype.post_adder=null,Ii.prototype.subber=null,Ii.prototype.dontremove=null,Ii.prototype.reverse_flag=null,Ii.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ii.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ii.prototype.modify_test=function(){},Ii.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ii.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ii.prototype.at_index=null,Ii.prototype.at_ite=null,Ii.prototype.push_ite=null,Ii.prototype.zip_length=null,Ii.prototype.user_length=null,Ii.prototype.__class__=Ii;var Ti=zpp_nape.util.ZPP_InteractionGroupList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new De,this._invalidated=!0};Ti.__name__=["zpp_nape","util","ZPP_InteractionGroupList"],Ti.get=function(n,t){null==t&&(t=!1);var e=new F;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ti.prototype.outer=null,Ti.prototype.inner=null,Ti.prototype.immutable=null,Ti.prototype._invalidated=null,Ti.prototype._invalidate=null,Ti.prototype._validate=null,Ti.prototype._modifiable=null,Ti.prototype.adder=null,Ti.prototype.post_adder=null,Ti.prototype.subber=null,Ti.prototype.dontremove=null,Ti.prototype.reverse_flag=null,Ti.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ti.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ti.prototype.modify_test=function(){},Ti.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ti.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ti.prototype.at_index=null,Ti.prototype.at_ite=null,Ti.prototype.push_ite=null,Ti.prototype.zip_length=null,Ti.prototype.user_length=null,Ti.prototype.__class__=Ti;var Ni=zpp_nape.util.ZPP_ArbiterList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new fe,this._invalidated=!0};Ni.__name__=["zpp_nape","util","ZPP_ArbiterList"],Ni.get=function(n,t){null==t&&(t=!1);var e=new j;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Ni.prototype.outer=null,Ni.prototype.inner=null,Ni.prototype.immutable=null,Ni.prototype._invalidated=null,Ni.prototype._invalidate=null,Ni.prototype._validate=null,Ni.prototype._modifiable=null,Ni.prototype.adder=null,Ni.prototype.post_adder=null,Ni.prototype.subber=null,Ni.prototype.dontremove=null,Ni.prototype.reverse_flag=null,Ni.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Ni.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Ni.prototype.modify_test=function(){},Ni.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Ni.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Ni.prototype.at_index=null,Ni.prototype.at_ite=null,Ni.prototype.push_ite=null,Ni.prototype.zip_length=null,Ni.prototype.user_length=null,Ni.prototype.__class__=Ni;var Li=zpp_nape.util.ZPP_ContactList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new $i,this._invalidated=!0};Li.__name__=["zpp_nape","util","ZPP_ContactList"],Li.get=function(n,t){null==t&&(t=!1);var e=new N;return e.zpp_inner.inner=n,t&&(e.zpp_inner.immutable=!0),e.zpp_inner.zip_length=!0,e},Li.prototype.outer=null,Li.prototype.inner=null,Li.prototype.immutable=null,Li.prototype._invalidated=null,Li.prototype._invalidate=null,Li.prototype._validate=null,Li.prototype._modifiable=null,Li.prototype.adder=null,Li.prototype.post_adder=null,Li.prototype.subber=null,Li.prototype.dontremove=null,Li.prototype.reverse_flag=null,Li.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Li.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Li.prototype.modify_test=function(){},Li.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Li.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Li.prototype.at_index=null,Li.prototype.at_ite=null,Li.prototype.push_ite=null,Li.prototype.zip_length=null,Li.prototype.user_length=null,Li.prototype.__class__=Li,(l=zpp_nape.util.ZPP_Math=function(){}).__name__=["zpp_nape","util","ZPP_Math"],l.sqrt=function(n){return Math.sqrt(n)},l.invsqrt=function(n){return 1/Math.sqrt(n)},l.sqr=function(n){return n*n},l.clamp2=function(n,t){var e=-t;return n<e?e:t<n?t:n},l.clamp=function(n,t,e){return n<t?t:e<n?e:n},l.prototype.__class__=l;var Vi=zpp_nape.util.ZPP_PubPool=function(){};Vi.__name__=["zpp_nape","util","ZPP_PubPool"],Vi.prototype.__class__=Vi;var Di=zpp_nape.util.ZPP_Set_ZPP_Body=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Di.__name__=["zpp_nape","util","ZPP_Set_ZPP_Body"],Di.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Di.prototype.alloc=function(){},Di.prototype.lt=null,Di.prototype.swapped=null,Di.prototype.data=null,Di.prototype.prev=null,Di.prototype.next=null,Di.prototype.parent=null,Di.prototype.colour=null,Di.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Di.prototype.empty=function(){return null==this.parent},Di.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Di.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Di.prototype.has=function(n){return null!=this.find(n)},Di.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Di.prototype.has_weak=function(n){return null!=this.find_weak(n)},Di.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Di.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Di.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Di.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Di.prototype.remove=function(n){this.remove_node(this.find(n))},Di.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Di.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Di.prototype.successor=function(n){n=this.successor_node(this.find(n));return null==n?null:n.data},Di.prototype.predecessor=function(n){n=this.predecessor_node(this.find(n));return null==n?null:n.data},Di.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}l=p.next;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}e=n.parent;null==e?this.parent=i:e.prev==n?e.prev=i:e.next=i,null!=i&&(i.parent=e),n.parent=n.prev=n.next=null;n.data=null,n.lt=null,n.swapped=null,n.next=Di.zpp_pool,Di.zpp_pool=n},Di.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;)e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Di.zpp_pool,Di.zpp_pool=t,n);this.parent=null}},Di.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Di.zpp_pool,Di.zpp_pool=e,t);this.parent=null}},Di.prototype.clear_node=function(n,t){t(n.data);t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Di.zpp_pool,Di.zpp_pool=n,t},Di.prototype.__fix_neg_red=function(n){var t,e,i,p,l=n.parent,r=l.prev==n?(p=n.prev,t=(i=n.next).prev,e=i.next,p.colour=0,n.colour=l.colour=1,null!=(n.next=t)&&(t.parent=n),t=l.data,l.data=i.data,i.data=t,null!=this.swapped&&this.swapped(l.data,i.data),null!=(i.prev=e)&&(e.parent=i),i.next=l.next,null!=l.next&&(l.next.parent=i),null!=(l.next=i)&&(i.parent=l),p):(r=n.next,i=(e=n.prev).next,p=e.prev,r.colour=0,n.colour=l.colour=1,null!=(n.prev=i)&&(i.parent=n),n=l.data,l.data=e.data,e.data=n,null!=this.swapped&&this.swapped(l.data,e.data),null!=(e.next=p)&&(p.parent=e),e.prev=l.prev,null!=l.prev&&(l.prev.parent=e),null!=(l.prev=e)&&(e.parent=l),r);null!=r.prev&&0==r.prev.colour?this.__fix_dbl_red(r.prev):null!=r.next&&0==r.next.colour&&this.__fix_dbl_red(r.next)},Di.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));a=s.parent;if(null==a?this.parent=e:a.prev==s?a.prev=e:a.next=e,null!=e&&(e.parent=a),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Di.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Di.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Di.prototype.insert=function(n){var t;if(null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Di.prototype.__class__=Di;var Fi=zpp_nape.util.ZPP_Set_ZPP_CbSetPair=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Fi.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSetPair"],Fi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Fi.prototype.alloc=function(){},Fi.prototype.lt=null,Fi.prototype.swapped=null,Fi.prototype.data=null,Fi.prototype.prev=null,Fi.prototype.next=null,Fi.prototype.parent=null,Fi.prototype.colour=null,Fi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Fi.prototype.empty=function(){return null==this.parent},Fi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Fi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Fi.prototype.has=function(n){return null!=this.find(n)},Fi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Fi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Fi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Fi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Fi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Fi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Fi.prototype.remove=function(n){this.remove_node(this.find(n))},Fi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Fi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Fi.prototype.successor=function(n){n=this.successor_node(this.find(n));return null==n?null:n.data},Fi.prototype.predecessor=function(n){n=this.predecessor_node(this.find(n));return null==n?null:n.data},Fi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}l=p.next;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}e=n.parent;null==e?this.parent=i:e.prev==n?e.prev=i:e.next=i,null!=i&&(i.parent=e),n.parent=n.prev=n.next=null;n.data=null,n.lt=null,n.swapped=null,n.next=Fi.zpp_pool,Fi.zpp_pool=n},Fi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;)e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Fi.zpp_pool,Fi.zpp_pool=t,n);this.parent=null}},Fi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Fi.zpp_pool,Fi.zpp_pool=e,t);this.parent=null}},Fi.prototype.clear_node=function(n,t){t(n.data);t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Fi.zpp_pool,Fi.zpp_pool=n,t},Fi.prototype.__fix_neg_red=function(n){var t,e,i,p,l=n.parent,r=l.prev==n?(p=n.prev,t=(i=n.next).prev,e=i.next,p.colour=0,n.colour=l.colour=1,null!=(n.next=t)&&(t.parent=n),t=l.data,l.data=i.data,i.data=t,null!=this.swapped&&this.swapped(l.data,i.data),null!=(i.prev=e)&&(e.parent=i),i.next=l.next,null!=l.next&&(l.next.parent=i),null!=(l.next=i)&&(i.parent=l),p):(r=n.next,i=(e=n.prev).next,p=e.prev,r.colour=0,n.colour=l.colour=1,null!=(n.prev=i)&&(i.parent=n),n=l.data,l.data=e.data,e.data=n,null!=this.swapped&&this.swapped(l.data,e.data),null!=(e.next=p)&&(p.parent=e),e.prev=l.prev,null!=l.prev&&(l.prev.parent=e),null!=(l.prev=e)&&(e.parent=l),r);null!=r.prev&&0==r.prev.colour?this.__fix_dbl_red(r.prev):null!=r.next&&0==r.next.colour&&this.__fix_dbl_red(r.next)},Fi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));a=s.parent;if(null==a?this.parent=e:a.prev==s?a.prev=e:a.next=e,null!=e&&(e.parent=a),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Fi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Fi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Fi.prototype.insert=function(n){var t;if(null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Fi.prototype.__class__=Fi;var Ri=zpp_nape.util.ZPP_Set_ZPP_PartitionVertex=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Ri.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionVertex"],Ri.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Ri.prototype.alloc=function(){},Ri.prototype.lt=null,Ri.prototype.swapped=null,Ri.prototype.data=null,Ri.prototype.prev=null,Ri.prototype.next=null,Ri.prototype.parent=null,Ri.prototype.colour=null,Ri.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Ri.prototype.empty=function(){return null==this.parent},Ri.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Ri.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Ri.prototype.has=function(n){return null!=this.find(n)},Ri.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Ri.prototype.has_weak=function(n){return null!=this.find_weak(n)},Ri.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Ri.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Ri.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Ri.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Ri.prototype.remove=function(n){this.remove_node(this.find(n))},Ri.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Ri.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Ri.prototype.successor=function(n){n=this.successor_node(this.find(n));return null==n?null:n.data},Ri.prototype.predecessor=function(n){n=this.predecessor_node(this.find(n));return null==n?null:n.data},Ri.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}l=p.next;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}e=n.parent;null==e?this.parent=i:e.prev==n?e.prev=i:e.next=i,null!=i&&(i.parent=e),n.parent=n.prev=n.next=null;n.data=null,n.lt=null,n.swapped=null,n.next=Ri.zpp_pool,Ri.zpp_pool=n},Ri.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;)e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Ri.zpp_pool,Ri.zpp_pool=t,n);this.parent=null}},Ri.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Ri.zpp_pool,Ri.zpp_pool=e,t);this.parent=null}},Ri.prototype.clear_node=function(n,t){t(n.data);t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Ri.zpp_pool,Ri.zpp_pool=n,t},Ri.prototype.__fix_neg_red=function(n){var t,e,i,p,l=n.parent,r=l.prev==n?(p=n.prev,t=(i=n.next).prev,e=i.next,p.colour=0,n.colour=l.colour=1,null!=(n.next=t)&&(t.parent=n),t=l.data,l.data=i.data,i.data=t,null!=this.swapped&&this.swapped(l.data,i.data),null!=(i.prev=e)&&(e.parent=i),i.next=l.next,null!=l.next&&(l.next.parent=i),null!=(l.next=i)&&(i.parent=l),p):(r=n.next,i=(e=n.prev).next,p=e.prev,r.colour=0,n.colour=l.colour=1,null!=(n.prev=i)&&(i.parent=n),n=l.data,l.data=e.data,e.data=n,null!=this.swapped&&this.swapped(l.data,e.data),null!=(e.next=p)&&(p.parent=e),e.prev=l.prev,null!=l.prev&&(l.prev.parent=e),null!=(l.prev=e)&&(e.parent=l),r);null!=r.prev&&0==r.prev.colour?this.__fix_dbl_red(r.prev):null!=r.next&&0==r.next.colour&&this.__fix_dbl_red(r.next)},Ri.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));a=s.parent;if(null==a?this.parent=e:a.prev==s?a.prev=e:a.next=e,null!=e&&(e.parent=a),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Ri.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Ri.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Ri.prototype.insert=function(n){var t;if(null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Ri.prototype.__class__=Ri;var Zi=zpp_nape.util.ZPP_Set_ZPP_PartitionPair=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Zi.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionPair"],Zi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Zi.prototype.alloc=function(){},Zi.prototype.lt=null,Zi.prototype.swapped=null,Zi.prototype.data=null,Zi.prototype.prev=null,Zi.prototype.next=null,Zi.prototype.parent=null,Zi.prototype.colour=null,Zi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Zi.prototype.empty=function(){return null==this.parent},Zi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Zi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Zi.prototype.has=function(n){return null!=this.find(n)},Zi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Zi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Zi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Zi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Zi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Zi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Zi.prototype.remove=function(n){this.remove_node(this.find(n))},Zi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Zi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Zi.prototype.successor=function(n){n=this.successor_node(this.find(n));return null==n?null:n.data},Zi.prototype.predecessor=function(n){n=this.predecessor_node(this.find(n));return null==n?null:n.data},Zi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}l=p.next;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}e=n.parent;null==e?this.parent=i:e.prev==n?e.prev=i:e.next=i,null!=i&&(i.parent=e),n.parent=n.prev=n.next=null;n.data=null,n.lt=null,n.swapped=null,n.next=Zi.zpp_pool,Zi.zpp_pool=n},Zi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;)e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Zi.zpp_pool,Zi.zpp_pool=t,n);this.parent=null}},Zi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Zi.zpp_pool,Zi.zpp_pool=e,t);this.parent=null}},Zi.prototype.clear_node=function(n,t){t(n.data);t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Zi.zpp_pool,Zi.zpp_pool=n,t},Zi.prototype.__fix_neg_red=function(n){var t,e,i,p,l=n.parent,r=l.prev==n?(p=n.prev,t=(i=n.next).prev,e=i.next,p.colour=0,n.colour=l.colour=1,null!=(n.next=t)&&(t.parent=n),t=l.data,l.data=i.data,i.data=t,null!=this.swapped&&this.swapped(l.data,i.data),null!=(i.prev=e)&&(e.parent=i),i.next=l.next,null!=l.next&&(l.next.parent=i),null!=(l.next=i)&&(i.parent=l),p):(r=n.next,i=(e=n.prev).next,p=e.prev,r.colour=0,n.colour=l.colour=1,null!=(n.prev=i)&&(i.parent=n),n=l.data,l.data=e.data,e.data=n,null!=this.swapped&&this.swapped(l.data,e.data),null!=(e.next=p)&&(p.parent=e),e.prev=l.prev,null!=l.prev&&(l.prev.parent=e),null!=(l.prev=e)&&(e.parent=l),r);null!=r.prev&&0==r.prev.colour?this.__fix_dbl_red(r.prev):null!=r.next&&0==r.next.colour&&this.__fix_dbl_red(r.next)},Zi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));a=s.parent;if(null==a?this.parent=e:a.prev==s?a.prev=e:a.next=e,null!=e&&(e.parent=a),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Zi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Zi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Zi.prototype.insert=function(n){var t;if(null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Zi.prototype.__class__=Zi;var Bi=zpp_nape.util.ZPP_Set_ZPP_SimpleVert=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Bi.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleVert"],Bi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Bi.prototype.alloc=function(){},Bi.prototype.lt=null,Bi.prototype.swapped=null,Bi.prototype.data=null,Bi.prototype.prev=null,Bi.prototype.next=null,Bi.prototype.parent=null,Bi.prototype.colour=null,Bi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Bi.prototype.empty=function(){return null==this.parent},Bi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Bi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Bi.prototype.has=function(n){return null!=this.find(n)},Bi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Bi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Bi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Bi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Bi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Bi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Bi.prototype.remove=function(n){this.remove_node(this.find(n))},Bi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Bi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Bi.prototype.successor=function(n){n=this.successor_node(this.find(n));return null==n?null:n.data},Bi.prototype.predecessor=function(n){n=this.predecessor_node(this.find(n));return null==n?null:n.data},Bi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}l=p.next;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}e=n.parent;null==e?this.parent=i:e.prev==n?e.prev=i:e.next=i,null!=i&&(i.parent=e),n.parent=n.prev=n.next=null;n.data=null,n.lt=null,n.swapped=null,n.next=Bi.zpp_pool,Bi.zpp_pool=n},Bi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;)e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Bi.zpp_pool,Bi.zpp_pool=t,n);this.parent=null}},Bi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Bi.zpp_pool,Bi.zpp_pool=e,t);this.parent=null}},Bi.prototype.clear_node=function(n,t){t(n.data);t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Bi.zpp_pool,Bi.zpp_pool=n,t},Bi.prototype.__fix_neg_red=function(n){var t,e,i,p,l=n.parent,r=l.prev==n?(p=n.prev,t=(i=n.next).prev,e=i.next,p.colour=0,n.colour=l.colour=1,null!=(n.next=t)&&(t.parent=n),t=l.data,l.data=i.data,i.data=t,null!=this.swapped&&this.swapped(l.data,i.data),null!=(i.prev=e)&&(e.parent=i),i.next=l.next,null!=l.next&&(l.next.parent=i),null!=(l.next=i)&&(i.parent=l),p):(r=n.next,i=(e=n.prev).next,p=e.prev,r.colour=0,n.colour=l.colour=1,null!=(n.prev=i)&&(i.parent=n),n=l.data,l.data=e.data,e.data=n,null!=this.swapped&&this.swapped(l.data,e.data),null!=(e.next=p)&&(p.parent=e),e.prev=l.prev,null!=l.prev&&(l.prev.parent=e),null!=(l.prev=e)&&(e.parent=l),r);null!=r.prev&&0==r.prev.colour?this.__fix_dbl_red(r.prev):null!=r.next&&0==r.next.colour&&this.__fix_dbl_red(r.next)},Bi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));a=s.parent;if(null==a?this.parent=e:a.prev==s?a.prev=e:a.next=e,null!=e&&(e.parent=a),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Bi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Bi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Bi.prototype.insert=function(n){var t;if(null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Bi.prototype.__class__=Bi;var Gi=zpp_nape.util.ZPP_Set_ZPP_SimpleSeg=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};Gi.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleSeg"],Gi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},Gi.prototype.alloc=function(){},Gi.prototype.lt=null,Gi.prototype.swapped=null,Gi.prototype.data=null,Gi.prototype.prev=null,Gi.prototype.next=null,Gi.prototype.parent=null,Gi.prototype.colour=null,Gi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},Gi.prototype.empty=function(){return null==this.parent},Gi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},Gi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},Gi.prototype.has=function(n){return null!=this.find(n)},Gi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},Gi.prototype.has_weak=function(n){return null!=this.find_weak(n)},Gi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},Gi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},Gi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},Gi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},Gi.prototype.remove=function(n){this.remove_node(this.find(n))},Gi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},Gi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},Gi.prototype.successor=function(n){n=this.successor_node(this.find(n));return null==n?null:n.data},Gi.prototype.predecessor=function(n){n=this.predecessor_node(this.find(n));return null==n?null:n.data},Gi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}l=p.next;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}e=n.parent;null==e?this.parent=i:e.prev==n?e.prev=i:e.next=i,null!=i&&(i.parent=e),n.parent=n.prev=n.next=null;n.data=null,n.lt=null,n.swapped=null,n.next=Gi.zpp_pool,Gi.zpp_pool=n},Gi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;)e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=Gi.zpp_pool,Gi.zpp_pool=t,n);this.parent=null}},Gi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=Gi.zpp_pool,Gi.zpp_pool=e,t);this.parent=null}},Gi.prototype.clear_node=function(n,t){t(n.data);t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=Gi.zpp_pool,Gi.zpp_pool=n,t},Gi.prototype.__fix_neg_red=function(n){var t,e,i,p,l=n.parent,r=l.prev==n?(p=n.prev,t=(i=n.next).prev,e=i.next,p.colour=0,n.colour=l.colour=1,null!=(n.next=t)&&(t.parent=n),t=l.data,l.data=i.data,i.data=t,null!=this.swapped&&this.swapped(l.data,i.data),null!=(i.prev=e)&&(e.parent=i),i.next=l.next,null!=l.next&&(l.next.parent=i),null!=(l.next=i)&&(i.parent=l),p):(r=n.next,i=(e=n.prev).next,p=e.prev,r.colour=0,n.colour=l.colour=1,null!=(n.prev=i)&&(i.parent=n),n=l.data,l.data=e.data,e.data=n,null!=this.swapped&&this.swapped(l.data,e.data),null!=(e.next=p)&&(p.parent=e),e.prev=l.prev,null!=l.prev&&(l.prev.parent=e),null!=(l.prev=e)&&(e.parent=l),r);null!=r.prev&&0==r.prev.colour?this.__fix_dbl_red(r.prev):null!=r.next&&0==r.next.colour&&this.__fix_dbl_red(r.next)},Gi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));a=s.parent;if(null==a?this.parent=e:a.prev==s?a.prev=e:a.next=e,null!=e&&(e.parent=a),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},Gi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},Gi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},Gi.prototype.insert=function(n){var t;if(null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},Gi.prototype.__class__=Gi;var qi=zpp_nape.util.ZPP_Set_ZPP_SimpleEvent=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};qi.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleEvent"],qi.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},qi.prototype.alloc=function(){},qi.prototype.lt=null,qi.prototype.swapped=null,qi.prototype.data=null,qi.prototype.prev=null,qi.prototype.next=null,qi.prototype.parent=null,qi.prototype.colour=null,qi.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},qi.prototype.empty=function(){return null==this.parent},qi.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},qi.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},qi.prototype.has=function(n){return null!=this.find(n)},qi.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},qi.prototype.has_weak=function(n){return null!=this.find_weak(n)},qi.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},qi.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},qi.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},qi.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},qi.prototype.remove=function(n){this.remove_node(this.find(n))},qi.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},qi.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},qi.prototype.successor=function(n){n=this.successor_node(this.find(n));return null==n?null:n.data},qi.prototype.predecessor=function(n){n=this.predecessor_node(this.find(n));return null==n?null:n.data},qi.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}l=p.next;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}e=n.parent;null==e?this.parent=i:e.prev==n?e.prev=i:e.next=i,null!=i&&(i.parent=e),n.parent=n.prev=n.next=null;n.data=null,n.lt=null,n.swapped=null,n.next=qi.zpp_pool,qi.zpp_pool=n},qi.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;)e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=qi.zpp_pool,qi.zpp_pool=t,n);this.parent=null}},qi.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=qi.zpp_pool,qi.zpp_pool=e,t);this.parent=null}},qi.prototype.clear_node=function(n,t){t(n.data);t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=qi.zpp_pool,qi.zpp_pool=n,t},qi.prototype.__fix_neg_red=function(n){var t,e,i,p,l=n.parent,r=l.prev==n?(p=n.prev,t=(i=n.next).prev,e=i.next,p.colour=0,n.colour=l.colour=1,null!=(n.next=t)&&(t.parent=n),t=l.data,l.data=i.data,i.data=t,null!=this.swapped&&this.swapped(l.data,i.data),null!=(i.prev=e)&&(e.parent=i),i.next=l.next,null!=l.next&&(l.next.parent=i),null!=(l.next=i)&&(i.parent=l),p):(r=n.next,i=(e=n.prev).next,p=e.prev,r.colour=0,n.colour=l.colour=1,null!=(n.prev=i)&&(i.parent=n),n=l.data,l.data=e.data,e.data=n,null!=this.swapped&&this.swapped(l.data,e.data),null!=(e.next=p)&&(p.parent=e),e.prev=l.prev,null!=l.prev&&(l.prev.parent=e),null!=(l.prev=e)&&(e.parent=l),r);null!=r.prev&&0==r.prev.colour?this.__fix_dbl_red(r.prev):null!=r.next&&0==r.next.colour&&this.__fix_dbl_red(r.next)},qi.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));a=s.parent;if(null==a?this.parent=e:a.prev==s?a.prev=e:a.next=e,null!=e&&(e.parent=a),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},qi.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},qi.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},qi.prototype.insert=function(n){var t;if(null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},qi.prototype.__class__=qi;var op=zpp_nape.util.ZPP_Set_ZPP_CbSet=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};op.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSet"],op.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},op.prototype.alloc=function(){},op.prototype.lt=null,op.prototype.swapped=null,op.prototype.data=null,op.prototype.prev=null,op.prototype.next=null,op.prototype.parent=null,op.prototype.colour=null,op.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var t=n.data,e=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(e){if(t==p)e=!1;else if(!this.lt(p,t)&&this.lt(t,p))return!1}else if(!this.lt(t,p)&&this.lt(p,t))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},op.prototype.empty=function(){return null==this.parent},op.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},op.prototype.size=function(){var n=0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;)if(++n,null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}return n},op.prototype.has=function(n){return null!=this.find(n)},op.prototype.find=function(n){for(var t=this.parent;null!=t&&t.data!=n;)t=this.lt(n,t.data)?t.prev:t.next;return t},op.prototype.has_weak=function(n){return null!=this.find_weak(n)},op.prototype.find_weak=function(n){for(var t=this.parent;null!=t;)if(this.lt(n,t.data))t=t.prev;else{if(!this.lt(t.data,n))break;t=t.next}return t},op.prototype.lower_bound=function(n){var t=null;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){var i=e.data;if(!this.lt(i,n)){t=i;break}if(null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return t},op.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},op.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var t=n.data;return this.remove_node(n),t},op.prototype.remove=function(n){this.remove_node(this.find(n))},op.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var t=n;for(n=n.parent;null!=n&&n.prev!=t;)n=(t=n).parent}return n},op.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var t=n;for(n=n.parent;null!=n&&n.next!=t;)n=(t=n).parent}return n},op.prototype.successor=function(n){n=this.successor_node(this.find(n));return null==n?null:n.data},op.prototype.predecessor=function(n){n=this.predecessor_node(this.find(n));return null==n?null:n.data},op.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var t=n.next;null!=t.prev;)t=t.prev;var e=n.data;n.data=t.data,t.data=e,null!=this.swapped&&this.swapped(n.data,t.data),n=t}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}l=p.next;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}e=n.parent;null==e?this.parent=i:e.prev==n?e.prev=i:e.next=i,null!=i&&(i.parent=e),n.parent=n.prev=n.next=null;n.data=null,n.lt=null,n.swapped=null,n.next=op.zpp_pool,op.zpp_pool=n},op.prototype.clear=function(){if(null!=this.parent){for(var n,t,e=this.parent;null!=e;)e=null!=e.prev?e.prev:null!=e.next?e.next:(null!=(n=e.parent)&&(e==n.prev?n.prev=null:n.next=null,e.parent=null),(t=e).data=null,t.lt=null,t.swapped=null,t.next=op.zpp_pool,op.zpp_pool=t,n);this.parent=null}},op.prototype.clear_with=function(n){if(null!=this.parent){for(var t,e,i=this.parent;null!=i;)i=null!=i.prev?i.prev:null!=i.next?i.next:(n(i.data),null!=(t=i.parent)&&(i==t.prev?t.prev=null:t.next=null,i.parent=null),(e=i).data=null,e.lt=null,e.swapped=null,e.next=op.zpp_pool,op.zpp_pool=e,t);this.parent=null}},op.prototype.clear_node=function(n,t){t(n.data);t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=op.zpp_pool,op.zpp_pool=n,t},op.prototype.__fix_neg_red=function(n){var t,e,i,p,l=n.parent,r=l.prev==n?(p=n.prev,t=(i=n.next).prev,e=i.next,p.colour=0,n.colour=l.colour=1,null!=(n.next=t)&&(t.parent=n),t=l.data,l.data=i.data,i.data=t,null!=this.swapped&&this.swapped(l.data,i.data),null!=(i.prev=e)&&(e.parent=i),i.next=l.next,null!=l.next&&(l.next.parent=i),null!=(l.next=i)&&(i.parent=l),p):(r=n.next,i=(e=n.prev).next,p=e.prev,r.colour=0,n.colour=l.colour=1,null!=(n.prev=i)&&(i.parent=n),n=l.data,l.data=e.data,e.data=n,null!=this.swapped&&this.swapped(l.data,e.data),null!=(e.next=p)&&(p.parent=e),e.prev=l.prev,null!=l.prev&&(l.prev.parent=e),null!=(l.prev=e)&&(e.parent=l),r);null!=r.prev&&0==r.prev.colour?this.__fix_dbl_red(r.prev):null!=r.next&&0==r.next.colour&&this.__fix_dbl_red(r.next)},op.prototype.__fix_dbl_red=function(n){for(;;){var t,e,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(o=(i=s).next,r=n==a.prev?(e=a,p=(t=n).prev,l=n.next,a.next):(e=n,p=(t=a).prev,l=n.prev,n.next)):(p=(t=s).prev,o=n==a.prev?(i=a,l=(e=n).prev,r=n.next,a.next):(i=n,l=(e=a).prev,r=n.prev,n.next));a=s.parent;if(null==a?this.parent=e:a.prev==s?a.prev=e:a.next=e,null!=e&&(e.parent=a),null!=(t.prev=p)&&(p.parent=t),null!=(t.next=l)&&(l.parent=t),null!=(e.prev=t)&&(t.parent=e),null!=(e.next=i)&&(i.parent=e),null!=(i.prev=r)&&(r.parent=i),null!=(i.next=o)&&(o.parent=i),e.colour=s.colour-1,t.colour=1,i.colour=1,e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){n=e;continue}break}},op.prototype.try_insert_bool=function(n){var t=null,e=null;if(null==this.parent)null==op.zpp_pool?t=new op:(t=op.zpp_pool,op.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==op.zpp_pool?t=new op:(t=op.zpp_pool,op.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==op.zpp_pool?t=new op:(t=op.zpp_pool,op.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null!=t&&(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),!0)},op.prototype.try_insert=function(n){var t=null,e=null;if(null==this.parent)null==op.zpp_pool?t=new op:(t=op.zpp_pool,op.zpp_pool=t.next,t.next=null),t.data=n,this.parent=t;else for(e=this.parent;;)if(this.lt(n,e.data)){if(null==e.prev){null==op.zpp_pool?t=new op:(t=op.zpp_pool,op.zpp_pool=t.next,t.next=null),t.data=n,(e.prev=t).parent=e;break}e=e.prev}else{if(!this.lt(e.data,n))break;if(null==e.next){null==op.zpp_pool?t=new op:(t=op.zpp_pool,op.zpp_pool=t.next,t.next=null),t.data=n,(e.next=t).parent=e;break}e=e.next}return null==t?e:(null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t)},op.prototype.insert=function(n){var t;if(null==op.zpp_pool?t=new op:(t=op.zpp_pool,op.zpp_pool=t.next,t.next=null),t.data=n,null==this.parent)this.parent=t;else for(var e=this.parent;;)if(this.lt(t.data,e.data)){if(null==e.prev){(e.prev=t).parent=e;break}e=e.prev}else{if(null==e.next){(e.next=t).parent=e;break}e=e.next}return null==t.parent?t.colour=1:(t.colour=0)==t.parent.colour&&this.__fix_dbl_red(t),t},op.prototype.__class__=op,String.prototype.__class__=String,String.__name__=!0,Array.__name__=!0;var ap={__name__:["Int"]},sp={__name__:["Dynamic"]},_p=Number;_p.__name__=["Float"];var hp=Boolean;hp.__ename__=["Bool"];var up={__name__:["Class"]},xp={};D.__toStr={}.toString,jp.epsilon=1e-8,jp.fluidAngularDragFriction=2.5,jp.fluidAngularDrag=100,jp.fluidVacuumDrag=.5,jp.fluidLinearDrag=.5,jp.collisionSlop=.2,jp.collisionSlopCCD=.5,jp.distanceThresholdCCD=.05,jp.staticCCDLinearThreshold=.05,jp.staticCCDAngularThreshold=.005,jp.bulletCCDLinearThreshold=.125,jp.bulletCCDAngularThreshold=.0125,jp.dynamicSweepLinearThreshold=17,jp.dynamicSweepAngularThreshold=.6,jp.angularCCDSlipScale=.75,jp.arbiterExpirationDelay=6,jp.staticFrictionThreshold=2,jp.elasticThreshold=20,jp.sleepDelay=60,jp.linearSleepThreshold=.2,jp.angularSleepThreshold=.4,jp.contactBiasCoef=.3,jp.contactStaticBiasCoef=.6,jp.contactContinuousBiasCoef=.4,jp.contactContinuousStaticBiasCoef=.5,jp.constraintLinearSlop=.1,jp.constraintAngularSlop=.001,jp.illConditionedThreshold=2e8,qn.zpp_pool=null,Un.zpp_pool=null,Kn.zpp_pool=null,Wn.zpp_pool=null,Yn.zpp_pool=null,Jn.zpp_pool=null,Xn.zpp_pool=null,Hn.zpp_pool=null,$n.zpp_pool=null,Qn.zpp_pool=null,nt.zpp_pool=null,tt.zpp_pool=null,et.zpp_pool=null,it.zpp_pool=null,pt.zpp_pool=null,y.FMAX=1e100,fn._Constraint=0,fn._Interactor=0,fn._CbType=0,fn._CbSet=0,fn._Listener=0,fn._ZPP_SimpleVert=0,fn._ZPP_SimpleSeg=0,fn._Space=0,fn._InteractionGroup=0,lt.zpp_pool=null,Ki.zpp_pool=null,Wi.zpp_pool=null,Sn.ANY_SHAPE=new h,Sn.ANY_BODY=new h,Sn.ANY_COMPOUND=new h,Sn.ANY_CONSTRAINT=new h,Yi.internal=!1,Yi.id_ImmState_ACCEPT=1,Yi.id_ImmState_IGNORE=2,Yi.id_ImmState_ALWAYS=4,Yi.id_GravMassMode_DEFAULT=0,Yi.id_GravMassMode_FIXED=1,Yi.id_GravMassMode_SCALED=2,Yi.id_InertiaMode_DEFAULT=0,Yi.id_InertiaMode_FIXED=1,Yi.id_MassMode_DEFAULT=0,Yi.id_MassMode_FIXED=1,Yi.id_BodyType_STATIC=1,Yi.id_BodyType_DYNAMIC=2,Yi.id_BodyType_KINEMATIC=3,Yi.id_ListenerType_BODY=0,Yi.id_PreFlag_ACCEPT=1,Yi.id_ListenerType_CONSTRAINT=1,Yi.id_PreFlag_IGNORE=2,Yi.id_ListenerType_INTERACTION=2,Yi.id_PreFlag_ACCEPT_ONCE=3,Yi.id_ListenerType_PRE=3,Yi.id_PreFlag_IGNORE_ONCE=4,Yi.id_CbEvent_BEGIN=0,Yi.id_InteractionType_COLLISION=1,Yi.id_CbEvent_ONGOING=6,Yi.id_InteractionType_SENSOR=2,Yi.id_CbEvent_END=1,Yi.id_InteractionType_FLUID=4,Yi.id_CbEvent_WAKE=2,Yi.id_InteractionType_ANY=7,Yi.id_CbEvent_SLEEP=3,Yi.id_CbEvent_BREAK=4,Yi.id_CbEvent_PRE=5,Yi.id_Winding_UNDEFINED=0,Yi.id_Winding_CLOCKWISE=1,Yi.id_Winding_ANTICLOCKWISE=2,Yi.id_ValidationResult_VALID=0,Yi.id_ValidationResult_DEGENERATE=1,Yi.id_ValidationResult_CONCAVE=2,Yi.id_ValidationResult_SELF_INTERSECTING=3,Yi.id_ShapeType_CIRCLE=0,Yi.id_ShapeType_POLYGON=1,Yi.id_Broadphase_DYNAMIC_AABB_TREE=0,Yi.id_Broadphase_SWEEP_AND_PRUNE=1,Yi.id_ArbiterType_COLLISION=1,Yi.id_ArbiterType_SENSOR=2,Yi.id_ArbiterType_FLUID=4,An.types=function(){null==Yi.ListenerType_BODY&&(Yi.internal=!0,Yi.ListenerType_BODY=new v,Yi.internal=!1);var n=Yi.ListenerType_BODY;null==Yi.ListenerType_CONSTRAINT&&(Yi.internal=!0,Yi.ListenerType_CONSTRAINT=new v,Yi.internal=!1);var t=Yi.ListenerType_CONSTRAINT;null==Yi.ListenerType_INTERACTION&&(Yi.internal=!0,Yi.ListenerType_INTERACTION=new v,Yi.internal=!1);var e=Yi.ListenerType_INTERACTION;return null==Yi.ListenerType_PRE&&(Yi.internal=!0,Yi.ListenerType_PRE=new v,Yi.internal=!1),[n,t,e,Yi.ListenerType_PRE]}(),An.events=function(){null==Yi.CbEvent_BEGIN&&(Yi.internal=!0,Yi.CbEvent_BEGIN=new _,Yi.internal=!1);var n=Yi.CbEvent_BEGIN;null==Yi.CbEvent_END&&(Yi.internal=!0,Yi.CbEvent_END=new _,Yi.internal=!1);var t=Yi.CbEvent_END;null==Yi.CbEvent_WAKE&&(Yi.internal=!0,Yi.CbEvent_WAKE=new _,Yi.internal=!1);var e=Yi.CbEvent_WAKE;null==Yi.CbEvent_SLEEP&&(Yi.internal=!0,Yi.CbEvent_SLEEP=new _,Yi.internal=!1);var i=Yi.CbEvent_SLEEP;null==Yi.CbEvent_BREAK&&(Yi.internal=!0,Yi.CbEvent_BREAK=new _,Yi.internal=!1);var p=Yi.CbEvent_BREAK;null==Yi.CbEvent_PRE&&(Yi.internal=!0,Yi.CbEvent_PRE=new _,Yi.internal=!1);var l=Yi.CbEvent_PRE;return null==Yi.CbEvent_ONGOING&&(Yi.internal=!0,Yi.CbEvent_ONGOING=new _,Yi.internal=!1),[n,t,e,i,p,l,Yi.CbEvent_ONGOING]}(),Dt.UCbSet=new Pn,Dt.VCbSet=new Pn,Dt.WCbSet=new Pn,Dt.UCbType=new In,Dt.VCbType=new In,Dt.WCbType=new In,Qt.internal=!1,Qt.COL=1,Qt.FLUID=4,Qt.SENSOR=2,Qt.types=function(){null==Yi.ArbiterType_COLLISION&&(Yi.internal=!0,Yi.ArbiterType_COLLISION=new E,Yi.internal=!1);var n=Yi.ArbiterType_COLLISION;null==Yi.ArbiterType_SENSOR&&(Yi.internal=!0,Yi.ArbiterType_SENSOR=new E,Yi.internal=!1);var t=Yi.ArbiterType_SENSOR;return null==Yi.ArbiterType_FLUID&&(Yi.internal=!0,Yi.ArbiterType_FLUID=new E,Yi.internal=!1),[null,n,t,null,Yi.ArbiterType_FLUID]}(),Ji.zpp_pool=null,Xi.zpp_pool=null,Hi.FACE1=0,Hi.FACE2=1,Hi.CIRCLE=2,Hi.zpp_pool=null,$i.internal=!1,$i.zpp_pool=null,st.zpp_pool=null,_t.SHAPE=1,_t.BODY=2,Lt.zpp_pool=null,Ep.flowpoly=new ut,Ep.flowsegs=new ut,dt.convexPool=null,dt.rayPool=null,dt.internal=!1,ye.zpp_pool=null,ze.zpp_pool=null,ce.ints=null,ce.paths=null,ii.zpp_pool=null,ct.zpp_pool=null,vt.zpp_pool=null,pi.zpp_pool=null,li.me=new li,li.look_march=[-1,224,56,216,14,-1,54,214,131,99,-1,91,141,109,181,85],mt.zpp_pool=null,bt.queue=null,bt.edges=null,gt.nextId=0,gt.zpp_pool=null,wt.zpp_pool=null,Ct.zpp_pool=null,kt.zpp_pool=null,Ot.zpp_pool=null,St.sweep=null,St.inthash=null,St.vertices=null,St.queue=null,St.ints=null,St.list_vertices=null,St.list_queue=null,At.zpp_pool=null,jt.zpp_pool=null,Et.stack=null,It.zpp_pool=null,Nt.zpp_pool=null,Vt.queue=null,Vt.stack=null,Vt.edgeSet=null,Ip.zpp_pool=null,Rt.types=function(){null==Yi.BodyType_STATIC&&(Yi.internal=!0,Yi.BodyType_STATIC=new tn,Yi.internal=!1);var n=Yi.BodyType_STATIC;null==Yi.BodyType_DYNAMIC&&(Yi.internal=!0,Yi.BodyType_DYNAMIC=new tn,Yi.internal=!1);var t=Yi.BodyType_DYNAMIC;return null==Yi.BodyType_KINEMATIC&&(Yi.internal=!0,Yi.BodyType_KINEMATIC=new tn,Yi.internal=!1),[null,n,t,Yi.BodyType_KINEMATIC]}(),Rt.bodystack=null,Rt.bodyset=null,Rt.cur_graph_depth=0,Bt.zpp_pool=null,Gt.zpp_pool=null,Gt.WAKE=1,Gt.PROPS=2,Gt.ANGDRAG=4,Gt.ARBITERS=8,qt.types=function(){null==Yi.ShapeType_CIRCLE&&(Yi.internal=!0,Yi.ShapeType_CIRCLE=new cn,Yi.internal=!1);var n=Yi.ShapeType_CIRCLE;return null==Yi.ShapeType_POLYGON&&(Yi.internal=!0,Yi.ShapeType_POLYGON=new cn,Yi.internal=!1),[n,Yi.ShapeType_POLYGON]}(),Kt.zpp_pool=null,Kt.internal=!1,Jt.zpp_pool=null,Xt.zpp_pool=null,Ht.tmpaabb=new Lt,$t.FATTEN=3,$t.VEL_STEPS=2,ne.zpp_pool=null,te.zpp_pool=null,np.zpp_pool=null,pe.zpp_pool=null,se.zpp_pool=null,Ge.zpp_pool=null,qe.zpp_pool=null,Ue.zpp_pool=null,Ke.zpp_pool=null,We.zpp_pool=null,Ye.zpp_pool=null,tp.zpp_pool=null,ep.zpp_pool=null,Je.zpp_pool=null,ip.zpp_pool=null,Xe.zpp_pool=null,He.zpp_pool=null,$e.zpp_pool=null,Qe.zpp_pool=null,ni.zpp_pool=null,ti.zpp_pool=null,ei.zpp_pool=null,ri.zpp_pool=null,oi.zpp_pool=null,ai.zpp_pool=null,si.zpp_pool=null,_i.zpp_pool=null,hi.zpp_pool=null,ui.zpp_pool=null,xi.zpp_pool=null,di.zpp_pool=null,pp.zpp_pool=null,lp.zpp_pool=null,yi.zpp_pool=null,rp.zpp_pool=null,zi.zpp_pool=null,ci.zpp_pool=null,vi.zpp_pool=null,mi.zpp_pool=null,fi.zpp_pool=null,gi.internal=!1,wi.internal=!1,Mi.internal=!1,Ci.internal=!1,ki.internal=!1,Oi.internal=!1,Pi.internal=!1,Si.internal=!1,Ai.internal=!1,ji.internal=!1,Ei.internal=!1,Ii.internal=!1,Ti.internal=!1,Ni.internal=!1,Li.internal=!1,Vi.poolGeomPoly=null,Vi.poolVec2=null,Vi.poolVec3=null,Di.zpp_pool=null,Fi.zpp_pool=null,Ri.zpp_pool=null,Zi.zpp_pool=null,Bi.zpp_pool=null,Gi.zpp_pool=null,qi.zpp_pool=null,op.zpp_pool=null,x.main()}();